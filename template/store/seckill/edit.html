<!DOCTYPE html>
<html>
    <head>

        {include file="public/header.html"}
        <style type="text/css">

        </style>
    </head>
    <body class="hold-transition skin-blue sidebar-mini">
        <div class="wrapper">

            {include file="public/title.html"}
            <!-- Left side column. contains the logo and sidebar -->
            {include file="public/menu.html"}

            <!-- Content Wrapper. Contains page content -->
            <div class="content-wrapper">
                <section class="content-header">
                    <h1>
                        限时秒杀
                    </h1>
                    <ol class="breadcrumb">
                        <li><a href="store.php?app=default&act=index&lang_id={$lang_id}"><i class="fa fa-dashboard"></i> 首页</a></li>
                        <li><a href="#">促销管理</a></li>
                        <li class="active">限时秒杀</li>
                    </ol>
                </section>
                <!-- Main content -->
                <section class="content">
                    <!-- /.row -->
                    <form class="form-horizontal" action="?app=seckill&act=doSecAdd&lang_id={$lang_id}"  data-type="ajax" method="post">
                        <div class="row">
                            <div class="col-xs-12">
                                <div class="box box-primary pb20">
                                    <div class="box-header">
                                        <div class="col-sm-1 col-md-1 no-padding pull-right">
                                            <a class="btn btn-primary pull-right btn-sm" href="?app=seckill&act=seckillList&lang_id={$lang_id}&p={$p}"><i class="fa fa-plus"></i> 返回</a>
                                        </div>
                                    </div>

                                    <div class="form-horizontal">
                                        <div class="box-body">
                                            <div class="form-group">
                                                <label class="col-sm-5 col-md-3  col-lg-3 control-label"><span class="text-red">*</span> 活动名称：</label>
                                                <div class="col-sm-7 col-md-6 col-lg-5">
                                                    <input type="text" class="form-control" placeholder="" name="name" value="{$info.name}" >
                                                    <input type="hidden"  name="id" value="{$info.id}" >
                                                    <input type="hidden"  name="p" value="{$p}" >
                                                </div>
                                            </div>
                                            <div class="form-group">
                                                <label class="col-sm-5 col-md-3  col-lg-3 control-label"><span class="text-red">*</span> 开始时间：</label>
                                                <div class="col-sm-7 col-md-6 col-lg-5">
                                                    <input type="text" value="{$info.start_time|date_format:"%Y-%m-%d"}" class="form-control w174 inblock" placeholder="" id="datepicker1" name="start_time" readonly>
                                                    <label class="">结束时间：</label>
                                                    <input type="text" value="{$info.end_time|date_format:"%Y-%m-%d"}" class="form-control w174 inblock" placeholder="" id="datepicker2" name="end_time" readonly>
                                                </div>
                                            </div>
                                            <div class="form-group">
                                                <label class="col-sm-5 col-md-3  col-lg-3 control-label"><span class="text-red">*</span> 开始小时：</label>
                                                <div class="col-sm-7 col-md-6 col-lg-5">
                                                    <input type="text"  value="{$info.start_our}" class="form-control w174 inblock" placeholder="" id="datepicker3" name="start_our" readonly>
                                                    <label class="">结束小时：</label>
                                                    <input type="text" value="{$info.end_our}" class="form-control w174 inblock" placeholder="" id="datepicker4" name="end_our" readonly>
                                                </div>
                                            </div>

                                            <div class="form-group">
                                                <label class="col-sm-5 col-md-3  col-lg-3 control-label"><span class="text-red">*</span> 添加商品：</label>
                                                <div class="col-sm-7 col-md-6 col-lg-5">
                                                    <a href="##" class="btn btn-primary j_add_product">重新选择商品</a>
                                                    <div class="zhuimg clearfix">
                                                        <div class="img pull-left">
                                                            <img src="{$info.goods_img}" width="80" height="80" class="product-img">
                                                        </div>
                                                        <div class="info pull-left">
                                                            <p class="price">{$symbol}<span class="product-price">{$info.o_price}</span></p>
                                                            <p class="product-name">{$info.goods_name}{$info.item_name}</p>
                                                            <input type="hidden" id="store_goods_id" name="store_goods_id" value="{$info.store_goods_id}"/>
                                                            <input type="hidden" id="goods_img" name="goods_img" value="{$info.goods_img}"/>
                                                            <input type="hidden" id="goods_name" name="goods_name" value="{$info.goods_name}"/>
                                                            <input type="hidden" id="item_key" name="item_key" value="{$info.item_key}"/>
                                                            <input type="hidden" id="item_name" name="item_name" value="{$info.item_name}"/>
                                                            <input type="hidden" id="o_price" name="o_price" value="{$info.o_price}" />
                                                            <input type="hidden" id="o_num" name="o_num" value="{$info.o_num}"/>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="form-group">
                                                <label class="col-sm-5 col-md-3  col-lg-3 control-label"><span class="text-red">*</span> 折扣优惠：</label>
                                                <div class="col-sm-7 col-md-6 col-lg-5">
                                                    <input type="number"  min="1" max="9" class="form-control" placeholder="请输入数字1-9" name="discount" value="{$info.discount}">
                                                </div>
                                            </div>
                                            <div class="form-group">
                                                <label class="col-sm-5 col-md-3  col-lg-3 control-label"><span class="text-red">*</span> 限购数量：</label>
                                                <div class="col-sm-7 col-md-6 col-lg-5">
                                                    <input type="text" class="form-control"  name="limit_num" value="{$info.limit_num}">
                                                </div>
                                            </div>
                                            <div class="form-group">
                                                <label class="col-sm-5 col-md-3  col-lg-3 control-label"> 活动描述：</label>
                                                <div class="col-sm-7 col-md-6 col-lg-5">
                                                    <input type="text" class="form-control" placeholder="" name="content" value="{$info.content}">
                                                </div>
                                            </div>

                                        </div>
                                    </div>

                                    <div class="box-footer">
                                        <div class="col-xs-5 col-xs-offset-3 ">
                                            <a href="?app=seckill&act=seckillList&lang_id={$lang_id}&p={$p}" class="btn btn-default"><i class="fa fa-times-circle"></i> 关 闭</a>
                                            <button type="submit" id="submit" class="btn btn-primary pull-right"><i class="fa fa-save"></i> 保 存
                                            </button>
                                        </div>
                                    </div>

                                </div>
                            </div>
                        </div>
                    </form>
                </section>
                <!-- /.content -->
            </div>
            <!-- /.content-wrapper -->
            {include file="public/footer.html"}
            <!-- /.control-sidebar -->
            <!-- Add the sidebar's background. This div must be placed
                 immediately after the control sidebar -->
            <div class="control-sidebar-bg"></div>
        </div>
        <!-- ./wrapper -->

        <!-- jQuery 2.2.3 -->
        {literal}
        <script type="text/javascript">
            //时间
            $(function() {
                $('#datepicker1').datetimepicker({
                    minView: "month", //选择日期后，不会再跳转去选择时分秒
                    autoclose: true,
                    language: 'ch',
                    format: "yyyy-mm-dd",
                    clearBtn: true,
                });
                $('#datepicker2').datetimepicker({
                    minView: "month", //选择日期后，不会再跳转去选择时分秒
                    autoclose: true,
                    language: 'ch',
                    format: "yyyy-mm-dd",
                    clearBtn: true
                });
                $('#datepicker3').datetimepicker({
                    language: 'ch',
                    weekStart: 1,
                    todayBtn: 1,
                    autoclose: 1,
                    todayHighlight: 1,
                    startView: 1,
                    minView: 2,
                    maxView: 1,
                    forceParse: 0,
                    format: "hh:ii",
                });
                $('#datepicker4').datetimepicker({
                    language: 'ch',
                    weekStart: 1,
                    todayBtn: 1,
                    autoclose: 1,
                    todayHighlight: 1,
                    startView: 1,
                    minView: 2,
                    maxView: 1,
                    forceParse: 0,
                    format: "hh:ii",
                });
            })
            //添加主商品
            $(function() {
                var timer=null;
                $('body').on('click', '.j_add_product', function(e) {
                   if(timer==null){
                       timer=setTimeout(function() {
                           dialog_form_radio('?app=seckill&act=getOneGoods', '选择商品');
                       }, 100);
                   }
                })
                function dialog_form_radio(file_url, title) {
                    $.get(file_url, function(data) {
                        $.confirm({
                            boxWidth: '60%',
                            useBootstrap: false,
                            title: title,
                            content: data,
                            animationBounce: 1.5,
                            type: 'blue',
                            buttons: {
                                confirm: {
                                    btnClass: 'btn-blue',
                                    text: '保存',
                                    action: function() {
                                        clearTimeout(timer);
                                        timer = null;
                                        var obj = $('.tc-box tbody input[type="radio"]:checked');
                                        dataurl = obj.attr('data-url');
                                        dataname = obj.attr('data-name'); //商品名称
                                        datasprice = obj.attr('data-sprice');
                                        datamprice = obj.attr('data-mprice');
                                        dataid = obj.attr('data-id');
                                        var a = obj.parents('tr').next().find('.att a');
                                        var attr = obj.parents('tr').next().find('.active');
                                        if(dataid.length < 0){
                                            return false;
                                        }
                                        if (a.length > 0) {//有active
                                            var dataattr = attr.attr('data-attr');
                                            var datakey = attr.attr('data-key');
                                            var dataiprice = attr.attr('data-iprice');
                                            var dataitem = attr.attr('data-item');
                                            var name = dataname + ' ' + dataattr;
                                            $('.product-img').attr('src', dataurl);
                                            $('.product-price').text(dataiprice);
                                            $('.product-name').text(name);
                                            $('#item_key').val(datakey);
                                            $('#item_name').val(dataattr);
                                            $('#store_goods_id').val(dataid);
                                            $('#goods_name').val(dataname);
                                            $('#goods_img').val(dataurl);
                                            $('#o_price').val(datasprice);

                                        }
                                        else {//如果没有属性
                                            var dataattr = attr.attr('data-attr');
                                            var datakey = attr.attr('data-key');
                                            var dataiprice = attr.attr('data-iprice');
                                            var dataitem = attr.attr('data-item');
                                            var name = dataname + ' ' + dataattr;
                                            $('.product-img').attr('src', dataurl);
                                            $('.product-price').text(datasprice);
                                            $('.product-name').text(dataname);
                                            $('#store_goods_id').val(dataid);
                                            $('#goods_name').val(dataname);
                                            $('#goods_img').val(dataurl);
                                            $('#o_price').val(datasprice);
                                        }

                                    }
                                },
                                cancel: {
                                    btnClass: 'btn-default', // multiple classes.
                                    text: '取消',
                                    action: function(){
                                        clearTimeout(timer);
                                        timer = null;
                                    }
                                }
                            }
                        });
                    })
                }
            })
            //添加商品和清除所有商品

            //批量修改和失去焦点单个修改

            //保存时折后价不能为空







        </script>
        {/literal}
    </body>
</html>
