<!DOCTYPE html>
<html>
    <head>

        {include file="public/header.html"}
        <style type="text/css">
            img[src=""]{
                opacity: 0;
            }
        </style>
    </head>
    <body class="hold-transition skin-blue sidebar-mini">
        <div class="wrapper">

            {include file="public/title.html"}
            <!-- Left side column. contains the logo and sidebar -->
            {include file="public/menu.html"}

            <!-- Content Wrapper. Contains page content -->
            <div class="content-wrapper">
                <section class="content-header">
                    <h1>
                        组合销售
                    </h1>
                    <ol class="breadcrumb">
                        <li><a href="#"><i class="fa fa-dashboard"></i> 首页</a></li>
                        <li><a href="#">促销管理</a></li>
                        <li class="active">组合销售</li>
                    </ol>
                </section>
                <!-- Main content -->
                <section class="content">
                    <!-- /.row -->
                    <form class="form-horizontal" action="?app=promotion&act=doGroupAdd"  data-type="ajax" method="post">
                        <div class="row">
                            <div class="col-xs-12">
                                <div class="box box-primary pb20">
                                    <div class="box-header">
                                        <div class="col-sm-1 col-md-1 no-padding pull-right">
                                            <!--                                            <a class="btn btn-primary pull-right btn-sm" href="##"><i class="fa fa-plus"></i> 返回</a>-->
                                        </div>
                                    </div>
                                    <input type="hidden" name="p" value="{$p}"/>
                                    <div class="form-horizontal">
                                        <div class="box-body">
                                            <div class="form-group">
                                                <label class="col-sm-5 col-md-3  col-lg-3 control-label"><span class="text-red">*</span> 活动名称：</label>
                                                <div class="col-sm-7 col-md-6 col-lg-5">
                                                    <input type="text" class="form-control" placeholder="" name="name">
                                                </div>
                                            </div>
                                            <div class="form-group">
                                                <label class="col-sm-5 col-md-3  col-lg-3 control-label"><span class="text-red">*</span> 主商品：</label>
                                                <div class="col-sm-7 col-md-6 col-lg-5">
                                                    <a href="##" class="btn btn-primary j_add_product">添加主商品</a>
                                                    <div class="zhuimg clearfix">
                                                        <div class="img pull-left">
                                                            <img src="" width="80" height="80" class="product-img">
                                                        </div>
                                                        <div class="info pull-left">
                                                            <input type="hidden" id="main_id" name="main_id" value=""/>
                                                            <input type="hidden" id="main_key" name="main_key" value=""/>
                                                            <input type="hidden" id="main_name" name="main_name" value=""/>
                                                            <input type="hidden" id="main_price" name="main_price" value=""/>
                                                            <input type="hidden" id="main_key_name" name="main_key_name" value=""/>
                                                            <input type="hidden" id="main_img" name="main_img" value=""/>
                                                            <p class="price">￥ <span class="product-price"></span></p>
                                                            <p class="product-name"></p>
                                                        </div>

                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="zuhesale clearfix">
                                        <div class="col-xs-12 header">
                                            <div class="col-xs-8">请选择商品</div>
                                            <div class="col-xs-4 text-right">
                                                <a href="##" class="btn btn-primary j_add">添加商品</a>
                                                <a href="##" class="btn btn-primary j_alldel">清除所有商品</a>
                                            </div>
                                        </div>
                                        <div class="col-xs-12 header-top ">
                                            <div class="col-xs-8">
                                                <label class="radio-inline">
                                                    <input type="radio" name="optionsRadios"  value="1" class="j_discount" checked>折扣
                                                </label>
                                                <label class="radio-inline">
                                                    <input type="radio" name="optionsRadios"  value="2" class="j_lessprice">减价
                                                </label>
                                                <input type="text" class="j_text form-control w100 inblock">
                                                <button class="btn btn-primary ml60 j_edite" type="button">批量修改</button>
                                            </div>
                                            <div class="col-xs-4 text-right">
                                                <!-- <a href="##" class="btn btn-primary">抹角</a>
                                                <a href="##" class="btn btn-primary">抹分</a> -->
                                            </div>
                                        </div>
                                        <div class="col-xs-12">
                                            <div class="new-table-responsive mb20">
                                                <div class="box-body table-responsive no-padding ">
                                                    <table class="table table-bordered">
                                                        <thead>
                                                            <tr>
                                                                <th>图片</th>
                                                                <th>商品名称</th>
                                                                <th>原价</th>
                                                                <th>打折</th>
                                                                <th>减价</th>
                                                                <th>折后价</th>
                                                                <!--<th>数量</th>-->
                                                                <th>操作</th>
                                                            </tr>
                                                        </thead>
                                                        <tbody class="j_tbody">

                                                        </tbody>
                                                    </table>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="box-footer">
                                        <div class="col-xs-5 col-xs-offset-3 ">
                                            <a href="?app=promotion&act=groupList&lang_id={$lang_id}&p={$p}" class="btn btn-default"><i class="fa fa-times-circle"></i> 关 闭</a>
                                            <button type="submit" id="submit" class="btn btn-primary pull-right"><i class="fa fa-save"></i> 保 存
                                            </button>
                                        </div>
                                    </div>

                                </div>
                            </div>
                        </div>
                    </form>
                </section>
                <!-- /.content -->
            </div>
            <!-- /.content-wrapper -->
            {include file="public/footer.html"}
            <!-- /.control-sidebar -->
            <!-- Add the sidebar's background. This div must be placed
                 immediately after the control sidebar -->
            <div class="control-sidebar-bg"></div>
        </div>
        <!-- ./wrapper -->

        <!-- jQuery 2.2.3 -->
        {literal}
        <script type="text/javascript">
            //添加主商品
            $(function () {
                var timer1 = null;
                $('body').on('click', '.j_add_product', function (e) {
                    var main_id = $('#main_id').val();
                    var main_key = $('#main_key').val();
                    if (timer1 == null) {
                        timer1 = setTimeout(function () {
                            dialog_form_radio('?app=promotion&act=getOneGoods&main_id=' + main_id + '&main_key=' + main_key, '选择商品');
                        }, 100);
                    }
                })
                function dialog_form_radio(file_url, title) {
                    $.get(file_url, function (data) {
                        $.confirm({
                            boxWidth: '60%',
                            useBootstrap: false,
                            title: title,
                            content: data,
                            animationBounce: 1.5,
                            type: 'blue',
                            buttons: {
                                confirm: {
                                    btnClass: 'btn-blue',
                                    text: '保存',
                                    action: function () {
                                        clearTimeout(timer1);
                                        timer1 = null;
                                        var obj = $('.tc-box tbody input[type="radio"]:checked');
                                        dataurl = obj.attr('data-url');
                                        dataname = obj.attr('data-name'); //商品名称
                                        datasprice = obj.attr('data-sprice');
                                        datamprice = obj.attr('data-mprice');
                                        dataid = obj.attr('data-id');
                                        var a = obj.parents('tr').next().find('.att a');
                                        var attr = obj.parents('tr').next().find('.active');
                                        if (a.length > 0) {//有active
                                            var dataattr = attr.attr('data-attr');
                                            var datakey = attr.attr('data-key');
                                            var dataiprice = attr.attr('data-iprice');
                                            var dataitem = attr.attr('data-item');
                                            var name = dataname + ' ' + dataattr;
                                            $('.product-img').attr('src', dataurl);
                                            $('.product-price').text(dataiprice);
                                            $('.product-name').text(name);
                                            $('#main_id').val(dataid);
                                            $('#main_key').val(datakey);
                                            $('#main_name').val(dataname);
                                            $('#main_price').val(dataiprice);
                                            $('#main_key_name').val(dataattr);
                                            $('#main_img').val(dataurl);

                                        } else {//如果没有属性
                                            var dataattr = attr.attr('data-attr');
                                            var datakey = attr.attr('data-key');
                                            var dataiprice = attr.attr('data-iprice');
                                            var dataitem = attr.attr('data-item');
                                            var name = dataname + ' ' + dataattr;
                                            $('.product-img').attr('src', dataurl);
                                            $('.product-price').text(datasprice);
                                            $('.product-name').text(dataname);
                                            $('#main_id').val(dataid);
                                            $('#main_name').val(dataname);
                                            $('#main_img').val(dataurl);
                                            $('#main_price').val(datasprice);
                                        }

                                    }
                                },
                                cancel: {
                                    btnClass: 'btn-default', // multiple classes.
                                    text: '取消',
                                    action: function () {
                                        clearTimeout(timer1);
                                        timer1 = null;
                                    }
                                }
                            }
                        });
                    })
                }
            })
            //添加商品和清除所有商品
            $(function () {
                var timer2 = null;
                $('body').on('click', '.j_add', function (e) {
                    var main_id = $('#main_id').val();
                    var main_key = $('#main_key').val();
                    if (timer2 == null) {
                        timer2 = setTimeout(function () {
                            dialog_form_checkbox('?app=promotion&act=getOneGoods&main_id=' + main_id + '&main_key=' + main_key + '&type=1', '选择商品');
                        }, 100);
                    }
                })
                $('body').on('click', '.j_alldel', function (e) {
                    $('.j_tbody').find('tr').remove();
                })
                //去重函数
                function quChong(str) {
                    var arr = [];
                    var flag;
                    hidden = $('.hid');
                    if (hidden.length == 0) {
                        flag = 0;
                    } else {
                        for (var i = 0; i < hidden.length; i++) {
                            if (str == $(hidden[i]).val()) {
                                flag = 1;
                                break;//如果找到相同的就跳出循环
                            } else {
                                flag = 0;
                            }
                        }
                    }
                    return flag;
                }
                //多选checkbox
                function dialog_form_checkbox(file_url, title) {
                    $.get(file_url, function (data) {
                        $.confirm({
                            boxWidth: '60%',
                            useBootstrap: false,
                            title: title,
                            content: data,
                            animationBounce: 1.5,
                            type: 'blue',
                            buttons: {
                                confirm: {
                                    btnClass: 'btn-blue',
                                    text: '保存',
                                    action: function () {
                                        clearTimeout(timer2);
                                        timer2 = null;
                                        var obj = $('.tc-box input[type="checkbox"]:checked').not('#all');
                                        for (var j = 0; j < obj.length; j++) {
                                            dataurl = $(obj[j]).attr('data-url');
                                            dataname = $(obj[j]).attr('data-name'); //商品名称
                                            datasprice = $(obj[j]).attr('data-sprice');
                                            datamprice = $(obj[j]).attr('data-mprice');
                                            dataid = $(obj[j]).attr('data-id');
                                            var a = $(obj[j]).parents('tr').next().find('.att a');
                                            var attr = $(obj[j]).parents('tr').next().find('.active');
                                            if (a.length > 0 && attr.length > 0) {//如果有选中的active
                                                for (var k = 0; k < attr.length; k++) {
                                                    var dataattr = $(attr[k]).attr('data-attr');
                                                    var datakey = $(attr[k]).attr('data-key');
                                                    var dataiprice = $(attr[k]).attr('data-iprice');
                                                    var dataitem = $(attr[k]).attr('data-item');
                                                    var name = dataname + ' ' + dataattr;
                                                    var flag = quChong(dataid + datakey);
                                                    if (!flag) {
                                                        var html = '';
                                                        html += '<tr>' +
                                                                '<input type="hidden" class="hid" value="' + dataid + datakey + '"/>' +
                                                                '<td>' +
                                                                '<img src="' + dataurl + '" width="80" height="80">' +
                                                                '<input type="hidden" name="goods_list[' + dataid + '][' + datakey + '][o_price]" value="' + dataiprice + '">' +
                                                                '<input type="hidden" name="goods_list[' + dataid + '][' + datakey + '][item_id]" value="' + dataitem + '">' +
                                                                '<input type="hidden" name="goods_list[' + dataid + '][' + datakey + '][img]" value="' + dataurl + '">' +
                                                                '<input type="hidden" name="goods_list[' + dataid + '][' + datakey + '][item_name]" value="' + name + '">' +
                                                                '</td>' +
                                                                '<td>' + name + '</td>' +
                                                                '<td class="yprice">' + dataiprice + '</td>' +
                                                                '<td><input type="text" value="" name="goods_list[' + dataid + '][' + datakey + '][discount]" class="form-control w70 discount" /></td>' +
                                                                '<td><input type="text" value=""  name="goods_list[' + dataid + '][' + datakey + '][lessprice]" class="form-control w100 lessprice" /></td>' +
                                                                '<td><input type="text" value="" name="goods_list[' + dataid + '][' + datakey + '][price]" class="form-control w100 zprice"/></td>' +
                                                                '<td>' +
                                                                '<a href="javascript:void(0)" name="7" data-toggle="tooltip" title="" class="btn btn-xs btn-danger delete-table1" style="overflow: hidden; position: relative;" data-original-title="删除"><i class="fa fa-times"></i></a>' +
                                                                '</td>' +
                                                                '</tr>';
                                                        //追加
                                                        $('.j_tbody').append(html);
                                                    }
                                                }

                                            }
                                            if (a.length > 0 && attr.length == 0) {
                                                var d = $.dialog({
                                                    content: '<div class="text-center">' + '至少要选择一个属性' + '</div>',
                                                    title: false, // hides the title.
                                                    closeIcon: false, // hides the close icon.
                                                    columnClass: 'xsmall',
                                                    onOpen: function () {
                                                        setTimeout(function () {
                                                            d.close();
                                                        }, 1000);

                                                    }
                                                });
                                                return false;


                                            } else if (attr.length == 0) {//如果没有属性
                                                var dataattr = $(attr[k]).attr('data-attr');
                                                var datakey = $(attr[k]).attr('data-key');
                                                var dataiprice = $(attr[k]).attr('data-iprice');
                                                var dataitem = $(attr[k]).attr('data-item');
                                                var name = dataname;
                                                var flag = quChong(dataid + datakey);
                                                if (!flag) {
                                                    var html = '';
                                                    html += '<tr>' +
                                                            '<input type="hidden" class="hid" value="' + dataid + datakey + '"/>' +
                                                            '<td>' +
                                                            '<img src="' + dataurl + '" width="80" height="80">' +
                                                            '<input type="hidden" name="goods_list[' + dataid + '][o_price]" value="' + datasprice + '">' +
                                                            '<input type="hidden" name="goods_list[' + dataid + '][item_id]" value="1">' +
                                                            '<input type="hidden" name="goods_list[' + dataid + '][img]" value="' + dataurl + '">' +
                                                            '<input type="hidden" name="goods_list[' + dataid + '][item_name]" value="' + name + '">' +
                                                            '</td>' +
                                                            '<td>' + dataname + '</td>' +
                                                            '<td class="yprice">' + datasprice + '</td>' +
                                                            '<td><input type="text" value="" name="goods_list[' + dataid + '][discount]" class="form-control w70 discount" /></td>' +
                                                            '<td><input type="text" value=""  name="goods_list[' + dataid + '][lessprice]" class="form-control w100 lessprice" /></td>' +
                                                            '<td><input type="text" value="" name="goods_list[' + dataid + '][price]" class="form-control w100 zprice"/></td>' +
                                                            '<td>' +
                                                            '<a href="javascript:void(0)" name="7" data-toggle="tooltip" title="" class="btn btn-xs btn-danger delete-table" style="overflow: hidden; position: relative;" data-original-title="删除"><i class="fa fa-times"></i></a>' +
                                                            '</td>' +
                                                            '</tr>';
                                                    //追加
                                                    $('.j_tbody').append(html);
                                                }
                                            }

                                            //
                                        }
                                    }
                                },
                                cancel: {
                                    btnClass: 'btn-default', // multiple classes.
                                    text: '取消',
                                    action: function () {
                                        clearTimeout(timer2);
                                        timer2 = null;
                                    }
                                }
                            }
                        });

                    })
                }
                //单个删除
                $('body').on('click', '.delete-table1', function () {
                    var that = $(this);
                    $.confirm({
                        title: '',
                        closeIcon: true,
                        content: "<i class='fa fa-warning text-yellow' style='font-size:38px'></i> 您确认要删除所选数据？",
                        type: 'blue',
                        buttons: {
                            confirm: {
                                btnClass: 'btn-blue',
                                text: '确认',
                                action: function () {
                                    that.parents('tr').remove();
                                }
                            },
                            cancel: {
                                btnClass: 'btn-default', // multiple classes.
                                text: '取消'
                            }
                        }
                    });

                });
            })
            //批量修改和失去焦点单个修改
            $(function () {
                //批量计算
                $('.j_edite').click(function () {
                    var type = $('.header-top').find('input[type="radio"]:checked').val();
                    if (type == 1) {
                        var text = $('.header-top .j_text').val();
                        if (text > 10 || isNaN(text)) {
                            $.confirm({
                                title: '',
                                closeIcon: true,
                                content: "<i class='fa fa-warning text-yellow' style='font-size:38px'></i>&nbsp;&nbsp; 折扣为数字且不能大于10 !",
                                type: 'blue',
                                buttons: {
                                    confirm: {
                                        btnClass: 'btn-blue',
                                        text: '确认',
                                        action: function () {
                                            $('.header-top .j_text').val(' ');
                                        }
                                    }
                                }
                            });
                            //alert('折扣不得大于10');
                            return;
                        }
                        if (text == '') {
                            $('.header-top .j_text').val(' ');
                            return;
                        }
                        if (text < 0 || isNaN(text)) {
                            $.confirm({
                                title: '',
                                closeIcon: true,
                                content: "<i class='fa fa-warning text-yellow' style='font-size:38px'></i>&nbsp;&nbsp; 折扣为数字且不能小于0 !",
                                type: 'blue',
                                buttons: {
                                    confirm: {
                                        btnClass: 'btn-blue',
                                        text: '确认',
                                        action: function () {
                                            $('.header-top .j_text').val(' ');
                                        }
                                    }
                                }
                            });
                            //alert('折扣不得小于1');
                            return;
                        } else {
                            $('.header-top .j_text').val(Number(text).toFixed(2));
                            var text = $('.header-top .j_text').val();
                            $('.j_tbody tr').each(function () {
                                var num = text / 10;
                                var yprice = $(this).find('.yprice').text();
                                var zprice = $(this).find('.zprice');
                                var discount = $(this).find('.discount');
                                var lessprice = $(this).find('.lessprice');
                                discount.val(text);//几折
                                zprice.val((yprice * num).toFixed(2));//折后价
                                lessprice.val((yprice - zprice.val()).toFixed(2));
                            })
                        }
                    } else {
                        var text = $('.header-top .j_text').val();//减价
                        if (text < 0) {
                            $.confirm({
                                title: '',
                                closeIcon: true,
                                content: "<i class='fa fa-warning text-yellow' style='font-size:38px'></i>&nbsp;&nbsp; 减价不能小于0 !",
                                type: 'blue',
                                buttons: {
                                    confirm: {
                                        btnClass: 'btn-blue',
                                        text: '确认',
                                        action: function () {
                                            $('.header-top .j_text').val(' ');
                                        }
                                    }
                                }
                            });
                            //alert('减价不能小于0');
                            return;
                        }
                        if (text == '') {
                            $('.header-top .j_text').val(' ');
                            return;
                        } else {
                            $('.header-top .j_text').val(Number(text).toFixed(2));
                            $('.j_tbody tr').each(function () {
                                var yprice = $(this).find('.yprice').text();
                                if ((yprice - text) < 0) {
                                    $.confirm({
                                        title: '',
                                        closeIcon: true,
                                        content: "<i class='fa fa-warning text-yellow' style='font-size:38px'></i>&nbsp;&nbsp; 减价的值不能大于原价 !",
                                        type: 'blue',
                                        buttons: {
                                            confirm: {
                                                btnClass: 'btn-blue',
                                                text: '确认',
                                                action: function () {
                                                    $('.header-top .j_text').val(' ');
                                                }
                                            }
                                        }
                                    });
                                    //alert("减价的值不能大于原价！");
                                    return false;
                                } else {
                                    var yprice = $(this).find('.yprice').text();
                                    var zprice = $(this).find('.zprice');
                                    var discount = $(this).find('.discount');
                                    var lessprice = $(this).find('.lessprice');
                                    lessprice.val(Number(text).toFixed(2));//减价
                                    zprice.val((yprice - lessprice.val()).toFixed(2));//折后价
                                    var val = (zprice.val() / yprice) * 10;
                                    discount.val(val.toFixed(2));//几折
                                }

                            })
                        }

                    }
                })
                //失去焦点，单独计算
                $('.j_tbody').on('blur', '.discount', function () {
                    var that = $(this);
                    if (!$(this).val()) {
                        return;
                    }
                    if ($(this).val() > 10) {
                        $.confirm({
                            title: '',
                            closeIcon: true,
                            content: "<i class='fa fa-warning text-yellow' style='font-size:38px'></i>&nbsp;&nbsp; 折扣不能大于10 !",
                            type: 'blue',
                            buttons: {
                                confirm: {
                                    btnClass: 'btn-blue',
                                    text: '确认',
                                    action: function () {
                                        that.val(' ');
                                    }
                                }
                            }
                        });
                        //alert('折扣不得大于10');
                        return;
                    }
                    if ($(this).val() < 0) {
                        $.confirm({
                            title: '',
                            closeIcon: true,
                            content: "<i class='fa fa-warning text-yellow' style='font-size:38px'></i>&nbsp;&nbsp; 折扣不能小于0 !",
                            type: 'blue',
                            buttons: {
                                confirm: {
                                    btnClass: 'btn-blue',
                                    text: '确认',
                                    action: function () {
                                        that.val(' ');
                                    }
                                }
                            }
                        });
                        //alert('折扣不得小于1！');
                        return;
                    } else {
                        var value = +$(this).val();
                        $(this).val(value.toFixed(2));
                        var yprice = $(this).parents('tr').find('.yprice').text();
                        var discount = $(this).val() / 10;
                        var zprice = $(this).parents('tr').find('.zprice');
                        var lessprice = $(this).parents('tr').find('.lessprice');
                        zprice.val((yprice * discount).toFixed(2));
                        lessprice.val((yprice - zprice.val()).toFixed(2));
                    }
                })
                $('.j_tbody').on('blur', '.lessprice', function () {
                    var that = $(this);
                    var yprice = $(this).parents('tr').find('.yprice').text();
                    if (!$(this).val()) {
                        return;
                    }
                    if ($(this).val() < 0) {
                        $.confirm({
                            title: '',
                            closeIcon: true,
                            content: "<i class='fa fa-warning text-yellow' style='font-size:38px'></i>&nbsp;&nbsp; 减价不能小于0 !",
                            type: 'blue',
                            buttons: {
                                confirm: {
                                    btnClass: 'btn-blue',
                                    text: '确认',
                                    action: function () {
                                        that.val(' ');
                                    }
                                }
                            }
                        });
                        //alert('减价不能小于0');

                        return;
                    }
                    if (($(this).val() - yprice) > 0) {
                        $.confirm({
                            title: '',
                            closeIcon: true,
                            content: "<i class='fa fa-warning text-yellow' style='font-size:38px'></i>&nbsp;&nbsp; 减价的值不能大于原价 !",
                            type: 'blue',
                            buttons: {
                                confirm: {
                                    btnClass: 'btn-blue',
                                    text: '确认',
                                    action: function () {
                                        that.val(' ');
                                    }
                                }
                            }
                        });
                        //alert("减价的值不能大于原价！");

                        return;
                    } else {
                        var value = +$(this).val();
                        $(this).val(value.toFixed(2));
                        var yprice = $(this).parents('tr').find('.yprice').text();
                        var lessprice = +$(this).parents('tr').find('.lessprice').val();
                        var zprice = $(this).parents('tr').find('.zprice');
                        var discount = $(this).parents('tr').find('.discount');
                        zprice.val((yprice - lessprice).toFixed(2));
                        var val = (zprice.val() / yprice) * 10;
                        discount.val(val.toFixed(2));//几折

                    }
                })
                $('.j_tbody').on('blur', '.zprice', function () {
                    var that = $(this);
                    var yprice = $(this).parents('tr').find('.yprice').text();
                    if (!$(this).val()) {
                        return;
                    }
                    if ($(this).val() < 0) {
                        $.confirm({
                            title: '',
                            closeIcon: true,
                            content: "<i class='fa fa-warning text-yellow' style='font-size:38px'></i>&nbsp;&nbsp; 折后价不能小于0 !",
                            type: 'blue',
                            buttons: {
                                confirm: {
                                    btnClass: 'btn-blue',
                                    text: '确认',
                                    action: function () {
                                        that.val(' ');
                                    }
                                }
                            }
                        });
                        //alert('折后价不能小于0');

                        return;
                    }
                    if (($(this).val() - yprice) > 0) {
                        $.confirm({
                            title: '',
                            closeIcon: true,
                            content: "<i class='fa fa-warning text-yellow' style='font-size:38px'></i>&nbsp;&nbsp; 折后价不能大于原价 !",
                            type: 'blue',
                            buttons: {
                                confirm: {
                                    btnClass: 'btn-blue',
                                    text: '确认',
                                    action: function () {
                                        that.val(' ');
                                    }
                                }
                            }
                        });
                        //alert("折后价不能大于原价！");

                        return;
                    } else {
                        var value = +$(this).val();
                        $(this).val(value.toFixed(2));
                        var yprice = $(this).parents('tr').find('.yprice').text();
                        var zprice = $(this).parents('tr').find('.zprice').val();
                        var lessprice = $(this).parents('tr').find('.lessprice');
                        var discount = $(this).parents('tr').find('.discount');
                        lessprice.val((yprice - zprice).toFixed(2));
                        var val = (zprice / yprice) * 10;
                        discount.val(val.toFixed(2));//几折

                    }
                })
            })
            //保存时折后价不能为空







        </script>
        {/literal}
    </body>
</html>
