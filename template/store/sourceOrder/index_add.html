{if $lang_id ==1}
<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <title>Add the order source</title>
        {include file="public/header.html"}
        <style>
            .input-number {
                width: 80px;
                padding: 0 12px;
                vertical-align: top;
                text-align: center;
                outline: none;
            }

            .input-number,
            .input-number-decrement,
            .input-number-increment {
                border: 1px solid #cccccc;
                display: inline-block;
                height: 40px;
            }

            .input-num{
                user-select: none;
                -moz-user-select: none;
                -o-user-select: none;
                -ms-user-select: none;
                -webkit-user-select:none ;
            }

            .input-number-decrement,
            .input-number-increment {
                display: inline-block;
                width: 30px;
                line-height: 38px;
                background: #f1f1f1;
                color: #444444;
                text-align: center;
                font-weight: bold;
                cursor: pointer;
            }

            .input-number-decrement:active,
            .input-number-increment:active {
                background: #dddddd;
            }

            .input-number-decrement {
                /*border-right: none;*/
                border-radius: 0px 0 0 0px;
            }

            .input-number-increment {
                /*border-left: none;*/
                border-radius: 0 0px 0px 0;
            }
            .no-paddsing {
                padding: 22px !important;
            }
            .col-md-7 {
                width: 100%;
            }
        </style>
    </head>
    <body class="hold-transition skin-blue sidebar-mini">
        <div class="wrapper">
            {include file="public/title.html"}
            <!-- Left side column. contains the logo and sidebar -->
            {include file="public/menu.html"}
            <!-- Content Wrapper. Contains page content -->
            <div class="content-wrapper">
                {include file="public/headtab.html"}
                <section class="content-header">
                    <h1>
                        Add the order source
                    </h1>
                    <ol class="breadcrumb">
                        <li><a href="?app=default&act=index&lang_id={$lang_id}"><i class="fa fa-dashboard"></i> Home</a></li>
                        <li>Order management</li>
                        <li class="active">Add the order source</li>
                    </ol>
                </section>
                <!-- Main content -->
                <section class="content">
                    <!-- /.row --> 
                    <div class="row">  
                        <div class="col-xs-12">
                            <div class="box box-primary">
                                <div class="box-header form-inline col-sm-10 col-md-7 no-paddsing">
                                    <br>
                                    <div class="form-group form-group-sm form-mar user_name" style="margin-right:0">
                                        &nbsp;&nbsp;
                                    </div>
                                    <div class="form-group form-group-sm form-mar" style="margin-right:0">
                                        <a href="##" class="btn btn-primary" id='add-role'> <i class="fa fa-search"></i>&nbsp;Select users</a>
                                    </div>
                                </div>
                                <div class="zuhesale clearfix">
                                    <div class="col-xs-12 header">
                                        <div class="col-xs-8">The order comes from：&nbsp;&nbsp;
                                            {foreach from=$info item=v}

                                            <span><input type="radio" name="source" value="{$v.id}" {if $info[0].id == $v.id} checked=checked {/if}>&nbsp;&nbsp;<img src="{$v.img}" width="120" height="45">&nbsp;&nbsp;&nbsp;&nbsp;</span>
                                            {/foreach}
                                            <!--                                            <span><input type="radio" name="source" value="2">&nbsp;&nbsp;<img src="{$STATIC_URL}/front/images/meituanwang.png" width="120" height="45">&nbsp;&nbsp;&nbsp;&nbsp;</span>
                                                                                        <span><input type="radio" name="source" value="3">&nbsp;&nbsp;<img src="{$STATIC_URL}/front/images/eleme.png" width="120" height="45">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>-->
                                        </div>
                                        <div class="col-xs-4 text-right">
                                            <a href="##" class="btn btn-primary j_add">Add goods</a>
                                            <a href="##" class="btn btn-primary j_alldel">Clear all the goods</a>
                                        </div>
                                    </div> 
                                    <div class="col-xs-12">
                                        <div class="new-table-responsive mb20">
                                            <div class="box-body table-responsive no-padding ">
                                                <table class="table table-bordered">
                                                    <thead>
                                                        <tr class="trall">
                                                            <th><input type="checkbox" name="" id="all"/></th>
                                                            <th>Picture</th>
                                                            <th>Commodity name</th>
                                                            <th>Commodity specification</th>
                                                            <th>Price</th>
                                                            <th>Number</th>
                                                            <th>Operation</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody class="j_tbody">

                                                    </tbody>
                                                </table>
                                            </div>
                                            <div class="box-body table-responsive no-padding ">
                                                <br>
                                                <p>Selected&nbsp;&nbsp;:<span class="numList">0individual</span><span style="float:right;">Total price&nbsp;&nbsp;:<span class="priceList">{$symbol}0.00</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p>
                                                <input type="hidden" class="numList"  name="totalQuantity" value="">   
                                                <input type="hidden" class="priceList" name="allPrices" value=""> 
                                            </div>
                                            <div class="box-body table-responsive no-padding "  align="center" >
                                                <p><h4>Preferential amount ：<input type="text" name="Discount" value='' style=' width: 230px;line-height: 30px;'></h4></p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <input type="hidden"  name="lang_id" value="{$lang_id}"> 
                                <input type="hidden"  name="symbol" value="{$symbol}"> 
                                <div class="box-footer" style="padding: 20px;">
                                    <div class="form-group">
                                        <div class="col-sm-6 col-sm-offset-4 col-md-5 col-md-offset-2 col-lg-4 col-lg-offset-2" style="margin-left: 27.666667%;">
                                            <a href="store.php?app=default&act=index&lang_id={$lang_id}" class="btn btn-default"><i class="fa fa-times-circle"></i> Close</a>
                                            <button class="btn btn-primary pull-right" id="submit"><i class="fa fa-save"></i> Place order</button>
                                        </div>
                                    </div>
                                </div>
                            </div> 
                        </div>
                    </div> 
                </section>
                <!-- /.content -->
            </div>
            <!-- /.content-wrapper -->
            {include file="public/footer.html"}
        </div>
        {literal}
        <script type="text/javascript">
            //全选价格
            $('body').on('click', '#all', function () {
                //实现全选反选功能
                var store_goods_iprice = [];    //价格
                var store_goods_number = [];    //数量
                var symbol = $('input[name=symbol]').val();
                var numList = 0;
                var priceList = 0;
                var goods_iprice, input_number, price;
                $('.j_tbody tr').each(function () {
                    if ($(this).find('.check-name').is(':checked')) {
                        goods_iprice = $(this).find('.store_goods_iprice').val();
                        store_goods_iprice.push(goods_iprice);
                        input_number = $(this).find('.input-number').val();
                        store_goods_number.push(input_number);
                        price = Number(goods_iprice);
                    } else {
                        goods_iprice = 0;
                        input_number = 0;
                        price = 0;
                    }
                    var price = price * Number(input_number);
                    console.log("price" + price);
                    priceList += price;
                    console.log("priceList" + priceList);
                    console.log(typeof (priceList));
                    numList += Number(input_number);


                    //console.log("numList  "+numList);
                });
                $("span.numList").html(numList + "individual");
                $("span.priceList").html(symbol + priceList.toFixed(2));
                $("input.numList").val(numList);
                $("input.priceList").val(priceList);
            });

            //单选
            $('body').on('click', '.check-name', function () {
                var $soncheck = $('.check-name');
                if ($(this).is(':checked')) {
                    //如果所有全选打对勾！
                    var len = $soncheck.length;
                    var num = 0;
                    $soncheck.each(function () {
                        if ($(this).is(':checked')) {
                            num++;
                        }
                    });
                    if (num == len) {
                        $('#all').prop("checked", true);
                    }
                } else {
                    $('#all').prop("checked", false);
                }
                total();
            });
            function total() {
                var total_money = 0;
                var total_count = 0;
                var symbol = $('input[name=symbol]').val();
                $('.check-name').each(function () {
                    if ($(this).is(':checked')) {
                        var goods = $(this).parent().parent().find('.price').html().substring(1);
                        var nums = parseInt($(this).parent().parent().find('.input-number').val());
                        //total_money += goods;
                        total_money += goods * nums;
                        total_count += nums;
                        console.log(goods, nums);
                    }
                });
                $(".numList").html(total_count + "individual");
                $(".priceList").html(symbol + total_money.toFixed(2));
                $("input.numList").val(total_count);
                $("input.priceList").val(total_money);
            }

//            $('body').on('click', '.check-name', function () {
//                var num = 0;
//                var price = 0;
//                for (var i = 0; i < $("input:checkbox:checked").length; i++) {
//                    var num1 = Number($($("input:checkbox:checked")[i]).parent().siblings().find(".num").val());
//                    var price1 = Number($($("input:checkbox:checked")[i]).parent().siblings("td.price").html().slice(1));
//                    console.log(num1, price1);
//                    price += price1 * num1;
//                    num += num1;
//                }
//                $("span.numList").html(num + "个");
//                $("span.priceList").html("¥" + price.toFixed(2));
//                $("input.numList").val(num);
//                $("input.priceList").val(price);
//            })
        </script>
        {/literal}
        {literal}
        <script type="text/javascript">
            $("input[name='source']").on("change", function (event) {
                var a = $("input[name='source']:checked").val();
//                alert("选中的radio的值是：" + a);
            });
        </script>
        <script type="text/javascript">
            $(function () {
                var active = false;
                $('#submit').click(function () {
                    var goods_id = [];
                    var store_goods_id = [];
                    var store_goods_name = [];
                    var store_goods_key = [];
                    var store_goods_attr = [];
                    var store_goods_url = [];
                    var store_goods_iprice = [];
                    var store_goods_number = [];
                    var user_name = $('input[name=user_name]').val();
                    var user_id = $('input[name=user_id]').val();
                    var source = $("input[type='radio']:checked").val();
                    var totalQuantity = $('input[name=totalQuantity]').val();
                    var allPrices = $('input[name=allPrices]').val();
                    var lang_id = $('input[name=lang_id]').val();
                    var discount = $('input[name=Discount]').val();
                    $('.j_tbody tr').each(function () {
                        if ($(this).find('.check-name').is(':checked')) {
                            var good_id = $(this).find('.goods_id').val();
                            goods_id.push(good_id);
                            var storegoods_id = $(this).find('.store_goods_id').val();
                            store_goods_id.push(storegoods_id);
                            var goods_name = $(this).find('.store_goods_name').val();
                            store_goods_name.push(goods_name);
                            var goods_key = $(this).find('.store_goods_key').val();
                            store_goods_key.push(goods_key);
                            var goods_attr = $(this).find('.store_goods_attr').val();
                            store_goods_attr.push(goods_attr);
                            var goods_url = $(this).find('.store_goods_url').val();
                            store_goods_url.push(goods_url);
                            var goods_iprice = $(this).find('.store_goods_iprice').val();
                            store_goods_iprice.push(goods_iprice);
                            var input_number = $(this).find('.input-number').val();
                            store_goods_number.push(input_number);
                        }
                    });
                    if (!user_id) {
                        layer.alert('Please select the user', {
                            icon: 2,
                            btn: false,
                            title: false,
                            closeBtn: 0,
                            time: 2000,
                            skin: 'alt-layer'
                        });
                        return false;
                    }
                    if (store_goods_id.length == 0) {
                        layer.alert('Please check the goods and settle the settlement', {
                            icon: 2,
                            btn: false,
                            title: false,
                            closeBtn: 0,
                            time: 2000,
                            skin: 'alt-layer'
                        });
                        return false;
                    } else {
                        if (active) {
                            return false;
                        }
                        var data = {'user_name': user_name, 'user_id': user_id, 'discount': discount, 'lang_id': lang_id, 'source': source, 'totalQuantity': totalQuantity, 'allPrices': allPrices, 'goods_id': goods_id, 'store_goods_id': store_goods_id, 'store_goods_name': store_goods_name, 'store_goods_key': store_goods_key, 'store_goods_attr': store_goods_attr, 'store_goods_url': store_goods_url, 'store_goods_iprice': store_goods_iprice, 'store_goods_number': store_goods_number};
                        // ajax 提交给后台方法
                        $.ajax({
                            url: '?app=sourceOrder&act=guestOrder',
                            type: 'POST',
                            data: data,
                            dataType: "json",
                            async: false,
                            error: function () {
                                alert('error');
                            },
                            success: function (data) {
                                if (data.status == 1) {
                                    var d = $.dialog({
                                        content: '<div class="text-center">' + data.message + '</div>',
                                        title: false, // hides the title.
                                        closeIcon: false, // hides the close icon.
                                        columnClass: 'xsmall',
                                        onOpen: function () {
                                            setTimeout(function () {
                                                d.close();
                                            }, 1000);
                                            window.location.href = data.info.url;
                                        }
                                    });
                                    active = true;
                                    return false;
                                } else {
                                    var d = $.dialog({
                                        content: '<div class="text-center">' + data.message + '</div>',
                                        title: false, // hides the title.
                                        closeIcon: false, // hides the close icon.
                                        columnClass: 'xsmall',
                                        onOpen: function () {
                                            setTimeout(function () {
                                                d.close();
                                            }, 1000);
                                        }
                                    });
                                    return false;
                                }

                            }

                        });
                    }
                })
            })
        </script>
        {/literal}
        {literal}
        <script type="text/javascript">
            //添加用户
            $(function () {
                var timer = null;
                $('body').on('click', '#add-role', function (e) {
                    e.preventDefault();
                    if (timer == null) {
                        timer = setTimeout(function () {
                            dialog_form_checkbox('?app=guestList&act=userid&lang_id=1', 'Select users');
                        }, 100);
                    }
                })
                //多选checkbox
                function dialog_form_checkbox(file_url, title) {
                    $.get(file_url, function (data) {
                        $.confirm({
                            boxWidth: '60%',
                            useBootstrap: false,
                            title: title,
                            content: data,
                            animationBounce: 1.5,
                            type: 'blue',
                            buttons: {
                                confirm: {
                                    btnClass: 'btn-blue',
                                    text: 'Preservation',
                                    action: function () {
                                        clearTimeout(timer);
                                        timer = null;
                                        var obj = $('.tc-box input[type="radio"]:checked').not('.check-name');
                                        var dataid = $(obj).attr('data-id');
                                        var dataname = $(obj).attr('data-name');
                                        var html = '';
                                        html += '&nbsp;&nbsp;Current user&nbsp;：<input type="text" class="form-control"  name="user_name" disabled="disabled" style="width:150px;height:35px;" value="' + dataname + '"/>&nbsp;&nbsp;' +
                                                '<input type="hidden" name="user_id" value="' + dataid + '"> ';
                                        //追加
                                        $('.user_name').empty();
                                        $('.user_name').append(html);
                                    }
                                },
                                cancel: {
                                    btnClass: 'btn-default', // multiple classes.
                                    text: 'Cancel',
                                    action: function () {
                                        clearTimeout(timer);
                                        timer = null;
                                    }
                                }
                            }
                        });
                    })
                }
            })
        </script>
        <script type="text/javascript">
            $(function () {
                $(".input-num").unbind("dbclick");
                window.inputNumber = function (el) {

                    var min = el.attr('min') || false;
                    var max = el.attr('max') || false;
                    var els = {};
                    els.dec = el.prev();
                    els.inc = el.next();
                    el.each(function () {
                        init($(this));
                    });
                    function init(el) {

                        els.dec.on('click', decrement);
                        els.inc.on('click', increment);
                        function decrement() {
                            var value = el[0].value;
                            value--;
                            if (!min || value >= min) {
                                el[0].value = value;
                            }
                        }

                        function increment() {
                            var value = el[0].value;
                            value++;
                            if (!max || value <= max) {
                                el[0].value = value++;
                            }
                        }
                    }
                }
                inputNumber($('.input-number'));
            })
        </script>
        <script type="text/javascript">
            //添加商品和清除所有商品
            $(function () {
                var timer = null;
                $('body').on('click', '.j_add', function (e) {
                    e.preventDefault();
                    if (timer == null) {
                        timer = setTimeout(function () {
                            dialog_form_checkbox('?app=guestList&act=add&lang_id=1', 'Add goods');
                        }, 100);
                    }
                })
                $('body').on('click', '.j_alldel', function (e) {
                    $('.j_tbody').find('tr').remove();
                })
                //多选checkbox
                function dialog_form_checkbox(file_url, title) {
                    $.get(file_url, function (data) {
                        $.confirm({
                            boxWidth: '60%',
                            useBootstrap: false,
                            title: title,
                            content: data,
                            animationBounce: 1.5,
                            type: 'blue',
                            buttons: {
                                confirm: {
                                    btnClass: 'btn-blue',
                                    text: 'Preservation',
                                    action: function () {
                                        clearTimeout(timer);
                                        timer = null;
                                        var symbol = $('input[name=symbol]').val();
                                        var obj = $('.tc-box input[type="checkbox"]:checked').not('#child-all');
                                        for (var j = 0; j < obj.length; j++) {
                                            dataid = $(obj[j]).attr('data-id');
                                            dataurl = $(obj[j]).attr('data-url');
                                            dataname = $(obj[j]).attr('data-name'); //商品名称
                                            datasprice = $(obj[j]).attr('data-sprice');
                                            datamprice = $(obj[j]).attr('data-mprice');
                                            datagoodsid = $(obj[j]).attr('data-goodsid');
                                            var a = $(obj[j]).parents('tr').next().find('.att a');
                                            var attr = $(obj[j]).parents('tr').next().find('.active');
                                            if (a.length > 0 && attr.length > 0) {//如果有选中的active
                                                for (var k = 0; k < attr.length; k++) {
                                                    var dataid = $(obj[j]).attr('data-id');
                                                    var dataattr = $(attr[k]).attr('data-attr');
                                                    var datakey = $(attr[k]).attr('data-key');
                                                    var dataiprice = $(attr[k]).attr('data-iprice');
                                                    var dataitem = $(attr[k]).attr('data-item');
                                                    var name = dataname;
                                                    var flag = quChong(dataid + datakey);
                                                    if (!flag) {
                                                        var html = '';
                                                        html += '<tr>' +
                                                                '<input type="hidden" class="hid" value="' + dataid + datakey + '"/>' +
                                                                '<td>' +
                                                                '<input type="hidden" class="store_goods_id" value="' + dataid + '"> ' +
                                                                '<input type="hidden" class="store_goods_key" value="' + datakey + '"> ' +
                                                                '<input type="hidden" class="store_goods_attr" value="' + dataattr + '"> ' +
                                                                '<input type="hidden" class="store_goods_url" value="' + dataurl + '"> ' +
                                                                '<input type="hidden" class="store_goods_iprice" value="' + dataiprice + '"> ' +
                                                                '<input type="hidden" class="store_goods_name" value="' + dataname + '"> ' +
                                                                '<input type="hidden" class="goods_id" value="' + datagoodsid + '"> ' +
                                                                '<input type="checkbox" class="check-name" value="' + dataid + '"/>' +
                                                                '</td>' +
                                                                '<td>' + '<img src="' + dataurl + '" width="80" height="40">' + '</td>' +
                                                                '<td class="yprice">' + name + '</td>' +
                                                                '<td>' + dataattr + '</td>' +
                                                                '<td class="price">' + symbol + dataiprice + '</td>' +
                                                                '<td><a class="input-number-decrement input-num minus">–</a><input class="input-number num" disabled="disabled" type="text" cart_id = "' + dataid + '"  value="1" min="1" max="10"><a class="input-number-increment input-num plus">+</a></td>' +
                                                                '<td>' +
                                                                '<a href="javascript:void(0)" name="7" data-toggle="tooltip" title="" class="btn btn-xs btn-danger delete-table1" style="overflow: hidden; position: relative;" data-original-title="Delete"><i class="fa fa-times"></i></a>' +
                                                                '</td>' +
                                                                '</tr>';
                                                        //追加
                                                        $('.j_tbody').append(html);
                                                    }
                                                }
                                            }
                                            if (a.length > 0 && attr.length == 0) {
                                                var d = $.dialog({
                                                    content: '<div class="text-center">' + 'At least one attribute should be selected' + '</div>',
                                                    title: false, // hides the title.
                                                    closeIcon: false, // hides the close icon.
                                                    columnClass: 'xsmall',
                                                    onOpen: function () {
                                                        setTimeout(function () {
                                                            d.close();
                                                        }, 1000);
                                                    }
                                                });
                                                return false;
                                            } else if (attr.length == 0) {//如果没有属性
                                                var dataid = $(obj[j]).attr('data-id');
                                                var dataiprice = $(attr[k]).attr('data-iprice');
                                                var dataitem = $(attr[k]).attr('data-item');
                                                var dataname;
                                                var flag = quChong(dataid + datakey);
                                                if (!flag) {
                                                    var html = '';
                                                    html += '<tr>' +
                                                            '<input type="hidden" class="hid" value="' + dataid + '"/>' +
                                                            '<td>' +
                                                            '<input type="hidden" class="store_goods_id" value="' + dataid + '"> ' +
                                                            '<input type="hidden" class="store_goods_url" value="' + dataurl + '"> ' +
                                                            '<input type="hidden" class="store_goods_iprice" value="' + datasprice + '"> ' +
                                                            '<input type="hidden" class="store_goods_name" value="' + dataname + '"> ' +
                                                            '<input type="hidden" class="goods_id" value="' + datagoodsid + '"> ' +
                                                            '<input type="checkbox" class="check-name" value="' + dataid + '"/>' +
                                                            '</td>' +
                                                            '<td>' + '<img src="' + dataurl + '" width="80" height="40">' + '</td>' +
                                                            '<td class="yprice">' + dataname + '</td>' +
                                                            '<td></td>' +
                                                            '<td class="price">' + symbol + datasprice + '</td>' +
                                                            '<td><a class="input-number-decrement input-num minus">–</a><input class="input-number num" disabled="disabled" type="text" name="number" value="1" min="1" max="10"><a class="input-number-increment input-num plus">+</a></td>' +
                                                            '<td>' +
                                                            '<a href="javascript:void(0)" name="7" data-toggle="tooltip" title="" class="btn btn-xs btn-danger delete-table1" style="overflow: hidden; position: relative;" data-original-title="Delete"><i class="fa fa-times"></i></a>' +
                                                            '</td>' +
                                                            '</tr>';
                                                    //追加
                                                    $('.j_tbody').append(html);
                                                }

                                            }//
                                        }
                                    }
                                },
                                cancel: {
                                    btnClass: 'btn-default', // multiple classes.
                                    text: 'Cancel',
                                    action: function () {
                                        clearTimeout(timer);
                                        timer = null;
                                    }
                                }
                            }
                        });
                    })
                }
                //去重函数
                function quChong(str) {
                    var arr = [];
                    var flag;
                    hidden = $('.hid');
                    if (hidden.length == 0) {
                        flag = 0;
                    } else {
                        for (var i = 0; i < hidden.length; i++) {
                            if (str == $(hidden[i]).val()) {
                                flag = 1;
                                layer.alert('The selection of goods is repeated, please continue to select', {
                                    icon: 2,
                                    btn: false,
                                    title: false,
                                    closeBtn: 0,
                                    time: 2000,
                                    skin: 'alt-layer'
                                });
                                break; //如果找到相同的就跳出循环
                            } else {
                                flag = 0;
                            }
                        }
                    }
                    return flag;
                }
                //按钮加减
                $(".j_tbody").on("click", ".minus", function () {
                    var symbol = $('input[name=symbol]').val();
                    var num = parseInt($(this).next().val());
                    num--;
                    if (num < 1) {
                        $(this).next().val("1");
                    } else {
                        $(this).next().val(num);
                    }
                    var number = 0;
                    var price = 0;
                    //单选了 加减数量
                    for (var i = 0; i < $("input:checkbox:checked:not(#all)").length; i++) {
                        var num1 = parseInt($($("input:checkbox:checked:not(#all)")[i]).parent().siblings().find("input.num").val());
                        var price1 = $($("input:checkbox:checked:not(#all)")[i]).parent().siblings("td.price").html().substring(1);
                        console.log(num1, price1);
                        price += price1 * num1;
                        number += num1;
                    }
                    $("span.numList").html(number + "individual");
                    $("span.priceList").html(symbol + price.toFixed(2));
                    $("input.numList").val(number);
                    $("input.priceList").val(price);

                });
                $(".j_tbody").on("click", ".plus", function () {
                    var symbol = $('input[name=symbol]').val();
                    console.log("plus");
                    var num = parseInt($(this).prev().val());
                    num++;
                    $(this).prev().val(num);


                    var number = 0;
                    var price = 0;
                    for (var i = 0; i < $("input:checkbox:checked:not(#all)").length; i++) {
                        var num1 = parseInt($($("input:checkbox:checked:not(#all)")[i]).parent().siblings().find("input.num").val());
                        var price1 = $($("input:checkbox:checked:not(#all)")[i]).parent().siblings("td.price").html().substring(1);
                        console.log(num1, price1);
                        price += price1 * num1;
                        number += num1;
                    }
                    $("span.numList").html(number + "individual");
                    $("span.priceList").html(symbol + price.toFixed(2));
                    $("input.numList").val(number);
                    $("input.priceList").val(price);

                });
                //单个删除
                $('body').on('click', '.delete-table1', function () {
                    var that = $(this);
                    $.confirm({
                        title: '',
                        closeIcon: true,
                        content: "<i class='fa fa-warning text-yellow' style='font-size:38px'></i> You confirm that you want to delete the selected data？",
                        type: 'blue',
                        buttons: {
                            confirm: {
                                btnClass: 'btn-blue',
                                text: 'Confirm',
                                action: function () {
                                    that.parents('tr').remove();
                                }
                            },
                            cancel: {
                                btnClass: 'btn-default', // multiple classes.
                                text: 'Cancel'
                            }
                        }
                    });
                });
            })
        </script>
        {/literal}
    </body>
</html>
{else}
<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <title>添加订单来源</title>
        {include file="public/header.html"}
        <style>
            .input-number {
                width: 80px;
                padding: 0 12px;
                vertical-align: top;
                text-align: center;
                outline: none;
            }

            .input-number,
            .input-number-decrement,
            .input-number-increment {
                border: 1px solid #cccccc;
                display: inline-block;
                height: 40px;
            }

            .input-num{
                user-select: none;
                -moz-user-select: none;
                -o-user-select: none;
                -ms-user-select: none;
                -webkit-user-select:none ;
            }

            .input-number-decrement,
            .input-number-increment {
                display: inline-block;
                width: 30px;
                line-height: 38px;
                background: #f1f1f1;
                color: #444444;
                text-align: center;
                font-weight: bold;
                cursor: pointer;
            }

            .input-number-decrement:active,
            .input-number-increment:active {
                background: #dddddd;
            }

            .input-number-decrement {
                /*border-right: none;*/
                border-radius: 0px 0 0 0px;
            }

            .input-number-increment {
                /*border-left: none;*/
                border-radius: 0 0px 0px 0;
            }
            .no-paddsing {
                padding: 22px !important;
            }
            .col-md-7 {
                width: 100%;
            }
        </style>
    </head>
    <body class="hold-transition skin-blue sidebar-mini">
        <div class="wrapper">
            {include file="public/title.html"}
            <!-- Left side column. contains the logo and sidebar -->
            {include file="public/menu.html"}
            <!-- Content Wrapper. Contains page content -->
            <div class="content-wrapper">
                {include file="public/headtab.html"}
                <section class="content-header">
                    <h1>
                        添加订单来源
                    </h1>
                    <ol class="breadcrumb">
                        <li><a href="?app=default&act=index&lang_id={$lang_id}"><i class="fa fa-dashboard"></i> 首页</a></li>
                        <li>订单管理</li>
                        <li class="active">添加订单来源</li>
                    </ol>
                </section>
                <!-- Main content -->
                <section class="content">
                    <!-- /.row --> 
                    <div class="row">  
                        <div class="col-xs-12">
                            <div class="box box-primary">
                                <div class="box-header form-inline col-sm-10 col-md-7 no-paddsing">
                                    <br>
                                    <div class="form-group form-group-sm form-mar user_name" style="margin-right:0">
                                        &nbsp;&nbsp;
                                    </div>
                                    <div class="form-group form-group-sm form-mar" style="margin-right:0">
                                        <a href="##" class="btn btn-primary" id='add-role'> <i class="fa fa-search"></i>&nbsp;选择用户</a>
                                    </div>
                                </div>
                                <div class="zuhesale clearfix">
                                    <div class="col-xs-12 header">
                                        <div class="col-xs-8">订单来源于：&nbsp;&nbsp;
                                            {foreach from=$info item=v}

                                            <span><input type="radio" name="source" value="{$v.id}" {if $info[0].id == $v.id} checked=checked {/if}>&nbsp;&nbsp;<img src="{$v.img}" width="120" height="45">&nbsp;&nbsp;&nbsp;&nbsp;</span>
                                            {/foreach}
                                            <!--                                            <span><input type="radio" name="source" value="2">&nbsp;&nbsp;<img src="{$STATIC_URL}/front/images/meituanwang.png" width="120" height="45">&nbsp;&nbsp;&nbsp;&nbsp;</span>
                                                                                        <span><input type="radio" name="source" value="3">&nbsp;&nbsp;<img src="{$STATIC_URL}/front/images/eleme.png" width="120" height="45">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>-->
                                        </div>
                                        <div class="col-xs-4 text-right">
                                            <a href="##" class="btn btn-primary j_add">添加商品</a>
                                            <a href="##" class="btn btn-primary j_alldel">清除所有商品</a>
                                        </div>
                                    </div> 
                                    <div class="col-xs-12">
                                        <div class="new-table-responsive mb20">
                                            <div class="box-body table-responsive no-padding ">
                                                <table class="table table-bordered">
                                                    <thead>
                                                        <tr class="trall">
                                                            <th><input type="checkbox" name="" id="all"/></th>
                                                            <th>图片</th>
                                                            <th>商品名称</th>
                                                            <th>商品规格</th>
                                                            <th>价格</th>
                                                            <th>数量</th>
                                                            <th>操作</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody class="j_tbody">

                                                    </tbody>
                                                </table>
                                            </div>
                                            <div class="box-body table-responsive no-padding ">
                                                <br>
                                                <p>已选&nbsp;&nbsp;:<span class="numList">0个</span><span style="float:right;">总价格&nbsp;&nbsp;:<span class="priceList">{$symbol}0.00</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p>
                                                <input type="hidden" class="numList"  name="totalQuantity" value="">   
                                                <input type="hidden" class="priceList" name="allPrices" value=""> 
                                            </div>
                                            <div class="box-body table-responsive no-padding "  align="center" >
                                                <p><h4>优惠金额 ：<input type="text" name="Discount" value='' style=' width: 230px;line-height: 30px;'></h4></p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <input type="hidden"  name="lang_id" value="{$lang_id}"> 
                                <input type="hidden"  name="symbol" value="{$symbol}"> 
                                <div class="box-footer" style="padding: 20px;">
                                    <div class="form-group">
                                        <div class="col-sm-6 col-sm-offset-4 col-md-5 col-md-offset-2 col-lg-4 col-lg-offset-2" style="margin-left: 27.666667%;">
                                            <a href="store.php?app=default&act=index&lang_id=0" class="btn btn-default"><i class="fa fa-times-circle"></i> 关 闭</a>
                                            <button class="btn btn-primary pull-right" id="submit"><i class="fa fa-save"></i> 提交订单</button>
                                        </div>
                                    </div>
                                </div>
                            </div> 
                        </div>
                    </div> 
                </section>
                <!-- /.content -->
            </div>
            <!-- /.content-wrapper -->
            {include file="public/footer.html"}
        </div>
        {literal}
        <script type="text/javascript">
            //全选价格
            $('body').on('click', '#all', function () {
                //实现全选反选功能
                var store_goods_iprice = [];    //价格
                var store_goods_number = [];    //数量
                var symbol = $('input[name=symbol]').val();
                var numList = 0;
                var priceList = 0;
                var goods_iprice, input_number, price;
                $('.j_tbody tr').each(function () {
                    if ($(this).find('.check-name').is(':checked')) {
                        goods_iprice = $(this).find('.store_goods_iprice').val();
                        store_goods_iprice.push(goods_iprice);
                        input_number = $(this).find('.input-number').val();
                        store_goods_number.push(input_number);
                        price = Number(goods_iprice);
                    } else {
                        goods_iprice = 0;
                        input_number = 0;
                        price = 0;
                    }
                    var price = price * Number(input_number);
                    console.log("price" + price);
                    priceList += price;
                    console.log("priceList" + priceList);
                    console.log(typeof (priceList));
                    numList += Number(input_number);


                    //console.log("numList  "+numList);
                });
                $("span.numList").html(numList + "个");
                $("span.priceList").html(symbol + priceList.toFixed(2));
                $("input.numList").val(numList);
                $("input.priceList").val(priceList);
            });

            //单选
            $('body').on('click', '.check-name', function () {
                var $soncheck = $('.check-name');
                if ($(this).is(':checked')) {
                    //如果所有全选打对勾！
                    var len = $soncheck.length;
                    var num = 0;
                    $soncheck.each(function () {
                        if ($(this).is(':checked')) {
                            num++;
                        }
                    });
                    if (num == len) {
                        $('#all').prop("checked", true);
                    }
                } else {
                    $('#all').prop("checked", false);
                }
                total();
            });
            function total() {
                var total_money = 0;
                var total_count = 0;
                var symbol = $('input[name=symbol]').val();
                $('.check-name').each(function () {
                    if ($(this).is(':checked')) {
                        var goods = $(this).parent().parent().find('.price').html().substring(1);
                        var nums = parseInt($(this).parent().parent().find('.input-number').val());
                        //total_money += goods;
                        total_money += goods * nums;
                        total_count += nums;
                        console.log(goods, nums);
                    }
                });
                $(".numList").html(total_count + "个");
                $(".priceList").html(symbol + total_money.toFixed(2));
                $("input.numList").val(total_count);
                $("input.priceList").val(total_money);
            }

//            $('body').on('click', '.check-name', function () {
//                var num = 0;
//                var price = 0;
//                for (var i = 0; i < $("input:checkbox:checked").length; i++) {
//                    var num1 = Number($($("input:checkbox:checked")[i]).parent().siblings().find(".num").val());
//                    var price1 = Number($($("input:checkbox:checked")[i]).parent().siblings("td.price").html().slice(1));
//                    console.log(num1, price1);
//                    price += price1 * num1;
//                    num += num1;
//                }
//                $("span.numList").html(num + "个");
//                $("span.priceList").html("¥" + price.toFixed(2));
//                $("input.numList").val(num);
//                $("input.priceList").val(price);
//            })
        </script>
        {/literal}
        {literal}
        <script type="text/javascript">
            $("input[name='source']").on("change", function (event) {
                var a = $("input[name='source']:checked").val();
//                alert("选中的radio的值是：" + a);
            });
        </script>
        <script type="text/javascript">
            $(function () {
                var active = false;
                $('#submit').click(function () {
                    var goods_id = [];
                    var store_goods_id = [];
                    var store_goods_name = [];
                    var store_goods_key = [];
                    var store_goods_attr = [];
                    var store_goods_url = [];
                    var store_goods_iprice = [];
                    var store_goods_number = [];
                    var user_name = $('input[name=user_name]').val();
                    var user_id = $('input[name=user_id]').val();
                    var source = $("input[type='radio']:checked").val();
                    var totalQuantity = $('input[name=totalQuantity]').val();
                    var allPrices = $('input[name=allPrices]').val();
                    var lang_id = $('input[name=lang_id]').val();
                    var discount = $('input[name=Discount]').val();
                    $('.j_tbody tr').each(function () {
                        if ($(this).find('.check-name').is(':checked')) {
                            var good_id = $(this).find('.goods_id').val();
                            goods_id.push(good_id);
                            var storegoods_id = $(this).find('.store_goods_id').val();
                            store_goods_id.push(storegoods_id);
                            var goods_name = $(this).find('.store_goods_name').val();
                            store_goods_name.push(goods_name);
                            var goods_key = $(this).find('.store_goods_key').val();
                            store_goods_key.push(goods_key);
                            var goods_attr = $(this).find('.store_goods_attr').val();
                            store_goods_attr.push(goods_attr);
                            var goods_url = $(this).find('.store_goods_url').val();
                            store_goods_url.push(goods_url);
                            var goods_iprice = $(this).find('.store_goods_iprice').val();
                            store_goods_iprice.push(goods_iprice);
                            var input_number = $(this).find('.input-number').val();
                            store_goods_number.push(input_number);
                        }
                    });
                    if (!user_id) {
                        layer.alert('请选择用户', {
                            icon: 2,
                            btn: false,
                            title: false,
                            closeBtn: 0,
                            time: 2000,
                            skin: 'alt-layer'
                        });
                        return false;
                    }
                    if (store_goods_id.length == 0) {
                        layer.alert('请勾选商品，进行结算', {
                            icon: 2,
                            btn: false,
                            title: false,
                            closeBtn: 0,
                            time: 2000,
                            skin: 'alt-layer'
                        });
                        return false;
                    } else {
                        if (active) {
                            return false;
                        }
                        var data = {'user_name': user_name, 'user_id': user_id, 'discount': discount, 'lang_id': lang_id, 'source': source, 'totalQuantity': totalQuantity, 'allPrices': allPrices, 'goods_id': goods_id, 'store_goods_id': store_goods_id, 'store_goods_name': store_goods_name, 'store_goods_key': store_goods_key, 'store_goods_attr': store_goods_attr, 'store_goods_url': store_goods_url, 'store_goods_iprice': store_goods_iprice, 'store_goods_number': store_goods_number};
                        // ajax 提交给后台方法
                        $.ajax({
                            url: '?app=sourceOrder&act=guestOrder',
                            type: 'POST',
                            data: data,
                            dataType: "json",
                            async: false,
                            error: function () {
                                alert('error');
                            },
                            success: function (data) {
                                if (data.status == 1) {
                                    var d = $.dialog({
                                        content: '<div class="text-center">' + data.message + '</div>',
                                        title: false, // hides the title.
                                        closeIcon: false, // hides the close icon.
                                        columnClass: 'xsmall',
                                        onOpen: function () {
                                            setTimeout(function () {
                                                d.close();
                                            }, 1000);
                                            window.location.href = data.info.url;
                                        }
                                    });
                                    active = true;
                                    return false;
                                } else {
                                    var d = $.dialog({
                                        content: '<div class="text-center">' + data.message + '</div>',
                                        title: false, // hides the title.
                                        closeIcon: false, // hides the close icon.
                                        columnClass: 'xsmall',
                                        onOpen: function () {
                                            setTimeout(function () {
                                                d.close();
                                            }, 1000);
                                        }
                                    });
                                    return false;
                                }

                            }

                        });
                    }
                })
            })
        </script>
        {/literal}
        {literal}
        <script type="text/javascript">
            //添加用户
            $(function () {
                var timer = null;
                $('body').on('click', '#add-role', function (e) {
                    e.preventDefault();
                    if (timer == null) {
                        timer = setTimeout(function () {
                            dialog_form_checkbox('?app=guestList&act=userid&lang_id=0', '选择用户');
                        }, 100);
                    }
                })
                //多选checkbox
                function dialog_form_checkbox(file_url, title) {
                    $.get(file_url, function (data) {
                        $.confirm({
                            boxWidth: '60%',
                            useBootstrap: false,
                            title: title,
                            content: data,
                            animationBounce: 1.5,
                            type: 'blue',
                            buttons: {
                                confirm: {
                                    btnClass: 'btn-blue',
                                    text: '保存',
                                    action: function () {
                                        clearTimeout(timer);
                                        timer = null;
                                        var obj = $('.tc-box input[type="radio"]:checked').not('.check-name');
                                        var dataid = $(obj).attr('data-id');
                                        var dataname = $(obj).attr('data-name');
                                        var html = '';
                                        html += '&nbsp;&nbsp;当前用户&nbsp;：<input type="text" class="form-control"  name="user_name" disabled="disabled" style="width:150px;height:35px;" value="' + dataname + '"/>&nbsp;&nbsp;' +
                                                '<input type="hidden" name="user_id" value="' + dataid + '"> ';
                                        //追加
                                        $('.user_name').empty();
                                        $('.user_name').append(html);
                                    }
                                },
                                cancel: {
                                    btnClass: 'btn-default', // multiple classes.
                                    text: '取消',
                                    action: function () {
                                        clearTimeout(timer);
                                        timer = null;
                                    }
                                }
                            }
                        });
                    })
                }
            })
        </script>
        <script type="text/javascript">
            $(function () {
                $(".input-num").unbind("dbclick");
                window.inputNumber = function (el) {

                    var min = el.attr('min') || false;
                    var max = el.attr('max') || false;
                    var els = {};
                    els.dec = el.prev();
                    els.inc = el.next();
                    el.each(function () {
                        init($(this));
                    });
                    function init(el) {

                        els.dec.on('click', decrement);
                        els.inc.on('click', increment);
                        function decrement() {
                            var value = el[0].value;
                            value--;
                            if (!min || value >= min) {
                                el[0].value = value;
                            }
                        }

                        function increment() {
                            var value = el[0].value;
                            value++;
                            if (!max || value <= max) {
                                el[0].value = value++;
                            }
                        }
                    }
                }
                inputNumber($('.input-number'));
            })
        </script>
        <script type="text/javascript">
            //添加商品和清除所有商品
            $(function () {
                var timer = null;
                $('body').on('click', '.j_add', function (e) {
                    e.preventDefault();
                    if (timer == null) {
                        timer = setTimeout(function () {
                            dialog_form_checkbox('?app=guestList&act=add&lang_id=0', '添加商品');
                        }, 100);
                    }
                })
                $('body').on('click', '.j_alldel', function (e) {
                    $('.j_tbody').find('tr').remove();
                })
                //多选checkbox
                function dialog_form_checkbox(file_url, title) {
                    $.get(file_url, function (data) {
                        $.confirm({
                            boxWidth: '60%',
                            useBootstrap: false,
                            title: title,
                            content: data,
                            animationBounce: 1.5,
                            type: 'blue',
                            buttons: {
                                confirm: {
                                    btnClass: 'btn-blue',
                                    text: '保存',
                                    action: function () {
                                        clearTimeout(timer);
                                        timer = null;
                                        var symbol = $('input[name=symbol]').val();
                                        var obj = $('.tc-box input[type="checkbox"]:checked').not('#child-all');
                                        for (var j = 0; j < obj.length; j++) {
                                            dataid = $(obj[j]).attr('data-id');
                                            dataurl = $(obj[j]).attr('data-url');
                                            dataname = $(obj[j]).attr('data-name'); //商品名称
                                            datasprice = $(obj[j]).attr('data-sprice');
                                            datamprice = $(obj[j]).attr('data-mprice');
                                            datagoodsid = $(obj[j]).attr('data-goodsid');
                                            var a = $(obj[j]).parents('tr').next().find('.att a');
                                            var attr = $(obj[j]).parents('tr').next().find('.active');
                                            if (a.length > 0 && attr.length > 0) {//如果有选中的active
                                                for (var k = 0; k < attr.length; k++) {
                                                    var dataid = $(obj[j]).attr('data-id');
                                                    var dataattr = $(attr[k]).attr('data-attr');
                                                    var datakey = $(attr[k]).attr('data-key');
                                                    var dataiprice = $(attr[k]).attr('data-iprice');
                                                    var dataitem = $(attr[k]).attr('data-item');
                                                    var name = dataname;
                                                    var flag = quChong(dataid + datakey);
                                                    if (!flag) {
                                                        var html = '';
                                                        html += '<tr>' +
                                                                '<input type="hidden" class="hid" value="' + dataid + datakey + '"/>' +
                                                                '<td>' +
                                                                '<input type="hidden" class="store_goods_id" value="' + dataid + '"> ' +
                                                                '<input type="hidden" class="store_goods_key" value="' + datakey + '"> ' +
                                                                '<input type="hidden" class="store_goods_attr" value="' + dataattr + '"> ' +
                                                                '<input type="hidden" class="store_goods_url" value="' + dataurl + '"> ' +
                                                                '<input type="hidden" class="store_goods_iprice" value="' + dataiprice + '"> ' +
                                                                '<input type="hidden" class="store_goods_name" value="' + dataname + '"> ' +
                                                                '<input type="hidden" class="goods_id" value="' + datagoodsid + '"> ' +
                                                                '<input type="checkbox" class="check-name" value="' + dataid + '"/>' +
                                                                '</td>' +
                                                                '<td>' + '<img src="' + dataurl + '" width="80" height="40">' + '</td>' +
                                                                '<td class="yprice">' + name + '</td>' +
                                                                '<td>' + dataattr + '</td>' +
                                                                '<td class="price">' + symbol + dataiprice + '</td>' +
                                                                '<td><a class="input-number-decrement input-num minus">–</a><input class="input-number num" disabled="disabled" type="text" cart_id = "' + dataid + '"  value="1" min="1" max="10"><a class="input-number-increment input-num plus">+</a></td>' +
                                                                '<td>' +
                                                                '<a href="javascript:void(0)" name="7" data-toggle="tooltip" title="" class="btn btn-xs btn-danger delete-table1" style="overflow: hidden; position: relative;" data-original-title="删除"><i class="fa fa-times"></i></a>' +
                                                                '</td>' +
                                                                '</tr>';
                                                        //追加
                                                        $('.j_tbody').append(html);
                                                    }
                                                }
                                            }
                                            if (a.length > 0 && attr.length == 0) {
                                                var d = $.dialog({
                                                    content: '<div class="text-center">' + '至少要选择一个属性' + '</div>',
                                                    title: false, // hides the title.
                                                    closeIcon: false, // hides the close icon.
                                                    columnClass: 'xsmall',
                                                    onOpen: function () {
                                                        setTimeout(function () {
                                                            d.close();
                                                        }, 1000);
                                                    }
                                                });
                                                return false;
                                            } else if (attr.length == 0) {//如果没有属性
                                                var dataid = $(obj[j]).attr('data-id');
                                                var dataiprice = $(attr[k]).attr('data-iprice');
                                                var dataitem = $(attr[k]).attr('data-item');
                                                var dataname;
                                                var flag = quChong(dataid + datakey);
                                                if (!flag) {
                                                    var html = '';
                                                    html += '<tr>' +
                                                            '<input type="hidden" class="hid" value="' + dataid + '"/>' +
                                                            '<td>' +
                                                            '<input type="hidden" class="store_goods_id" value="' + dataid + '"> ' +
                                                            '<input type="hidden" class="store_goods_url" value="' + dataurl + '"> ' +
                                                            '<input type="hidden" class="store_goods_iprice" value="' + datasprice + '"> ' +
                                                            '<input type="hidden" class="store_goods_name" value="' + dataname + '"> ' +
                                                            '<input type="hidden" class="goods_id" value="' + datagoodsid + '"> ' +
                                                            '<input type="checkbox" class="check-name" value="' + dataid + '"/>' +
                                                            '</td>' +
                                                            '<td>' + '<img src="' + dataurl + '" width="80" height="40">' + '</td>' +
                                                            '<td class="yprice">' + dataname + '</td>' +
                                                            '<td></td>' +
                                                            '<td class="price">' + symbol + datasprice + '</td>' +
                                                            '<td><a class="input-number-decrement input-num minus">–</a><input class="input-number num" disabled="disabled" type="text" name="number" value="1" min="1" max="10"><a class="input-number-increment input-num plus">+</a></td>' +
                                                            '<td>' +
                                                            '<a href="javascript:void(0)" name="7" data-toggle="tooltip" title="" class="btn btn-xs btn-danger delete-table1" style="overflow: hidden; position: relative;" data-original-title="删除"><i class="fa fa-times"></i></a>' +
                                                            '</td>' +
                                                            '</tr>';
                                                    //追加
                                                    $('.j_tbody').append(html);
                                                }

                                            }//
                                        }
                                    }
                                },
                                cancel: {
                                    btnClass: 'btn-default', // multiple classes.
                                    text: '取消',
                                    action: function () {
                                        clearTimeout(timer);
                                        timer = null;
                                    }
                                }
                            }
                        });
                    })
                }
                //去重函数
                function quChong(str) {
                    var arr = [];
                    var flag;
                    hidden = $('.hid');
                    if (hidden.length == 0) {
                        flag = 0;
                    } else {
                        for (var i = 0; i < hidden.length; i++) {
                            if (str == $(hidden[i]).val()) {
                                flag = 1;
                                layer.alert('商品选取重复,请继续挑选', {
                                    icon: 2,
                                    btn: false,
                                    title: false,
                                    closeBtn: 0,
                                    time: 2000,
                                    skin: 'alt-layer'
                                });
                                break; //如果找到相同的就跳出循环
                            } else {
                                flag = 0;
                            }
                        }
                    }
                    return flag;
                }
                //按钮加减
                $(".j_tbody").on("click", ".minus", function () {
                    var symbol = $('input[name=symbol]').val();
                    var num = parseInt($(this).next().val());
                    num--;
                    if (num < 1) {
                        $(this).next().val("1");
                    } else {
                        $(this).next().val(num);
                    }
                    var number = 0;
                    var price = 0;
                    //单选了 加减数量
                    for (var i = 0; i < $("input:checkbox:checked:not(#all)").length; i++) {
                        var num1 = parseInt($($("input:checkbox:checked:not(#all)")[i]).parent().siblings().find("input.num").val());
                        var price1 = $($("input:checkbox:checked:not(#all)")[i]).parent().siblings("td.price").html().substring(1);
                        console.log(num1, price1);
                        price += price1 * num1;
                        number += num1;
                    }
                    $("span.numList").html(number + "个");
                    $("span.priceList").html(symbol + price.toFixed(2));
                    $("input.numList").val(number);
                    $("input.priceList").val(price);

                });
                $(".j_tbody").on("click", ".plus", function () {
                    var symbol = $('input[name=symbol]').val();
                    console.log("plus");
                    var num = parseInt($(this).prev().val());
                    num++;
                    $(this).prev().val(num);


                    var number = 0;
                    var price = 0;
                    for (var i = 0; i < $("input:checkbox:checked:not(#all)").length; i++) {
                        var num1 = parseInt($($("input:checkbox:checked:not(#all)")[i]).parent().siblings().find("input.num").val());
                        var price1 = $($("input:checkbox:checked:not(#all)")[i]).parent().siblings("td.price").html().substring(1);
                        console.log(num1, price1);
                        price += price1 * num1;
                        number += num1;
                    }
                    $("span.numList").html(number + "个");
                    $("span.priceList").html(symbol + price.toFixed(2));
                    $("input.numList").val(number);
                    $("input.priceList").val(price);

                });
                //单个删除
                $('body').on('click', '.delete-table1', function () {
                    var that = $(this);
                    $.confirm({
                        title: '',
                        closeIcon: true,
                        content: "<i class='fa fa-warning text-yellow' style='font-size:38px'></i> 您确认要删除所选数据？",
                        type: 'blue',
                        buttons: {
                            confirm: {
                                btnClass: 'btn-blue',
                                text: '确认',
                                action: function () {
                                    that.parents('tr').remove();
                                }
                            },
                            cancel: {
                                btnClass: 'btn-default', // multiple classes.
                                text: '取消'
                            }
                        }
                    });
                });
            })
        </script>
        {/literal}
    </body>
</html>

{/if}