<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>区域站点商品添加</title>
    <!-- Tell the browser to be responsive to screen width -->
    {include file="public/header.html"}
</head>
<body class="hold-transition skin-blue sidebar-mini">
<div class="wrapper">

    {include file="public/title.html"}
    {include file="public/menu.html"}
    <div class="content-wrapper">
        {include file="public/headtab.html"}
        <section class="content-header">
            <h1>
               add Good
            </h1>
            <ol class="breadcrumb">
                <li><a href="?app=default&act=index&lang_id={$lang_id}"><i class="fa fa-dashboard"></i> home page</a></li>
                <li><a href="?app=areaGood&act=index&lang_id={$lang_id}">product information</a></li>
                <li class="active">add Good</li>
            </ol>
        </section>
        <!-- Main content -->
        <section class="content">
            <!-- /.row -->
            <div class="row">
                <div class="col-xs-12">
                    <div class="box box-primary">
                        <div class="box-header">
                            <input type='hidden' name='store_id' value='{$store_id}'>
                            <form class="form-inline col-sm-10 col-md-9 no-padding">
                                <div class="form-group form-group-sm form-mar">
                                    <input type='hidden' name='app' value='areaGood'>
                                    <input type='hidden' name='act' value='add'>
                                    <input type='hidden' name='lang_id' value='{$lang_id}'>
                                    {if $type == 'single'}
                                      <input type='hidden' name='type' value='single'>
                                    {/if}
                                    <input type="hidden" name="cate_status" value="{$Lcate}" />
                                    <!-- <small class="control-label sm"></small> -->
                                    <!--<select class="form-control w160 j_select" name = "select_type" id ='select_type' onchange="gettypelist(this.id)">-->
                                        <!--<option value="0">&#45;&#45;please select&#45;&#45;</option>-->
                                        <!--{foreach $good_type as $k => $v}-->
                                         <!--<option value="{$k}" {if $k == $selectType} selected {/if}>{$v}</option>-->
                                        <!--{/foreach}-->
                                    <!--</select>-->
                                </div>
                                <!--<div class="form-group form-group-sm j_treebox form-mar" style="display: none;">-->
                                    <!--<input type="text" class="form-control ipt" name ='cate' value="{$cate_name}" />-->
                                    <!--<input type="hidden" class="form-control ipt_1"  name="Lcate"/>-->
                                    <!--<span class="dw"></span>-->
                                    <!--<div class="st_tree ">-->
                                        <!--<ul>-->
                                            <!--{foreach from =$list_cate item =v1}-->
                                            <!--<li><a href="#" data-value="{$v1.id}">{$v1.name}</a></li>-->
                                            <!--<ul>-->
                                                <!--{foreach from=$v1.children item=v2}-->
                                                <!--<li><a href="#" data-value="{$v2.id}">{$v2.name}</a></li>-->
                                                <!--<ul>-->
                                                    <!--{foreach from=$v2.children item=v3}-->
                                                    <!--<li><a href="#" data-value="{$v3.id}">{$v3.name}</a></li>-->
                                                    <!--{/foreach}-->
                                                <!--</ul>-->
                                                <!--{/foreach}-->
                                            <!--</ul>-->
                                            <!--{/foreach}-->
                                        <!--</ul>-->
                                    <!--</div>-->
                                <!--</div>-->
                                <!--<div class="form-group form-group-sm form-mar" id="selectSite">-->
                                    <!--&lt;!&ndash; <small class="control-label sm"></small> &ndash;&gt;-->
                                    <!--<select class="form-control w160 j_select"  name="other" >-->
                                        <!--<option value="0">&#45;&#45;please select&#45;&#45;</option>-->
                                        <!--{foreach from=$canshu item=v}-->
                                         <!--<option value="{$v.id}" {if $v.id == $other} selected {/if}>{$v.name}</option>-->
                                        <!--{/foreach}-->
                                    <!--</select>-->
                                <!--</div>-->
                                <div class="form-group form-group-sm form-mar">
                                    <small class="control-label">product Name：</small>
                                    <input type="text" class="form-control" placeholder="goods Name" name="good_name" value="{$good_name}">
                                </div>
                                <div class="form-group form-group-sm form-mar">
                                    <small class="control-label sm">room type：</small>
                                    <select class="form-control w160 j_select" name="room_id">
                                        <option value="0">--select--</option>
                                        {foreach from=$room_type item=room}
                                        <option value="{$room.id}" {if $room_id == $room.id} selected {/if}>{$room.type_name}</option>
                                        {/foreach}
                                    </select>
                                </div>
                                <div class="form-group form-group-sm form-mar">
                                    <button type="submit" class="btn btn-default btn-sm">
                                        search <i class="fa fa-search"></i>
                                    </button>
                                </div>
                            </form>
                                <div class="col-sm-2  col-md-3 no-padding form-inline ">
                                    {if $type == 'single'}
                                    <!--<div class="form-group form-group-sm form-mar">-->
                                        <!--<select class="form-control w160 j_select" name="single_store" >-->
                                            <!--<option value='0'>请选择站点</option>-->
                                            <!--{foreach from=$store  item=v}-->
                                              <!--<option value="{$v.id}">{$v.store_name}</option>-->
                                            <!--{/foreach}-->
                                        <!--</select>-->
                                    <!--</div>-->
                                    {/if}
                                    {if $type == 'single'}
                                    <input type="hidden" name="status" value="1" /> <!--单站点选择 -->
                                    {else}
                                    <input type="hidden" name="status" value="2" /> <!-- 多站点选择-->
                                    {/if}
                                    <div class="form-group form-group-sm form-mar">
                                        <button type="submit" class="btn btn-primary btn-sm" id="submit">
                                            <i class="fa fa-plus"></i> add
                                        </button>
                                        <a  href ="?app=areaGood&act=index&lang_id={$lang_id}" class="btn btn-primary btn-sm">back
                                        </a>
                                    </div>
                                </div>
                            {if $type == 'multi'}
                                <div class="col-md-12" style="padding-left: 0; margin-top: 10px;" >
                                    {foreach from=$store  item=v}
                                    <label class="checkbox-inline col-sm-2" style="margin-left: 0;">
                                         <input type="checkbox" name="multi_store[]" value="{$v.id}"> {$v.store_name}
                                    </label>
                                    {/foreach}
                                </div>
                            {/if}
                        </div>
                        <div class="new-table-responsive">
                            <div class="box-body table-responsive no-padding ">
                                <table class="table table-hover middle-box">
                                    <tr>
                                        <th width="4%"><input type="checkbox" name="" id="all"/></th>
                                        <th width="20%">Good No</th>
                                        <th width="50%">Good Name</th>
                                        <th width="10%">Market Price</th>
                                        <th width="10%">Sale Price</th>
                                        <!--<th width="10%">语言</th>-->
                                    </tr>
                                    {foreach from=$list item=v}
                                    <tr>
                                        <td><input type="checkbox" name="check-name" value="{$v.goods_id}"/></td>
                                        <td>{$v.sort_id}</td>
                                        <td>
                                            <div class="clearfix">
                                                <div class="pull-left img-w">
                                                    <img src="{$v.original_img}" width="60" height="50">
                                                </div>
                                                <div class="wts ml15 pull-left" style="width: 85%">
                                                   {$v.goods_name}</div>
                                                </div>
                                            </div>
                                        </td>
                                        <td class="text-red">￥ {$v.market_price}</td>
                                        <td class="text-red">￥ {$v.shop_price}</td>
                                        <!--<td>{$v.lang_id}</td>-->
                                    </tr>
                                  {/foreach}
                                </table>
                            </div>
                        </div>
                        <div class="box-footer clearfix">
                           <!--  <div class="col-lg-3">
                                <a href="#" class="btn btn-primary btn-sm delete-all"><i class="fa fa-trash-o"></i> 批量删除</a>
                            </div> -->
                            <div class="col-lg-12">
                              {$page}
                            </div>
                        </div>
                        <!-- /.box-body -->
                    </div>
                </div>
            </div>
        </section>
        <!-- /.content -->
    </div>
{include file="public/footer.html"}
</div>
</body>
</html>
{literal}
<script type="text/javascript">
//    $(function(){
//      var cate_status = $('input[name=cate_status]').val();
//      if(cate_status != 0 ){
//          $('.j_treebox').show();
//          $('#selectSite').hide();
//      }
//    });
    function gettypelist(id){
        var type_id = $.trim($("#"+id).val());
        if(type_id == 0){
            var html = "<option value='0'>--please select--</option>";
            $("#selectSite").find('select').html(html);
            $('input[name=cate_status]').val(0);
            $('.j_treebox').hide();
            $("#selectSite").show();
            return false;
        }
        $.ajax({
            url: '?app=areaGood&act=getData',
            type: 'POST',
            data: "id="+type_id,
            dataType: "json",
            success:function(msg) {
//                 console.log(msg);
//                 return false;
                if(msg.status==1){
                    $('.j_treebox').show();
                    $('#selectSite').hide();
//                    var html = '<input type="text" class="form-control ipt"  name="cate"/>';
//                    var html ='';
//                    html ='<div class="st_tree">';
                   var html ='<ul>';
                    $.each(msg.data, function (key, value) {
                        html += '<li><a href="#" data-value="'+ value.id +'">'+ value.name +'</a></li>';
                        html += '<ul>';
                        $.each(value.children, function (k1, v2) {
                          html += '<li><a href="#" data-value="'+ v2.id +'">'+ v2.name +'</a></li>';
                          html += '<ul>';
                          $.each(v2.children, function (k3, v3) {
                          html += '<li><a href="#" data-value="'+ v3.id +'">'+ v3.name +'</a></li>';
                          });
                          html += '</ul>';
                        });
                        html += ' </ul>';
                    });
                    html +='</ul>';
                  $('.st_tree').html(html);
                   setTimeout(function() {
                        // alert($(".st_tree").length)
                        $(".st_tree").SimpleTree({
                            click:function(a){
                                if(!$(a).attr("hasChild"))
                                    alert($(a).attr("ref"));
                            }
                        });
                    }, 100);
        
                }else{
                    $('input[name=cate_status]').val(0);
                    $('.j_treebox').hide();
                    $('#selectSite').show();
                    var html = "<option value=''>--please select--</option>";
                    $.each(msg, function (key, value) {
                        html += "<option value='" + value.id + "'>" + value.name + "</option>";
                    });
                    $("#selectSite").find('select').html(html);
                }
            }
        });
    }
//    $(".st_tree").SimpleTree({
//        click:function(a){
//            if(!$(a).attr("hasChild"))
//                alert($(a).attr("ref"));
//        }
//    });
    $(function(){
        $('body').on('click','.j_treebox',function(){
            $('.st_tree').show();
        })
        $('.j_treebox').on('mousedown','a',function(){
            var text = $(this).text();
            var id = $(this).attr('data-value');
            $('.j_treebox .ipt').val(text);
            $('.j_treebox .ipt_1').val(id);
            $('.st_tree').hide();
        })
    })
//    setTimeout(function() {
//        // alert($(".st_tree").length)
//        $(".st_tree").SimpleTree({
//            click:function(a){
//                if(!$(a).attr("hasChild"))
//                    alert($(a).attr("ref"));
//            }
//        });
//    }, 100);
</script>
<script type="text/javascript">
  $('#submit').click(function(){
      var status = $('input[name=status]').val();
      var lang_id = $('input[name=lang_id]').val();
   if(status ==1) {
       var single_store = $('select[name=single_store]').val();
       var str = "";
       $("input[name='check-name']:checkbox").each(function () {
           if ($(this).is(":checked")) {
               str += $(this).attr("value") + ",";
           }
       });
       if (single_store == 0) {
           var d = $.dialog({
               content: '<div class="text-center">站点不能为空！</div>',
               title: false, // hides the title.
               closeIcon: false, // hides the close icon.
               columnClass: 'xsmall',
               onOpen: function () {
                   setTimeout(function () {
                       d.close();
                   }, 1000);
               }
           });
           return false;
       }
       if (str.length == 0) {
           var d = $.dialog({
               content: '<div class="text-center">Please select at least one good！</div>',
               title: false, // hides the title.
               closeIcon: false, // hides the close icon.
               columnClass: 'xsmall',
               onOpen: function () {
                   setTimeout(function () {
                       d.close();
                   }, 1000);
               }
           });
           return false;
       }
   }else{
       var single_store = "";
       $("input[name='multi_store[]']:checkbox").each(function () {
           if ($(this).is(":checked")) {
               single_store += $(this).attr("value") + ",";
           }
       });
      if(single_store.length ==0){
          var d = $.dialog({
              content: '<div class="text-center">The site cannot be empty！</div>',
              title: false, // hides the title.
              closeIcon: false, // hides the close icon.
              columnClass: 'xsmall',
              onOpen: function () {
                  setTimeout(function () {
                      d.close();
                  }, 1000);
              }
          });
          return false;
      }
       var str = "";
       $("input[name='check-name']:checkbox").each(function () {
           if ($(this).is(":checked")) {
               str += $(this).attr("value") + ",";
           }
       });
       if(str.length ==0){
           var d = $.dialog({
               content: '<div class="text-center">Please select at least one good！</div>',
               title: false, // hides the title.
               closeIcon: false, // hides the close icon.
               columnClass: 'xsmall',
               onOpen: function () {
                   setTimeout(function () {
                       d.close();
                   }, 1000);
               }
           });
           return false;
       }
   }
      $.ajax({
          url: '?app=areaGood&act=doAddGood',
          type: 'POST',
          data: {'store_id':single_store,'goods_id':str,'status':status,'lang_id':lang_id},
          dataType: "json",
          success:function(obj) {
              // console.log(msg);
              // return false;
              var msg = obj.message;
              if(obj.status == 1){
                  var d=$.dialog({
                      content: '<div class="text-center">'+msg+'</div>',
                      title: false, // hides the title.
                      closeIcon: false, // hides the close icon.
                      columnClass: 'xsmall',
                      onOpen: function(){
                          setTimeout(function(){
                              d.close();
                          }, 1000);
                      }
                  });
                  setTimeout(function(){window.location.href= obj.info.url;}, 1000);
              }
              else{
                  var d=$.dialog({
                      content: '<div class="text-center">'+msg+'</div>',
                      title: false, // hides the title.
                      closeIcon: false, // hides the close icon.
                      columnClass: 'xsmall',
                      onOpen: function(){
                          setTimeout(function(){
                              d.close();
                          }, 1000);
                      }
                  });
              }
          }
      });

  });
</script>

<!--选择单个商品出现选中状态 -->
<script type="text/javascript">
   $(function () {
       var store_id = $('input[name=store_id]').val();
       $("input[name='check-name']:checkbox").each(function () {
           if ($(this).is(":checked")) {
               $(this).prop("checked", false);
           }
       });
       $.ajax({
           url: '?app=areaGood&act=getGoodData',
           type: 'POST',
           data: "store_id="+store_id,
           dataType: "json",
           success:function(msg) {
              if(msg.status ==0){
                  $("input[name='check-name']:checkbox").each(function () {
                      if ($(this).is(":checked")) {
                          $(this).prop("checked", false);
                      }
                  });
                  return false;
              }
               $.each(msg.info, function (key, value) {
                 $("input[name='check-name']:checkbox").each(function () {
                      if(value.goods_id == $(this).val()){
                           $(this).prop("checked", true);
                      }
                   });
               });
           }
      });
   });
</script>
<!--选择复选框多个商品出现选中状态 -->
<script type="text/javascript">
    $("input[name='multi_store[]']:checkbox").change(function () {
        var store_ids ='';
        $("input[name='multi_store[]']:checkbox").each(function () {
            if ($(this).is(":checked")) {
                store_ids += $(this).attr("value") + ",";
            }
        });
        $("input[name='check-name']:checkbox").each(function () {
            if ($(this).is(":checked")) {
                $(this).prop("checked", false);
            }
        });
        $.ajax({
            url: '?app=areaGood&act=getMultiGoodData',
            type: 'POST',
            data: "store_id="+store_ids,
            dataType: "json",
            success:function(msg) {
//                if(msg.status ==0){
//                    $("input[name='check-name']:checkbox").each(function () {
//                        if ($(this).is(":checked")) {
//                            $(this).prop("checked", false);
//                        }
//                    });
//                    return false;
//                }
                $.each(msg.info, function (key, value) {
                    $("input[name='check-name']:checkbox").each(function () {
                        if(value.goods_id == $(this).val()){

                            $(this).prop("checked", true);
                        }
                    });
                });
            }
        });
    });
</script>

{/literal}
