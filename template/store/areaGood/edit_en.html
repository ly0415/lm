<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <title>storeGood edit</title>
        {include file="public/header.html"}
    </head>
</head>
<body class="hold-transition skin-blue sidebar-mini">
    <div class="wrapper">

        {include file="public/title.html"}
        {include file="public/menu.html"}
        <!-- Content Wrapper. Contains page content -->
        <div class="content-wrapper">
            {include file="public/headtab.html"}
            <section class="content-header">
                <h1>
                    Good Edit
                </h1>
                <ol class="breadcrumb">
                    <li><a href="?app=default&act=index&lang_id={$lang_id}"><i class="fa fa-dashboard"></i> home page</a></li>
                    <li><a href="?app=areaGood&act=index&lang_id={$lang_id}">product information</a></li>
                    <li class="active">good edit</li>
                </ol>
            </section>
            <!-- Main content -->
            <section class="content">
                <!-- /.row -->
                <div class="row">
                    <div class="col-md-12">
                        <div class="box box-primary">
                            <form class="" id="form-goodsedit" action="?app=areaGood&act=doInfo"  method="post" data-type="ajax">
                                <div class="nav-tabs-custom tabs-new">
                                    <ul class="nav nav-tabs">
                                        <li class="active"><a href="#tab_1" data-toggle="tab">General information</a></li>
                                        <li><a href="#tab_2" data-toggle="tab">Specification information</a></li>
                                    </ul>
                                    <div class="tab-content">
                                        <div class="tab-pane active" id="tab_1">
                                            <div class="box-body">
                                                <div class="form-horizontal">
                                                    <div class="form-group">
                                                        <label class="col-sm-4 col-md-2  col-lg-2 control-label"><span class="text-red">*</span> Commodity name：</label>
                                                        <div class="col-sm-7 col-md-6 col-lg-5">
                                                            <input type="text" class="form-control" name="goods_name" value="{$goodInfo.goods_name}" readonly="readonly">
                                                            <input type="hidden"  name="lang_id" value="{$lang_id}" >
                                                            <input type="hidden" name="p" value="{$p}"/>
                                                            <input type="hidden" name="id" value="{$goodInfo.id}" />
                                                            <input type="hidden" name="returnUrl" value="{$returnUrl}">
                                                        </div>
                                                    </div>
                                                    <div class="form-group">
                                                        <label class="col-sm-4 col-md-2  col-lg-2 control-label"><span class="text-red">*</span> Commodity classification：</label>
                                                        <div class="col-sm-8 col-md-8 col-lg-6">
                                                            <select class="form-control w160 j_select inblock j-cate1" name="cat_1" disabled="disabled">
                                                                <option {if $cat_1 == 0} selected {/if}> Please choose the classification</option>
                                                                {foreach from=$cat_list_1 item=item}
                                                                <option value="{$item.id}" {if $cat_1 == $item.id} selected {/if}>{$item.name}</option>
                                                                {/foreach}
                                                            </select>
                                                            <select class="form-control w160 j_select inblock j-cate2" name="cat_2" disabled="disabled">
                                                                <option {if $cat_2 == 0} selected {/if}>Please choose the classification</option>
                                                                {foreach from=$cat_list_2 item=item}
                                                                <option value="{$item.id}" {if $cat_2 == $item.id} selected {/if}>{$item.name}</option>
                                                                {/foreach}
                                                            </select>
                                                            <select class="form-control w160 j_select inblock j-cate3" name="cat_id" disabled="disabled">
                                                                <option value="" {if $goodInfo.cat_id == 0} selected {/if}>Please choose the classification</option>
                                                                {foreach from=$cat_list_3 item=item}
                                                                <option value="{$item.id}" {if $goodInfo.cat_id == $item.id} selected {/if}>{$item.name}</option>
                                                                {/foreach}
                                                            </select>
                                                        </div>
                                                    </div>  
                                                    <div class="form-group j_room" {if empty($room_list)} style="display: none;" {/if}>
                                                         <label class="col-sm-4 col-md-2  col-lg-2 control-label"> Type of room：</label>
                                                        <div class="col-sm-7 col-md-6 col-lg-5">
                                                            <select class="form-control j_select j-room" name="room_id"  disabled="disabled">
                                                                <option value="0" {if $goodInfo.room_id == 0} selected {/if}>Please choose the type of room</option>
                                                                {foreach from=$room_list item=item}
                                                                <option value="{$item.id}" {if $goodInfo.room_id == $item.id} selected {/if}>{$item.room_name}</option>
                                                                {/foreach}
                                                            </select>
                                                        </div>
                                                    </div>
                                                    <div class="form-group" id="en_dis" >
                                                        <label class="col-sm-4 col-md-2  col-lg-2 control-label"><span class="text-red"></span> Auxiliary classification：</label>
                                                        <div class="col-sm-8 col-md-8 col-lg-7">
                                                            <div>  
                                                                {if $auxiliary[0]['auxiliary_list'] !=''}
                                                                <div class="tags-box inblock"  id="box1" >
                                                                    {foreach from=$auxiliary item =v}
                                                                    <span class="tag"><span value="0_{$v['auxiliary_list']['category_id']}_{$v['auxiliary_lists']['category_id']}_{$v['auxiliary_liste']['category_id']}">{$v['auxiliary_list']['category_name']},{$v['auxiliary_lists']['category_name']},{$v['auxiliary_liste']['category_name']}</span></span>
                                                                    {/foreach}
                                                                </div> 
                                                                {else}
                                                                <div class="tags-box inblock"  id="box1" >
                                                                    No classification
                                                                </div> 
                                                                {/if}
                                                            </div>
                                                        </div> 
                                                    </div> 
                                                    <div class="form-group">
                                                        <label class="col-sm-4 col-md-2  col-lg-2 control-label"> Commodity brand：</label>
                                                        <div class="col-sm-7 col-md-6 col-lg-5">
                                                            <select class="form-control j_select " name="brand_id" disabled="disabled">
                                                                <option>Please select the brand</option>
                                                                {foreach from=$brand_list item=item}
                                                                <option value="{$item.id}" {if $goodInfo.brand_id == $item.id} selected {/if}>{$item.name}</option>
                                                                {/foreach}
                                                            </select>
                                                        </div>
                                                    </div>
                                                    <div class="form-group">
                                                        <label class="col-sm-4 col-md-2  col-lg-2 control-label"> Commodity style：</label>
                                                        <div class="col-sm-7 col-md-6 col-lg-5">
                                                            <select class="form-control j_select " name="style_id" disabled="disabled">
                                                                <option>Please choose style</option>
                                                                {foreach from=$style_list item=item}
                                                                <option value="{$item.id} " {if $goodInfo.style_id == $item.id} selected {/if}>{$item.style_name}</option>
                                                                {/foreach}
                                                            </select>
                                                        </div>
                                                    </div>
                                                    <div class="form-group">
                                                        <label class="col-sm-4 col-md-2  col-lg-2 control-label"> Commodity introduction：</label>
                                                        <div class="col-sm-7 col-md-6 col-lg-5">
                                                            <textarea  name="goods_remark" rows="3" cols="44" class="form-control" readonly="readonly">{$goodInfo.goods_remark}</textarea>
                                                        </div>
                                                    </div>
                                                    <div class="form-group">
                                                        <label class="col-sm-4 col-md-2  col-lg-2 control-label"><span class="text-red">*</span> Original stock：</label>
                                                        <div class="col-sm-7 col-md-6 col-lg-5">
                                                            <input type="text" class="form-control" name="goods_storage" value="{$goodInfo.goods_storage}">
                                                        </div>
                                                    </div>
                                                    <div class="form-group">
                                                        <label class="col-sm-4 col-md-2  col-lg-2 control-label"><span class="text-red">*</span> Regional currency：</label>
                                                        <div class="col-sm-7 col-md-6 col-lg-5">
                                                            <input type="text" class="form-control" name="bizhong" value="{$currencyInfo.short}（{$currencyInfo.symbol}）" disabled="disabled">
                                                            <!--<p class="mb0"><a href="?app=site&act=SiteList">重新设定币种</a></p>-->
                                                        </div>
                                                    </div>
                                                    <div class="form-group">
                                                        <label class="col-sm-4 col-md-2  col-lg-2 control-label"><span class="text-red">*</span> The price of our shop：</label>
                                                        <div class="col-sm-7 col-md-6 col-lg-5">
                                                            <input type="text" class="form-control" name="shop_price" value="{$goodInfo.shop_price}">
                                                        </div>
                                                    </div>
                                                    <div class="form-group">
                                                        <label class="col-sm-4 col-md-2  col-lg-2 control-label"><span class="text-red">*</span> Market value：</label>
                                                        <div class="col-sm-7 col-md-6 col-lg-5">
                                                            <input type="text" class="form-control" name="market_price" value="{$goodInfo.market_price}">
                                                        </div>
                                                    </div>
                                                    <div class="form-group">
                                                        <label class="col-sm-4 col-md-2  col-lg-2 control-label">Whether or not to post：</label>
                                                        <div class="col-sm-3">
                                                            {if $goodInfo.is_free_shipping eq 1}
                                                            <input  type="checkbox" name="is_free_shipping" value="1" checked>
                                                            {else}
                                                            <input  type="checkbox" name="is_free_shipping" value="2">
                                                            {/if}
                                                        </div>
                                                    </div>
                                                    <div class="form-group is_shipping"  {if $goodInfo.is_free_shipping == 1} style="display: none" {/if}>
                                                         <label class="col-sm-4 col-md-2  col-lg-2 control-label"><span class="text-red">*</span>Postage：</label>
                                                        <div class="col-sm-3">
                                                            <input  type="text" name="shipping_price" class="shipping_price" value="{$goodInfo.shipping_price}">（{$currencyInfo.symbol}）
                                                        </div>
                                                    </div>
                                                    <div class="form-group">
                                                        <label class="col-sm-4 col-md-2  col-lg-2 control-label"> Commodity keywords：</label>
                                                        <div class="col-sm-7 col-md-6 col-lg-5">
                                                            <input type="text" class="form-control" name="keywords" value="{$keywords.keywords}" readonly="readonly">
                                                        </div>
                                                    </div>
                                                    <!--<div class="form-group">-->
                                                    <!--<label class="col-sm-4 col-md-2  col-lg-2 control-label"> 商品二维码：</label>-->
                                                    <!--<div class="col-sm-7 col-md-6 col-lg-5">-->
                                                    <!--<img src="{$goodInfo.code_url}">-->
                                                    <!--</div>-->
                                                    <!--</div>-->
                                                    <!--<div class="form-group">-->
                                                    <!--<label class="col-sm-4 col-md-2 col-lg-2 control-label"> 商品详情描述：</label>-->
                                                    <!--<div class="col-sm-7 col-md-6 col-lg-5">-->
                                                    <!--<div class="editor">-->
                                                    <!--<textarea name="goods_content" style="width: 700px;height: 250px;">{$goodInfo.goods_content}</textarea>-->
                                                    <!--</div>-->
                                                    <!--</div>-->
                                                    <!--</div>-->
                                                </div>
                                                <!-- form -->
                                            </div>
                                        </div>
                                        <!-- /.tab-pane -->
                                        <div class="tab-pane" id="tab_2">
                                            <div class="box-body" id="tab_goods_images">
                                                <table class="table table-bordered">
                                                    <tr>
                                                        <th>Commodity specification</th>
                                                        <th>Commodity number</th>
                                                        <th>Businesssku</th>
                                                        <th>currency</th>
                                                        <th>Selling price</th>
                                                        <th>Stock</th>

                                                    </tr>
                                                    {foreach from=$itemList item=v}
                                                    <tr>
                                                        <td class="vm">{$v.key_name}</td>
                                                        <td class="vm">{$goodInfo.goods_sn}</td>
                                                        <td class="vm">{$v.sku}</td>
                                                        <td class="vm">{$currencyInfo.short}（{$currencyInfo.symbol}）</td>
                                                        <td>
                                                            <input type="text" class="form-control" value="{$v.price}"  name="item[{$v.id}][price]"/>
                                                        </td>
                                                        <td class="vm">
                                                            <div class="updown-box clearfix">
                                                                <span class="down pull-left">-</span>
                                                                <input type="text" class="form-control num pull-left" style="width: 50px;" value="{$v.goods_storage}" name="item[{$v.id}][goods_storage]"/>
                                                                <span class="up pull-left">+</span>
                                                            </div>
                                                        </td>
                                                    </tr>
                                                    {/foreach}
                                                </table>

                                            </div>
                                        </div>
                                        <!-- /.tab-pane -->
                                        <div class="box-footer">
                                            <div class="form-group">
                                                <div class="col-sm-6 col-sm-offset-4 col-md-5 col-md-offset-2 col-lg-4 col-lg-offset-2">
                                                    <a href="?app=areaGood&act=index&lang_id={$lang_id}&p={$p}" class="btn btn-default"><i class="fa fa-times-circle"></i> Close</a>
                                                    <button  id="submit" class="btn btn-primary pull-right"><i class="fa fa-save"></i> Preservation
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <!-- /.tab-content -->
                                </div>
                            </form>
                        </div>
                        <!-- /.box -->
                    </div>
                </div>
            </section>
            <!-- /.content -->
        </div>
        <!-- /.content-wrapper -->
        {include file="public/footer.html"}
    </div>
    <!-- ./wrapper -->
    {literal}
    <script type="text/javascript">
        $(function () {
            $("[name='is_free_shipping']").bootstrapSwitch({
                onText: "yes",
                offText: "no",
                size: "small",
                onSwitchChange: function (event, state) {
                    if (state == true) {
                        $(this).val("1");
                        $(".is_shipping").hide();
                    } else {
                        $(this).val("2");
                        $(".is_shipping").show();
                    }
                }
            });
        })
        $(function () {
            $('body').on('blur', '.sprice', function () {
                var pnumb = $('.pnumb').text();
                var sprice = $('.sprice').val();
                var kc = $('.kc').val();
                var html = pnumb + ',' + sprice + ',' + kc;
                //console.log(html);
                $.ajax({
                    type: "GET",
                    dataType: "json",
                    url: '',
                    data: html,
                    success: function (obj) {

                    },
                    error: function (obj) {

                    }
                })
            })
        })
        $(function () {
            $('body').on('click', '.down,.up', function () {
                var pnumb = $('.pnumb').text();
                var sprice = $('.sprice').val();
                var kc = $('.kc').val();
                var html = pnumb + ',' + sprice + ',' + kc;
                //console.log(html);
                $.ajax({
                    type: "GET",
                    dataType: "json",
                    url: '',
                    data: html,
                    success: function (obj) {

                    },
                    error: function (obj) {

                    }
                })
            })
        })
        $(function () {
            $("[name='my-checkbox1']").bootstrapSwitch({
                onText: "ON",
                offText: "OFF",
                size: "small",
                onSwitchChange: function (event, state) {
                    if (state == true) {
                        var id = $(this).attr('item_id');
                        $(this).val("1");
                        var is_on_sale = $(this).val();
                        $.ajax({
                            url: 'admin.php?app=areaGood&act=getStatus',
                            type: 'POST',
                            data: {'id': id, 'is_on_sale': is_on_sale},
                            dataType: "json",
                            success: function (msg) {
                                if (msg.status == 1) {
                                    //                                window.location.reload();
                                } else {
                                    var d = $.dialog({
                                        content: '<div class="text-center">' + msg.message + '</div>',
                                        title: false, // hides the title.
                                        closeIcon: false, // hides the close icon.
                                        columnClass: 'xsmall',
                                        onOpen: function () {
                                            setTimeout(function () {
                                                d.close();
                                            }, 400);
                                        }
                                    });
                                    setTimeout(function () {
                                        window.location.reload();
                                    }, 1000);
                                }
                            }
                        });
                    } else {
                        var id = $(this).attr('item_id');
                        $(this).val("2");
                        var is_on_sale = $(this).val();
                        $.ajax({
                            url: 'admin.php?app=areaGood&act=getStatus',
                            type: 'POST',
                            data: {'id': id, 'is_on_sale': is_on_sale},
                            dataType: "json",
                            success: function (msg) {
                                if (msg.status == 1) {
                                    //                                window.location.reload();
                                }
                            }
                        });
                    }
                }
            });
        })

        $(function () {
            //库存的增加和减少
            $('.updown-box .up').click(function () {
                var num = $(this).parent('.updown-box').find(' .num').val();
                $(this).prev().val(parseInt(num) + 1);
            })
            $('.updown-box .down').click(function () {
                var num = $(this).parent('.updown-box').find(' .num').val();
                if (num == 0) {
                    return false;
                } else {
                    $(this).next().val(parseInt(num) - 1);
                }
            })
        })
    </script>
    <script type="text/javascript">
        $('#goodSubmit').click(function () {
            var id = $('input[name=id]').val();
            var shop_price = $('input[name=shop_price]').val();
            var goods_storage = $('input[name=goods_storage]').val();
            console.log(goods_storage);
            if (shop_price == 0) {
                var d = $.dialog({
                    content: '<div class="text-center">The price can t be zero！</div>',
                    title: false, // hides the title.
                    closeIcon: false, // hides the close icon.
                    columnClass: 'xsmall',
                    onOpen: function () {
                        setTimeout(function () {
                            d.close();
                        }, 400);
                    }
                });
                return false;
            }
            var pre = /(^[1-9]\d*(\.\d{1,2})?$)|(^0(\.\d{1,2})?$)/;
            if (!pre.test(shop_price)) {
                var d = $.dialog({
                    content: '<div class="text-center">Incorrect sales price format！</div>',
                    title: false, // hides the title.
                    closeIcon: false, // hides the close icon.
                    columnClass: 'xsmall',
                    onOpen: function () {
                        setTimeout(function () {
                            d.close();
                        }, 400);
                    }
                });
                return false;
            }
            var preg = /^\d+$/;
            if (!preg.test(goods_storage)) {
                var d = $.dialog({
                    content: '<div class="text-center">The format of inventory is not correct！</div>',
                    title: false, // hides the title.
                    closeIcon: false, // hides the close icon.
                    columnClass: 'xsmall',
                    onOpen: function () {
                        setTimeout(function () {
                            d.close();
                        }, 400);
                    }
                });
                return false;
            }
            $.ajax({
                url: 'admin.php?app=areaGood&act=doSPrice',
                type: 'POST',
                data: {'id': id, 'shop_price': shop_price, 'goods_storage': goods_storage},
                dataType: "json",
                success: function (msg) {
                    if (msg.status == 1) {
                        var d = $.dialog({
                            content: '<div class="text-center">' + msg.message + '</div>',
                            title: false, // hides the title.
                            closeIcon: false, // hides the close icon.
                            columnClass: 'xsmall',
                            onOpen: function () {
                                setTimeout(function () {
                                    d.close();
                                }, 400);
                            }
                        });
                        setTimeout(function () {
                            window.location.reload();
                        }, 1000);
                    } else {
                        var d = $.dialog({
                            content: '<div class="text-center">' + msg.message + '</div>',
                            title: false, // hides the title.
                            closeIcon: false, // hides the close icon.
                            columnClass: 'xsmall',
                            onOpen: function () {
                                setTimeout(function () {
                                    d.close();
                                }, 400);
                            }
                        });
                        setTimeout(function () {
                            window.location.reload();
                        }, 1000);
                    }
                }
            });

        });
        //富文本编辑框

        KindEditor.ready(function (K) {
            editor = K.create('textarea[name="goods_content"]', {
                allowFileManager: true,
                afterBlur: function () {
                    this.sync();
                }
            });
        });
    </script>
    {/literal}
</body>
</html>
