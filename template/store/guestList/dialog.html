<style>
    .form-group-sm select.form-control {
        height: 30px;
        width: 127px;
        line-height: 30px;
    }
</style>
{if $lang_id ==1}
<div class="height">
    <div class="new-table-responsive">
        <div class="box-body table-responsive no-padding ">
            <div class="box-header">
                <div class="form-inline col-sm-10 col-md-11 no-padding">
                    <!--                    <div class="form-group form-group-sm form-mar">
                                            <input type="text" class="form-control"  value=""  name="gname"  placeholder="请输入商品名称">
                                        </div>-->
                    <div class="form-group form-group-sm form-mar">
                        <label class="col-sm-3 col-md-2  col-lg-2 control-label"> Screen：</label>
                        <div class="col-sm-3">
                            <select class="form-control" name="ctglev1"  id="ctglev1"  onchange="getctglist(this.id, 'ctglev2')"  >
                                <option value="0">Top-level classification</option>
                                {foreach from=$ctglev1 item=val}
                                <option value='{$val.id}'>{$val.category_name}</option>
                                {/foreach}
                            </select>
                        </div>
                        <div class="col-sm-3">
                            <select class="form-control" name="ctglev2"  id="ctglev2"  onchange="getctglist(this.id, 'ctglev3')">
                                <option value="0" >Please choose the classification</option>
                            </select>
                        </div>
                        <div class="col-sm-3">
                            <select class="form-control" name="ctglev3"  id="ctglev3"  >
                                <option value="0">Please choose the classification</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group form-group-sm form-mar">
                        <button type="button" class="btn btn-default btn-sm" id="submit1">
                            Search <i class="fa fa-search"></i>
                        </button>
                    </div>
                </div>
            </div>
            <input type="hidden"  name="totalpage"  value="{$totalpage}" >
            <table class="table tc-box" id="content">
                <thead>
                    <tr>
                        <th><input type="checkbox" name="" id="child-all"/></th>
                        <th>Commodity picture</th>
                        <th>Commodity name</th>
                        <th>Market price</th>
                        <th>Selling price</th>
                    </tr>
                </thead>
                <tbody >
                    {foreach from=$data item=item}
                    <tr>
                        <td><input type="checkbox" name="check-name" data-name="{$item.goods_name}" data-id="{$item.id}" data-mprice="{$item.market_price}" data-sprice="{$item.shop_price}" data-url="{$item.original_img}" data-goodsid="{$item.goods_id}"/></td>
                        <td><img src="{$item.original_img}" width="60" height="50"></td>
                        <td>{$item.goods_name}</td>
                        <td>{$symbol}{$item.market_price}</td>
                        <td>{$symbol}{$item.shop_price}</td>
                    </tr>
                    <tr>
                        <td></td>
                        <td colspan="3" class="t1 att">
                            {foreach from=$item.specarr item=v key=k}
                            <a href="##" class="ncbtn {if $k==0} active {/if}" data-attr="{$v.key_name}" data-key="{$v.key}" data-iprice="{$v.price}" data-item="{$v.id}">{$v.key_name}</a>
                            {/foreach}
                        </td>
                        <td></td>
                    </tr>
                    {/foreach}




                </tbody>
            </table>
            <div class="page-box">
                <ul id="page" class="pagination" >
                </ul>
            </div>
        </div>
    </div>
</div>
{literal}
<script>
    /**
     * 三级联动
     * @param id
     * @param tag
     */
    function getctglist(id, tag) {
        var d = $('#' + id).find('option:selected').val();
        if (parseInt(d) > 0) {
            var url = '?app=guestList&act=getctglist&id=' + d;
            $.get(url, function (res) {
                console.log(res);
                var html = '';
                html += ' <option value="0">Please choose the classification</option>';
                $.each(res, function (i, n) {
                    html += '<option  value=' + n.id + ' >' + n.category_name + '</option>';
                });

                $('#' + tag).html(html);

            }, 'json');

        } else {
            $('#' + tag).html('<option value="0">Please choose the classification</option>');
            $('#ctglev3').html('<option value="0">Please choose the classification</option>');
        }

    }
</script>
{/literal}
{literal}
<script type="text/javascript">
    // active样式选择
    $(function () {
        $('.tc-box').on('click', '.ncbtn', function () {
            $(this).toggleClass('active');
        })
    })
    //属性的显示隐藏
    $(function () {
        $('.tc-box tbody tr:nth-child(even)').css('display', 'none');
          $('.tc-box').on('click', '#child-all', function () {
             var checkbox_all = $('table tr td input[name=check-name]');
            if ($(this).is(':checked')) {
                    for (var i = 0, l = checkbox_all.length; i < l; i++) {
                        checkbox_all[i].checked = true;
                    }
                      $(this).parents('thead').next().find('tr:nth-child(even)').show();
                }else {
                    for (var i = 0, l = checkbox_all.length; i < l; i++) {
                        checkbox_all[i].checked = false;
                    }
                      $(this).parents('thead').next().find('tr:nth-child(even)').hide();
                }
//                $(this).parents('thead').next().find('tr:nth-child(even)').show();
//            } else {
//                $(this).parents('thead').next().find('tr:nth-child(even)').hide();
//            }
        })
        $('.tc-box').on('click', 'input[name="check-name"]', function () {
            if ($(this).is(':checked')) {
                $(this).parents('tr').next().show();
            } else {
                $(this).parents('tr').next().hide();
            }
        })
    })


    /*分页*/
    $(function () {

        var is_firsttime = true;
        var totalpage = $('input[name="totalpage"]').val();
        totalpage = parseInt(totalpage);
        $('#page').jqPaginator({
            totalPages: totalpage,
            visiblePages: 7,
            currentPage: 1,
            first: '<li class="prev"><a href="javascript:;">Home</a></li>',
            prev: '<li class="prev"><a href="javascript:;">Previous page</a></li>',
            next: '<li class="next"><a href="javascript:;">Next page</a></li>',
            page: '<li class="page"><a href="javascript:;">{{page}}</a></li>',
            last: '<li class="prev"><a href="javascript:;">Tail page</a></li>',
            onPageChange: function (num, type) {
                if (is_firsttime) {
                    is_firsttime = false;
                } else {
                    //ajax获取
                    var url = '?app=guestList&act=getGoodsList&p=' + num + '&lang_id=1';
                    $.get(url, function (res) {
                        $('#content').html(res);
                        $('.tc-box tbody tr:nth-child(even)').css('display', 'none');
                    });
                }
            }
        });
        /*搜索*/
        $('#submit1').click(function () {
            var ctglev3 = $.trim($('select[name="ctglev3"]').val());
            totalPage(ctglev3);
        });
        function totalPage(ctglev3) {
            //ajax
            if (ctglev3 == 0) {
                var d = $.dialog({
                    content: '<div class="text-center">Please select the three level classification and search for the goods</div>',
                    title: false, // hides the title.
                    closeIcon: false, // hides the close icon.
                    columnClass: 'xsmall',
                    onOpen: function () {
                        setTimeout(function () {
                            d.close();
                        }, 2000);
                    }
                });
                return false;
            }
            var url = '?app=guestList&act=totalPage&ctglev3=' + ctglev3;
            $.get(url, function (res) {
                var obj = jQuery.parseJSON(res);
                var r = obj.total;
                $('#page').jqPaginator({
                    totalPages: r,
                    visiblePages: 7,
                    currentPage: 1,
                    first: '<li class="prev"><a href="javascript:;">Home</a></li>',
                    prev: '<li class="prev"><a href="javascript:;">Previous page</a></li>',
                    next: '<li class="next"><a href="javascript:;">Next page</a></li>',
                    page: '<li class="page"><a href="javascript:;">{{page}}</a></li>',
                    last: '<li class="prev"><a href="javascript:;">Tail page</a></li>',
                    onPageChange: function (num, type) {
                        //ajax
                        var url = '?app=guestList&act=getGoodsList&p=' + num + '&ctglev3=' + ctglev3 + '&lang_id=1';
                        $.get(url, function (res) {
                            $('#content').html(res);
                            $('.tc-box tbody tr:nth-child(even)').css('display', 'none');
                        });
                    }
                });
            })
        }
    })
</script>
{/literal}
{else}
<div class="height">
    <div class="new-table-responsive">
        <div class="box-body table-responsive no-padding ">
            <div class="box-header">
                <div class="form-inline col-sm-10 col-md-11 no-padding">
                    <!--                    <div class="form-group form-group-sm form-mar">
                                            <input type="text" class="form-control"  value=""  name="gname"  placeholder="请输入商品名称">
                                        </div>-->
                    <div class="form-group form-group-sm form-mar">
                        <label class="col-sm-3 col-md-2  col-lg-2 control-label"> 分类查询：</label>
                        <div class="col-sm-3">
                            <select class="form-control" name="ctglev1"  id="ctglev1"  onchange="getctglist(this.id, 'ctglev2')"  >
                                <option value="0">顶级分类</option>
                                {foreach from=$ctglev1 item=val}
                                <option value='{$val.id}'>{$val.category_name}</option>
                                {/foreach}
                            </select>
                        </div>
                        <div class="col-sm-3">
                            <select class="form-control" name="ctglev2"  id="ctglev2"  onchange="getctglist(this.id, 'ctglev3')">
                                <option value="0" >请选择分类</option>
                            </select>
                        </div>
                        <div class="col-sm-3">
                            <select class="form-control" name="ctglev3"  id="ctglev3"  >
                                <option value="0">请选择分类</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group form-group-sm form-mar">
                        <button type="button" class="btn btn-default btn-sm" id="submit1">
                            搜索 <i class="fa fa-search"></i>
                        </button>
                    </div>
                </div>
            </div>
            <input type="hidden"  name="totalpage"  value="{$totalpage}" >
            <table class="table tc-box" id="content">
                <thead>
                    <tr>
                        <th><input type="checkbox" name="" id="child-all"/></th>
                        <th>商品图片</th>
                        <th>商品名称</th>
                        <th>市场价格</th>
                        <th>销售价格</th>
                    </tr>
                </thead>
                <tbody >
                    {foreach from=$data item=item}
                    <tr>
                        <td><input type="checkbox" name="check-name" data-name="{$item.goods_name}" data-id="{$item.id}" data-mprice="{$item.market_price}" data-sprice="{$item.shop_price}" data-url="{$item.original_img}" data-goodsid="{$item.goods_id}"/></td>
                        <td><img src="{$item.original_img}" width="60" height="50"></td>
                        <td>{$item.goods_name}</td>
                        <td>{$symbol}{$item.market_price}</td>
                        <td>{$symbol}{$item.shop_price}</td>
                    </tr>
                    <tr>
                        <td></td>
                        <td colspan="3" class="t1 att">
                            {foreach from=$item.specarr item=v key=k}
                            <a href="##" class="ncbtn {if $k==0} active {/if}" data-attr="{$v.key_name}" data-key="{$v.key}" data-iprice="{$v.price}" data-item="{$v.id}">{$v.key_name}</a>
                            {/foreach}
                        </td>
                        <td></td>
                    </tr>
                    {/foreach}




                </tbody>
            </table>
            <div class="page-box">
                <ul id="page" class="pagination" >
                </ul>
            </div>
        </div>
    </div>
</div>
{literal}
<script>
    /**
     * 三级联动
     * @param id
     * @param tag
     */
    function getctglist(id, tag) {
        var d = $('#' + id).find('option:selected').val();
        if (parseInt(d) > 0) {
            var url = '?app=guestList&act=getctglist&id=' + d;
            $.get(url, function (res) {
                console.log(res);
                var html = '';
                html += ' <option value="0">请选择分类</option>';
                $.each(res, function (i, n) {
                    html += '<option  value=' + n.id + ' >' + n.category_name + '</option>';
                });

                $('#' + tag).html(html);

            }, 'json');

        } else {
            $('#' + tag).html('<option value="0">请选择分类</option>');
            $('#ctglev3').html('<option value="0">请选择分类</option>');
        }

    }
</script>
{/literal}
{literal}
<script type="text/javascript">
    // active样式选择
    $(function () {
        $('.tc-box').on('click', '.ncbtn', function () {
            $(this).toggleClass('active');
        })
    })
    //属性的显示隐藏
    $(function () {
        $('.tc-box tbody tr:nth-child(even)').css('display', 'none');
        $('.tc-box').on('click', '#child-all', function () {
             var checkbox_all = $('table tr td input[name=check-name]');
            if ($(this).is(':checked')) {
                    for (var i = 0, l = checkbox_all.length; i < l; i++) {
                        checkbox_all[i].checked = true;
                    }
                      $(this).parents('thead').next().find('tr:nth-child(even)').show();
                }else {
                    for (var i = 0, l = checkbox_all.length; i < l; i++) {
                        checkbox_all[i].checked = false;
                    }
                      $(this).parents('thead').next().find('tr:nth-child(even)').hide();
                }
//                $(this).parents('thead').next().find('tr:nth-child(even)').show();
//            } else {
//                $(this).parents('thead').next().find('tr:nth-child(even)').hide();
//            }
        })
        $('.tc-box').on('click', 'input[name="check-name"]', function () {
            if ($(this).is(':checked')) {
                $(this).parents('tr').next().show();
            } else {
                $(this).parents('tr').next().hide();
            }
        })
    })


    /*分页*/
    $(function () {

        var is_firsttime = true;
        var totalpage = $('input[name="totalpage"]').val();
        totalpage = parseInt(totalpage);
        $('#page').jqPaginator({
            totalPages: totalpage,
            visiblePages: 7,
            currentPage: 1,
            first: '<li class="prev"><a href="javascript:;">首页</a></li>',
            prev: '<li class="prev"><a href="javascript:;">上一页</a></li>',
            next: '<li class="next"><a href="javascript:;">下一页</a></li>',
            page: '<li class="page"><a href="javascript:;">{{page}}</a></li>',
            last: '<li class="prev"><a href="javascript:;">尾页</a></li>',
            onPageChange: function (num, type) {
                if (is_firsttime) {
                    is_firsttime = false;
                } else {
                    //ajax获取
                    var url = '?app=guestList&act=getGoodsList&p=' + num;
                    $.get(url, function (res) {
                        $('#content').html(res);
                        $('.tc-box tbody tr:nth-child(even)').css('display', 'none');
                    });
                }
            }
        });
        /*搜索*/
        $('#submit1').click(function () {
            var ctglev3 = $.trim($('select[name="ctglev3"]').val());
            totalPage(ctglev3);
        });
        function totalPage(ctglev3) {
            //ajax
            if (ctglev3 == 0) {
                var d = $.dialog({
                    content: '<div class="text-center">请选择三级分类后在进行商品搜索</div>',
                    title: false, // hides the title.
                    closeIcon: false, // hides the close icon.
                    columnClass: 'xsmall',
                    onOpen: function () {
                        setTimeout(function () {
                            d.close();
                        }, 2000);
                    }
                });
                return false;
            }
            var url = '?app=guestList&act=totalPage&ctglev3=' + ctglev3;
            $.get(url, function (res) {
                var obj = jQuery.parseJSON(res);
                var r = obj.total;
                $('#page').jqPaginator({
                    totalPages: r,
                    visiblePages: 7,
                    currentPage: 1,
                    first: '<li class="prev"><a href="javascript:;">首页</a></li>',
                    prev: '<li class="prev"><a href="javascript:;">上一页</a></li>',
                    next: '<li class="next"><a href="javascript:;">下一页</a></li>',
                    page: '<li class="page"><a href="javascript:;">{{page}}</a></li>',
                    last: '<li class="prev"><a href="javascript:;">尾页</a></li>',
                    onPageChange: function (num, type) {
                        //ajax
                        var url = '?app=guestList&act=getGoodsList&p=' + num + '&ctglev3=' + ctglev3;
                        $.get(url, function (res) {
                            $('#content').html(res);
                            $('.tc-box tbody tr:nth-child(even)').css('display', 'none');
                        });
                    }
                });
            })
        }
    })
</script>
{/literal}
{/if}


