<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>站点商品编辑</title>
    {include file="public/header.html"}
</head>
</head>
<body class="hold-transition skin-blue sidebar-mini">
<div class="wrapper">

    {include file="public/title.html"}
    {include file="public/menu.html"}
    <!-- Content Wrapper. Contains page content -->
    <div class="content-wrapper">
        {include file="public/headtab.html"}
        <section class="content-header">
            <h1>
                区域站点商品编辑
            </h1>
            <ol class="breadcrumb">
                <li><a href="?app=default&act=index"><i class="fa fa-dashboard"></i> 首页</a></li>
                <li><a href="?app=areaGood&act=index">区域站点设置</a></li>
                <li class="active">商品编辑</li>
            </ol>
        </section>
        <!-- Main content -->
        <section class="content">
            <!-- /.row -->
            <div class="row">
                <div class="col-xs-12">
                    <div class="box box-primary">
                        <div class="box-header">
                            <div class="col-sm-2 col-md-3 no-padding">
                                <a class="btn btn-primary btn-sm" href="?app=good&act=goodList">返回</a>
                            </div>
                        </div>
                        <div class="new-table-responsive">
                            <div class="box-body table-responsive no-padding ">
                                <table class="table table-hover middle-box">
                                    <tr>
                                        <th>商品编号</th>
                                        <th>商家sku</th>
                                        <th>市场价格</th>
                                        <th>销售价格</th>
                                        <th>库存</th>
                                    </tr>
                                    <tr>
                                        <td class="vm">{$goodInfo.goods_sn}</td>
                                        <td class="vm">{$goodInfo.sku}</td>
                                        <td>
                                            <input type="text" class="form-control" disabled="disabled" value="{$goodInfo.market_price}"/>
                                        </td>
                                        <td>
                                            <input type="text" class="form-control" value="{$goodInfo.shop_price}"  name="shop_price"/>
                                        </td>
                                        <td class="vm">
                                            <div class="updown-box clearfix">
                                                <span class="down pull-left">-</span>
                                                <input type="text" class="form-control num pull-left" style="width: 50px;" value="{$goodInfo.goods_storage}" name="goods_storage"/>
                                                <span class="up pull-left">+</span>
                                            </div>
                                        </td>
                                        <input type="hidden" name="id" value="{$goodInfo.id}" />
                                    </tr> 
                                </table>
                                {if $hasList ==1}
                                <hr/>
                                <table class="table table-hover middle-box">
                                    <tr>
                                        <th>商品编号</th>
                                        <th>商家sku</th>
                                        <th>商品规格</th>
                                        <th>市场价格</th>
                                        <th>销售价格</th>
                                        <th>库存</th>
                                    </tr>
                                    {foreach from=$specList item=item}
                                    <tr>
                                        <td class="vm">{$goodInfo.goods_sn}</td>
                                        <td class="vm">{$goodInfo.sku}</td>
                                        <td class="vm">{$item.key_name}</td>
                                        <td>
                                            <input type="text" class="form-control" disabled="disabled" value="{$goodInfo.market_price}"/>
                                        </td>
                                        <td>
                                            <input type="text" class="form-control" value="{$item.price}"  name="shop_price"/>
                                        </td>
                                        <td class="vm">
                                            <div class="updown-box clearfix">
                                                <span class="down pull-left">-</span>
                                                <input type="text" class="form-control num pull-left" style="width: 50px;" value="{$item.goods_storage}" name="goods_storage"/>
                                                <span class="up pull-left">+</span>
                                            </div>
                                        </td>
                                        <input type="hidden" name="id" value="{$goodInfo.id}" />
                                    </tr>
                                    {/foreach}
                                </table>
                                {/if}
                            </div>
                        </div>
                        <div class="box-footer clearfix">
                               <!-- 放分页 -->
                        </div>
                        <div class="text-center mt60 pd60">
                            <button type="submit" class="btn btn-primary" id="goodSubmit"><i class="fa fa-save"></i> 保 存</button>
                        </div>
                        <!-- /.box-body -->
                    </div>
                </div>
            </div>
        </section>
        <!-- /.content -->
    </div>
    <!-- /.content-wrapper -->
    {include file="public/footer.html"}
</div>
<!-- ./wrapper -->
{literal}
<script type="text/javascript">
      $(function(){
        //库存的增加和减少 
        $('.updown-box .up').click(function(){
            var num = $('.updown-box .num').val();
            $(this).prev().val(parseInt(num) + 1);
        })
        $('.updown-box .down').click(function(){
            var num = $('.updown-box .num').val();
            if(num == 0){
                return false;
            }else{
                $(this).next().val(parseInt(num) - 1);
            }
        })
      })
</script>
<script type="text/javascript">
    $('#goodSubmit').click(function(){
       var id = $('input[name=id]').val();
       var shop_price = $('input[name=shop_price]').val();
       var goods_storage = $('input[name=goods_storage]').val();
       if(shop_price == 0){
           var d=$.dialog({
               content: '<div class="text-center">价格不能为零！</div>',
               title: false, // hides the title.
               closeIcon: false, // hides the close icon.
               columnClass: 'xsmall',
               onOpen: function(){
                   setTimeout(function(){
                       d.close();
                   }, 400);
               }
           });
           return false;
       }
       var pre = /(^[1-9]\d*(\.\d{1,2})?$)|(^0(\.\d{1,2})?$)/;
       if(!pre.test(shop_price)){
           var d=$.dialog({
               content: '<div class="text-center">销售价格格式不正确！</div>',
               title: false, // hides the title.
               closeIcon: false, // hides the close icon.
               columnClass: 'xsmall',
               onOpen: function(){
                   setTimeout(function(){
                       d.close();
                   }, 400);
               }
           });
           return false;
       }
       var preg = /^-[1-9]d*|0$/;
        if(!preg.test(goods_storage)){
            var d=$.dialog({
                content: '<div class="text-center">库存数量不正确！</div>',
                title: false, // hides the title.
                closeIcon: false, // hides the close icon.
                columnClass: 'xsmall',
                onOpen: function(){
                    setTimeout(function(){
                        d.close();
                    }, 400);
                }
            });
            return false;
        }
        $.ajax({
            url: '?app=good&act=doSPrice',
            type: 'POST',
            data: {'id':id,'shop_price':shop_price,'goods_storage':goods_storage},
            dataType: "json",
            success:function(msg) {
                if(msg.status==1){
                    var d=$.dialog({
                    content: '<div class="text-center">'+msg.message+'</div>',
                        title: false, // hides the title.
                        closeIcon: false, // hides the close icon.
                        columnClass: 'xsmall',
                        onOpen: function(){
                        setTimeout(function(){
                            d.close();
                        }, 400);
                    }
                });
                 setTimeout(function(){window.location.reload();},1000);
                }else{
                    var d=$.dialog({
                        content: '<div class="text-center">'+msg.message+'</div>',
                        title: false, // hides the title.
                        closeIcon: false, // hides the close icon.
                        columnClass: 'xsmall',
                        onOpen: function(){
                            setTimeout(function(){
                                d.close();
                            }, 400);
                        }
                    });
                    setTimeout(function(){window.location.reload();},1000);
                }
            }
        });
    });
</script>
{/literal}
</body>
</html>
