<!DOCTYPE html>
<html>
    <head>
        {include file="public/header.html"}
        <style>

        </style>
    </head>
    <body class="hold-transition skin-blue sidebar-mini">
        <div class="wrapper">
            {include file="public/title.html"}
            <!-- Left side column. contains the logo and sidebar -->
            {include file="public/menu.html"}

            <!-- Content Wrapper. Contains page content -->
            <div class="content-wrapper">

                <!-- Content Header (Page header) -->
                <section class="content-header">
                    <h1>
                        团购添加
                    </h1>
                    <ol class="breadcrumb">
                        <li><a href="store.php?app=default&act=index&lang_id={$lang_id}"><i class="fa fa-dashboard"></i> 首页</a></li>
                        <li class="active">促销管理</li>
                        <li class="active">团购添加</li>
                    </ol>

                </section>

                <!-- Main content -->
                <section class="content">
                    <!-- /.row -->
                    <form  id="groupform"  >
                        <div class="row">
                            <div class="col-xs-12">
                                <div class="box box-primary pb20">
                                    <div class="box-header">
                                        <div class="col-sm-1 col-md-1 no-padding pull-right">
                                            <a class="btn btn-primary pull-right btn-sm" href="store.php?app=groupbuy&act=grouplist&lang_id={$lang_id}&p={$p}"> 返回</a>
                                        </div>
                                    </div>

                                    <div class="form-horizontal">
                                        <div class="box-body">
                                            <input type="hidden" name="p"  value ="{$p}"/>
                                            <div class="form-group">
                                                <label class="col-sm-5 col-md-3  col-lg-3 control-label"><span class="text-red">*</span> 团购标题：</label>
                                                <div class="col-sm-7 col-md-6 col-lg-5">
                                                    <input type="text" class="form-control" name="title" >
                                                </div>
                                            </div>

                                            <div class="form-group">
                                                <label class="col-sm-5 col-md-3  col-lg-3 control-label"><span class="text-red">*</span> 开始时间：</label>
                                                <div class="col-sm-7 col-md-6 col-lg-5">
                                                    <input type="text" class="form-control w174 inblock"  name="start_time"  placeholder="" id="datepicker1" readonly />
                                                    <label class="">结束时间：</label>
                                                    <input type="text" class="form-control w174 inblock" name="end_time"  placeholder="" id="datepicker2" readonly />
                                                </div>
                                            </div>

                                            <div class="form-group">
                                                <label class="col-sm-5 col-md-3  col-lg-3 control-label"><span class="text-red">*</span> 团购价格：</label>
                                                <div class="col-sm-7 col-md-6 col-lg-5">
                                                    <input type="text" class="form-control" name="group_goods_price" >
                                                </div>
                                                <p >团购商品价格精确到正整数的后两位</p>
                                            </div>

                                            <div class="form-group">
                                                <label class="col-sm-5 col-md-3  col-lg-3 control-label"><span class="text-red">*</span> 商品参团库存：</label>
                                                <div class="col-sm-7 col-md-6 col-lg-5">
                                                    <input type="text" class="form-control" name="group_goods_num" >
                                                </div>
                                                <P  >请填写自然数，参与团购商品的数量</P>
                                            </div>

                                            <div class="form-group">
                                                <label class="col-sm-5 col-md-3  col-lg-3 control-label"><span class="text-red">*</span> 虚拟购买数：</label>
                                                <div class="col-sm-7 col-md-6 col-lg-5">
                                                    <input type="text" class="form-control" name="virtual_num" >
                                                </div>
                                                <p  >虚拟已购买参团人数</p>
                                            </div>

                                            <!--<div class="form-group">-->
                                            <!--<label class="col-sm-5 col-md-3  col-lg-3 control-label"><span class="text-red">*</span> 主商品：</label>-->
                                            <!--<div class="col-sm-7 col-md-6 col-lg-5">-->
                                            <!--<div class="zhuimg clearfix">-->
                                            <!--<div class="img pull-left">-->
                                            <!--<img src="../dist/img/ic8.png" width="80" height="80">-->
                                            <!--</div>-->
                                            <!--<div class="info pull-left">-->
                                            <!--<p class="price">￥ <span>3099</span></p>-->
                                            <!--<p class="name">艾美L'MERI267单人沙发</p>-->
                                            <!--</div>-->

                                            <!--</div>-->
                                            <!--</div>-->
                                            <!--</div>-->
                                        </div>
                                    </div>

                                    <div class="zuhesale clearfix">
                                        <div class="col-xs-12 header">
                                            <div class="col-xs-8">请选择商品</div>
                                            <div class="col-xs-4 text-right">
                                                <a href="javascript:;" class="btn btn-primary j_add">添加商品</a>
                                                <a href="javascript:;" class="btn btn-primary j_alldel">清除所有商品</a>
                                            </div>
                                        </div>
                                        <div class="col-xs-12 header-top ">
                                            <!--<div class="col-xs-8">-->
                                            <!--<label class="radio-inline">-->
                                            <!--<input type="radio" name="optionsRadios"  value="1" class="j_discount" checked>折扣-->
                                            <!--</label>-->
                                            <!--<label class="radio-inline">-->
                                            <!--<input type="radio" name="optionsRadios"  value="2" class="j_lessprice">减价-->
                                            <!--</label>-->
                                            <!--<input type="text" class="j_text form-control w100 inblock">-->
                                            <!--<button class="btn btn-primary ml60 j_edite">批量修改</button>-->
                                            <!--</div>-->
                                            <!--<div class="col-xs-4 text-right">-->
                                            <!--&lt;!&ndash; <a href="##" class="btn btn-primary">抹角</a>-->
                                            <!--<a href="##" class="btn btn-primary">抹分</a> &ndash;&gt;-->
                                            <!--</div>-->
                                        </div>
                                        <div class="col-xs-12">
                                            <div class="new-table-responsive mb20">
                                                <div class="box-body table-responsive no-padding ">
                                                    <table class="table table-bordered">
                                                        <thead>
                                                            <tr>
                                                                <th>图片</th>
                                                                <th>商品名称</th>
                                                                <th>原价</th>
                                                                <!--<th>打折</th>-->
                                                                <!--<th>减价</th>-->
                                                                <!--<th>折后价</th>-->
                                                                <!--<th>限购</th>-->
                                                                <th>操作</th>
                                                            </tr>
                                                        </thead>
                                                        <tbody class="j_tbody">

                                                        </tbody>
                                                    </table>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="box-footer">
                                        <div class="col-xs-5 col-xs-offset-3 ">
                                            <a href="store.php?app=groupbuy&act=grouplist&lang_id={$lang_id}&p={$p}" class="btn btn-default"><i class="fa fa-times-circle"></i> 关 闭</a>
                                            <button type="button" id="submit2" class="btn btn-primary pull-right"><i class="fa fa-save"></i> 保 存
                                            </button>
                                        </div>
                                    </div>

                                </div>
                            </div>
                        </div>
                    </form>
                </section>
                <!-- /.content -->
            </div>
            {include file="public/footer.html"}
        </div>

        {literal}
        <script type="text/javascript">
            //ajax提交保存
            $('#submit2').click(function () {
                //alert(12)
                var url = 'store.php?app=groupbuy&act=doadd';
                var data = $('#groupform').serializeArray();
                $.post(url, data, function (obj) {
                    var msg = obj.message;
                    if (obj.status == 1) {
                        var d = $.dialog({
                            content: '<div class="text-center">' + msg + '</div>',
                            title: false, // hides the title.
                            closeIcon: false, // hides the close icon.
                            columnClass: 'xsmall',
                            onOpen: function () {
                                setTimeout(function () {
                                    d.close();
                                }, 1000);
                            }
                        });
                        setTimeout(function () {
                            window.location.href = obj.info.url;
                        }, 1000);

                    } else {

                        var d = $.dialog({
                            content: '<div class="text-center">' + msg + '</div>',
                            title: false, // hides the title.
                            closeIcon: false, // hides the close icon.
                            columnClass: 'xsmall',
                            onOpen: function () {
                                setTimeout(function () {
                                    d.close();
                                }, 1000);
                            }
                        });
                    }

                }, 'json')

            });
            // 时间选择
            $(function () {
                var newDate = new Date();
                var t = newDate.toJSON();
                $('#datepicker1').datetimepicker({
                    autoclose: true,
                    language: 'ch',
                    format: "yyyy-mm-dd hh:ii",
                    clearBtn: true,
                    startDate: new Date(t),

                });
                $('#datepicker2').datetimepicker({
                    autoclose: true,
                    language: 'ch',
                    format: "yyyy-mm-dd hh:ii",
                    clearBtn: true,
                    startDate: new Date(t),
                });
            })

            //添加商品
            $(function () {
                var timer = null;
                $('body').on('click', '.j_add', function (e) {
                    e.preventDefault();
                    if (timer == null) {
                        timer = setTimeout(function () {
                            dialog_form_radio('store.php?app=radioDialog&act=goodsDialog', '添加商品');
                        }, 100);
                    }
                });
                $('body').on('click', '.j_alldel', function (e) {
                    $('.j_tbody').find('tr').remove();
                });
                function dialog_form_radio(file_url, title) {
                    $.get(file_url, function (data) {
                        $.confirm({
                            boxWidth: '60%',
                            useBootstrap: false,
                            title: title,
                            content: data,
                            animationBounce: 1.5,
                            type: 'blue',
                            buttons: {
                                confirm: {
                                    btnClass: 'btn-blue',
                                    text: '保存',
                                    action: function () {
                                        clearTimeout(timer);
                                        timer = null;
                                        var obj = $('.tc-box tbody input[type="radio"]:checked');
                                        dataurl = obj.attr('data-url');
                                        dataname = obj.attr('data-name'); //商品名称
                                        dataid = obj.attr('data-id'); //商品id
                                        datasprice = obj.attr('data-sprice');
                                        datamprice = obj.attr('data-mprice');
                                        var a = obj.parents('tr').next().find('.att a');
                                        var attr = obj.parents('tr').next().find('.active');
                                        if (dataid.length < 0) {
                                            return false;
                                        }
                                        if (a.length > 0) {//有active
                                            var dataattr = attr.attr('data-attr');
                                            var datakey = attr.attr('data-key');
                                            var dataiprice = attr.attr('data-iprice');
                                            var dataitem = attr.attr('data-item');
                                            var name = dataname + ' ' + dataattr;
                                            var html = '';
                                            html += '<tr>' +
                                                    '<td>' + '<img src="' + dataurl + '" width="80" height="40">' + '<input type="hidden" value="' + dataurl + '" name="imgurl" />' + '</td>' +
                                                    '<td>' + name + '<input type="hidden" value="' + dataname + '" name="gname" />' + '<input type="hidden" value="' + dataid + '" name="gid" />' + '</td>' +
                                                    '<td class="yprice">' + dataiprice + '<input type="hidden" value="' + dataiprice + '" name="gprice" />' + '<input type="hidden" value="' + datakey + '" name="key" />' + '<input  type="hidden" value="' + dataattr + '"  name="key_name" />' + '</td>' +
//                                            '<td><input type="text" value="" class="form-control w70 discount" /></td>'+
//                                            '<td><input type="text" value=""  class="form-control w100 lessprice" /></td>'+
//                                            '<td><input type="text" value=""  class="form-control w100 zprice"/></td>'+
//                                            '<td>'+
//                                            '限购&nbsp;&nbsp;'+
//                                            '<select class="form-control inblock w120 j_select" >'+
//                                            '<option value="1">不限购</option>'+
//                                            '<option value="2">限购一件</option>'+
//                                            '<option value="3">限购两件</option>'+
//                                            '<option value="4">限购三件</option>'+
//                                            '</select>'+
//                                            '</td>'+
                                                    '<td>' +
                                                    '<a href="javascript:void(0)" name="7" data-toggle="tooltip" title="" class="btn btn-xs btn-danger delete-table1" style="overflow: hidden; position: relative;" data-original-title="删除"><i class="fa fa-times"></i></a>' +
                                                    '</td>' +
                                                    '</tr>';
                                            //追加
                                            $('.j_tbody').html(html);
                                        } else {//如果没有属性
                                            var dataattr = attr.attr('data-attr');
                                            var datakey = attr.attr('data-key');
                                            var dataiprice = attr.attr('data-iprice');
                                            var dataitem = attr.attr('data-item');
                                            var name = dataname + ' ' + dataattr;
                                            var html = '';
                                            html += '<tr>' +
                                                    '<td>' + '<img src="' + dataurl + '" width="80" height="40">' + '<input type="hidden" value="' + dataurl + '" name="imgurl" />' + '</td>' +
                                                    '<td>' + dataname + '<input type="hidden" value="' + dataname + '" name="gname" />' + '<input type="hidden" value="' + dataid + '" name="gid" />' + '</td>' +
                                                    '<td class="yprice">' + datasprice + '<input type="hidden" value="' + datasprice + '" name="gprice" />' + '<input type="hidden" value="' + '' + '" name="key" />' + '<input  type="hidden" value="' + '' + '"  name="key_name" />' + '</td>' +
//                                            '<td><input type="text" value="" class="form-control w70 discount" /></td>'+
//                                            '<td><input type="text" value=""  class="form-control w100 lessprice" /></td>'+
//                                            '<td><input type="text" value=""  class="form-control w100 zprice"/></td>'+
//                                            '<td>'+
//                                            '限购&nbsp;&nbsp;'+
//                                            '<select class="form-control inblock w120 j_select" >'+
//                                            '<option value="1">不限购</option>'+
//                                            '<option value="2">限购一件</option>'+
//                                            '<option value="3">限购两件</option>'+
//                                            '<option value="4">限购三件</option>'+
//                                            '</select>'+
//                                            '</td>'+
                                                    '<td>' +
                                                    '<a href="javascript:void(0)" name="7" data-toggle="tooltip" title="" class="btn btn-xs btn-danger delete-table1" style="overflow: hidden; position: relative;" data-original-title="删除"><i class="fa fa-times"></i></a>' +
                                                    '</td>' +
                                                    '</tr>';
                                            //追加
                                            $('.j_tbody').html(html);
                                        }

                                    }
                                },
                                cancel: {
                                    btnClass: 'btn-default', // multiple classes.
                                    text: '取消',
                                    action: function () {
                                        clearTimeout(timer);
                                        timer = null;
                                    }
                                }
                            }
                        });

                    })
                }
                //单个删除
                $('body').on('click', '.delete-table1', function () {
                    var that = $(this);
                    $.confirm({
                        title: '',
                        closeIcon: true,
                        content: "<i class='fa fa-warning text-yellow' style='font-size:38px'></i> 您确认要删除所选数据？",
                        type: 'blue',
                        buttons: {
                            confirm: {
                                btnClass: 'btn-blue',
                                text: '确认',
                                action: function () {
                                    that.parents('tr').remove();
                                }
                            },
                            cancel: {
                                btnClass: 'btn-default', // multiple classes.
                                text: '取消'
                            }
                        }
                    });

                });
            })


        </script>
        {/literal}

    </body>
</html>
