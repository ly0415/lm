<!DOCTYPE html>
<html>
    <head>
        {include file="public/header.html"}
        <style>

        </style>
    </head>
    <body class="hold-transition skin-blue sidebar-mini">
        <div class="wrapper">
            {include file="public/title.html"}
            <!-- Left side column. contains the logo and sidebar -->
            {include file="public/menu.html"}

            <!-- Content Wrapper. Contains page content -->
            <div class="content-wrapper">

                <!-- Content Header (Page header) -->
                <section class="content-header">
                    <h1>
                        Group editor
                    </h1>
                    <ol class="breadcrumb">
                        <li><a href="store.php?app=default&act=index&lang_id={$lang_id}"><i class="fa fa-dashboard"></i> Home</a></li>
                        <li class="active">Promotion management</li>
                        <li class="active">Group editor</li>
                    </ol>

                </section>

                <!-- Main content -->
                <section class="content">
                    <!-- /.row -->
                    <form  id="groupform"  >
                        <input type="hidden"  name="id" value="{$data.id}" >
                        <div class="row">
                            <div class="col-xs-12">
                                <div class="box box-primary pb20">
                                    <div class="box-header">
                                        <div class="col-sm-1 col-md-1 no-padding pull-right">
                                            <a class="btn btn-primary pull-right btn-sm" href="store.php?app=groupbuy&act=grouplist&lang_id={$lang_id}&p={$p}"> Return</a>
                                        </div>
                                    </div>

                                    <div class="form-horizontal">
                                        <div class="box-body">

                                            <div class="form-group">
                                                <label class="col-sm-5 col-md-3  col-lg-3 control-label"><span class="text-red">*</span> Group buying title：</label>
                                                <div class="col-sm-7 col-md-6 col-lg-5">
                                                    <input type="text" class="form-control" name="title"  value="{$data.title}" >
                                                </div>
                                            </div>

                                            <div class="form-group">
                                                <label class="col-sm-5 col-md-3  col-lg-3 control-label"><span class="text-red">*</span> start time：</label>
                                                <div class="col-sm-7 col-md-6 col-lg-5">
                                                    <input type="text" class="form-control w174 inblock"  name="start_time"  value=' {$data.start_time|date_format:"%Y-%m-%d %H:%M" }' id="datepicker1" readonly/>
                                                    <label class="">End time：</label>
                                                    <input type="text" class="form-control w174 inblock" name="end_time"  value=' {$data.end_time|date_format:"%Y-%m-%d %H:%M" }' id="datepicker2" readonly/>
                                                </div>
                                            </div>

                                            <div class="form-group">
                                                <label class="col-sm-5 col-md-3  col-lg-3 control-label"><span class="text-red">*</span> Group purchase price：</label>
                                                <div class="col-sm-7 col-md-6 col-lg-5">
                                                    <input type="text" class="form-control" name="group_goods_price"  value="{$data.group_goods_price}" >
                                                </div>
                                                <p >The price of group buying is two to the positive integer</p>
                                            </div>

                                            <div class="form-group">
                                                <label class="col-sm-5 col-md-3  col-lg-3 control-label"><span class="text-red">*</span> The goods offered stock：</label>
                                                <div class="col-sm-7 col-md-6 col-lg-5">
                                                    <input type="text" class="form-control" name="group_goods_num"  value="{$data.group_goods_num}" >
                                                </div>
                                                <P  >Please fill in the natural number and participate in the quantity of the group purchase goods</P>
                                            </div>

                                            <div class="form-group">
                                                <label class="col-sm-5 col-md-3  col-lg-3 control-label"><span class="text-red">*</span> Virtual purchase number：</label>
                                                <div class="col-sm-7 col-md-6 col-lg-5">
                                                    <input type="text" class="form-control" name="virtual_num" value="{$data.virtual_num}" >
                                                </div>
                                                <p  >Virtual has purchased a number of offered</p>
                                            </div>

                                        </div>
                                    </div>

                                    <div class="zuhesale clearfix">
                                        <div class="col-xs-12 header">
                                            <div class="col-xs-8">Please choose goods</div>
                                            <div class="col-xs-4 text-right">
                                                <a href="javascript:;" class="btn btn-primary j_add">Add goods</a>
                                                <a href="javascript:;" class="btn btn-primary j_alldel">Clear all goods</a>
                                            </div>
                                        </div>
                                        <div class="col-xs-12 header-top ">

                                        </div>
                                        <div class="col-xs-12">
                                            <div class="new-table-responsive mb20">
                                                <div class="box-body table-responsive no-padding ">
                                                    <table class="table table-bordered">
                                                        <thead>
                                                            <tr>
                                                                <th>picture</th>
                                                                <th>Commodity name</th>
                                                                <th>Original price</th>
                                                                <!--<th>打折</th>-->
                                                                <!--<th>减价</th>-->
                                                                <!--<th>折后价</th>-->
                                                                <!--<th>限购</th>-->
                                                                <th>operation</th>
                                                            </tr>
                                                        </thead>
                                                        <tbody class="j_tbody">

                                                            <tr>
                                                                <td>
                                                                    <img src="{$data.original_img}" width="80" height="40">
                                                                    <input type="hidden" value="{$data.original_img}" name="imgurl">
                                                                </td>
                                                                <td>{$data.goods_name}{$data.key_name}
                                                                    <input type="hidden" value="{$data.goods_name}" name="gname">
                                                                    <input type="hidden" value="{$data.goods_id}" name="gid"></td>
                                                                <td class="yprice">{$data.goods_price}
                                                                    <input type="hidden" value="{$data.goods_price}" name="gprice">
                                                                    <input type="hidden" value="{$data.goods_spec_key}" name="key">
                                                                    <input type="hidden" value="{$data.key_name}" name="key_name">
                                                                    <input type="hidden" value="{$p}" name="p">
                                                                </td>
                                                                <td>
                                                                    <a href="javascript:void(0)" name="7" data-toggle="tooltip"  class="btn btn-xs btn-danger delete-table1" style="overflow: hidden; position: relative;" data-original-title="delete">
                                                                        <i class="fa fa-times"></i></a>
                                                                </td>
                                                            </tr>

                                                        </tbody>
                                                    </table>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="box-footer">
                                        <div class="col-xs-5 col-xs-offset-3 ">
                                            <a href="store.php?app=groupbuy&act=grouplist&lang_id={$lang_id}&p={$p}" class="btn btn-default"><i class="fa fa-times-circle"></i> Close</a>
                                            <button type="button" id="submit2" class="btn btn-primary pull-right"><i class="fa fa-save"></i> Preservation
                                            </button>
                                        </div>
                                    </div>

                                </div>
                            </div>
                        </div>
                    </form>
                </section>
                <!-- /.content -->
            </div>
            {include file="public/footer.html"}
        </div>
        {literal}
        <script type="text/javascript">
            //ajax提交保存
            $('#submit2').click(function () {
                //alert(12)
                var url = 'store.php?app=groupbuy&act=doedit&lang_id=' + 1;
                var data = $('#groupform').serializeArray();
                $.post(url, data, function (obj) {
                    var msg = obj.message;
                    if (obj.status == 1) {
                        var d = $.dialog({
                            content: '<div class="text-center">' + msg + '</div>',
                            title: false, // hides the title.
                            closeIcon: false, // hides the close icon.
                            columnClass: 'xsmall',
                            onOpen: function () {
                                setTimeout(function () {
                                    d.close();
                                }, 1000);
                            }
                        });
                        setTimeout(function () {
                            window.location.href = obj.info.url;
                        }, 1000);

                    } else {

                        var d = $.dialog({
                            content: '<div class="text-center">' + msg + '</div>',
                            title: false, // hides the title.
                            closeIcon: false, // hides the close icon.
                            columnClass: 'xsmall',
                            onOpen: function () {
                                setTimeout(function () {
                                    d.close();
                                }, 1000);
                            }
                        });

                    }

                }, 'json')

            });
            // 时间选择
            $(function(){
                var newDate = new Date();
                var t       = newDate.toJSON();
                $('#datepicker1').datetimepicker({
                    autoclose: true,
                    language: 'ch',
                    format:"yyyy-mm-dd hh:ii",
                    clearBtn:true,
                    startDate:new Date(t),

                });
                $('#datepicker2').datetimepicker({
                    autoclose: true,
                    language: 'ch',
                    format:"yyyy-mm-dd hh:ii",
                    clearBtn:true,
                    startDate:new Date(t),
                });
            });
            //添加商品
            $(function () {
                var timer=null;
                $('body').on('click', '.j_add', function (e) {
                   if(timer==null){
                       timer=setTimeout(function () {
                           dialog_form_radio('store.php?app=radioDialog&act=goodsDialog&lang_id=' + 1, 'Add goods');
                       }, 100);
                   }
                });
                $('body').on('click', '.j_alldel', function (e) {
                    $('.j_tbody').find('tr').remove();
                });
                function dialog_form_radio(file_url, title) {
                    $.get(file_url, function (data) {
                        $.confirm({
                            boxWidth: '60%',
                            useBootstrap: false,
                            title: title,
                            content: data,
                            animationBounce: 1.5,
                            type: 'blue',
                            buttons: {
                                confirm: {
                                    btnClass: 'btn-blue',
                                    text: 'Preservation',
                                    action: function () {
                                        clearTimeout(timer);
                                        timer = null;
                                        var obj = $('.tc-box tbody input[type="radio"]:checked');
                                        dataurl = obj.attr('data-url');
                                        dataname = obj.attr('data-name'); //商品名称
                                        dataid = obj.attr('data-id'); //商品id
                                        datasprice = obj.attr('data-sprice');
                                        datamprice = obj.attr('data-mprice');
                                        var a = obj.parents('tr').next().find('.att a');
                                        var attr = obj.parents('tr').next().find('.active');
                                        if (dataid.length < 0) {
                                            return false;
                                        }
                                        if (a.length > 0) {//有active
                                            var dataattr = attr.attr('data-attr');
                                            var datakey = attr.attr('data-key');
                                            var dataiprice = attr.attr('data-iprice');
                                            var dataitem = attr.attr('data-item');
                                            var name = dataname + ' ' + dataattr;
                                            var html = '';
                                            html += '<tr>' +
                                                    '<td>' + '<img src="' + dataurl + '" width="80" height="40">' + '<input type="hidden" value="' + dataurl + '" name="imgurl" />' + '</td>' +
                                                    '<td>' + name + '<input type="hidden" value="' + dataname + '" name="gname" />' + '<input type="hidden" value="' + dataid + '" name="gid" />' + '</td>' +
                                                    '<td class="yprice">' + dataiprice + '<input type="hidden" value="' + dataiprice + '" name="gprice" />' + '<input type="hidden" value="' + datakey + '" name="key" />' + '<input  type="hidden" value="' + dataattr + '"  name="key_name" />' + '</td>' +
//                                            '<td><input type="text" value="" class="form-control w70 discount" /></td>'+
//                                            '<td><input type="text" value=""  class="form-control w100 lessprice" /></td>'+
//                                            '<td><input type="text" value=""  class="form-control w100 zprice"/></td>'+
//                                            '<td>'+
//                                            '限购&nbsp;&nbsp;'+
//                                            '<select class="form-control inblock w120 j_select" >'+
//                                            '<option value="1">不限购</option>'+
//                                            '<option value="2">限购一件</option>'+
//                                            '<option value="3">限购两件</option>'+
//                                            '<option value="4">限购三件</option>'+
//                                            '</select>'+
//                                            '</td>'+
                                                    '<td>' +
                                                    '<a href="javascript:void(0)" name="7" data-toggle="tooltip" title="" class="btn btn-xs btn-danger delete-table1" style="overflow: hidden; position: relative;" data-original-title="delete"><i class="fa fa-times"></i></a>' +
                                                    '</td>' +
                                                    '</tr>';
                                            //追加
                                            $('.j_tbody').html(html);
                                        } else {//如果没有属性
                                            var dataattr = attr.attr('data-attr');
                                            var datakey = attr.attr('data-key');
                                            var dataiprice = attr.attr('data-iprice');
                                            var dataitem = attr.attr('data-item');
                                            var name = dataname + ' ' + dataattr;
                                            var html = '';
                                            html += '<tr>' +
                                                    '<td>' + '<img src="' + dataurl + '" width="80" height="40">' + '<input type="hidden" value="' + dataurl + '" name="imgurl" />' + '</td>' +
                                                    '<td>' + dataname + '<input type="hidden" value="' + dataname + '" name="gname" />' + '<input type="hidden" value="' + dataid + '" name="gid" />' + '</td>' +
                                                    '<td class="yprice">' + datasprice + '<input type="hidden" value="' + datasprice + '" name="gprice" />' + '<input type="hidden" value="' + '' + '" name="key" />' + '<input  type="hidden" value="' + '' + '"  name="key_name" />' + '</td>' +
//                                            '<td><input type="text" value="" class="form-control w70 discount" /></td>'+
//                                            '<td><input type="text" value=""  class="form-control w100 lessprice" /></td>'+
//                                            '<td><input type="text" value=""  class="form-control w100 zprice"/></td>'+
//                                            '<td>'+
//                                            '限购&nbsp;&nbsp;'+
//                                            '<select class="form-control inblock w120 j_select" >'+
//                                            '<option value="1">不限购</option>'+
//                                            '<option value="2">限购一件</option>'+
//                                            '<option value="3">限购两件</option>'+
//                                            '<option value="4">限购三件</option>'+
//                                            '</select>'+
//                                            '</td>'+
                                                    '<td>' +
                                                    '<a href="javascript:void(0)" name="7" data-toggle="tooltip" title="" class="btn btn-xs btn-danger delete-table1" style="overflow: hidden; position: relative;" data-original-title="delete"><i class="fa fa-times"></i></a>' +
                                                    '</td>' +
                                                    '</tr>';
                                            //追加
                                            $('.j_tbody').html(html);
                                        }

                                    }
                                },
                                cancel: {
                                    btnClass: 'btn-default', // multiple classes.
                                    text: 'cancel'
                                }
                            }
                        });

                    })
                }
                //单个删除
                $('body').on('click', '.delete-table1', function () {
                    var that = $(this);
                    $.confirm({
                        title: '',
                        closeIcon: true,
                        content: "<i class='fa fa-warning text-yellow' style='font-size:38px'></i> You are sure you want to delete the selected data？",
                        type: 'blue',
                        buttons: {
                            confirm: {
                                btnClass: 'btn-blue',
                                text: 'confirm',
                                action: function () {
                                    that.parents('tr').remove();
                                }
                            },
                            cancel: {
                                btnClass: 'btn-default', // multiple classes.
                                text: 'cancel',
                                action: function(){
                                    clearTimeout(timer);
                                    timer = null;
                                }
                            }
                        }
                    });

                });
            })


        </script>
        {/literal}

    </body>
</html>
