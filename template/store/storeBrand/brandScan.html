<!DOCTYPE html>
<html>
<head>

    {include file="public/header.html"}

</head>
<body class="hold-transition skin-blue sidebar-mini">
<div class="wrapper">

    {include file="public/title.html"}
    <!-- Left side column. contains the logo and sidebar -->
    {include file="public/menu.html"}

    <!-- Content Wrapper. Contains page content -->
    <div class="content-wrapper">
            {include file="public/headtab.html"}
        <!-- Content Header (Page header) -->
        <section class="content-header">
            <h1>
                品牌编辑
            </h1>
            <ol class="breadcrumb">
                <li><a href="admin.php?app=default&act=index"><i class="fa fa-dashboard"></i> 首页</a></li>
                <li class="active">商品管理</li>
                <li class="active">品牌列表</li>
            </ol>
        </section>

        <!-- Main content -->
        <section class="content">
            <div class="row">
                <!-- right column -->
                <div class="col-xs-12">
                    <!-- Horizontal Form -->
                    <div class="box box-primary">
                        <div class="box-header with-border">
                            <h3 class="box-title"></h3>
                        </div>
                        <!-- /.box-header -->
                        <!-- form start -->
                        <form class="form-horizontal" action="?app=storeGoodsBrand&act=doEdit" data-type="ajax" method="post">
                            <div class="box-body">
                                <input type="hidden" value="{$brandInfo.id}" name="id" />
                                <div class="form-group">
                                    <label class="col-sm-4 col-md-2  col-lg-2 control-label"><span class="text-red">*</span> 品牌名称:：</label>
                                    <div class="col-sm-6 col-md-5 col-lg-4">
                                        <input type="text" class="form-control" name="name"  value="{$brandInfo['name']}">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-sm-4 col-md-2  col-lg-2 control-label"><span class="text-red">*</span>所属分类:：</label>
                                    <div class="col-sm-3">
                                        <select class="form-control j_select" name="pro_id" id="pro_id" onchange="getcitylist(this.id)">
                                            <option value="0">顶级分类</option>
                                            {foreach from=$cates item=p}
                                            <option value='{$p.id}' {if $p.id == $brandInfo.max_cat_id} selected {/if}>{$p.name}</option>
                                            {/foreach}
                                        </select>
                                    </div>
                                    <div class="col-md-2">
                                        <select class="form-control j_select" name="city_id" id="city_id" onchange="getarealist(this.id)">
                                            <option value="0">请选择商品分类</option>
                                            {foreach from=$secCate item=vo}
                                            <option value="{$vo.id}" {if $vo.id == $brandInfo.parent_cat_id} selected {/if}>{$vo.name}</option>
                                            {/foreach}

                                        </select>
                                    </div>
                                    <div class="col-md-2">
                                        <select class="form-control j_select" name="area_id" id="area_id">
                                            <option value="0">请选择商品分类</option>
                                            {foreach from=$thirdCate item=vo}
                                            <option value="{$vo.id}" {if $vo.id == $brandInfo.cat_id} selected {/if}>{$vo.name}</option>
                                            {/foreach}
                                        </select>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <input type="hidden" name="image_id" id="image_id" value="{$brandInfo.logo}">
                                    <label class="col-sm-4 col-md-2  col-lg-2 control-label"><span class="text-red">*</span> 品牌图片标识：</label>
                                    <div class="col-sm-7 col-md-6 col-lg-5">
                                        <p class="file-img">
                                            {if $brandInfo.logo}
                                            <img id="img1" title="" src="{$brandInfo.logo}" width="100px" height="100px"/>
                                            {else}
                                            <img id="img1" title="" src="" width="100" height="100" style="display:none"/>
                                           {/if}
                                            
                                        </p>
                                        <p class="inblock">
                                            <input type="file" id="file1" name="fileName" />
                                        </p>
                                        <button type="button"  class="btn btn-primary file-btn" id="validate" >上传</button>
                                        
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-sm-4 col-md-2  col-lg-2 control-label"><span class="text-red">*</span> 分类排序：</label>
                                    <div class="col-sm-6 col-md-5 col-lg-4">
                                        <input type="text" class="form-control" name="sort" value="{$brandInfo.sort}" >
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-sm-4 col-md-2  col-lg-2 control-label"><span class="text-red"></span> 描述：</label>
                                    <div class="col-sm-6 col-md-5 col-lg-4">
                                        <textarea class="brief" rows="6" cols="40" name='desc' style="border:1px solid #ddd;width: 350px;">{$brandInfo.descrption}</textarea>
                                    </div>
                                </div>
                            </div>
                            <!-- /.box-body -->
                            <div class="box-footer">
                                <div class="form-group">
                                    <div class="col-sm-6 col-sm-offset-4 col-md-5 col-md-offset-2 col-lg-4 col-lg-offset-2">
                                        <a href="?app=storeGoodsBrand&act=storeBrand"  style="margin-left: 50%;" class="btn btn-default"><i class="fa fa-times-circle"></i> 关 闭</a>
                                    </div>
                                </div>
                            </div>
                        </form>
                        <!-- /.box -->
                        <!-- general form elements disabled -->
                    </div>
                    <!-- /.box -->
                </div>
                <!--/.col (right) -->
            </div>
            <!-- /.row -->
        </section>
        <!-- /.content -->
    </div>
    <!-- /.content-wrapper -->
    {include file="public/footer.html"}
    <script src="{$STATIC_URL}/plugin/kindeditor/kindeditor.js"></script>
    <script src="{$STATIC_URL}/plugin/kindeditor/lang/zh_CN.js"></script>
    <script src="{$STATIC_URL}/plugin/ajaxfileupload/ajaxfileupload.js"></script>
    <!-- Control Sidebar -->
    <!-- /.control-sidebar -->
    <!-- Add the sidebar's background. This div must be placed
         immediately after the control sidebar -->
    <div class="control-sidebar-bg"></div>
</div>
{literal}
<script type="text/javascript">
    $(function(){

        $("#validate").click(function () {

            if($("#file1").val().length > 0) {
                $.ajaxFileUpload
                (
                        {
                            url: 'admin.php?app=goodsClass&act=upload', //用于文件上传的服务器端请求地址
                            secureuri: false, //是否需要安全协议，一般设置为false
                            fileElementId: 'file1', //文件上传域的ID
                            dataType: 'JSON', //返回值类型 一般设置为json
                            data:{
                                image_id:$('#image_id').val()
                            },
                            success: function (obj, status)  //服务器成功响应处理函数
                            {
                                //alert(obj);
                                var data = eval('(' + obj + ')'); //由JSON字符串转换为JSON对象
                                //alert(data);
                                if (data.status == 'error') {
                                    var d=$.dialog({
                                        content: '<div class="text-center">'+msg+'</div>',
                                        title: false, // hides the title.
                                        closeIcon: false, // hides the close icon.
                                        columnClass: 'xsmall',
                                        onOpen: function(){
                                            setTimeout(function(){
                                                d.close();
                                            }, 1000);
                                        }
                                    });
                                    return false;
                                }
//                                alert(data.image_id);
                                $("#img1").attr("src", data.url);
                                $("#img1").show();
                                $("#img1").attr("width", '100px');
                                $("#img1").attr("height", '100px');
                                $("#image_id").val(data.url);
                                $("#img1").attr("style", 'display:block');
                            },
                            error: function (data, status, e)//服务器响应失败处理函数
                            {
                                alert(e);
                            }
                        }
                )
                return false;
            }else {
                var d=$.dialog({
                    content: '<div class="text-center">请选择图片</div>',
                    title: false, // hides the title.
                    closeIcon: false, // hides the close icon.
                    columnClass: 'xsmall',
                    onOpen: function(){
                        setTimeout(function(){
                            d.close();
                        }, 1000);
                    }
                });
                return false;
            }
        })
    })
</script>
<script type="text/javascript">
   function getcitylist(id){
        var pro_id = $.trim($("#"+id).val());
        if(pro_id == 0){
            var html = "<option value='0'>请选择商品分类</option>";
            $("#"+id).parent().next().find('select').html(html);
            $("#"+id).parent().next().next().find('select').html(html);
            return false;
        }
        $.ajax({
            url: '?app=goodsBrand&act=getCityAjaxData',
            type: 'POST',
            data: "id="+pro_id,
            dataType: "json",
            success:function(msg) {
                // console.log(msg);
                // return false;
                var html = "<option value=''>请选择商品分类</option>";
                $.each(msg, function(key, value){
                    html += "<option value='"+value.id+"'>"+value.name+"</option>";
                });
               $("#"+id).parent().next().find('select').html(html);
                $("#"+id).parent().next().next().find('select').html(html);
            }
        });
    }
   function getarealist(id){
       var city_id = $.trim($("#"+id).val());
       if(city_id == 0){
           var html = "<option value='0'>请选择商品分类</option>";
           $("#"+id).parent().next().find('select').html(html);
           return false;
       }
       $.ajax({
           url: '?app=goodsBrand&act=getCityAjaxData',
           type: 'POST',
           data: "id="+city_id,
           dataType: "json",
           success:function(msg) {
               // console.log(msg);
               // return false;
               var html = "<option value=''>请选择商品分类</option>";
               $.each(msg, function(key, value){
                   html += "<option value='"+value.id+"'>"+value.name+"</option>";
               });
               $("#"+id).parent().next().find('select').html(html);
           }
       });
   }

</script>

{/literal}
</body>
</html>


