<!DOCTYPE html>
<html>
    <head>
        {include file="public/header.html"}
    </head>
    <body class="hold-transition skin-blue sidebar-mini">
        <div class="wrapper">
            {include file="public/title.html"}
            <!-- Left side column. contains the logo and sidebar -->
            {include file="public/menu.html"}

            <!-- Content Wrapper. Contains page content -->
            <div class="content-wrapper">
                <!-- Content Header (Page header) -->
                <section class="content-header">
                    <h1>
                        文章修改
                    </h1>
                    <ol class="breadcrumb">
                        <li><a href="store.php?app=default&act=index"><i class="fa fa-dashboard"></i> 首页</a></li>
                        <li class="active">文章管理</li>
                        <li class="active">文章列表</li>
                    </ol>
                </section>

                <!-- Main content -->
                <section class="content">
                    <div class="row">
                        <div class="col-md-12">
                            <div class="box box-primary">
                                <form class="" id="form-goodsedit" action="?app=article&act=doEdit&lang_id={$lang_id}"  method="post" data-type="ajax">
                                    <input type="hidden" name='article_id' value="{$id}">
                                    <input type="hidden" name='p' value="{$p}">
                                    <div class="nav-tabs-custom tabs-new">
                                        <ul class="nav nav-tabs">
                                            <li class="active"><a href="#tab_1" data-toggle="tab">常规</a></li>
                                            <li><a href="#tab_2" data-toggle="tab">数据</a></li>

                                            <!--<li><a href="#tab_4" data-toggle="tab">商品物流</a></li>-->
                                            <!--<li><a href="#tab_5" data-toggle="tab">积分折扣</a></li>-->
                                        </ul>
                                        <div class="tab-content">
                                            <div class="tab-pane active" id="tab_1">
                                                <!-- 二级tab -->
                                                <div class="pro-tabs-menu">
                                                    {foreach from=$languageData item=item key=k}
                                                    <span {if $k == 0}class="active" {/if}><img src="{$item.logo}" width="16" height="11"><span>{$item.shorthand}</span></span>
                                                    {/foreach}
                                                </div>

                                                <div class="pro-tabs-box">
                                                    {foreach from=$languageData item=item key=k}
                                                    <div class="tab-item" {if $k == 0} style="display: block;" {/if}>
                                                         <div class="box-body">
                                                            <div class="form-horizontal">
                                                                <div class="form-group">
                                                                    <label class="col-sm-4 col-md-2  col-lg-2 control-label"><span class="text-red">*</span> 文章标题：</label>
                                                                    <div class="col-sm-6 col-md-5 col-lg-4">
                                                                        <input type="hidden"  value="{$item.id}" name="langList[]" />
                                                                        <input type="text" class="form-control" name="lang[{$item.id}][title]" value="{$data[$item.id]['title']}" >
                                                                    </div>
                                                                </div>

                                                                <div class="form-group">
                                                                    <label class="col-sm-4 col-md-2  col-lg-2 control-label"><span class="text-red">*</span> 文章简介：</label>
                                                                    <div class="col-sm-6 col-md-5 col-lg-4">
                                                                        <textarea  rows="6" cols="40" name='lang[{$item.id}][brief]' style="border:1px solid #ddd;width: 800px;">{$data[$item.id]['brif']}</textarea>
                                                                    </div>
                                                                </div>
                                                                <div class="form-group">
                                                                    <label class="col-sm-4 col-md-2  col-lg-2 control-label"><span class="text-red">*</span> 文章内容：</label>
                                                                    <div class="col-sm-6 col-md-5 col-lg-4">
                                                                        <textarea class="goods_content"  name='lang[{$item.id}][body]'  rows="40" cols="40"  style="border:1px solid #ddd;width: 800px;height: 400px">{$data[$item.id]['body']}</textarea>
                                                                    </div>
                                                                </div>



                                                            </div>
                                                        </div>
                                                    </div><!-- end -->
                                                    {/foreach}
                                                </div>
                                            </div>
                                            <!-- 一级开始 -->
                                            <div class="tab-pane" id="tab_2">
                                                <div class="box-body">
                                                    <div class="form-horizontal">
                                                        <div class="form-group">
                                                            <label class="col-sm-4 col-md-2  col-lg-2 control-label"><span class="text-red">*</span> 是否推荐：</label>
                                                            <div class="col-sm-6 col-md-5 col-lg-4">
                                                                <input type="radio"  name="isrecom"  value="1" {if $data['isrecom']==1} checked {/if}> 是
                                                                       <input type="radio"  name="isrecom" value="2" {if $data['isrecom']==2} checked {/if} > 否
                                                            </div>
                                                        </div>


                                                        <!--    <div class="form-group">
                                                        <label class="col-sm-4 col-md-2  col-lg-2 control-label"><span class="text-red">*</span>文章分类：</label>
            
                                                        <div class="col-sm-2">
                                                            <select class="form-control j_select" name="cate_id"  id="lev1"  >
                                                                <option value="0">&#45;&#45;请选择分类&#45;&#45;</option>
                                                                {foreach from=$ctglev1  item=val}
                                                                <option value='{$val.id}' {if {$data['cate_id']}=={$val.id} }selected="selected" {/if}>{$val.article_cate_name}</option>
                                                                {/foreach}
                                                            </select>
                                                        </div>-->

                                                        <div class="form-group" id="en_dis" >

                                                            <label class="col-sm-4 col-md-2  col-lg-2 control-label"><span class="text-red">*</span>文章分类：</label>

                                                            <div class="col-sm-8 col-md-8 col-lg-7 select">


                                                                {foreach from=$cateData item=item key=k}
                                                                {if $k==0}
                                                                <div class="mt10 j_choosebox">
                                                                    <select class="form-control w160 j_select inblock j-cate1_class" name="cate_id[]"  id="shen_id">
                                                                        <option value="0" data-name="请选择分类">--请选择分类--</option>
                                                                        {foreach from=$ctglev1  item=val}
                                                                        <option value="{$val.id}"  class="shang"  {if {$item.id}=={$val.id} }selected="selected" {/if}  >{$val.article_cate_name}</option>
                                                                        {/foreach}
                                                                    </select>
                                                                    <span class="btn btn-primary vb j_sure">+</span>
                                                                </div>
                                                                {else}
                                                                <div class="mt10 j_choosebox">
                                                                    <select class="form-control w160 j_select inblock j-cate1_class" name="cate_id[]"  id="shen_id">
                                                                        <option value="0" data-name="请选择分类">--请选择分类--</option>
                                                                        {foreach from=$ctglev1  item=val}
                                                                        <option value="{$val.id}"  {if {$item.id}=={$val.id} }selected="selected" {/if}  >{$val.article_cate_name}</option>
                                                                        {/foreach}
                                                                    </select>
                                                                    <span class="btn btn-primary vb j_sure">-</span>
                                                                </div>
                                                                {/if}
                                                                {/foreach}
                                                            </div>


                                                        </div>



                                                        <div class="form-group">
                                                            <input type="hidden" name="image_id" id="image_id" value="{$data['image']}">
                                                            <label class="col-sm-4 col-md-2  col-lg-2 control-label"><span class="text-red">*</span> 封面图片：</label>
                                                            <div class="col-sm-7 col-md-6 col-lg-5">
                                                                <p class="file-img">
                                                                    <!-- {if $image}
                                                                    <img id="img1" title="" src="{$image.url}" width="100px" height="100px"/>
                                                                    {else} -->
                                                                    <img id="img1" title="" src="{$data['image']}" width="100" height="100" />
                                                                    <!-- {/if} -->

                                                                </p>
                                                                <p class="inblock">
                                                                    <input type="file" id="file1" name="fileName"   />
                                                                </p>
                                                                <p>尺寸:870*400</p>
                                                                <button type="button"  class="btn btn-primary file-btn" id="validate" >上传</button>

                                                            </div>
                                                        </div>





                                                    </div>
                                                    <!-- form -->
                                                </div>
                                            </div>




                                        </div>
                                        <!-- /.tab-content -->
                                    </div>

                            </div>
                            <!-- /.box -->
                        </div>

                        <div class="box-footer">
                            <div class="form-group">
                                <div class="col-sm-6 col-sm-offset-4 col-md-5 col-md-offset-2 col-lg-4 col-lg-offset-2">
                                    <a href="store.php?app=article&act=articleList&lang_id={$lang_id}&p={$p}" class="btn btn-default"><i class="fa fa-times-circle"></i> 关 闭</a>
                                    <button class="btn btn-primary pull-right" id="submit"><i class="fa fa-save"></i> 保 存</button>
                                </div>
                            </div>
                        </div>

                        </form>
                    </div> 
                </section> 
                <!-- /.content -->
            </div> 
            <!--                    <script src="{$STATIC_URL}/plugin/kindeditor/kindeditor.js"></script>
                        <script src="{$STATIC_URL}/plugin/kindeditor/lang/zh_CN.js"></script>
                        <script src="{$STATIC_URL}/plugin/ajaxfileupload/ajaxfileupload.js"></script>-->

            {include file="public/footer.html"}

            <!-- Control Sidebar -->
            <!-- /.control-sidebar -->
            <!-- Add the sidebar's background. This div must be placed
                 immediately after the control sidebar -->
            <div class="control-sidebar-bg"></div>
        </div>
        {literal}
        <script type="text/javascript">
            $(function () {
                $('#en_dis').on('click', '.j_sure', function () {
                    var sure = $(this).html();
                    var select = $(this).parent().clone();
                    if (sure == '+') {
                        $('.select').append(select);
                        select.find('.j_sure').html('-');
                        select.find('option:first').prop("selected", 'selected');

                    } else {

                        $(this).parent().remove();
                    }

                })

                //图片上传
                $("#validate").click(function () {

                    if ($("#file1").val().length > 0) {
                        $.ajaxFileUpload
                                (
                                        {
                                            url: 'store.php?app=article&act=upload', //用于文件上传的服务器端请求地址
                                            secureuri: false, //是否需要安全协议，一般设置为false
                                            fileElementId: 'file1', //文件上传域的ID
                                            dataType: 'JSON', //返回值类型 一般设置为json
                                            data: {
                                                image_id: $('#image_id').val()
                                            },
                                            success: function (obj, status)  //服务器成功响应处理函数
                                            {
                                                //alert(obj);
                                                var data = eval('(' + obj + ')'); //由JSON字符串转换为JSON对象
                                                //alert(data);
                                                if (data.status == 'error') {
                                                    var d = $.dialog({
                                                        content: '<div class="text-center">' + data.message + '</div>',
                                                        title: false, // hides the title.
                                                        closeIcon: false, // hides the close icon.
                                                        columnClass: 'xsmall',
                                                        onOpen: function () {
                                                            setTimeout(function () {
                                                                d.close();
                                                            }, 1000);
                                                        }
                                                    });
                                                    return false;
                                                }
                                                //                                alert(data.image_id);
                                                $("#img1").attr("src", data.url);
                                                $("#img1").show();
                                                $("#img1").attr("width", '100px');
                                                $("#img1").attr("height", '100px');
                                                $("#image_id").val(data.url);
                                                $("#img1").attr("style", 'display:block');
                                            },
                                            error: function (data, status, e)//服务器响应失败处理函数
                                            {
                                                alert(e);
                                            }
                                        }
                                )
                        return false;
                    } else {
                        var d = $.dialog({
                            content: '<div class="text-center">请选择图片</div>',
                            title: false, // hides the title.
                            closeIcon: false, // hides the close icon.
                            columnClass: 'xsmall',
                            onOpen: function () {
                                setTimeout(function () {
                                    d.close();
                                }, 1000);
                            }
                        });
                        return false;
                    }
                });

                // 付文本编辑器
                KindEditor.ready(function (K) {
                    editor = K.create('textarea[class="goods_content"]', {
                        allowFileManager: true,
                        afterBlur: function () {
                            this.sync();
                        }
                    });
                });

            })
        </script>

        <script type="text/javascript">

            $(function () {
                $('.pro-tabs-menu span').click(function () {
                    var boxs = $('.pro-tabs-box .tab-item');
                    var index = $(this).index();
                    $('.pro-tabs-menu span').removeClass('active');
                    $(this).addClass('active');
                    boxs.hide();
                    boxs.eq(index).show();
                })
            })



            //分类联动
            function getctglist(id, tag) {
                var d = $('#' + id).find('option:selected').val();
                if (parseInt(d) > 0) {
                    var url = '?app=article&act=getCtg&id=' + d;
                    $.get(url, function (res) {
                        //console.log(res);
                        var html = '';
                        html += ' <option value="0">请选择分类</option>';
                        $.each(res, function (i, n) {
                            html += '<option  value=' + n.id + ' >' + n.name + '</option>';
                        });

                        $('#' + tag).html(html);

                    }, 'json');

                } else {
                    $('#' + tag).html('<option value="0">请选择分类</option>');
                }

            }

        </script>

        {/literal}
    </body>
</html>














