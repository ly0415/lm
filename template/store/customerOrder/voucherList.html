
<div class="height">
    <div class="new-table-responsive">
        <div class="box-body table-responsive no-padding ">
            <div class="box-header">
                <div class="form-inline col-sm-10 col-md-11 no-padding">
                    <div class="form-group form-group-sm form-mar">
                        <small class="control-label">一级业务类型：</small>
                        <select class="form-control w160 j_select inblock" id="j_cate1" name="cat_1">
                        </select>
                    </div>
                    <div class="form-group form-group-sm form-mar">
                        <small class="control-label">二级业务类型：</small>
                        <select class="form-control w160 j_select inblock" id="j_cate2" name="cat_2">
                            <option value="0">---请选择---</option>
                        </select>
                    </div>
                    <div class="form-group form-group-sm form-mar">
                        <button type="button" class="btn btn-default btn-sm" id="submit1">
                            搜索 <i class="fa fa-search"></i>
                        </button>
                    </div>
                </div>
            </div>
            <input type="hidden" name="totalpage" value="{$totalpage}">
            <table class="table tc-box">
                <thead>
                <tr>
                    <th></th>
                    <th>使用范围(业务类型)</th>
                    <th>可兑商品金额上限</th>
                </tr>
                </thead>
                <tbody id="content">
                {foreach from=$data item=item}
                <tr>
                    <td><input class="type_name" type="radio" name="radio" data-name="{$item.type_name}" data-id="{$item.id}"/></td>
                    <td>{$item.type_name}</td>
                    <td>{$item.money}</td>
                </tr>
                {/foreach}
                </tbody>
            </table>
            <div class="page-box">
                <ul id="page" class="pagination">
                </ul>
            </div>
        </div>
    </div>
</div>
{literal}
<script  type="text/javascript" >
    /*分页*/
    $(function() {
        var is_firsttime = true;
        var totalpage = $('input[name="totalpage"]').val();
        totalpage = parseInt(totalpage);
        $('#page').jqPaginator({
            totalPages: totalpage,
            visiblePages: 7,
            currentPage: 1,
            first: '<li class="prev"><a href="javascript:;">首页</a></li>',
            prev: '<li class="prev"><a href="javascript:;">上一页</a></li>',
            next: '<li class="next" style="margin-left: 0;width: auto"><a href="javascript:;">下一页</a></li>',
            page: '<li class="page"><a href="javascript:;">{{page}}</a></li>',
            last: '<li class="prev"><a href="javascript:;">尾页</a></li>',
            onPageChange: function(num, type) {
                if (is_firsttime) {
                    is_firsttime = false;
                } else {
                    //ajax获取
                    var url = '?app=customerOrder&act=getVoucherList&p=' + num;
                    $.get(url, function(res) {
                        $('#content').html(res);
                    });
                }
            }
        });

    });
    $(document).ready(function () {
        //获取一级分类下拉菜单
        getCate1();
        //一级分类切换触发
        $("#j_cate1").on("change", function () {
            cateClick1();
        });
    });
    /*搜索*/
    $('#submit1').click(function() {
        var j_cate1 = $('#j_cate1').val();
        var j_cate2 = $('#j_cate2').val();
        totalPage('&cat_1=' + j_cate1 + '&cat_2=' + j_cate2);
    });
    function totalPage(typeName) {
        var url = '?app=customerOrder&act=voucherTotal' + typeName;

        $.get(url, function(res) {
            var obj = jQuery.parseJSON(res);
            var r = obj.total;
            $('#page').jqPaginator({
                totalPages: r,
                visiblePages: 7,
                currentPage: 1,
                first: '<li class="prev"><a href="javascript:;">首页</a></li>',
                prev: '<li class="prev"><a href="javascript:;">上一页</a></li>',
                next: '<li class="next" style="margin-left: 0;width: auto"><a href="javascript:;">下一页</a></li>',
                page: '<li class="page"><a href="javascript:;">{{page}}</a></li>',
                last: '<li class="prev"><a href="javascript:;">尾页</a></li>',
                onPageChange: function(num,type) {
                    var url = '?app=customerOrder&act=getVoucherList&p=' + num + typeName;
                    $.get(url, function(res) {
                        $('#content').html(res);
                    });
                }
            });
        });
    }
    //获取一级分类下拉菜单
    function getCate1() {
        var url = "?app=ajaxLink&act=roomType&parent_id=0";
        $.ajax({
            type: "GET",
            dataType: "json",
            url: url,
            success: function (obj) {
                var options = '<option value="0">---请选择---</option>';
                $.each(obj, function (i, e) {
                    options += '<option value="' + e.id + '">' + e.name + '</option>';
                });
                $('#j_cate1').html(options);
            }

        });
    }
    //一级分类切换事件
    function cateClick1() {
        var id = $('#j_cate1').find(":selected").val();
        var url = "?app=ajaxLink&act=roomType&parent_id=" + id;
        $.ajax({
            type: "GET",
            dataType: "json",
            url: url,
            success: function (obj) {
                var options = '<option value="0">---请选择---</option>';
                $.each(obj, function (i, e) {
                    options += '<option value="' + e.id + '">' + e.name + '</option>';
                });
                $('#j_cate2').html(options);
            }

        });
    }
</script>
{/literal}

