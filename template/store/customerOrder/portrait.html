<!DOCTYPE html>
<html>
<head>
    {include file="public/header.html"}
    <script src="//player.polyv.net/script/polyvplayer.min.js"></script>
    <style>
        .add-box .j_del {
            font-size: 24px;
            cursor: pointer;

        }
        .selects {
            margin-bottom: 20px;
            width: 520px;
            border: 1px solid #ddd;
            padding: 10px;
        }
        .add-input{
            margin-bottom:10px;
        }
        .add-input input{
            margin-left:10px;
        }
        .personals::-webkit-inner-spin-button {
            -webkit-appearance: none;
        }
        .personals::-webkit-outer-spin-button {
            -webkit-appearance: none;
        }
        input[type=number] {
            -moz-appearance:textfield;
        }
    </style>
</head>
<body class="hold-transition skin-blue sidebar-mini">
<div class="wrapper">

    <!-- Left side column. contains the logo and sidebar -->
    {include file="public/title.html"}
    {include file="public/menu.html"}

    <!-- Content Wrapper. Contains page content -->
    <div class="content-wrapper">
        {include file="public/headtab.html"}
        <!-- Content Header (Page header) -->
        <section class="content-header">
            <h1>
                顾客画像
            </h1>
            <ol class="breadcrumb">
                <li><a href="store.php?app=default&act=index&lang_id={$lang_id}"><i class="fa fa-dashboard"></i> 首页</a></li>
                <li><a href="#">订单管理</a></li>
                <li class="active">顾客画像</li>
            </ol>
        </section>

        <!-- Main content -->
        <section class="content">
            <div class="row">
                <!-- right column -->
                <div class="col-xs-12">
                    <!-- Horizontal Form -->
                    <div class="box box-primary">
                        <div class="box-header with-border">
                            <h3 class="box-title">订单号：{$order_sn}</h3>
                        </div>
                        <!-- /.box-header -->
                        <!-- form start -->
                        <form class="form-horizontal" id="form1">
                            <input type="hidden" name="order_sn" value="{$order_sn}">
                            <div class="box-body">
                                <div class="form-group">
                                    <label class="col-sm-4 col-md-2  col-lg-2 control-label"><span class="text-red">*</span> 顾客人数：</label>
                                    <div class="col-sm-6 col-md-5 col-lg-4">
                                        <input type="number" placeholder="请填写人数（格式数字即可，不可大于9）" class="form-control inblock personals" min="1" step="1" max="9" name="person"  value="{$result[0]['persons']}">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-sm-2"></label>
                                    <div class="col-sm-10" id="pers">
                                        {foreach from=$arr item=v key=k}
                                        <div class="selects">
                                            {foreach from=$v item=vv key=kk}
                                            {foreach from=$vv item=vvv key=key}
                                           <div class="add-input">
                                               {if $kk==0}<select class="form-control j_select inblock" style="width: 120px" j-id = '{$k}' name="type[{$k}][]">{else}<select class="form-control j_select inblock" style="width: 120px"  name="type[{$k}][]">{/if}
                                                    <option value="1" {if $key==1}selected{/if}>年龄</option>
                                                    <option value="2" {if $key==2}selected{/if}>性别</option>
                                                    <option value="3" {if $key==3}selected{/if}>着装</option>
                                                    <option value="4" {if $key==4}selected{/if}>用的手机</option>
                                                    <option value="5" {if $key==5}selected{/if}>身高</option>
                                                    <option value="6" {if $key==6}selected{/if}>体型</option>
                                                    <option value="7" {if $key==7}selected{/if}>谈吐</option>
                                               </select><input type="text" class="form-control content1 inblock" style="width: 350px !important;" value="{$vvv}" placeholder="请填写内容" name="content[{$k}][]">
                                               {if $kk==0}<span class="j_add">+</span>{else}<span class="j_del">-</span>{/if}
                                           </div>
                                            {/foreach}
                                            {/foreach}
                                        </div>
                                        {/foreach}
                                    </div>
                                </div>
                            </div>
                            <!-- /.box-body -->
                            <div class="box-footer">
                                <div class="form-group">
                                    <div class="col-sm-6 col-sm-offset-4 col-md-5 col-md-offset-2 col-lg-4 col-lg-offset-2">
                                        <a href="#" onclick="history.go(-1)" class="btn btn-default"><i class="fa fa-times-circle"></i> 返回</a>
                                        <button type="button" class="btn btn-primary pull-right" id="submit"><i class="fa fa-save"></i> 保存</button>
                                    </div>
                                </div>
                            </div>
                        </form>
                        <!-- /.box -->
                        <!-- general form elements disabled -->
                    </div>
                    <!-- /.box -->
                </div>
                <!--/.col (right) -->
            </div>
            <!-- /.row -->
        </section>
        <!-- /.content -->
    </div>
    <!-- /.content-wrapper -->
    {include file="public/footer.html"}
    <!-- Control Sidebar -->
</div>
<!-- ./wrapper -->
<script type="text/javascript" >
    $(document).ready(function() {
        $(".personals").keyup(function () {
            var count = $(this).val();
            // if (count>9){
            //     alertDialog('输入的数字不能大于9！');
            //     return false;
            // }
            var html_content = "";
            if (count !== '') {
                $("#pers").empty();
                for (var i = 0; i < count; i++) {
                    html_content += '<div class="selects">'
                        + '<div class="add-input">'
                        + '<select class="form-control j_select inblock" style="width: 120px" j-id = ' + i + ' name="type[' + i + '][]">'
                        + '<option value="1">年龄</option>'
                        + '<option value="2">性别</option>'
                        + '<option value="3">着装</option>'
                        + '<option value="4">用的手机</option>'
                        + '<option value="5">身高</option>'
                        + '<option value="6">体型</option>'
                        + '<option value="7">谈吐</option>'
                        + '</select>'
                        + '<input type="text" class="form-control content1 inblock" style="width: 350px !important;" placeholder="请填写内容" name="content[' + i + '][]">'
                        + ' <span class="j_add">+</span>'
                        + '</div>'
                        + '<div class="add-input">'
                        + '<select class="form-control j_select inblock" style="width: 120px" j-id = ' + i + ' name="type[' + i + '][]">'
                        + '<option value="1">年龄</option>'
                        + '<option value="2">性别</option>'
                        + '<option value="3">着装</option>'
                        + '<option value="4">用的手机</option>'
                        + '<option value="5">身高</option>'
                        + '<option value="6">体型</option>'
                        + '<option value="7">谈吐</option>'
                        + '</select>'
                        + '<input type="text" class="form-control content1 inblock" style="width: 350px !important;" placeholder="请填写内容" name="content[' + i + '][]">'
                        + ' <span class="j_del">-</span>'
                        + '</div>'
                        + '<div class="add-input">'
                        + '<select class="form-control j_select inblock" style="width: 120px" j-id = ' + i + ' name="type[' + i + '][]">'
                        + '<option value="1">年龄</option>'
                        + '<option value="2">性别</option>'
                        + '<option value="3">着装</option>'
                        + '<option value="4">用的手机</option>'
                        + '<option value="5">身高</option>'
                        + '<option value="6">体型</option>'
                        + '<option value="7">谈吐</option>'
                        + '</select>'
                        + '<input type="text" class="form-control content1 inblock" style="width: 350px !important;" placeholder="请填写内容" name="content[' + i + '][]">'
                        + ' <span class="j_del">-</span>'
                        + '</div>'
                        + '</div>'
                }
                $("#pers").append(html_content);
            } else if (count == '') {
                $("#pers").empty();
            }
        });
        $(document).on('click', '.j_add', function () {
            var html = '';
            var i = $(this).siblings('.j_select').attr('j-id');
            console.log(i);
            html += '<div class="add-input">'
                + '<select class="form-control j_select inblock" style="width: 120px" name="type[' + i + '][]">'
                + '<option value="1">年龄</option>'
                + '<option value="2">性别</option>'
                + '<option value="3">着装</option>'
                + '<option value="4">用的手机</option>'
                + '<option value="5">身高</option>'
                + '<option value="6">体型</option>'
                + '<option value="7">谈吐</option>'
                + '</select><input type="text" class="form-control content1 inblock" style="width: 350px !important;" placeholder="请填写内容"  name="content[' + i + '][]">'
                + ' <span class="j_del">-</span>'
                + '</div>';
            $(this).parents('.selects').append(html);
        });
        $(document).on('click', '.j_del', function () {
            $(this).parent('.add-input').remove();
        });
    })

</script>
{literal}
<script>
    $('#submit').click(function(){
        var url = '?app=customerOrder&act=doPortrait';
        var form = $('#form1').serialize();
        $.ajax({
            type: "POST",
            url: url,
            dataType: "json",
            data:form,
            success: function(res){
                var msg = res.message;
                if(res.status == 1){
                    alertDialog(msg);
                    setTimeout(function(){
                        window.location.reload();
                    }, 1000);
                }else{
                    alertDialog(msg);
                }
            }
        });
    });


</script>
{/literal}
</body>
</html>