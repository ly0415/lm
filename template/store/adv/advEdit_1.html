<!DOCTYPE html>
<html>
    <head>

        {include file="public/header.html"}

    </head>
    <body class="hold-transition skin-blue sidebar-mini">
        <div class="wrapper">

            {include file="public/title.html"}
            <!-- Left side column. contains the logo and sidebar -->
            {include file="public/menu.html"}

            <!-- Content Wrapper. Contains page content -->
            <div class="content-wrapper">
                <!-- Content Header (Page header) -->
                <section class="content-header">
                    <h1>
                        Ad editor
                    </h1>
                    <ol class="breadcrumb">
                        <li><a href="store.php?app=default&act=index&lang_id={$lang_id}"><i class="fa fa-dashboard"></i> Home</a></li>
                        <li class="active">Advertising management</li>
                        <li class="active">Ad placement</li>
                    </ol>
                </section>

                <!-- Main content -->
                <section class="content">
                    <div class="row">
                        <!-- right column -->
                        <div class="col-xs-12">
                            <!-- Horizontal Form -->
                            <div class="box box-primary">
                                <div class="box-header with-border">
                                    <h3 class="box-title"></h3>
                                </div>
                                <!-- /.box-header -->
                                <!-- form start -->
                                <form class="form-horizontal" action="?app=adv&act=doEdit"  data-type="ajax" method="post">
                                    <div class="box-body">
                                        <input type="hidden" value="{$lang_id}" name="lang_id" />
                                        <input type="hidden"  name="ad_id"  value="{$data.ad_id}"  >

                                        <div class="form-group">
                                            <label class="col-sm-4 col-md-2  col-lg-2 control-label"><span class="text-red">*</span> Advertisement Chinese name:</label>
                                            <div class="col-sm-6 col-md-5 col-lg-4">
                                                <input type="text" class="form-control" name="ad_name"  value="{$data.ad_name}" >
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label class="col-sm-4 col-md-2  col-lg-2 control-label"><span class="text-red">*</span>  Advertisement English name:</label>
                                            <div class="col-sm-6 col-md-5 col-lg-4">
                                                <input type="text" class="form-control" name="ad_english_name"  value="{$data.ad_english_name}" >
                                            </div>
                                        </div>

                                        <div class="form-group">
                                            <label class="col-sm-4 col-md-2  col-lg-2 control-label"><span class="text-red">*</span>Ad position:</label>

                                            <div class="col-sm-3">
                                                <select class="form-control j_select" name="ps_id"   >
                                                    {$options}
                                                </select>
                                            </div>

                                        </div>
                                        <div class="form-group">
                                            <label class="col-sm-4 col-md-2  col-lg-2 control-label"><span class="text-red">*</span>Advertising goods：</label>
                                            <div class="col-sm-6 col-md-5 col-lg-4">
                                                <tr>
                                                    <td>
                                                        <input type="text" value="{$giftGood.goods_name}" name="goods_name" class="form-control w250 inblock j_add giftname" readonly="true"  placeholder="选择广告展示商品">
                                                        <input type="hidden" value="{$data.goods_id}" name="goods_id" />
                                                    </td>
                                                </tr>
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <input type="hidden" name="image_id" id="image_id" value="{$data.ad_code}">
                                            <label class="col-sm-4 col-md-2  col-lg-2 control-label"><span class="text-red">*</span>  Ad Image:</label>
                                            <div class="col-sm-7 col-md-6 col-lg-5">
                                                <p class="file-img">
                                                    <img id="img1"  src="{$data.ad_code}" width="100" height="100" />
                                                </p>
                                                <p class="inblock">
                                                    <input type="file" id="file1" name="fileName" />
                                                </p>
                                                <button type="button"  class="btn btn-primary file-btn" id="validate" >Upload</button>

                                            </div>
                                        </div>

                                    </div>
                                    <!-- /.box-body -->
                                    <div class="box-footer">
                                        <div class="form-group">
                                            <div class="col-sm-6 col-sm-offset-4 col-md-5 col-md-offset-2 col-lg-4 col-lg-offset-2">
                                                <a href="store.php?app=adv&act=advList&lang_id={$lang_id}" class="btn btn-default"><i class="fa fa-times-circle"></i> shut down</a>
                                                <button class="btn btn-primary pull-right" id="submit"><i class="fa fa-save"></i> save</button>
                                            </div>
                                        </div>
                                    </div>
                                </form>
                                <!-- /.box -->
                                <!-- general form elements disabled -->
                            </div>
                            <!-- /.box -->
                        </div>
                        <!--/.col (right) -->
                    </div>
                    <!-- /.row -->
                </section>
                <!-- /.content -->
            </div>
            <!-- /.content-wrapper -->
            {include file="public/footer.html"}
            <script src="{$STATIC_URL}/plugin/ajaxfileupload/ajaxfileupload.js"></script>

            <div class="control-sidebar-bg"></div>
        </div>

        {literal}

        <script type="text/javascript">
            $(function () {
                //图片上传
                $("#validate").click(function () {

                    if ($("#file1").val().length > 0) {
                        $.ajaxFileUpload
                                (
                                        {
                                            url: 'store.php?app=adv&act=upload&lang_id=1', //用于文件上传的服务器端请求地址
                                            secureuri: false, //是否需要安全协议，一般设置为false
                                            fileElementId: 'file1', //文件上传域的ID
                                            dataType: 'JSON', //返回值类型 一般设置为json
                                            data: {
                                                image_id: $('#image_id').val()
                                            },
                                            success: function (obj, status)  //服务器成功响应处理函数
                                            {
                                                //alert(obj);
                                                var data = eval('(' + obj + ')'); //由JSON字符串转换为JSON对象
                                                //alert(data);
                                                if (data.status == 'error') {
                                                    var d = $.dialog({
                                                        content: '<div class="text-center">' + data.message + '</div>',
                                                        title: false, // hides the title.
                                                        closeIcon: false, // hides the close icon.
                                                        columnClass: 'xsmall',
                                                        onOpen: function () {
                                                            setTimeout(function () {
                                                                d.close();
                                                            }, 1000);
                                                        }
                                                    });
                                                    return false;
                                                }
                                                //                                alert(data.image_id);
                                                $("#img1").attr("src", data.url);
                                                $("#img1").show();
                                                $("#img1").attr("width", '100px');
                                                $("#img1").attr("height", '100px');
                                                $("#image_id").val(data.url);
                                                $("#img1").attr("style", 'display:block');
                                            },
                                            error: function (data, status, e)//服务器响应失败处理函数
                                            {
                                                alert(e);
                                            }
                                        }
                                )
                        return false;
                    } else {
                        var d = $.dialog({
                            content: '<div class="text-center">Please select pictures</div>',
                            title: false, // hides the title.
                            closeIcon: false, // hides the close icon.
                            columnClass: 'xsmall',
                            onOpen: function () {
                                setTimeout(function () {
                                    d.close();
                                }, 1000);
                            }
                        });
                        return false;
                    }
                });

            })
            //加载弹窗页面
            $('body').on('click', '.j_add', function (e) {
                setTimeout(function () {
                    dialog_form_radio('store.php?app=adv&act=goodsDialog&lang_id=1', 'Edit the advertisement to show the goods');
                }, 100);
                _that = $(this);
            })
            function dialog_form_radio(file_url, title) {
                $.get(file_url, function (data) {
                    $.confirm({
                        boxWidth: '60%',
                        useBootstrap: false,
                        title: title,
                        content: data,
                        animationBounce: 1.5,
                        type: 'blue',
                        buttons: {
                            confirm: {
                                btnClass: 'btn-blue',
                                text: 'Preservation',
                                action: function () {
                                    var obj = $('.tc-box tbody input[type="radio"]:checked');
                                    dataid = obj.attr('data-id');
                                    dataname = obj.attr('data-name'); //商品名称
                                    var a = obj.parents('tr').next().find('.att a');
                                    var attr = obj.parents('tr').next().find('.active');
                                    var flag_1 = $('input[type=radio]:checked').val();
                                    if (dataid.length < 0) {
                                        return false;
                                    }
                                    $('input[name=goods_name]').val(dataname);
                                    $('input[name=goods_id]').val(dataid);
                                }
                            },
                            cancel: {
                                btnClass: 'btn-default', // multiple classes.
                                text: 'Cancel'
                            }
                        }
                    });

                })
            }
        </script>

        {/literal}

    </body>
</html>


