<!DOCTYPE html>
<html>
    <head>
        {include file="public/header.html"}
    </head>
    <style>
        .address-box:hover .address {
            display: block;}
        .tri-pointer {
            position: absolute;
            left: 50%;
            top: -21px;
            margin-left: -10px;
            display: inline-block;
            width: 0;
            height: 0;
            border: 10px solid;
            border-color: transparent transparent #dedede;}
        .tri-pointer .inner-tri {
            position: absolute;
            top: -9px;
            left: -10px;
            border: 10px solid;
            border-color: transparent transparent #fff;}
        .rx-charge>p{
            color:#000;
        }
        .table-responsive{
            min-height:650px !important;
            overflow-x: auto;
        }
    </style>
    <body class="hold-transition skin-blue sidebar-mini">
        <div class="wrapper">

            {include file="public/title.html"}
            <!-- Left side column. contains the logo and sidebar -->
            {include file="public/menu.html"}

            <!-- Content Wrapper. Contains page content -->
            <div class="content-wrapper">
                {include file="public/headtab.html"}
                <!-- Content Header (Page header) -->
                <section class="content-header">
                    <h1>
                        {$language1->business_type_list}
                    </h1>
                    <ol class="breadcrumb">
                        <li><a href="admin.php?app=default&act=index"><i class="fa fa-dashboard"></i> {$language1->index}</a></li>
                        <li class="active">{$language1->good_manage}</li>
                        <li class="active">{$language1->business_type_list}</li>
                    </ol>
                </section>

                <!-- Main content -->
                <section class="content">
                    <!-- /.row -->
                    <div class="row">
                        <div class="col-xs-12">
                            <div class="box box-primary">
                                <div class="box-header">
                                    <form class="form-inline col-sm-10 col-md-11 no-padding" action="?app=roomType&act=roomTypeIndex">
                                        <div class="form-group form-group-sm form-mar">
                                            <!--                                            <small class="control-label sm">房间名称：</small>-->
                                            <input type='hidden' name='app' value='roomType'>
                                            <input type='hidden' name='act' value='roomTypeIndex'>
                                            <!--                                            <input type="text" class="form-control" name="name" value="{$name}">-->
                                        </div>
                                        <!--                                        <div class="form-group form-group-sm form-mar" style="margin-left:10px;">
                                                                                    <button type='submit' class="btn btn-default btn-sm" id="search" style="padding-top: 5px;">
                                                                                        搜索 <i class="fa fa-search"></i>
                                                                                    </button>
                                                                                </div>-->
                                    </form>

                                    <div class="col-sm-2  col-md-1 no-padding">
                                        <a class="btn btn-primary pull-right btn-sm" href="admin.php?app=roomType&act=roomTypeAdd&p={$p}" role="button"><i class="fa fa-plus"></i>{$language1->add_type}</a>
                                    </div>

                                </div>
                                <div class="new-table-responsive">
                                    <div class="box-body table-responsive no-padding">
                                        <table class="table table-hover" id="example-advanced">
                                            <thead>
                                                <tr>
                                                    <th style="padding-left: 25px !important;">{$language2->numb}</th>
                                                    <!--                                                    <th>类型编号</th>-->
                                                    <th>{$language1->business_name}</th>
                                                    <th>{$language1->business_picture}</th>
                                                    <th>{$language1->business_ad}</th>
                                                    <!--                                                    <th>广告链接</th>-->
                                                    <th>{$language2->sort}</th>
                                                    <th>{$language1->applets_url}</th>
                                                    <th>{$language1->applets_code}</th>
                                                    <th>{$language2->add_time}</th>
                                                    <th style="width: 100px;">{$language2->control}</th>
                                                </tr>
                                            </thead>

                                            {foreach from=$res item=val }
                                            <tr data-tt-id="{$val.id}" data-tt-parent-id="0">
                                                <td>{$val.id}</td>
                                                <td>{$val.type_name}</td>
                                                <td><img src="{$val.room_img}" style="width: 30px;height: 30px;"></td>
                                                <td></td>
                                                <!--                                                <td><div class="ellipsis" >{$val.adv_url}</div></td>-->
                                                <td>{$val.sort}</td>
                                                <td>{$val.app_url}</td>
                                                {if $val.room_url ==''}
                                                <td></td>
                                                {else}
                                                <td align="center">
                                                    <div class="fl item item3">
                                                        <div class="address-box mt15">
                                                            <a href="##" class="uline or">{$language2->look}<i class="ico ico-b"></i></a>
                                                            <div class="address rx-charge" style="width:170px;height: 200px;position: absolute;top: 34px;right: 0;">
                                                                <span class="tri-pointer">
                                                                    <i class="inner-tri"></i>
                                                                </span>
                                                                <p><img src="{$val.room_url}" style="width:150px;height: 150px;" class="img{$val.id}" ></p>
                                                                <p><input type="button" value="{$language2->export}" class="btn btn-xs btn-danger" style="width:80px;height:30px;" onclick="downloadIamge('.img{$val.id}', '{$val.room_url}')"></p>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </td>
                                                {/if}
                                                <td>{$val.add_time}</td>
                                                <td>
                                                    {if $val.room_url  == ''}
                                                    <a href="javascript:void(0)" data-toggle="tooltip" class="btn btn-xs btn-success edit-table " onclick="make('{$val.id}')">{$language1->generate_applets_code}</a>
                                                    {/if}
                                                    <!--                                                    <a href="admin.php?app=roomTypeCate&act=roomTypeCateIndex&type_id={$val.type_id}&lang_id={$lang_id}" data-toggle="tooltip" title="" class="btn btn-xs btn-success" style="overflow: hidden; position: relative;" >分类列表</a>-->
                                                    <a href="admin.php?app=roomType&act=roomEdit&id={$val.id}&p={$p}" data-toggle="tooltip" title="" class="btn btn-xs btn-success edit-table" style="overflow: hidden; position: relative;">{$language2->edit}</a>
                                                    <a href="javascript:void(0)" data-toggle="tooltip" title="" class="btn btn-xs btn-danger delete-table" style="overflow: hidden; position: relative;"  onclick="shanchu('{$val.id}');">{$language2->drop}
                                                    </a>
                                                </td>
                                            </tr>
                                            {foreach from=$val.child item=vo}
                                            <tr data-tt-id="{$vo.id}" data-tt-parent-id="{$val.id}">
                                                <td>{$vo.id}</td>
                                                <td>{$vo.type_name}</td>
                                                <td><img src="{$vo.room_img}" style="width: 30px;height: 30px;"></td>
                                                <td><img src="{$vo.room_adv_img}" style="width: 30px;height: 30px;"></td>
                                                <!--                                                <td>{$vo.adv_url}</td>-->
                                                <td>{$vo.sort}</td>
                                                <td></td>
                                                <td></td>
                                                <td>{$vo.add_time}</td>
                                                <td>
                                                    <a href="admin.php?app=roomTypeCate&act=roomTypeCateIndex&type_id={$vo.type_id}" data-toggle="tooltip" title="" class="btn btn-xs btn-success" style="overflow: hidden; position: relative;" >{$language1->type_list}</a>
                                                    <a href="admin.php?app=roomType&act=roomEdit&id={$vo.id}&p={$p}&display=1" data-toggle="tooltip" title="" class="btn btn-xs btn-success edit-table" style="overflow: hidden; position: relative;">{$language2->edit}</a>
                                                    <a href="javascript:void(0)" data-toggle="tooltip" title="" class="btn btn-xs btn-danger delete-table" style="overflow: hidden; position: relative;"  onclick="shanchu('{$vo.id}');">{$language2->drop}
                                                    </a>
                                                </td>
                                            </tr>
                                            {/foreach}
                                            {/foreach}

                                        </table>
                                    </div>
                                </div>
                                <div class="box-footer clearfix">
                                    {$page}
                                </div>
                                <!-- /.box-body -->
                            </div>
                        </div>
                    </div>
                </section>
                <!-- /.content -->
            </div>
            <!-- /.content-wrapper -->
            {include file="public/footer.html"}
        </div>
        <!-- ./wrapper -->

        <!-- jQuery 2.2.3 -->
        <script type="text/javascript" >
            /*删除*/
            function shanchu(id) {
                deletes('?app=roomType&act=dele&id=' + id);
            }
        </script>
        {literal}
        <script type="text/javascript">
            function downloadIamge(selector, name) {
                // 通过选择器获取img元素，
                var img = document.querySelector(selector)
                //                     console.log(img);
                // 将图片的src属性作为URL地址
                var url = img.src
                var a = document.createElement('a')
                var event = new MouseEvent('click')

                a.download = name || '下载图片名称'
                a.href = url

                a.dispatchEvent(event)
            }
        </script>
        {/literal}
        {literal}
        <script>
            function make(id) {
                var url = "?app=roomType&act=getRoomXcxCode&id=" + id;
                $.ajax({
                    url: url,
                    type: "POST",
                    dataType: "json",
                    success: function (data) {
                        console.log(data);
                        if (data.status == 1) {
                            layer.msg(data.message);
                            setTimeout(function () {
                                window.location.reload();
                            }, 1000);
                        } else {
                            layer.msg(data.message);
                        }
                    }
                })
            }

            $(function () {
                //
                $("#example-advanced").treetable({
                    expandable: true,
                    clickableNodeNames: true
                });
                //
                $('body').on('click', '.j_click', function () {
                    var val = 0;
                    if ($(this).hasClass('yes')) {
                        $(this).removeClass('yes');
                        $(this).find('i').removeClass('fa-check-circle');
                        $(this).addClass('no');
                        $(this).find('i').addClass('fa-ban');
                        $(this).html('<i class="fa fa-ban"></i> 否');
                        val = 0;
                    } else {
                        $(this).removeClass('no');
                        $(this).find('i').removeClass('fa-ban');
                        $(this).addClass('yes');
                        $(this).find('i').addClass('fa-check-circle');
                        $(this).html('<i class="fa fa-check-circle"></i> 是');
                        val = 1;
                    }
                    $.ajax({
                        type: "GET",
                        dataType: "json",
                        url: url,
                        data: {'val': val},
                        success: function (obj) {

                        },
                        error: function (obj) {

                        }
                    })

                    ////

                })

            });
        </script>
        {/literal}
    </body>
</html>
