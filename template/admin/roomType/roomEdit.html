<!DOCTYPE html>
<html>
    <head>

        {include file="public/header.html"}

    </head>
    <body class="hold-transition skin-blue sidebar-mini">
        <div class="wrapper">

            {include file="public/title.html"}
            <!-- Left side column. contains the logo and sidebar -->
            {include file="public/menu.html"}

            <!-- Content Wrapper. Contains page content -->
            <div class="content-wrapper">
                {include file="public/headtab.html"}
                <!-- Content Header (Page header) -->
                <section class="content-header">
                    <h1>
                        {$language1->type_add}
                    </h1>
                    <ol class="breadcrumb">
                        <li><a href="admin.php?app=default&act=index"><i class="fa fa-dashboard"></i>  {$language1->index}</a></li>
                        <li class="active">{$language1->good_manage}</li>
                        <li class="active">{$language1->business_type_list}</li>
                    </ol>
                </section>

                <!-- Main content -->
                <section class="content">
                    <div class="row">
                        <!-- right column -->
                        <div class="col-xs-12">
                            <!-- Horizontal Form -->
                            <div class="box box-primary">
                                <div class="box-header with-border">
                                    <h3 class="box-title"></h3>
                                </div>
                                <!-- /.box-header -->
                                <!-- form start -->
                                <form class="form-horizontal" action="?app=roomType&act=doEdit" data-type="ajax" method="post">
                                    <div class="box-body">
                                        <input type="hidden" name="id" value="{$id}">
                                        <input type="hidden" name="p" value="{$p}">
                                        <div class="form-group">
                                            <label class="col-sm-4 col-md-2  col-lg-2 control-label"><span class="text-red">*</span> {$language1->business_type_name}：</label>
                                            <div class="col-sm-2">
                                                <select class="form-control w160 j_select j-cate3 " name="room_id" id="room_id" >
                                                    {$options}
                                                </select>
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label class="col-sm-4 col-md-2  col-lg-2 control-label"><span class="text-red">*</span> {$language1->type_name}:</label>
                                            <div class="col-sm-6 col-md-5 col-lg-4">
                                                {$html}
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <input type="hidden" name="image_id" id="image_id" value="{$room.room_img}">
                                            <label class="col-sm-4 col-md-2  col-lg-2 control-label"><span class="text-red">*</span> {$language1->business_picture}:</label>
                                            <div class="col-sm-7 col-md-6 col-lg-5">
                                                <p class="file-img">
                                                    {if $room.room_img}
                                                    <img id="img1" title="" src="{$room.room_img}" width="100px" height="100px"/>
                                                    {else}
                                                    <img id="img1" title="" src="" width="100" height="100" style="display:none"/>
                                                    {/if}

                                                </p>
                                                <p class="inblock">
                                                    <input type="file" id="file1" name="fileName" />
                                                </p>
                                                <p>{$language1->size_hundred} </p>
                                                <button type="button"  class="btn btn-primary file-btn" id="validate" >{$language2->upload}</button>

                                            </div>
                                        </div>
                                        <!--                                        <div class="form-group">
                                                                                    <label class="col-sm-4 col-md-2  col-lg-2 control-label"><span class="text-red">*</span> 广告位链接:</label>
                                                                                    <div class="col-sm-6 col-md-5 col-lg-4">
                                                                                        <input type="text" class="form-control" name="adv_url"  value="{$room.adv_url}">
                                                                                    </div>
                                                                                </div>--> 
                                        {if $room.room_adv_img ==''}
                                        <div class="form-group j_room" style="display: none;">
                                            <input type="hidden" name="adv_id" id="adv_id" value="">
                                            <label class="col-sm-4 col-md-2  col-lg-2 control-label"><span class="text-red">*</span>{$language1->ad_picture}：</label>
                                            <div class="col-sm-7 col-md-6 col-lg-5">
                                                <p class="file-img">
                                                    <!-- {if $image}
                                                    <img id="img1" title="" src="{$image.url}" width="100px" height="100px"/>
                                                    {else} -->
                                                    <img id="img2" title="" src="" width="100" height="100" style="display:none"/>
                                                    <!-- {/if} -->

                                                </p>
                                                <p class="inblock">
                                                    <input type="file" id="file2" name="fileName" />
                                                </p>
                                                <p>尺寸:1200*450 </p>
                                                <button type="button"  class="btn btn-primary file-btn" id="validate2" >{$language2->upload}</button>

                                            </div>
                                        </div>
                                        {else}
                                        <div class="form-group">
                                            <input type="hidden" name="adv_id" id="adv_id" value="{$room.room_adv_img}">
                                            <label class="col-sm-4 col-md-2  col-lg-2 control-label"><span class="text-red">*</span>{$language1->ad_picture}:</label>
                                            <div class="col-sm-7 col-md-6 col-lg-5">
                                                <p class="file-img">
                                                    {if $room.room_adv_img}
                                                    <img id="img2" title="" src="{$room.room_adv_img}" width="100px" height="100px"/>
                                                    {else}
                                                    <img id="img2" title="" src="" width="100" height="100" style="display:none"/>
                                                    {/if}

                                                </p>
                                                <p class="inblock">
                                                    <input type="file" id="file2" name="fileName" />
                                                </p>
                                                <p>尺寸:1200*450 </p>
                                                <button type="button"  class="btn btn-primary file-btn" id="validate2" >{$language2->upload}</button>
                                            </div>
                                        </div>
                                        {/if}
                                        <div class="form-group">
                                            <label class="col-sm-4 col-md-2  col-lg-2 control-label" ><span class="text-red">*</span>{$language2->sort} </label>
                                            <div class="col-sm-6 col-md-5 col-lg-4">
                                                <input type="text" class="form-control" name="sort" value="{$room.sort}">
                                            </div>
                                        </div>
                                        {if $display !=1}
                                        <div class="box-body" id="tab_goods_images">
                                            <label class="col-sm-4 col-md-2  col-lg-2 control-label" ><span class="text-red">*</span>{$language1->carousel_picture} </label>
                                            <table class="table table-bordered">
                                                <tbody>
                                                <tr>
                                                    <td>
                                                        {foreach from=$type_images item=vo}
                                                        {if $vo}
                                                        <div style="width:100px; text-align:center; margin: 5px; display:inline-block;" class="goods_xc">
                                                            <input type="hidden" value="{$vo}" name="goods_images[]">
                                                            <a onClick="" href="{$vo}" target="_blank"><img width="100" height="100" src="{$vo}"></a>
                                                            <br>
                                                            <a href="javascript:void(0)" onClick="ClearPicArr2(this, '{$vo}')">{$language2->drop}</a>

                                                        </div>
                                                        {/if}
                                                        {/foreach}
                                                        <div class="goods_xc" style="width:100px; text-align:center; margin: 5px; display:inline-block;">
                                                            <input type="hidden" name="goods_images[]" value="">
                                                            <a href="##" onclick="GetUploadify(9, '', 'goods', 'call_back2');">
                                                                <img src="{$STATIC_URL}/admin/dist/img/add-button.jpg" width="100" height="100">
                                                            </a>
                                                            <br>
                                                            <a href="##">&nbsp;&nbsp;</a>
                                                        </div>
                                                    </td>
                                                </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                    {/if}
                                    <!-- /.box-body -->
                                    <div class="box-footer">
                                        <div class="form-group">
                                            <div class="col-sm-6 col-sm-offset-4 col-md-5 col-md-offset-2 col-lg-4 col-lg-offset-2">
                                                <a href="admin.php?app=roomType&act=roomTypeIndex&p={$p}" class="btn btn-default"><i class="fa fa-times-circle"></i> {$language2->close}</a>
                                                <button class="btn btn-primary pull-right" id="submit"><i class="fa fa-save"></i> {$language2->save}</button>
                                            </div>
                                        </div>
                                    </div>
                                </form>
                                <!-- /.box -->
                                <!-- general form elements disabled -->
                            </div>
                            <!-- /.box -->
                        </div>
                        <!--/.col (right) -->
                    </div>
                    <!-- /.row -->
                </section>
                <!-- /.content -->
            </div>
            <!-- /.content-wrapper -->
            {include file="public/footer.html"}
            <script src="{$STATIC_URL}/plugin/kindeditor/kindeditor.js"></script>
            <script src="{$STATIC_URL}/plugin/kindeditor/lang/zh_CN.js"></script>
            <script src="{$STATIC_URL}/plugin/ajaxfileupload/ajaxfileupload.js"></script>
            <!-- Control Sidebar -->
            <!-- /.control-sidebar -->
            <!-- Add the sidebar's background. This div must be placed
                 immediately after the control sidebar -->
            <div class="control-sidebar-bg"></div>
        </div>
        {literal}
        <script type="text/javascript">
            $(".j-cate3").on("change", function () {
                var id = $(this).find(":selected").val();
                if (id != 0) {
                    $('.j_room').show();
                    $('#tab_goods_images').hide();
                }else{
                    $('.j_room').hide();
                    $('#tab_goods_images').show();
                }
            });
            function GetUploadify(num, elementid, path, callback)
            {
                // var upurl ='/index.php?m=Admin&c=Uploadify&a=upload&num='+num+'&input='+elementid+'&path='+path+'&func='+callback;
                var upurl = 'admin.php?app=goods&act=upload&num=' + num + '&input=' + elementid + '&path=' + path + '&func=' + callback;
                // console.log(upurl);
                layer.open({
                    type: 2,
                    title: '上传图片',
                    shadeClose: true,
                    shade: false,
                    maxmin: true, //开启最大化最小化按钮
                    area: ['50%', '60%'],
                    content: upurl
                });
            }
            function img_call_back(fileurl_tmp)
            {
                $("#imagetext").val(fileurl_tmp);
                $("#img_a").attr('href', fileurl_tmp);
                $("#img_i").attr('onmouseover', "layer.tips('<img src=" + fileurl_tmp + ">',this,{tips: [1, '#fff']});");
            }

            function call_back(fileurl_tmp) {
                $("#original_img").val(fileurl_tmp);
                $("#original_img2").attr('href', fileurl_tmp);
            }

            // 上传商品相册回调函数
            function call_back2(paths) {
                var last_div = $(".goods_xc:last").prop("outerHTML");
                for (i = 0; i < paths.length; i++)
                {
                    $(".goods_xc:eq(0)").before(last_div);  // 插入一个 新图片
                    $(".goods_xc:eq(0)").find('a:eq(0)').attr('href', paths[i]).attr('onclick', '').attr('target', "_blank");// 修改他的链接地址
                    $(".goods_xc:eq(0)").find('img').attr('src', paths[i]);// 修改他的图片路径
                    $(".goods_xc:eq(0)").find('a:eq(1)').attr('onclick', "ClearPicArr2(this,'" + paths[i] + "')").text('删除');
                    $(".goods_xc:eq(0)").find('input').val(paths[i]); // 设置隐藏域 要提交的值
                }
            }
            /*
             * 上传之后删除组图input
             * @access   public
             * @val      string  删除的图片input
             */
            function ClearPicArr2(obj, path) {
                $.ajax({
                    type: 'GET',
                    url: "?app=goods&act=delUpload",
                    data: {action: "del", filename: path},
                    success: function () {
                        $(obj).parent().remove(); // 删除完服务器的, 再删除 html上的图片
                    }
                });
            }
            $(function () {

                $("#validate").click(function () {

                    if ($("#file1").val().length > 0) {
                        $.ajaxFileUpload
                                (
                                        {
                                            url: 'admin.php?app=goodsClass&act=upload', //用于文件上传的服务器端请求地址
                                            secureuri: false, //是否需要安全协议，一般设置为false
                                            fileElementId: 'file1', //文件上传域的ID
                                            dataType: 'JSON', //返回值类型 一般设置为json
                                            data: {
                                                image_id: $('#image_id').val()
                                            },
                                            success: function (obj, status)  //服务器成功响应处理函数
                                            {
                                                //alert(obj);
                                                var data = eval('(' + obj + ')'); //由JSON字符串转换为JSON对象
                                                //alert(data);
                                                if (data.status == 'error') {
                                                    var d = $.dialog({
                                                        content: '<div class="text-center">' + data.message + '</div>',
                                                        title: false, // hides the title.
                                                        closeIcon: false, // hides the close icon.
                                                        columnClass: 'xsmall',
                                                        onOpen: function () {
                                                            setTimeout(function () {
                                                                d.close();
                                                            }, 1000);
                                                        }
                                                    });
                                                    return false;
                                                }
                                                //                                alert(data.image_id);
                                                $("#img1").attr("src", data.url);
                                                $("#img1").show();
                                                $("#img1").attr("width", '100px');
                                                $("#img1").attr("height", '100px');
                                                $("#image_id").val(data.url);
                                                $("#img1").attr("style", 'display:block');
                                            },
                                            error: function (data, status, e)//服务器响应失败处理函数
                                            {
                                                alert(e);
                                            }
                                        }
                                )
                        return false;
                    } else {
                        var d = $.dialog({
                            content: '<div class="text-center">请选择图片</div>',
                            title: false, // hides the title.
                            closeIcon: false, // hides the close icon.
                            columnClass: 'xsmall',
                            onOpen: function () {
                                setTimeout(function () {
                                    d.close();
                                }, 1000);
                            }
                        });
                        return false;
                    }
                })
            })
        </script>
        <script type="text/javascript">
            $(function () {

                $("#validate2").click(function () {

                    if ($("#file2").val().length > 0) {
                        $.ajaxFileUpload
                                (
                                        {
                                            url: 'admin.php?app=goodsClass&act=upload', //用于文件上传的服务器端请求地址
                                            secureuri: false, //是否需要安全协议，一般设置为false
                                            fileElementId: 'file2', //文件上传域的ID
                                            dataType: 'JSON', //返回值类型 一般设置为json
                                            data: {
                                                image_id: $('#image_id').val()
                                            },
                                            success: function (obj, status)  //服务器成功响应处理函数
                                            {
                                                //alert(obj);
                                                var data = eval('(' + obj + ')'); //由JSON字符串转换为JSON对象
                                                //alert(data);
                                                if (data.status == 'error') {
                                                    var d = $.dialog({
                                                        content: '<div class="text-center">' + data.message + '</div>',
                                                        title: false, // hides the title.
                                                        closeIcon: false, // hides the close icon.
                                                        columnClass: 'xsmall',
                                                        onOpen: function () {
                                                            setTimeout(function () {
                                                                d.close();
                                                            }, 1000);
                                                        }
                                                    });
                                                    return false;
                                                }
                                                //                                alert(data.image_id);
                                                $("#img2").attr("src", data.url);
                                                $("#img2").show();
                                                $("#img2").attr("width", '100px');
                                                $("#img2").attr("height", '100px');
                                                $("#adv_id").val(data.url);
                                                $("#img2").attr("style", 'display:block');
                                            },
                                            error: function (data, status, e)//服务器响应失败处理函数
                                            {
                                                alert(e);
                                            }
                                        }
                                )
                        return false;
                    } else {
                        var d = $.dialog({
                            content: '<div class="text-center">请选择图片</div>',
                            title: false, // hides the title.
                            closeIcon: false, // hides the close icon.
                            columnClass: 'xsmall',
                            onOpen: function () {
                                setTimeout(function () {
                                    d.close();
                                }, 1000);
                            }
                        });
                        return false;
                    }
                })
            })
        </script>
        {/literal}
    </body>
</html>


