<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <title>{$language1->site_good}</title>
        {include file="public/header.html"}
    </head>
    <body class="hold-transition skin-blue sidebar-mini">
        <div class="wrapper">
            {include file="public/title.html"}
            <!-- Left side column. contains the logo and sidebar -->
            {include file="public/menu.html"}
            <!-- Content Wrapper. Contains page content -->
            <div class="content-wrapper">
                {include file="public/headtab.html"}
                <section class="content-header">
                    <h1>
                        {$language1->site_good}
                    </h1>
                    <ol class="breadcrumb">
                        <li><a href="?app=default&act=index"><i class="fa fa-dashboard"></i> {$language1->index}</a></li>
                        <li><a href="##">{$language1->regional_manage}</a></li>
                        <li class="active">{$language1->site_good}</li>
                    </ol>
                </section>
                <!-- Main content -->
                <section class="content">
                    <!-- /.row -->
                    <div class="row">
                        <div class="col-xs-12">
                            <div class="box box-primary">
                                <div class="box-header">
                                    <form class="form-inline col-sm-10 col-md-5 no-padding">
                                        <input type="hidden" name="app" value="areaGood" />
                                        <input type="hidden" name="act" value="index" />
                                        <input type="hidden" name = "delAll" value="dele">
                                        <div class="form-group form-group-sm form-mar">
                                            <!-- <small class="control-label sm"></small> -->
                                            <select class="form-control w160 j_select" name="store_id">
                                                <option value="0">--{$language1->please_select_site}--</option>
                                                {foreach from=$store item=v}
                                                <option value="{$v.id}" {if $store_id == $v.id} selected {/if}>{$v.store_name}</option>
                                                {/foreach}
                                            </select>
                                        </div>
                                        <div class="form-group form-group-sm form-mar">
                                            <input type="text" class="form-control" placeholder="{$language1->product_name}" name="goods_name" value="{$goods_name}">
                                        </div>
                                        <div class="form-group form-group-sm form-mar">
                                            <button type="submit" class="btn btn-default btn-sm">
                                                {$language2->search} <i class="fa fa-search"></i>
                                            </button>
                                        </div>
                                    </form>
                                    <div class="col-sm-2 col-md-7 no-padding">
                                        <a class="btn btn-primary pull-right btn-sm patchUnRecommend">{$language1->batch_not_recommend}</a>
                                        <a class="btn btn-primary pull-right btn-sm mr15 patchRecommend">{$language1->batch_recommend}</a>
                                        <a class="btn btn-primary pull-right btn-sm mr15 patchOffSale">{$language1->batch_off}</a>
                                        <a class="btn btn-primary pull-right btn-sm mr15 patchOnSale">{$language1->batch_on}</a>
                                        <a class="btn btn-primary pull-right btn-sm mr15" href="?app=areaGood&act=add&type=multi&p={$p}"><i class="fa fa-plus"></i> {$language1->site_add_good}</a>
                                        <a class="btn btn-primary pull-right btn-sm mr15" href="?app=areaGood&act=add&type=single&p={$p}"><i class="fa fa-plus"></i> {$language1->add_good}</a>
                                        <!--<a class="btn btn-primary pull-right btn-sm mr15 j_add" ><i class="fa fa-plus"></i> 添加商品</a>-->
                                    </div>
                                </div>
                                <div class="new-table-responsive">
                                    <div class="box-body table-responsive no-padding ">
                                        <table class="table table-hover middle-box">
                                            <tr>
                                                <th><input type="checkbox" name="" id="all"/></th>
                                                <th>{$language1->good_no}</th>
                                                <th>{$language1->good_code}</th>
                                                <th>{$language1->product_name}</th>
                                                <th>{$language1->short_name}</th>
                                                <th>{$language2->price}</th>
                                                <th>{$language1->recommend}</th>
                                                <th>{$language1->on_or_off}</th>
                                                <th>{$language2->store_name}</th>
                                                <th>{$language2->add_time}</th>
                                                <th>{$language1->total_stock}</th>
                                                <th>{$language1->total_sales}</th>
                                                <!--<th>所有站点使用</th>-->
                                                <th>{$language2->control}</th>
                                            </tr>
                                            {foreach from=$list item=v}
                                            <tr>
                                                <td><input type="checkbox" name="check-name" value="{$v.id}"/></td>
                                                <td>{$v.sort_id}</td>
                                                <td>{$v.goods_sn}</td>
                                                <td>
                                                    <div class="clearfix" style="width: 380px;">
                                                        <div class="pull-left img-w">
                                                            <img src="{$v.sgl_img}" width="60" height="50">
                                                        </div>
                                                        <div class="wts ml15 pull-left w300">
                                                            {$v.goods_name}</div>
                                                    </div>
                                                    </div>
                                                </td>
                                                <td>{$v.short}({$v.symbol})</td>
                                                <td class="text-red">{$v.shop_price}</td>
                                                <td>
                                                    {if $v.is_recommend ==1}
                                                    <p style="margin: 0;">
                                                        <input  type="checkbox" name="is_recommend" checked  data-value = '{$v.id}'>
                                                    </p>
                                                    {else}
                                                    <p style="margin: 0;">
                                                        <input  type="checkbox" name="is_recommend"  data-value = '{$v.id}'>
                                                    </p>
                                                    {/if}
                                                </td>
                                                <td>
                                                    {if $v.is_on_sale ==1}
                                                    <p style="margin: 0;">
                                                        <input  type="checkbox" name="is_on_sale" checked data-value = '{$v.id}' >
                                                    </p>
                                                    {else}
                                                    <p style="margin: 0;">
                                                        <input  type="checkbox" name="is_on_sale"  data-value = '{$v.id}' >
                                                    </p>
                                                    {/if}
                                                </td>
                                                <td>{$v.store_name}</td>
                                                <td>{$v.add_time}</td>

                                                <!--<td>-->
                                                <!--<p style="margin: 0;">-->
                                                <!--<input  type="checkbox" name="my-checkbox1" checked >-->
                                                <!--</p>-->
                                                <!--</td>-->

                                                <td>&nbsp;&nbsp;&nbsp;{$v.goods_storage}</td>
                                                {if $v.sales_Volume==''}
                                                <td>&nbsp;&nbsp;&nbsp;0</td>
                                                {else}
                                                <td>&nbsp;&nbsp;&nbsp;{$v.sales_Volume}</td>
                                                {/if}
                                                <!--<td>-->
                                                <!--<p style="margin: 0;">-->
                                                <!--<input  type="checkbox" name="my-checkbox1" checked >-->
                                                <!--</p>-->
                                                <!--</td>-->

                                                <td> 
                                                    {if $v.itemList==''}
                                                    {else}
                                                    <a href="admin.php?app=areaGood&act=specIfications&id={$v.id}&p={$p}&store_id={$store_id}" class="btn btn-xs btn-success delete-table" style="overflow: hidden; position: relative;">{$language1->specific_stock}</a>
                                                    {/if}
                                                    <a href="admin.php?app=areaGood&act=orderDetails&id={$v.id}&p={$p}&store_id={$store_id}" class="btn btn-xs btn-success delete-table" style="overflow: hidden; position: relative;">{$language1->sale_record}</a>
                                                    <a href="javascript:void(0)" data-toggle="tooltip" class="btn btn-xs btn-danger delete-table" style="overflow: hidden; position: relative;" onclick="shanchu({$v.id})">{$language2->drop}</a>
                                                </td>
                                            </tr>
                                            {/foreach}
                                        </table>
                                    </div>
                                </div>
                                <div class="box-footer clearfix">
                                    <div class="col-lg-3">
                                        <a href="#" class="btn btn-primary btn-sm delete-all"><i class="fa fa-trash-o"></i> {$language2->all_drop}</a>
                                    </div>
                                    <div class="col-lg-9">
                                        <div class="form-inline col-sm-10 col-md-9 no-padding" action="">
                                            <!--<div class="form-group form-group-sm form-mar">-->
                                            <!--<small class="control-label sm">价格：</small>-->
                                            <!--<input type="text" class="form-control" placeholder="价格" name="shop_price">-->
                                            <!--</div>-->
                                            <!--<div class="form-group form-group-sm form-mar">-->
                                            <!--<small class="control-label sm">库存：</small>-->
                                            <!--<input type="text" class="form-control" placeholder="库存" name="goods_storage">-->
                                            <!--</div>-->
                                            <!--<div class="form-group form-group-sm form-mar">-->
                                            <!--<button type="submit" class="btn btn-primary btn-sm" id ="goodSubmit">-->
                                            <!--批量设置 <i class="fa fa-search"></i>-->
                                            <!--</button>-->
                                            <!--</div>-->
                                        </div>
                                        {$page}
                                    </div>
                                </div>
                                <!-- /.box-body -->
                            </div>
                        </div>
                    </div>
                </section>
                <!-- /.content -->
            </div>
            <!-- /.content-wrapper -->
             <input type="hidden" name = "language2_yes" value="{$language2->yes}"/>
            <input type="hidden" name = "language2_no" value="{$language2->no}"/>
             <input type="hidden" name = "language1_select_set" value="{$language1->select_set}"/>
            {include file="public/footer.html"}
        </div>
        <script type="text/javascript">
            //删除
            function shanchu(id) {
                deletes('?app=areaGood&act=dele&id=' + id);
            }
            </script>
{literal}
<script type="text/javascript">
           $(function(){
            $("[name='my-checkbox1']").bootstrapSwitch({
          // onText:"是",
          // offText:"否",
          size:"mini",
          onSwitchChange:function(event,state){  
            if(state==true){  
                $(this).val("1");
            }else{  
                $(this).val("2");  
            }  
          }  
        });
        $("[name='my-checkbox2']").bootstrapSwitch({
          // onText:"是",
          // offText:"否",
          size:"mini",
          onSwitchChange:function(event,state){  
            if(state==true){  
                $(this).val("1");
            }else{  
                $(this).val("2");  
            }  
          }  
        });
      })
</script>
<script type="text/javascript">
    $('#goodSubmit').click(function(){
        var id = "";
        $("input[name='check-name']:checkbox").each(function () {
            if ($(this).is(":checked")) {
                id += $(this).attr("value") + ",";
            }
        });
        if(id.length ==0){
            var d=$.dialog({
                content: '<div class="text-center">Please choose at least one item！</div>',
                title: false, // hides the title.
                closeIcon: false, // hides the close icon.
                columnClass: 'xsmall',
                onOpen: function(){
                    setTimeout(function(){
                        d.close();
                    }, 400);
                }
            });
            return false;
        }
        var shop_price = $('input[name=shop_price]').val();
        var goods_storage = $('input[name=goods_storage]').val();
        if(goods_storage.length == 0){
            var d=$.dialog({
                content: '<div class="text-center">The stock can not be empty！</div>',
                title: false, // hides the title.
                closeIcon: false, // hides the close icon.
                columnClass: 'xsmall',
                onOpen: function(){
                    setTimeout(function(){
                        d.close();
                    }, 400);
                }
            });
            return false;
        }
//        if(shop_price.length !=0) {
//            var pre = /(^[1-9]\d*(\.\d{1,2})?$)|(^0(\.\d{1,2})?$)/;
//            if (!pre.test(shop_price)) {
//                var d = $.dialog({
//                    content: '<div class="text-center">销售价格格式不正确！</div>',
//                    title: false, // hides the title.
//                    closeIcon: false, // hides the close icon.
//                    columnClass: 'xsmall',
//                    onOpen: function () {
//                        setTimeout(function () {
//                            d.close();
//                        }, 400);
//                    }
//                });
//                return false;
//            }
//        }
       if(goods_storage.length !=0) {
           var reg = /^[1-9]+\d*$/;
           if (!reg.test(goods_storage)) {
               var d = $.dialog({
                   content: '<div class="text-center">The number of stocks must be positive integers！</div>',
                   title: false, // hides the title.
                   closeIcon: false, // hides the close icon.
                   columnClass: 'xsmall',
                   onOpen: function () {
                       setTimeout(function () {
                           d.close();
                       }, 400);
                   }
               });
               return false;
           }
       }
        $.ajax({
            url: 'admin.php?app=areaGood&act=doDPrice',
            type: 'POST',
            data: {'id':id,'shop_price':shop_price,'goods_storage':goods_storage},
            dataType: "json",
            success:function(msg) {
                if(msg.status==1){
                    var d=$.dialog({
                        content: '<div class="text-center">'+msg.message+'</div>',
                        title: false, // hides the title.
                        closeIcon: false, // hides the close icon.
                        columnClass: 'xsmall',
                        onOpen: function(){
                            setTimeout(function(){
                                d.close();
                            }, 400);
                        }
                    });
                    setTimeout(function(){window.location.reload();},1000);
                }else{
                    var d=$.dialog({
                        content: '<div class="text-center">'+msg.message+'</div>',
                        title: false, // hides the title.
                        closeIcon: false, // hides the close icon.
                        columnClass: 'xsmall',
                        onOpen: function(){
                            setTimeout(function(){
                                d.close();
                            }, 400);
                        }
                    });
                    setTimeout(function(){window.location.reload();},1000);
                }
            }
        });

    });
</script>
<script type="text/javascript">
    $(function(){
         var yes=$('input[name=language2_yes]').val();
              var no=$('input[name=language2_no]').val();
        $("[name='is_on_sale']").bootstrapSwitch({
            onText:yes,
            offText:no,
            size:"mini",
            onSwitchChange:function(event,state){
                if(state==true){
                    var id  = $(this).attr('data-value');
                    $(this).val("1");
                    var is_on_sale = $(this).val();
                    $.ajax({
                        url: 'admin.php?app=areaGood&act=changeSales',
                        type: 'POST',
                        data: {'id':id,'is_on_sale':is_on_sale},
                        dataType: "json",
                        success:function(msg) {
                            if(msg.status==1){
                                window.location.reload();
                                //setTimeout(function(){window.location.reload();},1000);
                            }else{
                                var d=$.dialog({
                                    content: '<div class="text-center">'+msg.message+'</div>',
                                    title: false, // hides the title.
                                    closeIcon: false, // hides the close icon.
                                    columnClass: 'xsmall',
                                    onOpen: function(){
                                        setTimeout(function(){
                                            d.close();
                                        }, 400);
                                    }
                                });
                                setTimeout(function(){window.location.reload();},1000);
                            }
                        }
                    });
                }else{
                    var id  = $(this).attr('data-value');
                    $(this).val("2");
                    var is_on_sale = $(this).val();
                    $.ajax({
                        url: 'admin.php?app=areaGood&act=changeSales',
                        type: 'POST',
                        data: {'id':id,'is_on_sale':is_on_sale},
                        dataType: "json",
                        success:function(msg) {
                            if(msg.status==1){
                                window.location.reload();
                                //setTimeout(function(){window.location.reload();},1000);
                            }else{
                                var d=$.dialog({
                                    content: '<div class="text-center">'+msg.message+'</div>',
                                    title: false, // hides the title.
                                    closeIcon: false, // hides the close icon.
                                    columnClass: 'xsmall',
                                    onOpen: function(){
                                        setTimeout(function(){
                                            d.close();
                                        }, 400);
                                    }
                                });
                                setTimeout(function(){window.location.reload();},1000);
                            }
                        }
                    });
                }
            }
        });
        // 是否推荐
        $("[name='is_recommend']").bootstrapSwitch({
            onText:no,
            offText:no,
            size:"mini",
            onSwitchChange:function(event,state){
                if(state==true){
                    var id  = $(this).attr('data-value');
                    $(this).val("1");
                    var is_recommend = $(this).val();
                    $.ajax({
                        url: 'admin.php?app=areaGood&act=changeRecommend',
                        type: 'POST',
                        data: {'id':id,'is_recommend':is_recommend},
                        dataType: "json",
                        success:function(msg) {
                            if(msg.status==1){
                                window.location.reload();
                                //setTimeout(function(){window.location.reload();},1000);
                            }else{
                                var d=$.dialog({
                                    content: '<div class="text-center">'+msg.message+'</div>',
                                    title: false, // hides the title.
                                    closeIcon: false, // hides the close icon.
                                    columnClass: 'xsmall',
                                    onOpen: function(){
                                        setTimeout(function(){
                                            d.close();
                                        }, 400);
                                    }
                                });
                                setTimeout(function(){window.location.reload();},1000);
                            }
                        }
                    });
                }else{
                    var id  = $(this).attr('data-value');
                    $(this).val("0");
                    var is_recommend = $(this).val();
                    $.ajax({
                        url: 'admin.php?app=areaGood&act=changeRecommend',
                        type: 'POST',
                        data: {'id':id,'is_recommend':is_recommend},
                        dataType: "json",
                        success:function(msg) {
                            if(msg.status==1){
                                window.location.reload();
                                //setTimeout(function(){window.location.reload();},1000);
                            }else{
                                var d=$.dialog({
                                    content: '<div class="text-center">'+msg.message+'</div>',
                                    title: false, // hides the title.
                                    closeIcon: false, // hides the close icon.
                                    columnClass: 'xsmall',
                                    onOpen: function(){
                                        setTimeout(function(){
                                            d.close();
                                        }, 400);
                                    }
                                });
                                setTimeout(function(){window.location.reload();},1000);
                            }
                        }
                    });

                }
            }
        });
    });
</script>
<!-- 批量推荐和批量商家功能-->
<script type="text/javascript">
     var select_set=$('input[name=language1_select_set]').val();
    $('.patchRecommend').click(function(){
        var goodArr = [] ;
        $('input[name=check-name]').each(function(){
            if($(this).is(":checked")){
                goodArr.push($(this).val());
            }
        });
        // 判断是否选中商品ID
        if(goodArr.length == 0){
            dialog(select_set);
            return ;
        }
        <!-- 获取当前推荐的值-->
        $.ajax({
            url: '?app=areaGood&act=doRecommend',
            type: 'POST',
            data: {'good_ids':goodArr,'flag':1},
            dataType: "json",
            success:function(msg) {
                if(msg.status==1){
                    dialog(msg.message);
                    setTimeout(function(){window.location.reload();},1000);
                }else{
                    dialog(msg.message);
                    if(msg.info){
                        return;
                    }
                    setTimeout(function(){window.location.reload();},1000);
                }
            }
        });
    });
    $('.patchUnRecommend').click(function(){
        var goodArr = [] ;
        $('input[name=check-name]').each(function(){
            if($(this).is(":checked")){
                goodArr.push($(this).val());
            }
        });
        <!-- 判断是否选中商品ID-->
        if(goodArr.length == 0){
            dialog(select_set);
            return ;
        }
        <!-- 获取当前推荐的值-->
        $.ajax({
            url: '?app=areaGood&act=doRecommend',
            type: 'POST',
            data: {'good_ids':goodArr,'flag':2},
            dataType: "json",
            success:function(msg) {
                if(msg.status==1){
                    dialog(msg.message);
                    setTimeout(function(){window.location.reload();},1000);
                }else{
                    dialog(msg.message);
                    if(msg.info){
                        return;
                    }
                    setTimeout(function(){window.location.reload();},1000);
                }
            }
        });
    });
    $('.patchOnSale').click(function(){
        var goodArr = [] ;
        $('input[name=check-name]').each(function(){
            if($(this).is(":checked")){
                goodArr.push($(this).val());
            }
        });
      <!-- 判断是否选中商品ID-->
        if(goodArr.length == 0){
            dialog(select_set);
            return ;
        }
        <!-- 获取当前推荐的值-->
        $.ajax({
            url: '?app=areaGood&act=doOnSale',
            type: 'POST',
            data: {'good_ids':goodArr,'flag':1},
            dataType: "json",
            success:function(msg) {
                if(msg.status==1){
                    dialog(msg.message);
                    setTimeout(function(){window.location.reload();},1000);
                }else{
                    dialog(msg.message);
                    if(msg.info =='return'){
                        return;
                    }
                    setTimeout(function(){window.location.reload();},1000);
                }
            }
        });
    });
    $('.patchOffSale').click(function(){
        var goodArr = [] ;
        $('input[name=check-name]').each(function(){
            if($(this).is(":checked")){
                goodArr.push($(this).val());
            }
        });
         <!-- 判断是否选中商品ID-->
        if(goodArr.length == 0){
            dialog(select_set);
            return ;
        }
        <!-- 获取当前推荐的值-->
        $.ajax({
            url: '?app=areaGood&act=doOnSale',
            type: 'POST',
            data: {'good_ids':goodArr,'flag':2},
            dataType: "json",
            success:function(msg) {
                if(msg.status==1){
                    dialog(msg.message);
                    setTimeout(function(){window.location.reload();},1000);
                }else{
                    dialog(msg.message);
                    if(msg.info == 'return'){
                        return;
                    }
                    setTimeout(function(){window.location.reload();},1000);
                }
            }
        });
    });
</script>
<!--封装提示框-->
<script type="text/javascript">
    function dialog($msg){
        var d=$.dialog({
            content: '<div class="text-center">'+$msg+'</div>',
            title: false, // hides the title.
            closeIcon: false, // hides the close icon.
            columnClass: 'xsmall',
            onOpen: function(){
                setTimeout(function(){
                    d.close();
                }, 800);
            }
        });
    }
</script>
{/literal}
    </body>
</html>
