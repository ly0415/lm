<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>{$language1->add_area_good}</title>
    <!-- Tell the browser to be responsive to screen width -->
    {include file="public/header.html"}
</head>
<body class="hold-transition skin-blue sidebar-mini">
<div class="wrapper">

    {include file="public/title.html"}
    {include file="public/menu.html"}
    <div class="content-wrapper">
        {include file="public/headtab.html"}
        <section class="content-header">
            <h1>
               {$language1->add_area_good}
            </h1>
            <ol class="breadcrumb">
                <li><a href="?app=default&act=index"><i class="fa fa-dashboard"></i> {$language1->index}</a></li>
                <li><a href="##">{$language1->site}</a></li>
                <li class="active">{$language1->add_area_good}</li>
            </ol>
        </section>
        <!-- Main content -->
        <section class="content">
            <!-- /.row -->
            <div class="row">
                <div class="col-xs-12">
                    <div class="box box-primary">
                        <div class="box-header">
                            <form class="form-inline col-sm-10 col-md-9 no-padding">
                                <div class="form-group form-group-sm form-mar">
                                    <input type='hidden' name='app' value='areaGood'>
                                    <input type='hidden' name='act' value='add'>
                                    <input type="hidden" name="store_id" value="{$store_id}"  />
                                    <input type="hidden" name="type" value="{$type}"   />
                                    <input type="hidden" name="p" value="{$p}"   />
                                    {if $type == 'single'}
                                      <input type='hidden' name='type' value='single'>
                                    {/if}
                                    <!--<input type="hidden" name="cate_status" value="{$Lcate}" />-->
                                    <!-- <small class="control-label sm"></small> -->
                                    <!--<select class="form-control w160 j_select" name = "select_type" id ='select_type' onchange="gettypelist(this.id)">-->
                                        <!--<option value="0">&#45;&#45;请选择&#45;&#45;</option>-->
                                        <!--{foreach $good_type as $k => $v}-->
                                         <!--<option value="{$k}" {if $k == $selectType} selected {/if}>{$v}</option>-->
                                        <!--{/foreach}-->
                                    <!--</select>-->
                                </div>
                                <!--<div class="form-group form-group-sm j_treebox form-mar" style="display: none;">-->
                                    <!--<input type="text" class="form-control ipt" name ='cate' value="{$cate_name}" readonly />-->
                                    <!--<input type="hidden" class="form-control ipt_1"  name="Lcate" value="{$Lcate}"/>-->
                                    <!--<span class="dw"></span>-->
                                    <!--<div class="st_tree ">-->
                                        <!--<ul>-->
                                            <!--{foreach from =$list_cate item =v1}-->
                                            <!--<li><a href="#" data-value="{$v1.id}" >{$v1.name}</a></li>-->
                                            <!--<ul>-->
                                                <!--{foreach from=$v1.children item=v2}-->
                                                <!--<li><a href="#" data-value="{$v2.id}">{$v2.name}</a></li>-->
                                                <!--<ul>-->
                                                    <!--{foreach from=$v2.children item=v3}-->
                                                    <!--<li><a href="#" data-value="{$v3.id}">{$v3.name}</a></li>-->
                                                    <!--{/foreach}-->
                                                <!--</ul>-->
                                                <!--{/foreach}-->
                                            <!--</ul>-->
                                            <!--{/foreach}-->
                                        <!--</ul>-->
                                    <!--</div>-->
                                <!--</div>-->
                                <!--<div class="form-group form-group-sm form-mar" id="selectSite">-->
                                    <!--&lt;!&ndash; <small class="control-label sm"></small> &ndash;&gt;-->
                                    <!--<select class="form-control w160 j_select"  name="other" >-->
                                        <!--<option value="0">&#45;&#45;请选择&#45;&#45;</option>-->
                                        <!--{foreach from=$canshu item=v}-->
                                         <!--<option value="{$v.id}" {if $v.id == $other} selected {/if}>{$v.name}</option>-->
                                        <!--{/foreach}-->
                                    <!--</select>-->
                                <!--</div>-->
                                <div class="form-group form-group-sm form-mar">
                                    <small class="control-label">{$language1->product_name}：</small>
                                    <input type="text" class="form-control" placeholder="{$language1->enter_good_name}" name="good_name" value="{$good_name}">
                                </div>
                                <div class="form-group form-group-sm form-mar">
                                    <button type="submit" class="btn btn-default btn-sm">
                                        {$language2->search} <i class="fa fa-search"></i>
                                    </button>
                                </div>
                            </form>
                                <div class="col-sm-2  col-md-3 no-padding form-inline ">
                                    {if $type == 'single'}
                                    <div class="form-group form-group-sm form-mar">
                                        <select class="form-control w160 j_select" name="single_store" >
                                            <option value='0'>{$language1->please_select_site}</option>
                                            {foreach from=$store  item=v}
                                              <option value="{$v.id}" {if $store_id == $v.id} selected {/if}>{$v.store_name}</option>
                                            {/foreach}
                                        </select>
                                    </div>
                                    {/if}
                                    {if $type == 'single'}
                                    <input type="hidden" name="status" value="1" /> <!--单站点选择 -->
                                    {else}
                                    <input type="hidden" name="status" value="2" /> <!-- 多站点选择-->
                                    {/if}
                                    <div class="form-group form-group-sm form-mar">
                                        <button type="submit" class="btn btn-primary btn-sm" id="submit">
                                            <i class="fa fa-plus"></i> {$language2->add_to}
                                        </button>
                                        <a  href ="?app=areaGood&act=index&p={$p}" class="btn btn-primary btn-sm">{$language2->back}
                                        </a>
                                    </div>
                                </div>
                            {if $type == 'multi'}
                                <div class="col-md-12" style="padding-left: 0; margin-top: 10px;" >
                                    <select class="form-control w160 j_select j_country"  name="storeCate" >
                                        <option value="0">--{$language1->select_country}--</option>
                                        {foreach from=$countrys item=v}
                                        <option value="{$v.id}" {if $v.id == $storeCountry} selected {/if} >{$v.cate_name}</option>
                                        {/foreach}
                                    </select>
                                </div>
                                <div class="col-md-12 j_store_cate" style="padding-left: 0; margin-top: 20px;" >
                                    {foreach from=$store  item=v}
                                    <label class="checkbox-inline col-sm-2" style="margin-left: 0;">
                                         <input type="checkbox" name="multi_store[]" value="{$v.id}" {if in_array($v.id,$storeArr)} checked
                                                {/if}> {$v.store_name}
                                    </label>
                                    {/foreach}
                                    {if !store}
                                        <span style="color: red;">{$language1->select_country}</span>
                                    {/if}
                                </div>
                            {/if}
                        </div>
                        <div class="new-table-responsive">
                            <div class="box-body table-responsive no-padding ">
                                <table class="table table-hover middle-box">
                                    <tr>
                                        <th width="4%"><input type="checkbox" name="" id="all"/></th>
                                        <th width="20%">{$language2->serial_number}</th>
                                        <th width="50%">{$language1->product_name}</th>
                                        <th width="10%">{$language1->market_price}</th>
                                        <th width="10%">{$language1->sale_price}</th>
                                        <!--<th width="10%">语言</th>-->
                                    </tr>
                                    {foreach from=$list item=v}
                                    <tr>
                                        <td><input type="checkbox" name="check-name" value="{$v.goods_id}"/></td>
                                        <td>{$v.sort_id}</td>
                                        <td>
                                            <div class="clearfix">
                                                <div class="pull-left img-w">
                                                    <img src="{$v.original_img}" width="60" height="50">
                                                </div>
                                                <div class="wts ml15 pull-left" style="width: 85%">
                                                   {$v.goods_name}</div>
                                                </div>
                                            </div>
                                        </td>
                                        <td class="text-red">￥ {$v.market_price}</td>
                                        <td class="text-red">￥ {$v.shop_price}</td>
                                        <!--<td>{$v.lang_id}</td>-->
                                    </tr>
                                  {/foreach}
                                </table>
                            </div>
                        </div>

                        <div class="box-footer clearfix">
                           <!--  <div class="col-lg-3">
                                <a href="#" class="btn btn-primary btn-sm delete-all"><i class="fa fa-trash-o"></i> 批量删除</a>
                            </div> -->
                            <div class="col-lg-12">
                              {$page}
                            </div>
                        </div>
                        <!-- /.box-body -->
                    </div>
                </div>
            </div>
        </section>
        <!-- /.content -->
    </div>
     <input type="hidden" name = "language2_please_select" value="{$language2->please_select}"/>
     <input type="hidden" name = "language1_site_required" value="{$language1->site_required}"/>
     <input type="hidden" name = "language1_select_good" value="{$language1->select_good}"/>
{include file="public/footer.html"}
</div>
</body>
</html>
{literal}
<script type="text/javascript">
//    $(function(){
//      var cate_status = $('input[name=cate_status]').val();
//      if(cate_status.length != 0 ){
//          $('.j_treebox').show();
//          $('#selectSite').hide();
//      }
//    });
    function gettypelist(id){
         var please_select=$('input[name=language2_please_select]').val();
        var type_id = $.trim($("#"+id).val());
        if(type_id == 0){
            var html = "<option value='0'>--" + please_select + "--</option>";
            $("#selectSite").find('select').html(html);
            $('input[name=cate_status]').val(0);
            $('.j_treebox').hide();
            $("#selectSite").show();
            return false;
        }
        $.ajax({
            url: '?app=areaGood&act=getData',
            type: 'POST',
            data: "id="+type_id,
            dataType: "json",
            success:function(msg) {
//                 console.log(msg);
//                 return false;
                if(msg.status==1){
                    $('.j_treebox').show();
                    $('#selectSite').hide();
//                    var html = '<input type="text" class="form-control ipt"  name="cate"/>';
//                    var html ='';
//                    html ='<div class="st_tree">';
                   var html ='<ul>';
                    $.each(msg.data, function (key, value) {
                        html += '<li><a href="#" data-value="'+ value.id +'">'+ value.name +'</a></li>';
                        html += '<ul>';
                        $.each(value.children, function (k1, v2) {
                          html += '<li><a href="#" data-value="'+ v2.id +'">'+ v2.name +'</a></li>';
                          html += '<ul>';
                          $.each(v2.children, function (k3, v3) {
                          html += '<li><a href="#" data-value="'+ v3.id +'">'+ v3.name +'</a></li>';
                          });
                          html += '</ul>';
                        });
                        html += ' </ul>';
                    });
                    html +='</ul>';
                  $('.st_tree').html(html);
                   setTimeout(function() {
                        // alert($(".st_tree").length)
                        $(".st_tree").SimpleTree({
                            click:function(a){
                                if(!$(a).attr("hasChild"))
                                    alert($(a).attr("ref"));
                            }
                        });
                    }, 100);
        
                }else{
                    $('input[name=cate_status]').val(0);
                    $('.j_treebox').hide();
                    $('#selectSite').show();
                    var html = "<option value=''>--" + please_select + "--</option>";
                    $.each(msg, function (key, value) {
                        html += "<option value='" + value.id + "'>" + value.name + "</option>";
                    });
                    $("#selectSite").find('select').html(html);
                }
            }
        });
    }
//    $(".st_tree").SimpleTree({
//        click:function(a){
//            if(!$(a).attr("hasChild"))
//                alert($(a).attr("ref"));
//        }
//    });
    $(function(){
        $('body').on('click','.j_treebox',function(){
            $('.st_tree').show();
        })
        $('.j_treebox').on('mousedown','a',function(){
            var text = $(this).text();
            console.log(text);
            var id = $(this).attr('data-value');
            $('.j_treebox .ipt').val(text);
            $('.j_treebox .ipt_1').val(id);
            $('.st_tree').hide();
        })
    })
//    setTimeout(function() {
//        // alert($(".st_tree").length)
//        $(".st_tree").SimpleTree({
//            click:function(a){
//                if(!$(a).attr("hasChild"))
//                    alert($(a).attr("ref"));
//            }
//        });
//    }, 100);
</script>
<script type="text/javascript">
  $('#submit').click(function(){
      var status = $('input[name=status]').val();
      var siterequired = $('input[name=language1_site_required]').val();
      var select_good = $('input[name=language1_select_good]').val();
   if(status ==1) {
       var single_store = $('select[name=single_store]').val();
       var str = "";
       $("input[name='check-name']:checkbox").each(function () {
           if ($(this).is(":checked")) {
               str += $(this).attr("value") + ",";
           }
       });
       if (single_store == 0) {
           var d = $.dialog({
               content: '<div class="text-center">'+ siterequired +'</div>',
               title: false, // hides the title.
               closeIcon: false, // hides the close icon.
               columnClass: 'xsmall',
               onOpen: function () {
                   setTimeout(function () {
                       d.close();
                   }, 1000);
               }
           });
           return false;
       }
       if (str.length == 0) {
           var d = $.dialog({
               content: '<div class="text-center">'+ select_good +'</div>',
               title: false, // hides the title.
               closeIcon: false, // hides the close icon.
               columnClass: 'xsmall',
               onOpen: function () {
                   setTimeout(function () {
                       d.close();
                   }, 1000);
               }
           });
           return false;
       }
   }else{
       var single_store = "";
       $("input[name='multi_store[]']:checkbox").each(function () {
           if ($(this).is(":checked")) {
               single_store += $(this).attr("value") + ",";
           }
       });
      if(single_store.length ==0){
          var d = $.dialog({
              content: '<div class="text-center">'+ siterequired +'</div>',
              title: false, // hides the title.
              closeIcon: false, // hides the close icon.
              columnClass: 'xsmall',
              onOpen: function () {
                  setTimeout(function () {
                      d.close();
                  }, 1000);
              }
          });
          return false;
      }
       var str = "";
       $("input[name='check-name']:checkbox").each(function () {
           if ($(this).is(":checked")) {
               str += $(this).attr("value") + ",";
           }
       });
       if(str.length ==0){
           var d = $.dialog({
               content: '<div class="text-center">'+ select_good +'</div>',
               title: false, // hides the title.
               closeIcon: false, // hides the close icon.
               columnClass: 'xsmall',
               onOpen: function () {
                   setTimeout(function () {
                       d.close();
                   }, 1000);
               }
           });
           return false;
       }
   }
      $.ajax({
          url: '?app=areaGood&act=doAddGood',
          type: 'POST',
          data: {'store_id':single_store,'goods_id':str,'status':status},
          dataType: "json",
          success:function(obj) {
              // console.log(msg);
              // return false;
              var msg = obj.message;
              if(obj.status == 1){
                  var d=$.dialog({
                      content: '<div class="text-center">'+msg+'</div>',
                      title: false, // hides the title.
                      closeIcon: false, // hides the close icon.
                      columnClass: 'xsmall',
                      onOpen: function(){
                          setTimeout(function(){
                              d.close();
                          }, 1000);
                      }
                  });
                  setTimeout(function(){window.location.href= obj.info.url;}, 1000);
              }
              else{
                  var d=$.dialog({
                      content: '<div class="text-center">'+msg+'</div>',
                      title: false, // hides the title.
                      closeIcon: false, // hides the close icon.
                      columnClass: 'xsmall',
                      onOpen: function(){
                          setTimeout(function(){
                              d.close();
                          }, 1000);
                      }
                  });
              }
          }
      });

  });
</script>

<script type="text/javascript">
    $('select[name=single_store]').change(function () {
        var store_id = $(this).val();
        var good_name = $('input[name=good_name]').val();
        var url = "?app=areaGood&act=add&type=single";
        if(good_name.length >0){
            url +="&good_name="+good_name;
        }
        if(store_id.length > 0){
            url +="&store_id="+store_id;
        }

        window.location= url;
    });
</script>

<!--选择单个商品出现选中状态 -->
<!--<script type="text/javascript">-->
   <!--$(function() {-->
           <!--var store_id = $('select[name=single_store]').val();-->
<!--//       window.location= "?app=areaGood&act=add&type=single&store_id="+store_id;-->
           <!--$("input[name='check-name']:checkbox").each(function () {-->
               <!--if ($(this).is(":checked")) {-->
                   <!--$(this).prop("checked", false);-->
               <!--}-->
           <!--});-->
           <!--$.ajax({-->
               <!--url: '?app=areaGood&act=getGoodData',-->
               <!--type: 'POST',-->
               <!--data: "store_id=" + store_id,-->
               <!--dataType: "json",-->
               <!--success: function (msg) {-->
<!--//               console.log(msg);-->
<!--//               return false;-->
                   <!--if (msg.status == 0) {-->
                       <!--$("input[name='check-name']:checkbox").each(function () {-->
                           <!--if ($(this).is(":checked")) {-->
                               <!--$(this).prop("checked", false);-->
                           <!--}-->
                       <!--});-->
                       <!--return false;-->
                   <!--}-->
                   <!--$.each(msg.info.data, function (key, value) {-->
                       <!--$("input[name='check-name']:checkbox").each(function () {-->
                           <!--if (value.goods_id == $(this).val()) {-->

                               <!--$(this).prop("checked", true);-->
                           <!--}-->
                       <!--});-->
                   <!--});-->
               <!--}-->
           <!--});-->
   <!--});-->
<!--</script>-->

<script type="text/javascript">
   $('.j_store_cate').on('click',"input[name='multi_store[]']:checkbox",function(){
        //$("input[name='multi_store[]']:checkbox").click(function () {
        var store_ids ='';
        $("input[name='multi_store[]']:checkbox").each(function () {
            if ($(this).is(":checked")) {
                store_ids += $(this).attr("value") + ",";
            }
        });
       var goods_name = $('input[name=good_name]').val();
       var url = "?app=areaGood&act=add&type=multi;

       if(goods_name.length > 0){
           url +='&good_name='+goods_name;
       }
       if(store_ids.length > 0 ){
           url +='&store_id='+store_ids;
       }
        window.location= url;
    });
</script>
<!--选择复选框多个商品出现选中状态 -->
<!--<script type="text/javascript">-->
    <!--$(function () {-->
        <!--var store_ids ='';-->
        <!--$("input[name='multi_store[]']:checkbox").each(function () {-->
            <!--if ($(this).is(":checked")) {-->
                <!--store_ids += $(this).attr("value") + ",";-->
            <!--}-->
        <!--});-->
        <!--$("input[name='check-name']:checkbox").each(function () {-->
            <!--if ($(this).is(":checked")) {-->
                <!--$(this).prop("checked", false);-->
            <!--}-->
        <!--});-->
        <!--$.ajax({-->
            <!--url: '?app=areaGood&act=getMultiGoodData',-->
            <!--type: 'POST',-->
            <!--data: "store_id="+store_ids,-->
            <!--dataType: "json",-->
            <!--success:function(msg) {-->
<!--//                if(msg.status ==0){-->
<!--//                    $("input[name='check-name']:checkbox").each(function () {-->
<!--//                        if ($(this).is(":checked")) {-->
<!--//                            $(this).prop("checked", false);-->
<!--//                        }-->
<!--//                    });-->
<!--//                    return false;-->
<!--//                }-->
                <!--$.each(msg.info, function (key, value) {-->
                    <!--$("input[name='check-name']:checkbox").each(function () {-->
                        <!--if(value.goods_id == $(this).val()){-->

                            <!--$(this).prop("checked", true);-->
                        <!--}-->
                    <!--});-->
                <!--});-->
            <!--}-->
        <!--});-->
    <!--});-->
<!--</script>-->
<!-- 选择国家切换区域店铺-->
<script type="text/javascript">
    //分类关联
    $(".j_country").on("change", function() {
        $('.j_room').hide();
        var _this = $(this);
        var id = $(this).find(":selected").val();
        var url = "?app=fxRuler&act=getChild&parent_id=" + id;
        $.ajax({
            type: "GET",
            dataType: "json",
            url: url,
            success: function(obj) {
                if (obj.status == 1) {
                    var option ='';
                    $.each(obj.info, function(i, e) {
                        option +=' <label class="checkbox-inline col-sm-2" style="margin-left: 0;">';
                        option += '<input type="checkbox" name="multi_store[]" value="'+e.id +'" class="check check1">'+ e.store_name;
                        option += '</label>';
                    });
                    $('.j_store_cate').html(option);
                    $("input[name='check-name']:checkbox").each(function () {
                        if ($(this).is(":checked")) {
                            $(this).prop("checked", false);
                        }
                    });

                } else {
                    option = '<span style="color: red;">请选择国家！</span>';
                    $('.j_store_cate').html(option);
                    $("input[name='check-name']:checkbox").each(function () {
                        if ($(this).is(":checked")) {
                            $(this).prop("checked", false);

                        }
                    });
                    var goods_name = $('input[name=good_name]').val();
                    var url = "?app=areaGood&act=add&type=multi";
                    if(goods_name.length > 0){
                        url +='&good_name='+goods_name;
                    }
                    window.location= url;
                }

            }

        });
    });
</script>

{/literal}
