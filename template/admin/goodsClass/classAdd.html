<!DOCTYPE html>
<html>
    <head>

        {include file="public/header.html"}

    </head>
    <body class="hold-transition skin-blue sidebar-mini">
        <div class="wrapper">

            {include file="public/title.html"}
            <!-- Left side column. contains the logo and sidebar -->
            {include file="public/menu.html"}

            <!-- Content Wrapper. Contains page content -->
            <div class="content-wrapper">
                {include file="public/headtab.html"}
                <!-- Content Header (Page header) -->
                <section class="content-header">
                    <h1>
                        {$language1->add_classify}
                    </h1>
                    <ol class="breadcrumb">
                        <li><a href="admin.php?app=default&act=index"><i class="fa fa-dashboard"></i> {$language1->index}</a></li>
                        <li class="active">{$language1->good_manage}</li>
                        <li class="active">{$language1->good_type_list}</li>
                    </ol>
                </section>

                <!-- Main content -->
                <section class="content">
                    <div class="row">
                        <!-- right column -->
                        <div class="col-xs-12">
                            <!-- Horizontal Form -->
                            <div class="box box-primary">
                                <div class="box-header with-border">
                                    <h3 class="box-title"></h3>
                                </div>
                                <!-- /.box-header -->
                                <!-- form start -->
                                <form class="form-horizontal" action="?app=goodsClass&act=doAdd" data-type="ajax" method="post">
                                    <div class="box-body">
                                        <div class="form-group">
                                            <label class="col-sm-4 col-md-2  col-lg-2 control-label"><span class="text-red">*</span> {$language1->classification_name}：</label>

                                            <div class="col-sm-6 col-md-5 col-lg-4">
                                                {$html}
                                            </div>

                                        </div>

                                        <div class="form-group">
                                            <label class="col-sm-4 col-md-2  col-lg-2 control-label"><span class="text-red">*</span>{$language1->superior_classify}：</label>
                                            <div class="col-sm-6 col-md-5 col-lg-4">
                                                <select class="form-control w160 j_select inblock" name="pro_id" id="pro_id" onchange="getcitylist(this.id)">
                                                    <option value="0">{$language1->top_classification}</option>
                                                    {foreach from=$cates item=p}
                                                    <option value='{$p.id}'>{$p.category_name}</option>
                                                    {/foreach}
                                                </select>
                                                <select class="form-control w160 j_select inblock" name="city_id" id="lev2_ctg"  >
                                                    <option>{$language1->select_categories}</option>
                                                </select>
                                            </div>
                                        </div>
                                        <!--<div class="form-group">-->
                                        <!--<label class="col-sm-4 col-md-2  col-lg-2 control-label"><span class="text-red">*</span> 导航显示：</label>-->
                                        <!--<div class="col-md-2">-->
                                        <!--<select class="form-control j_select" name="is_show">-->
                                        <!--<option value="1">显示</option>-->
                                        <!--<option value="2">隐藏</option>-->
                                        <!--</select>-->
                                        <!--</div>-->
                                        <!--</div>-->
                                        <div class="form-group">
                                            <input type="hidden" name="image_id" id="image_id" value="">
                                            <label class="col-sm-4 col-md-2  col-lg-2 control-label"><span class="text-red">*</span> {$language2->picture}：</label>
                                            <div class="col-sm-7 col-md-6 col-lg-5">
                                                <p class="file-img">
                                                    <!-- {if $image}
                                                    <img id="img1" title="" src="{$image.url}" width="100px" height="100px"/>
                                                    {else} -->
                                                    <img id="img1" title="" src="" width="100" height="100" style="display:none"/>
                                                    <!-- {/if} -->

                                                </p>
                                                <p class="inblock">
                                                    <input type="file" id="file1" name="fileName" />
                                                </p>
                                                <p>{$language1->picture_size} </p>
                                                <button type="button"  class="btn btn-primary file-btn" id="validate" >{$language2->upload}</button>

                                            </div>
                                        </div>

                                        <div class="form-group">
                                            <input type="hidden" name="image_id2" id="image_id2" value="">
                                            <label class="col-sm-4 col-md-2  col-lg-2 control-label"><span class="text-red">*</span> {$language1->advertising_picture}：</label>
                                            <div class="col-sm-7 col-md-6 col-lg-5">
                                                <p class="file-img">
                                                    <!-- {if $image}
                                                    <img id="img1" title="" src="{$image.url}" width="100px" height="100px"/>
                                                    {else} -->
                                                    <img id="img2" title="" src="" width="100" height="100" style="display:none"/>
                                                    <!-- {/if} -->

                                                </p>
                                                <p class="inblock">
                                                    <input type="file" id="file2" name="fileName" />
                                                </p>
                                                <p>{$language1->ad_picture_size} </p>
                                                <button type="button"  class="btn btn-primary file-btn" id="validate2" >{$language2->upload}</button>

                                            </div>
                                        </div>

                                        <div class="form-group">
                                            <label class="col-sm-4 col-md-2  col-lg-2 control-label"><span class="text-red">*</span> {$language2->sort}：</label>
                                            <div class="col-sm-6 col-md-5 col-lg-4">
                                                <input type="text" class="form-control" name="sort_order" >
                                            </div>
                                        </div>
                                    </div>
                                    <!-- /.box-body -->
                                    <div class="box-footer">
                                        <div class="form-group">
                                            <div class="col-sm-6 col-sm-offset-4 col-md-5 col-md-offset-2 col-lg-4 col-lg-offset-2">
                                                <a href="admin.php?app=goodsClass&act=classIndex" class="btn btn-default"><i class="fa fa-times-circle"></i> {$language2->close}</a>
                                                <button class="btn btn-primary pull-right" id="submit"><i class="fa fa-save"></i>  {$language2->save}</button>
                                            </div>
                                        </div>
                                    </div>
                                </form>
                                <!-- /.box -->
                                <!-- general form elements disabled -->
                            </div>
                            <!-- /.box -->
                        </div>
                        <!--/.col (right) -->
                    </div>
                    <!-- /.row -->
                </section>
                <!-- /.content -->
            </div>
            <!-- /.content-wrapper -->
            {include file="public/footer.html"}
            <script src="{$STATIC_URL}/plugin/kindeditor/kindeditor.js"></script>
            <script src="{$STATIC_URL}/plugin/kindeditor/lang/zh_CN.js"></script>
            <script src="{$STATIC_URL}/plugin/ajaxfileupload/ajaxfileupload.js"></script>
            <!-- Control Sidebar -->
            <!-- /.control-sidebar -->
            <!-- Add the sidebar's background. This div must be placed
                 immediately after the control sidebar -->
            <div class="control-sidebar-bg"></div>
        </div>
        {literal}
        <script type="text/javascript">
        $(function() {

            $("#validate").click(function() {

                if ($("#file1").val().length > 0) {
                    $.ajaxFileUpload
                            (
                                {
                                    url: 'admin.php?app=goodsClass&act=upload', //用于文件上传的服务器端请求地址
                                    secureuri: false, //是否需要安全协议，一般设置为false
                                    fileElementId: 'file1', //文件上传域的ID
                                    dataType: 'JSON', //返回值类型 一般设置为json
                                    data: {
                                        image_id: $('#image_id').val()
                                    },
                                    success: function(obj, status)  //服务器成功响应处理函数
                                    {
                                        //alert(obj);
                                        var data = eval('(' + obj + ')'); //由JSON字符串转换为JSON对象
                                        //alert(data);
                                        if (data.status == 'error') {
                                            var d = $.dialog({
                                                content: '<div class="text-center">' + data.message + '</div>',
                                                title: false, // hides the title.
                                                closeIcon: false, // hides the close icon.
                                                columnClass: 'xsmall',
                                                onOpen: function() {
                                                    setTimeout(function() {
                                                        d.close();
                                                    }, 1000);
                                                }
                                            });
                                            return false;
                                        }
                                        //                                alert(data.image_id);
                                        $("#img1").attr("src", data.url);
                                        $("#img1").show();
                                        $("#img1").attr("width", '100px');
                                        $("#img1").attr("height", '100px');
                                        $("#image_id").val(data.url);
                                        $("#img1").attr("style", 'display:block');
                                    },
                                    error: function(data, status, e)//服务器响应失败处理函数
                                    {
                                        alert(e);
                                    }
                                }
                            );
                    return false;
                } else {
                    var d = $.dialog({
                        content: '<div class="text-center">请选择图片</div>',
                        title: false, // hides the title.
                        closeIcon: false, // hides the close icon.
                        columnClass: 'xsmall',
                        onOpen: function() {
                            setTimeout(function() {
                                d.close();
                            }, 1000);
                        }
                    });
                    return false;
                }
            })

            $("#validate2").click(function() {

                if ($("#file2").val().length > 0) {
                    $.ajaxFileUpload
                    (
                            {
                                url: 'admin.php?app=goodsClass&act=upload', //用于文件上传的服务器端请求地址
                                secureuri: false, //是否需要安全协议，一般设置为false
                                fileElementId: 'file2', //文件上传域的ID
                                dataType: 'JSON', //返回值类型 一般设置为json
                                data: {
                                    image_id: $('#image_id2').val()
                                },
                                success: function(obj, status)  //服务器成功响应处理函数
                                {
                                    //alert(obj);
                                    var data = eval('(' + obj + ')'); //由JSON字符串转换为JSON对象
                                    //alert(data);
                                    if (data.status == 'error') {
                                        var d = $.dialog({
                                            content: '<div class="text-center">' + data.message + '</div>',
                                            title: false, // hides the title.
                                            closeIcon: false, // hides the close icon.
                                            columnClass: 'xsmall',
                                            onOpen: function() {
                                                setTimeout(function() {
                                                    d.close();
                                                }, 1000);
                                            }
                                        });
                                        return false;
                                    }
                                    // alert(data.image_id);
                                    $("#img2").attr("src", data.url);
                                    $("#img2").show();
                                    $("#img2").attr("width", '100px');
                                    $("#img2").attr("height", '100px');
                                    $("#image_id2").val(data.url);
                                    $("#img2").attr("style", 'display:block');
                                },
                                error: function(data, status, e)//服务器响应失败处理函数
                                {
                                    alert(e);
                                }
                            }
                    );
                    return false;
                } else {
                    var d = $.dialog({
                        content: '<div class="text-center">请选择图片</div>',
                        title: false, // hides the title.
                        closeIcon: false, // hides the close icon.
                        columnClass: 'xsmall',
                        onOpen: function() {
                            setTimeout(function() {
                                d.close();
                            }, 1000);
                        }
                    });
                    return false;
                }
            })
        });
        </script>

        <script type="text/javascript">
            function getcitylist(id) {
                var pro_id = $.trim($("#" + id).val());
                if (pro_id == 0) {
                    var html = "<option value='0'>请选择商品分类</option>";
                    $("#" + id).parent().next().find('select').html(html);
                    return false;
                }
                $.ajax({
                    url: '?app=goodsClass&act=getCityAjaxData',
                    type: 'POST',
                    data: "pro_id=" + pro_id,
                    dataType: "json",
                    success: function(msg) {
                        // console.log(msg);
                        // return false;
                        var html = "<option value=''>请选择商品分类</option>";
                        $.each(msg, function(key, value) {
                            html += "<option value='" + value.id + "'>" + value.category_name + "</option>";
                        });
                        $('#lev2_ctg').html(html);
                    }
                });
            }


        </script>

        {/literal}
    </body>
</html>


