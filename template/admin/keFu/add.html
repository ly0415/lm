<!DOCTYPE html>
<html>
<head>
    {include file="public/header.html"}
</head>
<body class="hold-transition skin-blue sidebar-mini">
<div class="wrapper">

    {include file="public/title.html"}
    <!-- Left side column. contains the logo and sidebar -->
    {include file="public/menu.html"}

    <!-- Content Wrapper. Contains page content -->
    <div class="content-wrapper">
        {include file="public/headtab.html"}
        <!-- Content Header (Page header) -->
        <section class="content-header">
            <h1>
                客服添加
            </h1>
            <ol class="breadcrumb">
                <li><a href="admin.php?app=default&act=index"><i class="fa fa-dashboard"></i> 首页</a></li>
                <li class="active">网站</li>
                <li class="active">客服添加</li>
            </ol>
        </section>

        <!-- Main content -->
        <section class="content">
            <div class="row">
                <!-- right column -->
                <div class="col-xs-12">
                    <!-- Horizontal Form -->
                    <div class="box box-primary">
                        <div class="box-header with-border">
                            <h3 class="box-title"></h3>
                        </div>
                        <!-- /.box-header -->
                        <!-- form start -->
                        <form class="form-horizontal" action="?app=kf&act=doAdd" data-type="ajax" method="post">
                            <div class="box-body">
                                <input type="hidden" value="{$lang_id}" name="lang_id" />
                                <div class="form-group">
                                    <label class="col-sm-4 col-md-2  col-lg-2 control-label"><span class="text-red">*</span> 客服名称：</label>
                                    <div class="col-sm-6 col-md-5 col-lg-4">
                                        <input type="text" class="form-control" name="name">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-sm-4 col-md-2  col-lg-2 control-label"><span class="text-red">*</span> 客服QQ：</label>
                                    <div class="col-sm-6 col-md-5 col-lg-4">
                                        <input type="text" class="form-control" name="QQ">
                                    </div>
                            </div>
                            <!-- /.box-body -->
                            <div class="box-footer">
                                <div class="form-group">
                                    <div class="col-sm-6 col-sm-offset-4 col-md-5 col-md-offset-2 col-lg-4 col-lg-offset-2">
                                        <a href="?app=kf&act=index" class="btn btn-default"><i class="fa fa-times-circle"></i> 关 闭</a>
                                        <button class="btn btn-primary pull-right" id="submit"><i class="fa fa-save"></i> 保 存</button>
                                    </div>
                                </div>
                            </div>
                        </form>
                        <!-- /.box -->
                        <!-- general form elements disabled -->
                    </div>
                    <!-- /.box -->
                </div>
                <!--/.col (right) -->
            </div>
            <!-- /.row -->
        </section>
        <!-- /.content -->
    </div>
    <!-- /.content-wrapper -->
    {include file="public/footer.html"}
</div>
{literal}
<script type="text/javascript">
    $(function(){

        $("#validate").click(function () {

            if($("#file1").val().length > 0) {
                $.ajaxFileUpload
                (
                    {
                        url: 'admin.php?app=areaStore&act=upload', //用于文件上传的服务器端请求地址
                        secureuri: false, //是否需要安全协议，一般设置为false
                        fileElementId: 'file1', //文件上传域的ID
                        dataType: 'JSON', //返回值类型 一般设置为json
                        data:{
                            image_id:$('#image_id').val()
                        },
                        success: function (obj, status)  //服务器成功响应处理函数
                        {
                            //alert(obj);
                            var data = eval('(' + obj + ')'); //由JSON字符串转换为JSON对象
                            //alert(data);
                            if (data.status == 'error') {
                                var d=$.dialog({
                                    content: '<div class="text-center">'+data.message+'</div>',
                                    title: false, // hides the title.
                                    closeIcon: false, // hides the close icon.
                                    columnClass: 'xsmall',
                                    onOpen: function(){
                                        setTimeout(function(){
                                            d.close();
                                        }, 1000);
                                    }
                                });
                                return false;
                            }
//                                alert(data.image_id);
                            $("#img1").attr("src", data.url);
                            $("#img1").show();
                            $("#img1").attr("width", '100px');
                            $("#img1").attr("height", '100px');
                            $("#image_id").val(data.url);
                            $("#img1").attr("style", 'display:block');
                        },
                        error: function (data, status, e)//服务器响应失败处理函数
                        {
                            alert(e);
                        }
                    }
                )
                return false;
            }else {
                var d=$.dialog({
                    content: '<div class="text-center">请选择图片</div>',
                    title: false, // hides the title.
                    closeIcon: false, // hides the close icon.
                    columnClass: 'xsmall',
                    onOpen: function(){
                        setTimeout(function(){
                            d.close();
                        }, 1000);
                    }
                });
                return false;
            }
        })
    })
</script>
<script type="text/javascript">
    function getcitylist(id){
        var pro_id = $.trim($("#"+id).val());
        if(pro_id == 0){
            var html = "<option value='0'>请选择城市</option>";
            $("#"+id).parent().next().find('select').html(html);
            var city_id = $("#"+id).parent().next().find('select').val();
            if(city_id == 0){
                var html = "<option value='0'>请选择区域</option>";
                $("#"+id).parent().next().next().find('select').html(html);
            }
            return false;
        }
        $.ajax({
            url: '?app=areaStore&act=getAjaxData',
            type: 'POST',
            data: "pro_id="+pro_id,
            dataType: "json",
            success:function(msg) {
                var html = "<option value=''>请选择城市</option>";
                $.each(msg, function(key, value){
                    html += "<option value='"+value.id+"'>"+value.name+"</option>";
                });
                $("#"+id).parent().next().find('select').html(html);
                var html_1 = "<option value='0'>请选择区域</option>";
                $("#"+id).parent().next().next().find('select').html(html_1);
            }
        });
        return false;
    }
    //获取当前区域列表
    function getarealist(id){
        var city_id = $.trim($("#"+id).val());
        if(pro_id ==0){
            var html = "<option value='0'>请选择区域</option>";
            $("#"+id).parent().next().find('select').html(html);
            return false;
        }
        $.ajax({
            url: '?app=areaStore&act=getAjaxData',
            type: 'POST',
            data: "pro_id="+city_id,
            dataType: "json",
            success:function(msg) {
                var html = "<option value=''>请选择区域</option>";
                $.each(msg, function(key, value){
                    html += "<option value='"+value.id+"'>"+value.name+"</option>";
                });
                $("#"+id).parent().next().find('select').html(html);
            }
        });
        return false;
    }
</script>
<script  type="text/javascript">
    $(function(){
        var new_html;
        var g_new_html;
        $('.j_add').click(function(){
            $('.j_choosebox').show();
        })
        $('.j_shou').click(function(){
            $('.j_choosebox').hide();
        })

        $('.j_choosebox').on('click','.j_sure',function(){
            var sw= $('#switch').val();
            if(sw == 2){
                var country = $("#delivery_country_id").find("option:selected").attr("data-name");
                var zone = $("#delivery_zone_id").find("option:selected").attr("data-name");
                var g_html = country +','+ zone;
                var g_area = $('input[name=g_area]').val();
                if((country == '请选择国家')||(zone == '请选择城市')){
                    var d=$.dialog({
                        content: '<div class="text-center">请选择地区</div>',
                        title: false, // hides the title.
                        closeIcon: false, // hides the close icon.
                        columnClass: 'xsmall',
                        onOpen: function(){
                            setTimeout(function(){
                                d.close();
                            }, 1000);
                        }
                    });
                }else{
                    var str = '<span class="tag">'+g_html+'<em class="j_del">×</em></span>';
                    if(g_area == ''){
                        g_new_html =g_html;
                    }else{
                        g_new_html = g_area;
                        var g_arr = g_new_html.split(':')
                        var g_exist=$.inArray(g_html,g_arr);//从0开始
                        if(g_exist >=0){
                            var d=$.dialog({
                                content: '<div class="text-center">当前地区已存在！</div>',
                                title: false, // hides the title.
                                closeIcon: false, // hides the close icon.
                                columnClass: 'xsmall',
                                onOpen: function(){
                                    setTimeout(function(){
                                        d.close();
                                    }, 1000);
                                }
                            });
                            return false;
                        }

                        g_new_html = g_area+':'+g_html;
                    }
                    //str +='<input type="hidden" name="area" value='+html+'/>';
                    $('.tags-box').append(str);
                    $('input[name=g_area]').val(g_new_html);
                }
                return false;
            }else{
                var shen =$("#shen_id").find("option:selected").attr("data-name");
                var shi = $("#shi_id").find("option:selected").attr("data-name");
                var qu = $("#qu_id").find("option:selected").attr("data-name");
                var html;
                if((shen != '请选择省份')){
                    html = shen;
                    if(shi != '请选择城市'){
                        html += ','+shi;
                        if(qu != '请选择区域'){
                            html += ','+qu;
                        }
                    }
                }
               // var html =shen+','+shi+','+qu;
                var area = $('input[name=area]').val();
                if(shen == '请选择省份'){
                    console.log(html);
                    return false;
                    var d=$.dialog({
                        content: '<div class="text-center">请选择地区</div>',
                        title: false, // hides the title.
                        closeIcon: false, // hides the close icon.
                        columnClass: 'xsmall',
                        onOpen: function(){
                            setTimeout(function(){
                                d.close();
                            }, 1000);
                        }
                    });
                }else{
                    var str = '<span class="tag"><span>'+html+'</span><em class="j_del">×</em></span>';
                    if(area == ''){
                        new_html =html;
                    }else{
                         new_html = area;
                         var arr = new_html.split(':');
                         var _exist=$.inArray(html,arr);//从0开始
                         if(_exist >=0){
                             var d=$.dialog({
                                 content: '<div class="text-center">当前地区已存在！</div>',
                                 title: false, // hides the title.
                                 closeIcon: false, // hides the close icon.
                                 columnClass: 'xsmall',
                                 onOpen: function(){
                                     setTimeout(function(){
                                         d.close();
                                     }, 1000);
                                 }
                             });
                             return false;
                         }

                        new_html = area+':'+html;
                    }
                    //str +='<input type="hidden" name="area" value='+html+'/>';
                    $('.tags-box').append(str);
                    $('input[name=area]').val(new_html);
                    //<input type="hidden" name="area" value='"+str+"'/>
                }
            }
        })
        $('.tags-box').on('click','.j_del',function(){
            $(this).parent().remove();
        })
    })
</script>
<script type="text/javascript">
    $(function(){
        $("[name='is_site']").bootstrapSwitch({
            onText:"是",
            offText:"否",
            size:"small",
            onSwitchChange:function(event,state){
                if(state==true){
                    $(this).val("1");
                }else{
                    $(this).val("2");
                }
            }
        });
    })
</script>
<script type="text/javascript">
    $(function(){
        $("[name='switch-lan']").bootstrapSwitch({
            onText:"国内",
            offText:"国际",
            size:"small",
            onSwitchChange:function(event,state){
                if(state==true){
                    $(this).val('1');
                    $('#en').addClass('mp100');
                    $('#ch').removeClass('mp100');
                    $('#ch_dis').removeClass('mp100');
                    $('#en_dis').addClass('mp100');
                    $(".tag").remove();
                    $('#delivery_country_id').val('0');
                    $('#delivery_zone_id').val('0');
                    $('input[name=area]').val('');

                }else{
                    $(this).val('2');
                    $('#ch').addClass('mp100');
                    $('#en').removeClass('mp100');
                    $('#ch_dis').addClass('mp100');
                    $('#en_dis').removeClass('mp100');
                    $(".tag").remove();
                    $('#shen_id').val('0');
                    $('#shi_id').val('0');
                    $('#qu_id').val('0');
                    $('input[name=g_area]').val('');
                }
            }
        });
    })
</script>
<script type="text/javascript">
    function getZonelist(id){
        var pro_id = $.trim($("#"+id).val());
        if(pro_id == 0){
            var html = "<option value='0'>请选择城市</option>";
            $("#"+id).parent().next().find('select').html(html);
            return;
        }
        $.ajax({
            url: '?app=areaStore&act=getZoneData',
            type: 'POST',
            data: "pro_id="+pro_id,
            dataType: "json",
            success:function(msg) {
                // console.log(msg);
                // return false;
                var html = "<option value=''>请选择城市</option>";
                $.each(msg, function(key, value){
                    html += "<option value='"+value.zone_id+"'>"+value.name+"</option>";
                });
                $("#"+id).parent().next().find('select').html(html);
            }
        });
        return false;
    }
</script>
<script type="text/javascript">
    function getcitylist(id){
        var pro_id = $.trim($("#"+id).val());
        if(pro_id == 0){
            var html = "<option value='0'>请选择城市</option>";
            $("#"+id).parent().next().find('select').html(html);
            var city_id = $("#"+id).parent().next().find('select').val();
            if(city_id == 0){
                var html = "<option value='0'>请选择区域</option>";
                $("#"+id).parent().next().next().find('select').html(html);
            }
            return;
        }
        $.ajax({
            url: '?app=areaStore&act=getAjaxData',
            type: 'POST',
            data: "pro_id="+pro_id,
            dataType: "json",
            success:function(msg) {
                // console.log(msg);
                // return false;
                var html = "<option value=''>请选择城市</option>";
                $.each(msg, function(key, value){
                    html += "<option value='"+value.id+"' data-name='"+value.name+"'>"+value.name+"</option>";
                });
//                console.log(html);
                $("#"+id).parent().next().find('select').html(html);

                var html_1 = "<option value='0'>请选择区域</option>";
                $("#"+id).parent().next().next().find('select').html(html_1);
            }
        });
        return false;
    }
    //获取当前区域列表
    function getarealist(id){
        var pro_id = $.trim($("#"+id).val());
        $.ajax({
            url: '?app=areaStore&act=getAjaxData',
            type: 'POST',
            data: "pro_id="+pro_id,
            dataType: "json",
            success:function(msg) {
                var html = "<option value=''>请选择区域</option>";
                $.each(msg, function(key, value){
                    html += "<option value='"+value.id+"' data-name='"+value.name+"'>"+value.name+"</option>";
                });
                console.log(html);
                $("#"+id).parent().next().find('select').html(html);
            }
        });
        return false;
    }
</script>
<script type="text/javascript">
    function getshilist(id){
        var pro_id = $.trim($("#"+id).val());
        if(pro_id == 0){
            var html = "<option value='0' data-name='请选择城市'>请选择城市</option>";
            $("#"+id).next().find('select').html(html);
            var city_id = $("#"+id).parent().next().find('select').val();
            if(city_id == 0){
                var html = "<option value='0' data-name='请选择区域'>请选择区域</option>";
                $("#"+id).next().next().find('select').html(html);
            }
            return;
        }
        $.ajax({
            url: '?app=areaStore&act=getAjaxData',
            type: 'POST',
            data: "pro_id="+pro_id,
            dataType: "json",
            success:function(msg) {
                // console.log(msg);
                // return false;
                var html = "<option value='0' data-name='请选择城市'>请选择城市</option>";
                $.each(msg, function(key, value){
                    html += "<option value='"+value.id+"' data-name='"+value.name+"'>"+value.name+"</option>";
                });
                $("#"+id).siblings().eq(0).html(html);

                var html_1 = "<option value='0' data-name='请选择区域'>请选择区域</option>";
                $("#"+id).siblings().eq(1).html(html_1);
            }
        });
        return false;
    }
    //获取当前区域列表
    function getquyulist(id){
        var pro_id = $.trim($("#"+id).val());
        if(pro_id ==0 || pro_id == null ){
            var html = "<option value='0' data-name='请选择区域'>请选择区域</option>";
            $("#"+id).siblings().eq(1).html(html);
            return;
        }
        $.ajax({
            url: '?app=areaStore&act=getAjaxData',
            type: 'POST',
            data: "pro_id="+pro_id,
            dataType: "json",
            success:function(msg) {
                var html = "<option value='0' data-name='请选择区域'>请选择区域</option>";
                $.each(msg, function(key, value){
                    html += "<option value='"+value.id+"' data-name='"+value.name+"'>"+value.name+"</option>";
                });
                $("#"+id).siblings().eq(1).html(html);
            }
        });
        return false;
    }
</script>
<script type="text/javascript">
    function getDelConutry(id){
        var pro_id = $.trim($("#"+id).val());
        if(pro_id == 0){
            var html = "<option value='0' data-name='请选择城市'>请选择城市</option>";
            $("#"+id).next().html(html);
            return;
        }
        $.ajax({
            url: '?app=areaStore&act=getZoneData',
            type: 'POST',
            data: "pro_id="+pro_id,
            dataType: "json",
            success:function(msg) {
                var html = "<option value='0' data-name='请选择城市'>请选择城市</option>";
                $.each(msg, function(key, value){
                    html += "<option value='"+value.zone_id+"' data-name='"+value.name+"'>"+value.name+"</option>";
                });
                $("#"+id).next().html(html);
            }
        });
        return false;
    }
</script>
{/literal}
</body>
</html>
