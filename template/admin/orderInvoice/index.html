<!DOCTYPE html>
<html>
<head>
    {include file="public/header.html"}
</head>
<body class="hold-transition skin-blue sidebar-mini">
<div class="wrapper">
    {include file="public/title.html"}
    <!-- Left side column. contains the logo and sidebar -->
    {include file="public/menu.html"}

    <!-- Content Wrapper. Contains page content -->
    <div class="content-wrapper">
        {include file="public/headtab.html"}
        <!-- Content Header (Page header) -->
        <section class="content-header">
            <h1>
                发票列表
            </h1>
            <ol class="breadcrumb">
                <li><a href="?app=default&act=index"><i class="fa fa-dashboard"></i> 首页</a></li>
                <li class="active">订单管理</li>
                <li class="active">发票列表</li>
            </ol>

        </section>

        <!-- Main content -->
        <section class="content">
            <!-- /.row -->
            <div class="row">
                <div class="col-xs-12">
                    <div class="box box-primary">
                        <div class="box-header">
                            <form class="form-inline col-sm-10 col-md-11 no-padding">
                                <input type='hidden' name='app' value='orderInvoice'>
                                <input type='hidden' name='act' value='index'>
                                <input type="hidden" name="delAll" value="dele">

                                <div class="form-group form-group-sm form-mar">
                                    <small class="control-label">订单编号：</small>
                                    <input type="text" class="form-control" name='order_sn' value='{$order_sn}'>
                                </div>
                                <div class="form-group form-group-sm form-mar">
                                    <small class="control-label">发票状态：</small>
                                    <select class="form-control w160 j_select" name="status">
                                        <option value="0">全部</option>
                                        <option value="1" {if $status==1}selected{/if}>申请中</option>
                                        <option value="2" {if $status==2}selected{/if}>已开票</option>
                                    </select>
                                </div>
                                <!--<div class="form-group form-group-sm form-mar">-->
                                    <!--<small class="control-label">发票编号：</small>-->
                                    <!--<input type="text" class="form-control" name='invoice_sn' value='{$invoice_sn}'>-->
                                <!--</div>-->
                                <div class="form-group form-group-sm form-mar">
                                    <button type="submit" class="btn btn-default btn-sm">
                                        搜索 <i class="fa fa-search"></i>
                                    </button>
                                </div>
                            </form>
                        </div>
                        <div class="new-table-responsive">
                            <div class="box-body table-responsive no-padding">
                                <table class="table table-hover">
                                    <thead>
                                    <tr>
                                        <th><input type="checkbox" name="" id="all"/></th>
                                        <th>序号</th>
                                        <th>订单编号</th>
                                        <th>店铺名称</th>
                                        <th>发票状态</th>
                                        <th>开票金额</th>
                                        <th>抬头名称</th>
                                        <th>抬头类型</th>
                                        <th>申请人</th>
                                        <th>申请时间</th>
                                        <th>电子发票</th>
                                        <th style="width: 120px;">操作</th>
                                    </tr>
                                    </thead>

                                    {foreach $list as $key => $item}
                                    <tr>
                                        <td><input type="checkbox" name="check-name" value="{$item.id}"/></td>
                                        <td>{$list|@count - $key}</td>
                                        <td><a href="?app=orderInvoice&act=info&id={$item.id}">{$item.order_sn}</a></td>
                                        <td>{$item.store_name}</td>
                                        <td>{if $item.status==2}已开票{else}申请中{/if}</td>
                                        <td>{$symbol} {$item.invoice_money}</td>
                                        <td>{$item.head_title}</td>
                                        <td>{if $item.head_type==2}企业抬头{else}个人抬头{/if}</td>
                                        <td>{$item.username}</td>
                                        <td>{$item.add_time}</td>
                                        <td>
                                            {if $item.filepath}
                                            <a href="{$item.filepath}" download="{$item.filepath}" data-toggle="tooltip" class="btn btn-xs btn-success" style="overflow: hidden; position: relative;" data-original-title="下载"><i class="fa fa-download"></i> </a>
                                            {/if}
                                        </td>
                                        <td class="cz">
                                            <a href="javascript:void(0)" data-toggle="tooltip" class="btn btn-xs btn-success" style="overflow: hidden; position: relative;" data-original-title="上传" onclick="uploadClick('{$item.id}');"><i class="fa fa-upload"></i> </a>
                                            <a href="?app=orderInvoice&act=info&id={$item.id}" data-toggle="tooltip" class="btn btn-xs btn-success " style="overflow: hidden; position: relative;"  >查看</a>
                                            <a href="javascript:void(0)" data-toggle="tooltip" class="btn btn-xs btn-danger delete-table"
                                               style="overflow: hidden; position: relative;" onclick="shanchu('{$item.id}');">删除
                                            </a>
                                        </td>

                                    </tr>
                                    {/foreach}

                                </table>
                            </div>
                        </div>
                        <div class="box-footer clearfix">
                            <a href="#" class="btn btn-primary btn-sm delete-all"><i class="fa fa-trash-o"></i> 批量删除</a>
                            {$page}
                        </div>
                        <!-- /.box-body -->
                    </div>
                </div>
            </div>
        </section>
        <!-- /.content -->
    </div>
    {include file="public/footer.html"}

</div>
<form id="form_search" style="display: none">
    <input type="file" name="uploadfile" id="uploadfile" style="display: none;"/>
</form>
{literal}
<script type="text/javascript">
    var invoiceId = 0;
    $(function(){
        //监听图片选择
        $('#uploadfile').change(function(){
            if ($(this).val() != "") {
                file_upload();
            }
        });
    });
    /*删除*/
    function shanchu(id) {
        deletes('?app=orderInvoice&act=dele&id=' + id);
    }
    //上传按钮点击事件
    function uploadClick(id) {
        invoiceId = id;
        $('#uploadfile').click();
    }
    //文件上传
    function file_upload(){
        var data = new FormData($('#form_search')[0]);
        $.ajax({
            url: '?app=uploadfiles&act=uploadFile&uplodename=uploadfile',
            type: 'POST',
            data: data,
            dataType: 'JSON',
            cache: false,
            processData: false,
            contentType: false,
            success: function(res){
                var msg = res.message;
                if(res.status == 1){
                    $.ajax({
                        type: "POST",
                        url: '?app=orderInvoice&act=saveFilePath',
                        dataType: "json",
                        data: {id:invoiceId, filepath:res.info.filepath},
                        success: function (obj) {
                            alertDialog(msg);
                            setTimeout(function(){
                                window.location.reload();
                            }, 500);
                        }
                    });
                }else{
                    alertDialog(msg);
                }
            }
        });
        return false;
    }
</script>
{/literal}
</body>
</html>