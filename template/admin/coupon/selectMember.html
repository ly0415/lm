<div class="height">
    <div class="new-table-responsive">
        <div class="box-body table-responsive no-padding ">
            <div class="box-header">
                <div class="form-inline col-sm-10 col-md-11 no-padding">
                    <div class="form-group form-group-sm form-mar">
                    <small class="control-label sm">{$language1->user_name}：</small>
                    <input type="text" name="true_name" class="form-control"  value=""  placeholder="{$language1->fill_name}">
                    </div>
                    <div class="form-group form-group-sm form-mar">
                        <small class="control-label sm">{$language1->phone}：</small>
                        <input type="text" name="phone" class="form-control"  value=""  placeholder="{$language1->please_phone}">
                    </div>
                    <div class="form-group form-group-sm form-mar">
                        <button type="button" class="btn btn-default btn-sm" id="submit1">
                            {$language2->search} <i class="fa fa-search"></i>
                        </button>
                    </div>
                </div>
            </div>
            <input type="hidden"  name="totalpage"  value="{$totalpage}" >
            <input type="hidden"  name="user_id" id="user_id" value="{$userId}" >
            <input type="hidden"  name="user_name" id="user_name" value="{$userName}" >
            <table class="table tc-box">
                <thead>
                    <tr>
                        <th></th>
                        <th>{$language1->user_name}</th>
                        <th>{$language2->phone}</th>
                        <th>{$language2->add_time}</th>
                    </tr>
                </thead>
                <tbody  id="content" >
                    {foreach from=$data item=item}
                        <tr>
                            <td><input class="radio-name" type="checkbox" name="radio" data-name="{$item.username}" data-id="{$item.id}" {if in_array($item.id, $userIdList)}checked{/if}/></td>
                            <td>{$item.username}</td>
                            <td>{$item.phone}</td>
                            <td>{$item.add_time|date_format:"%Y-%m-%d"}</td>
                        </tr>
                    {/foreach}
                </tbody>
            </table>
            <div class="page-box">
                <ul id="page" class="pagination" >

                </ul>
            </div>
        </div>
    </div>
</div>
<script type="text/javascript">
    var user_id = '{$userId}';
    var user_name = '{$userName}';
    if (user_id) {
        // user_id = ['{$userId}'];
        // user_name = ['{$userName}'];
        user_id = '{$userId}'.split(',');
        user_name =  '{$userName}'.split(',');
    } else {
        user_id = [];
        user_name = [];
    }
    // console.log(user_id)
</script>
{literal}
<script  type="text/javascript" >
    $('.radio-name').click(function(){
        if ($(this).is(':checked')) {
            if ($.inArray($(this).attr('data-id'), user_id) < 0) {
                user_id.push($(this).attr('data-id'));
                user_name.push($(this).attr('data-name'));
            }
        } else {
            user_id.splice($.inArray($(this).attr('data-id'),user_id),1);
            user_name.splice($.inArray($(this).attr('data-name'),user_name),1);
        }
        $('#user_id').val(user_id);
        $('#user_name').val(user_name);
    })

    /*分页*/
    $(function() {
        var is_firsttime = true;
        var totalpage = $('input[name="totalpage"]').val();
        totalpage = parseInt(totalpage);
        $('#page').jqPaginator({
            totalPages: totalpage,
            visiblePages: 7,
            currentPage: 1,
            first: '<li class="prev"><a href="javascript:;">首页</a></li>',
            prev: '<li class="prev"><a href="javascript:;">上一页</a></li>',
            next: '<li class="next"><a href="javascript:;">下一页</a></li>',
            page: '<li class="page"><a href="javascript:;">{{page}}</a></li>',
            last: '<li class="prev"><a href="javascript:;">尾页</a></li>',
            onPageChange: function(num, type) {
                if (is_firsttime) {
                    is_firsttime = false;
                } else {
                    // //ajax获取
                    if (user_id) {
                        var url = '?app=coupon&act=getUserList&p=' + num + '&user_id=' + user_id + '&user_name=' + user_name;
                    } else {
                        var url = '?app=coupon&act=getUserList&p=' + num;
                    }
                    $.get(url, function(res) {
                        $('#content').html(res);
                    });
                }
            }
        });

    });


    /*搜索*/
    $('#submit1').click(function() {
        var true_name = $.trim($('input[name="true_name"]').val());
        var phone = $.trim($('input[name="phone"]').val());
        totalPage(true_name, phone);
    });
    function totalPage(true_name, phone) {
        //ajax
        var url = '?app=coupon&act=totalPage&true_name=' + true_name + '&phone=' + phone;
        $.get(url, function(res) {
            var obj = jQuery.parseJSON(res);
            var r = obj.total;

            $('#page').jqPaginator({
                totalPages: r,
                visiblePages: 7,
                currentPage: 1,
                first: '<li class="prev"><a href="javascript:;">首页</a></li>',
                prev: '<li class="prev"><a href="javascript:;">上一页</a></li>',
                next: '<li class="next"><a href="javascript:;">下一页</a></li>',
                page: '<li class="page"><a href="javascript:;">{{page}}</a></li>',
                last: '<li class="prev"><a href="javascript:;">尾页</a></li>',
                onPageChange: function(num, type) {
                    //ajax
                    var url = '?app=coupon&act=getUserList&p=' + num + '&true_name=' + true_name + '&phone=' + phone;
                    $.get(url, function(res) {
                        $('#content').html(res);
                    });
                }

            });

        });
    }



</script>
{/literal}