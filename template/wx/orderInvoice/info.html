{include file="public/wx_header.html"}
</head>
<body>
<div class="invoicedetail">
    <div class="invoicetitles">
        <span>{if $data.status==2}已开票{else}申请中{/if}</span>
    </div>
    <div class="invoicedetailbody">
        <div class="idetailbg">
            <div class="key">
                <img src="{$STATIC_URL}/wx/orderInvoice/images/invoicekey.png" class="invoicekey"/>
                <span class="title">增值税电子发票</span>
            </div>
            <div class="idetiailitem">
                <div class="items clearfix">
                    <span>发票抬头</span>
                    <span>{$data.head_title}</span>
                </div>
                {if $data.taxnum}
                <div class="items clearfix">
                    <span>税号</span>
                    <span>{$data.taxnum}</span>
                </div>
                {/if}
                {if $data.bankname}
                <div class="items clearfix">
                    <span>开户银行</span>
                    <span>{$data.bankname}</span>
                </div>
                {/if}
                {if $data.bankaccount}
                <div class="items clearfix">
                    <span>银行账号</span>
                    <span>{$data.bankaccount}</span>
                </div>
                {/if}
                {if $data.address}
                <div class="items clearfix">
                    <span>企业地址</span>
                    <span>{$data.address}</span>
                </div>
                {/if}
                {if $data.phone}
                <div class="items clearfix">
                    <span>企业电话</span>
                    <span>{$data.phone}</span>
                </div>
                {/if}
                <div class="items clearfix">
                    <span>发票金额</span>
                    <span>{$symbol}{$data.invoice_money}</span>
                </div>
                <div class="items clearfix">
                    <span>申请日期</span>
                    <span>{$data.add_time}</span>
                </div>
            </div>
            {if $data.status==2}
            {if $data.filepath}
            <!--<a href="{$data.filepath}" download="{$data.filepath}" class="identailsubmit down">下载</a>-->
            <a href="javascript:void(0);" class="identailsubmit" id="sendMail">发送到邮箱</a>
            {/if}
            {else}
            <a href="?app=orderInvoice&act=edit&id={$data.id}" class="identailsubmit">修改申请</a>
            {/if}
        </div>
    </div>
</div>
<div class="modal-mask"></div>
<div class="modal-dialog">
    <div class="modal-content">
        <form id="form_sendemail">
            <div class="title1">发送到邮箱</div>
            <div class="title2">提交成功后系统会自动发送邮件!</div>
            <div class="info">
                <input type="hidden" name="id" value="{$data.id}">
                <input type="text" name="email" class="email" value='' placeholder='请填写正确的邮箱地址！'/>
            </div>
        </form>
    </div>
    <div class="modal-footer">
        <span class="cancel" bindtap="hideModal" onclick="hideModal();">取消</span>
        <span bindtap="drawBack" onclick="sendEmail('{$data.id}');">发送</span>
    </div>
</div>
<script src="{$STATIC_URL}/phone/js/jquery-2.1.1.min.js" type="text/javascript"></script>
<script src="{$STATIC_URL}/phone/js/layer/layer.js" type="text/javascript"></script>
<script src="{$STATIC_URL}/phone/js/mobiscroll.custom-2.17.1.min.js" type="text/javascript"></script>
<script src="{$STATIC_URL}/phone/js/index.js" type="text/javascript"></script>
<script src="{$STATIC_URL}/phone/js/common.js" type="text/javascript"></script>
<script>
    var sendFlag = false;
    $(function () {
        $("#sendMail").click(function(){
            showModal();
        });
        $(".modal-mask").click(function () {
            hideModal();
        });
    });
    //显示模态框
    function showModal() {
        $(".modal-mask").show();
        $(".modal-dialog").show();
    }
    //隐藏模态框
    function hideModal() {
        $(".modal-mask").hide();
        $(".modal-dialog").hide();
    }
    //发送邮箱
    function sendEmail() {
        if (sendFlag) {
            return false;
        }
        sendFlag = true;
        var url = '?app=orderInvoice&act=saveEmail';
        var formdata = $('#form_sendemail').serialize();
        $.ajax({
            type: "POST",
            url: url,
            dataType: "json",
            data: formdata,
            success: function (res) {
                sendFlag = false;
                if (res.status == 1) {
                    layer.open({
                        shade: false,
                        content: " <i class='ico ico-correct'></i>" + res.message,
                        className: 'layer-tip',
                        time: 2
                    });
                    hideModal();
                } else {
                    layer.open({
                        shade: false,
                        content: " <i class='ico ico-error'></i>" + res.message,
                        className: 'layer-tip',
                        time: 2
                    });
                }
            }
        });
    }
</script>
</body>
</html>