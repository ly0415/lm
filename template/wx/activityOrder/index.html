<!DOCTYPE html>
<html>
    <head lang="en">
        <meta charset="UTF-8">
        <title>{$langdata.order_confirm}</title>
        <meta content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no" name="viewport">
        <meta content="yes" name="apple-mobile-web-app-capable">
        <meta content="black" name="apple-mobile-web-app-status-bar-style">
        <meta content="telephone=no" name="format-detection">
        <meta content="email=no" name="format-detection">
        <link href="{$STATIC_URL}/phone/css/mobiscroll.custom-2.17.1.min.css"  rel="stylesheet" type="text/css"/>
        <link href="{$STATIC_URL}/phone/css/style.css?_t={time()}"  rel="stylesheet" type="text/css"/>
        <style>
            .modal{
                position: fixed;
                z-index: 100000;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background-color: rgba(0,0,0,0.7);
                overflow: hidden;
                display:none;
            }
            .modal-dialog {
                width: 100%;
                height: 450px;
                background-color: #fff;
                position: fixed;
                bottom: 0;
                left: 50%;
                transform: translate(-50%);
                padding-bottom: 1rem;
            }
            .yhq-right{
                padding-bottom:0;
            }
            .div.couponContainer div.yhq div.yhq-left{
                top:0
            }
            div.couponContainer div.yhq div.yhq-left-top{
                padding-bottom:0;
            }
            .yhq-right{
                top:0;
            }
            div.couponContainer>div{
                overflow: auto;
                height: 6.5rem;
            }
            div.couponContainer>div.active {
                display: block;
                overflow: auto;
                height: 6.5rem;
            }
            div.tabsTxt{
                padding:0;
            }
            .yhq-right>div{
                padding-bottom:0;
            }
            div.couponContainer div.yhq div.yhq-left-top b{
                font-size:0.4rem;
            }
            div.tabsTxt1{
                margin-left:0;
            }
            div.couponTabs ul li{
                margin-right:0.3rem;
            }
            div.couponContainer div.yhq {
                width: 100%;
                height: 2rem;
                background: url(./assets/phone/images/yhqBg.png) no-repeat;
                background-size: 100% 100%;
                margin-top: 0.3rem;
                position: relative;
            }
               .addr span.red{
                background: #f63d3d;
                color: #fff;
                border-radius: 10px;
                padding: 0.02rem 0.3rem;
            }
               .sureorder-wrap .tj-order .btn-daifu {
                display: block;
                text-align: center;
                width: 50%;
                background-color: #f33e3e;
                color: #fff;
                font-size: .3rem;
                height: 100%;
                line-height: 0.9rem;
            }
        </style>


    </head>
    <body>
        <div class="sureorder-wrap">
            <div class="sureorder-address">
                {if $flag ==1}
                <!-- 无地址时样式 -->
                <a href="wx.php?app=userCenter&act=addAddress1&id={$userAddress.id}&name={$userAddress.name}&mp={$userAddress.app}&address={$userAddress.pays}&phone={$userAddress.phone}&postal={$userAddress.postal_code}&storeid={$storeid}&lang={$lang}&auxiliary={$auxiliary}&nowlatlon={$nowlatlon}&latlon={$latlon}&url={$referer}" class="btn-add-address">{$langdata.order_address}</a><!--添加地址-->
                {else}
                <!-- 有地址时样式 -->
                <a href="wx.php?app=userCenter&act=myAddress&id={$userAddress.id}&name={$userAddress.name}&mp={$userAddress.app}&address={$city}&phone={$userAddress.phone}&postal={$userAddress.postal_code}&storeid={$storeid}&lang={$lang}&auxiliary={$auxiliary}&nowlatlon={$nowlatlon}&latlon={$latlon}&returnUrl={$referer}" class="clearfix">
                    <i class="ico ico-address fl"></i>
                    <div class="mid fl">
                        <div class="clearfix">
                            <span class="fl">{$langdata.order_receipt}：{$userAddress.name}</span><!--收货人-->
                            <span class="fr">{$userAddress.phone}</span>
                        </div>
                        <p class="addr">
                             {if $userAddress.default_addr==1}
                            <span class='red'>默认</span>
                            {/if}
                            {$langdata.order_receipt_address}：
                            <span id="userAddress">{$address1}</span>
                        </p><!--收货地址-->
                    </div>
                    <i class="ico ico-right fr"></i>
                </a>
                {/if}
            </div>
            <div class="myorderstate-list mt20">
                <div class="shop">
                    <a href="##">
                        <i class="ico ico-shop"></i>
                        <span>{$storeName}</span>
                        <i class="ico ico-rg"></i>
                    </a>

                    <span class="fr state">{$langdata.order_waitfor}</span>
                </div>
                <ul>
                    <li class="itembox">
                        <a href="##" class="clearfix">
                            <div class="pro-logo fl">
                                <img src="{$activityGoodsData.goods_img}" width="100%">
                            </div>
                            <div class="pro-info fl">
                                <h3 class="pro-name ellipsis">{$activityGoodsData.goods_name}</h3>
                                <p class="pro-tags">
                                    <span>{$langdata.order_Specifications}: {$activityGoodsData.goods_key_name} </span><br/>
                                    <span style="color: red;">{$langdata.order_Postage}: {$symbol} {$shippingPrice} </span>
                                </p>
                                <input type="hidden" name="shippingprice" value="{$info.shipping_price}">
                            </div>
                            <div class="pro-right fr">
                                <p class="xprice">{$symbol}{$activityGoodsData.discount_price}</p>
                                <p class="num">X {$goodsNum}</p>
                            </div>
                        </a>
                    </li>
                </ul>
                <div class="otherbox">
                    <ul>
                        <li>
                            <span>{$langdata.order_mode}</span>
                            <span class="fr">
                                <input type="radio" name="sendout" value="1"  checked="checked"/>{$langdata.order_zitiya}&nbsp;
                                <input type="radio" name="sendout" value="2"/>{$langdata.order_Autonomy}
                                <input type="radio" name="sendout" value="3">{$langdata.order_yjty}
                            </span>
                        </li>
                        <li>
                            <span>{$langdata.order_Leavingamessage}</span>
                            <span class="fr" style="width:60%"><input type="text" style="width:100%;" value="" placeholder="{$langdata.order_seller} "  name="seller_msg"/></span>
                        </li>
                    </ul>
                </div>
            </div>
            <div class="tj-order clearfix ">
                <div class="left fl tc">
                    <p class="price"><span class="pri">{$langdata.order_Total}:{$symbol} {$totalMoney}</span> <span class="pri1">({$langdata.order_charges} {$symbol} 0.00)</span></p>
                </div>
                <div class="btnbox">
                    <!--<a class="btn-daifu fr" style="background:#bea58c">{$langdata.order_Submit}</a>&lt;!&ndash;提交订单&ndash;&gt;-->
                    <a class="btn-settle fr">{$langdata.order_Submit}</a><!--提交订单-->
                </div>
            </div>
        </div>
        <input type="hidden" name="storeId" value="{$storeId}" >
        <input type="hidden" name="langId" value="{$langId}" >
        <input type="hidden" name="storeGoodsId" value="{$storeGoodsId}" >
        <input type="hidden" name="goodsKey" value="{$activityGoodsData.goods_key}" >
        <input type="hidden" name="goodsNum" value="{$goodsNum}" >
        <input type="hidden" name="shippingPrice" value="{$shippingPrice}" >
        <input type="hidden" name="activityId" value="{$activityId}" >
        <input type="hidden" name="activityGoodsId" value="{$activityGoodsId}" >
        <input type="hidden" name="goodsKeyName" value="{$activityGoodsData.goods_key_name}" >
        <input type="hidden" name="discountPrice" value="{$activityGoodsData.discount_price}" >
        <input type="hidden" name="source" value="{$source}" >
        <script src="{$STATIC_URL}/phone/js/jquery-2.1.1.min.js" type="text/javascript"></script>
        <script src="{$STATIC_URL}/phone/js/common.js" type="text/javascript"></script>
        <script src="{$STATIC_URL}/phone/js/layer/layer.js" type="text/javascript"></script>
        <script src="{$STATIC_URL}/phone/js/mobiscroll.custom-2.17.1.min.js" type="text/javascript"></script>
        <script src="{$STATIC_URL}/phone/js/index.js" type="text/javascript"></script>
    </body>
</html>

{literal}
<!-- 分销金额-->
<script type="text/javascript">
    //tab页切换
    $("div.couponTabs li").click(function () {
        $(this).addClass("active").siblings("li.active").removeClass("active");
        var id = $(this).find("span").attr("target");
        $(id).addClass("active").siblings("div.active").removeClass("active");
    });
    $("#cha").click(function () {
        $("div.modal").css("display", "none");
    });
</script>
<!--提交订单并直接支付-->
<script type="text/javascript">
    var active=false;
 /*    $('.btn-daifu').click(function () {
         var daifu =1;
        getCartId(daifu);
    });*/
    $('.btn-settle').click(function () {
         var daifu =2;
        getCartId(daifu);
    });
    function getCartId(daifu) {
        var storeId = $('input[name=storeId]').val();
        var langId = $('input[name=langId]').val();
        var seller_msg = $('input[name=seller_msg]').val();
        var user_address = $('input[name=user_address]').val();
        var storeGoodsId = $('input[name=storeGoodsId]').val();
        var goodsKey = $('input[name=goodsKey]').val();
        var goodsNum = $('input[name=goodsNum]').val();
        var shippingPrice = $('input[name=shippingPrice]').val();
        var activityId = $('input[name=activityId]').val();
        var activityGoodsId = $('input[name=activityGoodsId]').val();
        var source = $('input[name=source]').val();
        var sendout = $("input[name='sendout']:checked").val();
        var address = $('input[name=address]').val();
        var addr_id = $('input[name=addr_id]').val();
        var userAddress = $('#userAddress').html();
        var goodsKeyName=$('input[name=goodsKeyName]').val();
        var discountPrice=$('input[name=discountPrice]').val();
        if (userAddress == undefined) {
            if (sendout !== '1') {
                layer.open({
                    shade: false,
                    content: " <i class='ico ico-correct'></i>" + '收货地址不能为空',
                    className: 'layer-tip',
                    time: 2
                });
                return false;
            }

        }
        if(active){
            return false;
        }
        $.ajax({
            url: 'wx.php?app=activityOrder&act=comfirm',
            type: 'POST',
            data: {
                'storeId': storeId,
                'langId': langId,
                'seller_msg': seller_msg,
                'user_address': user_address,
                'storeGoodsId': storeGoodsId,
                'goodsKey': goodsKey,
                'goodsNum': goodsNum,
                'shippingPrice': shippingPrice,
                'activityId': activityId,
                'activityGoodsId': activityGoodsId,
                'source': source,
                'sendout': sendout,
                'addr_id': addr_id,
                'address': address,
                'goodsKeyName':goodsKeyName,
                'discountPrice':discountPrice
            },
            async: false, //默认为true 异步
            error: function () {
                alert('error');
            },
            success: function (json) {
                var data = eval("(" + json + ")");
                if (data.status == 1) {
                    active=true;
                    layer.open({
                        shade: false,
                        content: " <i class='ico ico-correct'></i>" + data.message,
                        className: 'layer-tip',
                        time: 2
                    });
                    setTimeout(function () {
                        window.location.href = data.info.url;
                    }, 1000);
                } else {

                    dialog(data.message, '');

                }
            }
        });
    }
    $('input[type=radio][name=sendout]').change(function () {
     /*   var type = $('input:radio[name=sendout]:checked').val();
        var source = $('input[name=source]').val();
        var symbol = $('input[name=symbol]').val();
        var order_charges = $('input[name=order_charges]').val();
        var totalMoney = $('input[name=totalMoney]').val();
        var storeId = $('input[name=storeId]').val();
        var shippingprice = $('input[name=shippingprice]').val();
        total = delcommafy(total);
        var discount = delcommafy($('input[name=discount]').val());*/
    });
    function delcommafy(num) {
        if ((num + "").trim() == "") {
            return"";
        }
        num = num.replace(/,/gi, '');
        return num;
    }
    function commafy(num) {
        if ((num + "").trim() == "") {
            return"";
        }
        if (isNaN(num)) {
            return"";
        }
        num = num + "";
        if (/^.*\..*$/.test(num)) {
            var pointIndex = num.lastIndexOf(".");
            var intPart = num.substring(0, pointIndex);
            var pointPart = num.substring(pointIndex + 1, num.length);
            intPart = intPart + "";
            var re = /(-?\d+)(\d{3})/
            while (re.test(intPart)) {
                intPart = intPart.replace(re, "$1,$2")
            }
            num = intPart + "." + pointPart;
        } else {
            num = num + "";
            var re = /(-?\d+)(\d{3})/
            while (re.test(num)) {
                num = num.replace(re, "$1,$2")
            }
        }
        return num;
    }
    function toDecimal2(x) {
        var f = parseFloat(x);
        if (isNaN(f)) {
            return false;
        }
        var f = Math.round(x * 100) / 100;
        var s = f.toString();
        var rs = s.indexOf('.');
        if (rs < 0) {
            rs = s.length;
            s += '.';
        }
        while (s.length <= rs + 2) {
            s += '0';
        }
        return s;
    }
</script>
{/literal}
