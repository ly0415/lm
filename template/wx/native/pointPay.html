<!DOCTYPE html>
<html style="background-color: #fff;">
<head lang="en">
    <meta charset="UTF-8">
    <title>支付页面</title>
    <meta content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no" name="viewport">
    <meta content="yes" name="apple-mobile-web-app-capable">
    <meta content="black" name="apple-mobile-web-app-status-bar-style">
    <meta content="telephone=no" name="format-detection">
    <meta content="email=no" name="format-detection">
    <link href="{$STATIC_URL}/phone/css/mobiscroll.custom-2.17.1.min.css"  rel="stylesheet" type="text/css"/>
    <link href="{$STATIC_URL}/phone/css/style.css"  rel="stylesheet" type="text/css"/>
</head>
<body>
<div class="pay-wrap tc">
    <input type="hidden" name="store_id" value="{$store_id}" />
    <input type="hidden" name="lang" value="{$lang}" />
    <div class="img">
        <p class="money">{$order_amount}<span>元</span></p>
        <button class="btn-pay"  onclick="callpay()" >立即支付</button>
    </div>
</div>
<script src="{$STATIC_URL}/phone/js/jquery-2.1.1.min.js" type="text/javascript"></script>
<script src="{$STATIC_URL}/phone/js/common.js" type="text/javascript"></script>
<script src="{$STATIC_URL}/phone/js/layer/layer.js" type="text/javascript"></script>
<script src="{$STATIC_URL}/phone/js/mobiscroll.custom-2.17.1.min.js" type="text/javascript"></script>
<script src="{$STATIC_URL}/phone/js/index.js" type="text/javascript"></script>
<script type="text/javascript">
    var jsApiParameters = {$jsApiParameters};
    var store_id = {$store_id};
    var lang = {$lang};
    var auxiliary={$auxiliary};
    //调用微信JS api 支付
    function jsApiCall()
    {
        WeixinJSBridge.invoke(
            'getBrandWCPayRequest',
//            <?php echo $jsApiParameters; ?>,
            jsApiParameters,
            function(res){
                WeixinJSBridge.log(res.err_msg);
                if(res.err_msg == "get_brand_wcpay_request:ok"){
                    //alert(res.err_code+res.err_desc+res.err_msg);
                    var url = "http://www.711home.net/wx.php?app=userCenter&act=pointLog&storeid="+store_id+"&lang="+lang+"&auxiliary="+auxiliary;
                    window.location.href=url;
                }else{
                    //返回跳转到订单详情页面
//                    alert(res.err_code+res.err_desc+res.err_msg);
                    alert('支付失败');
                    var url = "http://www.711home.net/wx.php?app=userCenter&act=pointLog&storeid="+store_id+"&lang="+lang+"&auxiliary="+auxiliary;
                    // window.location.href="http://blog.sina.com.cn/u/1863605217";
                    window.location.href= url;

                }
            }
        );
    }

    function callpay()
    {
        console.log(typeof WeixinJSBridge);
        if (typeof WeixinJSBridge == "undefined"){
            if( document.addEventListener ){
                document.addEventListener('WeixinJSBridgeReady', jsApiCall, false);
            }else if (document.attachEvent){
                document.attachEvent('WeixinJSBridgeReady', jsApiCall);
                document.attachEvent('onWeixinJSBridgeReady', jsApiCall);
            }
        }else{
            jsApiCall();
        }
    }
</script>
<script type="text/javascript">
    var editAddress = {$editAddress};
    //获取共享地址
    function editAddress()
    {
        WeixinJSBridge.invoke(
            'editAddress',
//            <?php echo $editAddress; ?>,
            editAddress,
            function(res){
                var value1 = res.proviceFirstStageName;
                var value2 = res.addressCitySecondStageName;
                var value3 = res.addressCountiesThirdStageName;
                var value4 = res.addressDetailInfo;
                var tel = res.telNumber;

                console.log(value1 + value2 + value3 + value4 + ":" + tel);
            }
        );
    }

    window.onload = function(){
        if (typeof WeixinJSBridge == "undefined"){
            if( document.addEventListener ){
                document.addEventListener('WeixinJSBridgeReady', editAddress, false);
            }else if (document.attachEvent){
                document.attachEvent('WeixinJSBridgeReady', editAddress);
                document.attachEvent('onWeixinJSBridgeReady', editAddress);
            }
        }else{
            editAddress();
        }
    };

</script>
</body>
</html>