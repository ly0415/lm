<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0"/>

    <link href="{$STATIC_URL}/phone/css/mobiscroll.custom-2.17.1.min.css"  rel="stylesheet" type="text/css"/>
    <link href="{$STATIC_URL}/phone/css/style.css"  rel="stylesheet" type="text/css"/>
    <link href="{$STATIC_URL}/phone/css/swiper.min.css"  rel="stylesheet" type="text/css"/>
    <title></title>
    <style>
        html{
            font-size:50px!important;
        }
    </style>
</head>
<body>
    <section class="section1">

        <div class="discount">
            <span class="count">{$langdata.recharge_rui}</span>
            <div class="useCount">
                <input type="number" placeholder="{$langdata.recharge_rui}" min="1" name="num" class="num"/> <span>{$langdata.rmb}{$res.point_rate}{$langdata.rui}</span>
            </div>
        </div>
        <div class="pay">
            {$langdata.rui_amount}ï¼š{$symbol}<span class="amount">0.00</span>
        </div>
        <input type="hidden" name="rate" value="{$res.point_rate}">
        <input type="hidden" name="symbol" value="{$symbol}">
        <input type="hidden"  name="storeid"  value="{$storeid}" >
        <input type="hidden"  name="lang"  value="{$lang}" >
        <input type="hidden"  name="auxiliary"  value="{$auxiliary}" >
        <input type="hidden" name="userid" value="{$userid}">
        <input type="hidden" name="latlon" value="{$latlon}">
    </section>
    <footer>
        <button id="point">{$langdata.recharge}</button>
    </footer>
    <script src="{$STATIC_URL}/phone/js/jquery-2.1.1.min.js" type="text/javascript"></script>

    <script src="{$STATIC_URL}/front/plus/layer/layer.js" type="text/javascript"></script>

    <script type="text/javascript">
        $(function(){
            var rate=$("input[name='rate']").val();
            var amount=0;
            var num =0.00;
            var symbol=$("input[name='symbol']");
            $('.num').keyup(function(){
                num=($(this).val())/rate;
                amount=toDecimal2(num);
                $('.amount').html(amount);
                $(this).attr('value',parseInt($(this).val()));

            })

            function toDecimal2(x) {
                var f = parseFloat(x);
                if (isNaN(f)) {
                    return false;
                }
                var f = Math.round(x*100)/100;
                var s = f.toString();
                var rs = s.indexOf('.');
                if (rs < 0) {
                    rs = s.length;
                    s += '.';
                }
                while (s.length <= rs + 2) {
                    s += '0';
                }
                return s;
            }
        })

    </script>
    {literal}
    <script type="text/javascript">
        $(function(){
            var active=false;
            $('#point').click(function(){
                var storeid=$('input[name="storeid"]').val();
                var lang=$('input[name="lang"]').val();
                var auxiliary=$('input[name="auxiliary"]').val();
                var rate=$('input[name="rate"]').val();
                var point_num=$('input[name="num"]').val();
                var userid=$('input[name="userid"]').val();
                var latlon=$('input[name=latlon]').val();
                if(active){
                    return false;
                }
                    $.ajax({
                        url: 'wx.php?app=order&act=orderPoint',
                        type: 'POST',
                        data: {"storeid": storeid,'lang':lang,'auxiliary':auxiliary,'rate':rate,'point_num':point_num,'userid':userid,'latlon':latlon},
                        async: false,
                        error: function() {
                            alert('error');
                        },
                        success: function(data) {
                            var data = eval("(" + data + ")");
                            if (data.status == 1) {
                                layer.alert(data.message, {
                                    icon: 6,
                                    btn: false,
                                    title: false,
                                    closeBtn: 0,
                                    time: 2000,
                                    skin: 'alt-layer'
                                });
                                setTimeout(function () {
                                    window.location.href = data.info.url;
                                }, 1000);
                                active=true;
                            } else {
                                layer.alert(data.message,{
                                    icon: 0,
                                    btn: false,
                                    title: false,
                                    closeBtn: 0,
                                    time: 2000,
                                    skin: 'alt-layer'
                                });
                            }
                        }

                    })


            })
        })

    </script>
    {/literal}
</body>
</html>