<!DOCTYPE html>

<html>
    <head lang="en">
        <meta charset="UTF-8">
        <title>{$langdata.evaluate}</title>  <!-- {$langdata.evaluate}  -->
        <meta content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no" name="viewport">
        <meta content="yes" name="apple-mobile-web-app-capable">
        <meta content="black" name="apple-mobile-web-app-status-bar-style">
        <meta content="telephone=no" name="format-detection">
        <meta content="email=no" name="format-detection">
        <link href="{$STATIC_URL}/phone/css/mobiscroll.custom-2.17.1.min.css"  rel="stylesheet" type="text/css"/>
        <link href="{$STATIC_URL}/phone/css/style.css"  rel="stylesheet" type="text/css"/>
    </head>
    <body>
        <form  id="form_r">
            <div class="pingj-wrap">
                <div class="ss-nav">
                    <a href="wx.php?app=order&act=orderEvaluate&storeid={$storeid}&lang={$lang}&auxiliary={$auxiliary}&latlon={$latlon}" class="ss-nav-back"></a>
                    <div class="ss-nav-title">{$langdata.evaluate}</div><!-- 评价  -->
                    <a href="##" class="ss-nav-operate red submit">{$langdata.evaluate_Release}</a><!-- 发布  -->
                </div>
                <div class="height90" style="height:0.9rem"></div>
                <div class="pingj-product mt20">
                    <img src="{$data.goods_image}">
                    <span class="ellipsis">{$data.goods_name}</span>
                </div>
                <div class="pingj-comment">
                    <textarea name="evaluete_content" placeholder="{$langdata.evaluate_input}" rows="4" ></textarea><!-- 请输入您对商品的评价  -->
                </div>
                <div class="pingj-photo clearfix">
                    <div class="z_img">
                    </div>
                    <div class="z_file" onclick="chooseImage('.wx-photo')">
                        <button type="button" class="buss-photo wx-photo" name=""/></button>
                        <input type="hidden" name="picturePath" value="" id="picturePath">
                        <input type="hidden" name="pictureName" value="" id="pictureName">
                    </div>
                </div>
                <div class="pingj-shop mt20">
                    <div class="pingj-titile">
                        <i class="ico ico-shop"></i>
                        {$langdata.evaluate_goods}<!-- 商品评价  -->
                    </div>
                    <div class="pingj-content clearfix">
                        <span class="fl name">{$langdata.evaluate_describe}</span><!-- 描述相符 -->
                        <div class="fl" id="ratystart">
                            <div id="star" class="fl"></div>
                            <div id="target" class="fl text"></div>
                            <input type="hidden"  name='star_num' value="5"/>
                        </div>
                    </div>
                    <input type="hidden" name="lang"  value="{$lang}"/>
                    <input type="hidden" name="storeid"  value="{$storeid}"/>
                    <input type="hidden" name="store_id" value="{$store_id}">
                    <input type="hidden" name="gid"  value="{$goods_id}"/>
                    <input type="hidden" name="user_id"  value="{$user_id}"/>
                    <input type="hidden" name="order_id"  value="{$order_id}"/>
                    <input type="hidden" name="order_sn"  value="{$order_sn}"/>
                    <input type="hidden" name="auxiliary"  value="{$auxiliary}"/>
                    <input type="hidden" name="rec_id"  value="{$rec_id}"/>
                    <input type="hidden" name="languages"  value="{$languages}"/>
                </div>
            </div>
        </form>
        <script src="{$STATIC_URL}/phone/js/jquery-2.1.1.min.js" type="text/javascript"></script>
        <script src="{$STATIC_URL}/phone/js/common.js" type="text/javascript"></script>
        <script src="{$STATIC_URL}/phone/js/layer/layer.js" type="text/javascript"></script>
        <script src="{$STATIC_URL}/phone/js/mobiscroll.custom-2.17.1.min.js" type="text/javascript"></script>
        <script src="{$STATIC_URL}/phone/js/index.js" type="text/javascript"></script>
        <script src="{$STATIC_URL}/phone/js/jquery.raty.js" type="text/javascript"></script>
        <script type="text/javascript" src="http://res.wx.qq.com/open/js/jweixin-1.2.0.js"></script>
        {if $languages=='ZH'}
        <script type="text/javascript">
                        $('#star').raty({
                            number: 5,
                            score: 5, //初始值是设置
                            hints: ['非常差', '差', '一般', '好', '非常好'],
                            target: '#target',
                            width: 'auto',
                            targetKeep: true,
                            starOff: 'star-off-big1.png',
                            starOn: 'star-on-big1.png',
                            click: function (score, evt) {
                                $('input[name="star_num"]').val(score);
                            }
                        });
                        //删除图片
                        $('body').on('click', '.ico-close', function () {
                            $(this).parents('.img').remove();
                        });
        </script>
        {else}
        <script type="text/javascript">
            $('#star').raty({
                number: 5,
                score: 5, //初始值是设置
                hints: ['Very poor', 'Difference', 'Commonly', 'Good', 'Very nice'],
                target: '#target',
                width: 'auto',
                targetKeep: true,
                starOff: 'star-off-big1.png',
                starOn: 'star-on-big1.png',
                click: function (score, evt) {
                    $('input[name="star_num"]').val(score);
                }
            });
            //删除图片
            $('body').on('click', '.ico-close', function () {
                $(this).parents('.img').remove();
            });
        </script>
        {/if}
        {literal}
        <script type="text/javascript">
            $(function () {
                $('.submit').click(function () {
                    var data = $("#form_r").serializeArray()
                    $.ajax({
                        url: 'wx.php?app=order&act=addEvaluate',
                        type: 'post',
                        data: data,
                        async: false, //默认为true 异步
                        error: function () {
                            alert('error');
                        },
                        success: function (res) {
                            var jsondata = $.parseJSON(res);
                            if (jsondata.status == '1') {
                                layer.open({
                                    shade: false
                                    , content: '<i class="ico ico-correct"></i>' + jsondata.message
                                    , className: 'layer-tip'
                                    , time: 2
                                });
                                setTimeout(function () {
                                    window.location.href = jsondata.info.url;
                                }, 1000);
                            } else {
                                layer.open({
                                    shade: false
                                    , content: '<i class="ico ico-error"></i>' + jsondata.message
                                    , className: 'layer-tip'
                                    , time: 2
                                });
                            }

                        }
                    });
                })
            })
        </script>
        {/literal}
        <script>

            wx.config({
                debug: false,
                appId: '{$signPackage["appId"]}',
                timestamp: '{$signPackage["timestamp"]}',
                nonceStr: '{$signPackage["nonceStr"]}',
                signature: '{$signPackage["signature"]}',
                jsApiList: [
                    // 所有要调用的 API 都要加到这个列表中
                    'checkJsApi',
                    'openLocation',
                    'getLocation',
                    'chooseImage',
                    'previewImage',
                    'uploadImage',
                    'getLocalImgData'
                ]
            });
            function chooseImage(obj) {
                // 选择张片
                wx.chooseImage({
                    count: 1, // 默认9
                    sizeType: ['original', 'compressed'], // 可以指定是原图还是压缩图，默认二者都有
                    success: function (res) {
                        var localIds = res.localIds;// 返回选定照片的本地ID列表，localId可以作为img标签的src属性显示图片
                        // 上传照片
                        wx.uploadImage({
                            localId: '' + localIds,
                            isShowProgressTips: 1,
                            success: function (res) {
                                serverId = res.serverId;
                                //图片下载打水印
                                $.ajax({
                                    type: "post",
                                    async: false,
                                    url: "?app=order&act=getUploadPicture",
                                    data: {
                                        'serverId': serverId,
                                        'access_token': "{$access_token}"
                                    },
                                    dataType: "json", //返回类型
                                    success: function (data) {
                                        var uploadPath = data.info.uploadPath;
                                        var newDirName = data.info.newDirName;
                                        var imageName = data.info.imageName;
                                        var pic = newDirName + imageName;
                                        var imgHtml = "<div class='img'> " + "<img src='" + localIds + "' class='photo'> "
                                                + "<input type='hidden' name='order_pic[]' value='" + pic + "'>"
                                                + " <i class='ico ico-close'></i>" + "</div>";
                                        $('.z_img').append(imgHtml);
                                    },
                                });//ajax结束
                            }
                        });
                    }
                });
            }



            $('.select').anselcfg({});
            $('.select_mul').anselcfg_mulit({});
        </script>
        <!--<script type="text/javascript">-->
        <!--$('input[name='']')-->
        <!--</script>-->

    </body>
</html>