{include file="public/wx_header.html"}
<style>
    html a:hover {
        color: #333 !important;
    }
</style>
</head>
<body>
<div class="myorderstate-wrap">
    <div class="myorderstate-menus">
        <ul>
            <li><a href="wx.php?app=order&act=orderindex&storeid={$storeid}&lang={$lang}&type=1" {if $type==1}class="active"{/if}>全部</a></li>
            <li><a href="wx.php?app=order&act=orderindex&storeid={$storeid}&lang={$lang}&type=2" {if $type==2}class="active"{/if}>待付款</a></li>
            <li><a href="wx.php?app=order&act=orderindex&storeid={$storeid}&lang={$lang}&type=3" {if $type==3}class="active"{/if}>待发货</a></li>
            <li><a href="wx.php?app=order&act=orderindex&storeid={$storeid}&lang={$lang}&type=4" {if $type==4}class="active"{/if}>待收货</a></li>
            <li><a href="wx.php?app=order&act=orderindex&storeid={$storeid}&lang={$lang}&type=5" {if $type==5}class="active"{/if}>待评价</a></li>
        </ul>
    </div>
    {foreach from=$data item=item}
    <div class="myorderstate-list mt20">
        <div class="shop">
            <a>
                <i class="ico ico-shop"></i>
                <span class="storeName">{$item.store_name}</span>
            </a>
            <span class="fr state">{$item.statusName}</span>
        </div>
        <ul>
            {foreach $item['goods_list'] as $good}
            <li class="itembox">
<!--                <a href="wx.php?app=orderList&act=pendingPayment&lang={$lang}&orderSn={$item.order_sn}" class="clearfix">-->
                    <a href="wx.php?app=orderList&act=orderDetails&lang={$lang}&orderSn={$item.order_sn}" class="clearfix">
                    <div class="pro-logo fl">
                        <img src="{$good.goods_image}" style="width:100%;height:100%;">
                    </div>
                    <div class="pro-info fl">
                        <h3 class="pro-name ellipsis">{$good.goods_name}</h3>

                        <p class="pro-tags">
                            <span>产品规格: {$good.spec_key_name}</span>
                        </p>

                        <div class="pro-right clearfix">
                            <p class="xprice fl">￥{$good.goods_pay_price}</p>

                            <p class="num fr">X{$good.goods_num}</p>
                        </div>
                    </div>
                </a>
            </li>
            {/foreach}
        </ul>
        <div class="totalbox">
            <span>共{$item['num']}件商品</span>
            <span class="ml20">合计：￥{$item.order_amount}</span>
            <span class="ml20">（含运费￥{$item.shipping_fee}）</span>
        </div>
        <div class="btnbox tr">
            {if $item['order_state']==0}
            <a href="javascript:;" class="btn-sure j_delet" data-ordersn='{$item.order_sn}'>删除订单</a>
            {else if $item['order_state'] ==10}
            <a href="?app=orderList&act=comfirmOrder&order_id={$item.order_sn}&lang={$lang}&auxiliary={$auxiliary}&latlon={$latlon}" class="btn-sure">立即付款</a>
            <a href="##" class="btn-sure changeState" data='{$item["order_sn"]}_{$item["order_state"]}_cancel_{$item["store_id"]}'>取消订单</a>
            {else if $item['order_state'] ==20}
            {if $item.payment_type != 5}
            <a href="?app=refund&act=index&order_sn={$item.order_sn}&store_id={$item.store_id}&lang={$lang}" class="btn-sure">退款</a>
            {/if}
            {else if $item['order_state'] ==25}
            {if $item.payment_type != 5}
            <a href="?app=refund&act=index&order_sn={$item.order_sn}&store_id={$item.store_id}&lang={$lang}" class="btn-sure">退款</a>
            {/if}
            {else if $item['order_state'] ==30}
            {if $item.payment_type != 5}
            <a href="?app=refund&act=index&order_sn={$item.order_sn}&store_id={$item.store_id}&lang={$lang}" class="btn-sure">退款</a>
            {/if}
            {else if $item['order_state'] ==40}
            <a href="##" class="btn-sure changeState" data='{$item["order_sn"]}_{$item["order_state"]}_receive_{$item.store_id}'>确认收货</a>
            {if $item.payment_type != 5}
            <a href="?app=refund&act=index&order_sn={$item.order_sn}&store_id={$item.store_id}&lang={$lang}" class="btn-sure">退款</a>
            {/if}
            {else if $item['order_state'] ==50}
            {if $item.evaluation_state==0}
            <a href="?app=order&act=evaluateDetails&storeid={$storeid}&order_id={$item.order_id}&order_sn={$item.order_sn}&gid={$good.ogoods_id}&rec_id={$good.rec_id}&lang={$lang}"  class="btn-sure">评价</a>
            {/if}
            <a href="?app=orderInvoice&act=add&store_id={$item.store_id}&order_sn={$item.order_sn}" class="btn-sure">申请开票</a>
            {/if}
        </div>
        <input type="hidden" name="languages" value="{$lang_id}"/>
    </div>
    {/foreach}
</div>
<script src="{$STATIC_URL}/phone/js/jquery-2.1.1.min.js" type="text/javascript"></script>
<script src="{$STATIC_URL}/phone/js/layer/layer.js" type="text/javascript"></script>
<script src="{$STATIC_URL}/phone/js/mobiscroll.custom-2.17.1.min.js" type="text/javascript"></script>
<script src="{$STATIC_URL}/phone/js/index.js" type="text/javascript"></script>
<script src="{$STATIC_URL}/phone/js/common.js" type="text/javascript"></script>
<script type="text/javascript">
    $(".changeState").click(function () {
        var _data = $(this).attr("data");
        layer.open({
            className: 'layer-confirm'
            , content: '您确定要继续当前操作？'
            , btn: ['确定', '取消']
            , yes: function (index) {
                $.ajax({
                    url: "wx.php?app=order&act=editOrderState&storeid={$storeid}&lang={$lang}&auxiliary={$auxiliary}&latlon={$latlon}",
                    data: "data=" + _data,
                    type: "Post",
                    dataType: "json",
                    success: function (res) {
                        if (res.status == '1') {
                            layer.open({
                                shade: false
                                , content: '<i class="ico ico-correct"></i> 操作成功！'
                                , className: 'layer-tip'
                                , time: 2
                            });
                            setTimeout(function () {
                                window.location.reload();
                            }, 1000);
                        } else {
                            layer.open({
                                shade: false
                                , content: '<i class="ico ico-error"></i> 操作失败！'
                                , className: 'layer-tip'
                                , time: 2
                            });
                            setTimeout(function () {
                                window.location.reload();
                            }, 1000);
                        }
                    }
                })
            }
        });
    })
</script>
<script type="text/javascript">
    //删除地址
    $('body').on('click', '.j_delet', function () {
        var order_sn = $(this).attr('data-ordersn');
        deletes('wx.php?app=order&act=dele&storeid={$storeid}&order_sn=' + order_sn);
    });
</script>
</body>
</html>