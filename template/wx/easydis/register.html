<!DOCTYPE html>
<html>
    <head lang="en">
        <meta charset="UTF-8">
        <title>注册</title>
        <meta content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no" name="viewport">
        <meta content="yes" name="apple-mobile-web-app-capable">
        <meta content="black" name="apple-mobile-web-app-status-bar-style">
        <meta content="telephone=no" name="format-detection">
        <meta content="email=no" name="format-detection">
        <link href="{$STATIC_URL}/phone/css/mobiscroll.custom-2.17.1.min.css"  rel="stylesheet" type="text/css"/>
        <link href="{$STATIC_URL}/phone/css/style.css"  rel="stylesheet" type="text/css"/>
    </head>
    <body>
        <div class="register-wrap">
            <div class="sn-nav">
                <!--                <a href="##" class="sn-nav-close"></a>-->
                <div class="sn-nav-title">注册</div>
            </div>
            <div class="register-main forgetpass-main">
                <ul class="register-phone register-item" style="display: block;">
                    <li>
                        <i class="ico ico-phone"></i>
                        <input type="text" name='phone' placeholder="请输入手机号码" />
                        <input type="hidden" name='tj_code' value="{$tj_code}" />
                        <!--                        <div class="error" style="display: none;" id="phone_error"></div>-->
                    </li>
                    <li>
                        <i class="ico ico-num"></i>
                        <input type="text" name="code" placeholder="请输入验证码" class="text inblock" style="width: 50%">
                        <a href="##" class="validate-btn getval">获取验证码</a>
                        <!--<div class="error" style="display: none;" id="code_error"></div>-->
                    </li>
                    <li>
                        <i class="ico ico-password"></i>
                        <input type="password" placeholder="请输入密码" name='password' style="border:0px;background:rgba(0, 0, 0, 0);"/>
                        <div class="error" style="display: none;" id="passwd_error"></div>
                    </li>
                    <li>
                        <i class="ico ico-recomd"></i>
                        <input type="text" name='real_name' placeholder="真实姓名" />
                        <!--                        <div class="error" style="display: none;" id="phone_error"></div>-->
                    </li>
                    <li>
                        <i class="ico ico-bank"></i>
                        <input type="text" name='bank_name' placeholder="开户银行" />
                        <!--                        <div class="error" style="display: none;" id="phone_error"></div>-->
                    </li>
                    <li>
                        <i class="ico ico-card"></i>
                        <input type="text" name='bank_account' placeholder="银行账号" />
                        <!--                        <div class="error" style="display: none;" id="phone_error"></div>-->
                    </li>
                </ul>
            </div>
            <div class="register-accept">
                注册即表示已接受
                <span class="red">商城相关服务条款</span>
            </div>
            <button type="button" class="btn mt130 btn-sub" id="login_button">注册</button>
            <div class="error" style="display: none;" id="callback_result"></div>
            <div class="tc"><a href="wx.php?app=user&act=login&storeid={$storeid}&lang={$lang}" class="register-hadaccount">已有商城账号</a></div>
        </div>   
        <script src="{$STATIC_URL}/phone/js/jquery-2.1.1.min.js" type="text/javascript"></script>
        <script src="{$STATIC_URL}/phone/js/common.js" type="text/javascript"></script>
        <script src="{$STATIC_URL}/phone/js/layer/layer.js" type="text/javascript"></script>
        <script src="{$STATIC_URL}/phone/js/mobiscroll.custom-2.17.1.min.js" type="text/javascript"></script>
        <!--        <script src="{$STATIC_URL}/phone/js/index.js" type="text/javascript"></script>-->
        {literal}
        <script type="text/javascript">
            $(function() {
                $('.btn-sub').click(function() {
                        var phone = $('input[name=phone]').val();
                        var code = $('input[name=code]').val();
                        var password = $('input[name=password]').val();
                        var store_id = $('input[name=store_id]').val();
                        var tj_code = $('input[name=tj_code]').val();
                       var real_name = $('input[name=real_name]').val();
                       var bank_name = $('input[name=bank_name]').val();
                      var bank_account = $('input[name=bank_account]').val();
                        $.ajax({
                            url: 'wx.php?app=user&act=doFxregister',
                            type: 'post',
                            data: {'bank_account':bank_account,'bank_name':bank_name,'real_name':real_name,'phone': phone, 'code': code, 'password': password, 'store_id': store_id,'tj_code':tj_code},
                            async: false, //默认为true 异步
                            error: function() {
                                alert('error');
                            },
                            success: function(data) {
                                var data = eval("(" + data + ")");
                                if (data.status == 1) {
                                    layer.open({
                                        shade: false
                                        , content: '<i class="ico ico-correct"></i> ' + data.message
                                        , className: 'layer-tip'
                                        , time: 2
                                    });
                                    window.location.href = data.info.url;
                                } else {
                                    layer.open({
                                        shade: false
                                        , content: '<i class="ico ico-error"></i> ' + data.message
                                        , className: 'layer-tip'
                                        , time: 2
                                    });
                                }

                            }
                        });
                })
            })
            $(function() {
                //发送验证码
                var validCode = true;
                $(".getval").click(function() {
                    //发送短信验证吗
                    $('#phone_error').css('display', 'none');
                    var phone = $('input[name="phone"]').val();
                    var reg = /^(13[0-9]|14[0-9]|15[0-9]|17[0-9]|18[0-9])\d{8}$/;
                    //验证
                    if (phone.length == 0) {
                        $('#phone_error').css('display', 'block');
                        $('#phone_error').text('手机号码必填！');
                        return false;
                    }
                    ;

                    if (!reg.test(phone)) {
                        $('#phone_error').css('display', 'block');
                        $('#phone_error').text('手机号码格式错误！');
                        return false;
                    }
                    //
                    $.post('wx.php?app=sms&act=sendSms', {'phone': phone}, function(data) {

                    });
                    //倒计时
                    var time = 60;
                    var code = $(this);
                    code.addClass('active');
                    if (validCode) {
                        validCode = false;
                        var t = setInterval(function() {
                            time--;
                            code.html("已发送" + time + "秒");
                            if (time == 0) {
                                clearInterval(t);
                                code.removeClass('active');
                                code.html("重新获取");
                                validCode = true;
                            }
                        }, 1000)
                    }
                })
            });
        </script>
        {/literal}
    </body>
</html>