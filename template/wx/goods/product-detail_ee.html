<!DOCTYPE html>
<html>
    <head lang="en">
        <meta charset="UTF-8">
        <title>{$langdata.goods_details}</title><!--商品详情-->
        <meta content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no" name="viewport">
        <meta content="yes" name="apple-mobile-web-app-capable">
        <meta content="black" name="apple-mobile-web-app-status-bar-style">
        <meta content="telephone=no" name="format-detection">
        <meta content="email=no" name="format-detection">
        <link href="{$STATIC_URL}/phone/css/mobiscroll.custom-2.17.1.min.css"  rel="stylesheet" type="text/css"/>
        <link href="{$STATIC_URL}/phone/css/style.css"  rel="stylesheet" type="text/css"/>
        <link href="{$STATIC_URL}/phone/css/swiper.min.css"  rel="stylesheet" type="text/css"/>
        <link rel="stylesheet" href="{$STATIC_URL}/phone/layui/css/layui.css"/>
        <style>
            .detailinfo-item span{
                display:inline-block;
            }
        </style>
    </head>
    <body>
        <div class="productdetail-wrap">
            <a href="javascript:window.history.back(-1);" class="ico back"></a>
            <!-- Swiper轮播   -->
            <div class="swiper-container">
                <div class="swiper-wrapper">
                    <div class="swiper-slide"><img src="{$SITE_URL}/{$info.original_img}" width="100%"></div>
                    {foreach from=$img_arr item=item}
                    <div class="swiper-slide"><img src="{$SITE_URL}/{$item.image_url}" width="100%"></div>
                    {/foreach}
                </div>
                <div class="swiper-pagination"></div>
                <div class="bg">
                   <!--  <img src="{$STATIC_URL}/phone/{$info.original_img}" alt=""/> -->
                    <div class="text">
                        <span>{$arr.name}{if $source==3}{$arr.prom_name}{/if}</span>
                    </div>
                </div>
            </div>
       
            <!--  -->
            <div class="product-main">
                <div class="clearfix">
                    <div class="pro-title fl">
                        <h2>{$info.goods_name}</h2>
                    </div>
                </div>
                <div class="pro-price">
                    <span class="xprice">{$cur_info{$val.end_time|date_format:"%Y-%m-%d  %H:%M"}.symbol}{$info.shop_price}</span>
                    <span class="yprice">{$cur_info.symbol}{$info.market_price}</span>
                </div>
                <div class="pro-postage">
                    <p class="first ellipsis">
                        <span>{$langdata.goods_Post}</span><!--邮-->
                        {if $info.is_free_shipping ==1}
                        {$langdata.Free}
                        {else}
                        {$langdata.freight}：{$cur_info.symbol}{$info.shipping_price}
                        {/if}
                    </p>
                
               
                    <!--<p class="second">不包邮地区：台湾 澳门 香港</p>-->

                </div>
            </div>
            <input name="spec_arr" id="spec_arr" value="{$spec_arr}" type="hidden"/>
            <input name="old_pirce" value="{$info.shop_price}" type="hidden" id="old_price"/>
            <input name="old_num" value="{$info.goods_storage}" type="hidden" id="old_num"/>
            <input name="store_goods_id" value="{$store_goods_id}" type="hidden" name="store_goods_id"/>
            <input name="prom_id" value="0" type="hidden"/>
            {if $goods_price}
            <input name="goods_price" value="{$goods_price}" type="hidden"/>
            {else}
            <input name="goods_price" value="{$info.shop_price}" type="hidden" />
            {/if}
            <!--商品规格信息-->
            <input name="spec_price" value="" type="hidden" id="spec_price"/>
            <input name="spec_key" value="{$spec_key}" type="hidden" id="spec_key"/>
            <input name="order_from" value="2" type="hidden"/>
            <input name="store_id" value="{$store_id}" type="hidden"/>
            <input name="commtotalpage" value="{$commtotalpage}" type="hidden"/> <!--评论的页数-->
            <input name="langId" value="{$langId}" type="hidden"/>
            <input name="shipping_price" value="{$info.shipping_price}" type="hidden"/>
            <input name="symbol" value="{$cur_info.symbol}" type="hidden"/>
            <input name="store_good_id" value="{$info.goods_id}" type="hidden"/>
            <input name="shorthand" value="{$langid}" type="hidden"/>
            <input name="source" value="{$source}" type="hidden"/>
            <input type="hidden" value="{$cid}" name="cid">
            <input type="hidden" value="{$latlon}" name="latlon" >

            <!-- 添加的购物车弹窗内容页面1 -->
            <div id="addcar" style="display: none;">
                <div id="product-addcar">
                    <i class="ico ico-close"></i>
                    <div class="pro-info clearfix">
                        <div class="img fl">
                            <img src="{$SITE_URL}/{$info.original_img}">
                        </div>
                        <div class="info fl">
                            <p class="price red" id="specPrice">{$cur_info.symbol}
                           <span class="specPrice">{$info.shop_price}</span>
                            </p>
                            <!--<p class="num">库存：10000件</p>-->
                            <p class="choose">{$langdata.goods_Choice}：<span>{$langdata.goods_type}</span></p><!--请选择--><!--产品类型-->
                        </div>
                    </div>
                    <div class="pro-choose">
                        {foreach  from=$spec_img item=val key=key}
                        <h2>{$key}:</h2>
                        <div class="pro-tags">
                            {foreach from=$val  item = item key=k}

                            {if in_array($item.item_id, $arr1) && is_array($arr1) }
                            <span  style="cursor:pointer"  name="spec[]" {if $k==$k } class="active" {/if}  data-id="{$item.item_id}">{$item.item}</span>
                            {else}
                            <span  style="cursor:pointer"  name="spec[]" {if $k==0 } class="active" {/if}  data-id="{$item.item_id}">{$item.item}</span>

                            {/if}
                          {/foreach}
                        </div>
                        {/foreach}
<!-- 
                        <div class="public address">
                            <span>请选择配送店铺：</span>
                            <div id="dropdown">
                                <input class="input_select" type="text" value="南京市雨花台区"/>
                                <ul>
                                    <li><a href="#" rel="2">南京市</a></li>
                                    <li><a href="#" rel="3">上海</a></li>
                                    <li><a href="#" rel="4">武汉</a></li>
                                    <li><a href="#" rel="5">广州</a></li>
                                </ul>
                            </div>
                            <div style="clear: both"></div>
                        </div> -->
                        <h2>{$langdata.goods_Number}</h2><!--购买数量-->
                        <div class="updown-box">
                            <span class="down fl ico ico-down"></span>
                            <input type="text" class="num fl" name="num" value="1" disabled="disabled">
                            <span class="up fl ico ico-up"></span>
                        </div>
                        <span class="storage fr" style="margin-top:0.22rem">{$langdata.goods_Stock}(<em class="product-amount">{if empty($info.goods_storage)} 0 {else} {$info.goods_storage} {/if}</em>)</span>
                    </div>
                    <button class="btn-sure" id="add">{$langdata.goods_Determine}</button><!--确定-->
                </div>
            </div>
            <!--活动时间-->
                {if $arr.in_time==1}
                    <div class="activity_time">
                        <span class="span1">Countdown：</span>
                        <input type="hidden" value="{$arr.end_timea}" name="endtime" />
                        <span class="clock span2"></span>
                    </div>        
                    {elseif $arr.in_time==2 }
                    <div class="activity_time">
                        <span class="span1">Sale time：</span>
                        <span class="span2">{$arr.start_our|date_format:"%H:%M "} - {$arr.end_our|date_format:"%H:%M "}</span>
                    </div>
                    {/if}
                    {if $source==2 }
                    <div class="activity_time">
                        <span class="span1">Deadline:</span>
                        <span class="span2">{$arr.end_time|date_format:"%Y-%m-%d  %H:%M"}</span>
                        <span class="span3">The number of offered:</span>
                        <span class="span4">{$arr.virtual_num}</span>
                    </div>
                    {/if}
                    {if $source==3 && $arr.status==2} 
                     <div class="activity_time">
                        <span class='span1'> Countdown：</span>
                        <input type="hidden" value="{$arr.end_timea}" name="endtime" />
                        <span class="clock span2"></span>
                    </div> 
                  {/if} 
                    {if $arr.status==1  }
                    <div class="activity_time">
                        <span class='span1'>The promotion hasn't started yet</span>
                    </div> 
                    {/if}
            <!--基本信息-->
            <div class="msg">
            {foreach from=$spec_img item=val key=key}
                <div class="public">
                    <span>{$key}：</span>
                    {foreach from=$val item=item key=k}
                    <button data-id="{$item.item_id}" {if $k==$k } class="active" {/if} name="spec[]" >{$item.item}</button>
                    {/foreach}
                </div>
            {/foreach}
                <div class="public count">
                   <span>Purchase quantity：</span>
                    <div class="count_btn">
                        <div class="minus">-</div>
                        <div><span class="num" id='ku'>1</span></div>
                        <div class="plus">+</div>
                    </div>
                </div>
        
                <div class="public address">
                     <span>{$langdata.goods_store}：</span>
                        <select name="store_choose" id="storelist" style="height: 0.5rem;font-size: 0.3rem;border-radius: 5px;border: 1px solid #D4D4D4;" onchange="resetSelectWidth(this);" >
                                {foreach from = $storelist item=item}
                                   <option style="font-size:0.3rem;" value="{$item.id}" {if $item.id == $store_id} selected {/if}>{$item.store_name}</option>
                                {/foreach}
                        </select>
                     <div style="clear: both"></div>
                </div> 
                
    
            <div class="product-detailinfo mt30" style="margin-top:0.2rem;">
                <ul class="detailinfo-menus clearfix">
                    <li class="active"><span>{$langdata.goods_details}</span></li><!--商品详情-->
                    <li><span>{$langdata.goods_parameter}</span></li><!--商品参数-->
                </ul>
                <div class="detailinfo-item" style="display: block;">
                    {$info.goods_content}
                </div>
                <div class="detailinfo-item">
                    <table class="table">
                        {foreach  from=$attr_arr item=v}
                        <tr>
                            <td>{$v.attr_name}</td>
                            <td>{$v.attr_value}</td>
                        </tr>
                        {/foreach}
                    </table>
                </div>
            </div>
            <div class="product-guid clearfix">
                <div class="fl left">
                    <ul>
                        <li class="j_btn_sc">
                            {if $info.type==1 }
                            <i class="ico ico-sc1-yes" name='clicki' id="{$info.id}"></i>
                            <span>{$langdata.goods_already}</span><!--已收藏-->
                            {else}
                            <i class="ico ico-sc1-no" name='clicki' id="{$info.id}"></i>
                            <span>{$langdata.goods_Collection}</span><!--收藏-->
                            {/if}

                        </li>
                        {if $kf_id}
                        <li>
                            {if $user_id}
                            <a href="http://www.711home.net/wx.php?app=wxIm&act=imIndex&uid={$user_id}&gid={$info.id}&store_id={$store_id}&lang_id={$langId}&kf_id={$kf_id}&latlon={$latlon}">
                            {else}
                            <a href="wx.php?app=user&act=loginOuth&storeid={$store_id}&lang={$langId}">
                            {/if}
                           <i class="ico ico-service"></i>
                            <span>Customer service</span></a>
                        </li>
                        {/if}
                        <li>
                            <a href="wx.php?app=cart&act=index">
                                <i class="ico ico-cart"></i>
                                <span>{$langdata.goods_ShoppingCart}</span><!--购物车-->
                            </a>
                        </li>
                    </ul>
                </div>
              <!--   <div class="fr right">
                 {if empty($source)}
                 <a href="##" class="btn-cart j_addcar" name="add">{$langdata.goods_join}</a>加入购物车
                 {/if}
                 
                  <a href="##" class="btn-buy j_addcar" id="buy"  name="buy">{$langdata.goods_purchase}</a>购买
                  
              </div> -->
            </div>
            <div class="height110"></div>
        </div>
        <script src="{$STATIC_URL}/phone/js/jquery-2.1.1.min.js" type="text/javascript"></script>
        <script src="{$STATIC_URL}/phone/js/common.js" type="text/javascript"></script>
            <script src="{$STATIC_URL}/phone/layui/layui.all.js"></script>
        <!--<script src="{$STATIC_URL}/phone/js/layer/layer.js" type="text/javascript"></script>-->
        <script src="{$STATIC_URL}/phone/js/mobiscroll.custom-2.17.1.min.js" type="text/javascript"></script>
        <script src="{$STATIC_URL}/phone/js/index.js" type="text/javascript"></script>
        <script src="{$STATIC_URL}/phone/js/swiper.min.js"  type="text/javascript" ></script>
        <script src="{$STATIC_URL}/phone/js/jquery.raty.js" type="text/javascript"></script>
        <script src="{$STATIC_URL}/phone/js/jquery.countdown.js" type="text/javascript"></script>
        <script type="text/javascript">
            $(function () {
                var clock = $('.clock');
                for (var i = 0; i < clock.length; i++) {
                    var twoDaysFromNow = $(clock[i]).prev().val();
                    var nowTime = new Date().valueOf();
                    var countDown = (nowTime + twoDaysFromNow * 1000);

                    $(clock[i]).countdown(countDown, function (event) {
                        $(this).html(event.strftime('%d Day %H Hours %M minutes %S seconds'));
                    });
                }
                function resetSelectWidth(obj){
                var tempObj=document.createElement("select");
                tempObj.length=1;
                tempObj.options[0].text=obj.options[obj.selectedIndex].text
                obj.parentNode.appendChild(tempObj);
                obj.style.width=tempObj.offsetWidth;
                obj.parentNode.removeChild(tempObj);
   }



            })
            var spec_goods_price = {$spec_arr};//规格数据

        </script>
        {literal}
        <!--<script type="text/javascript">-->
            <!--$(document).on('change','#storelist',function(){-->
                <!--console.log( $(this).find('option:selected'));-->
<!--//                $(this).find('option:selected').attr('selected','');-->
               <!--// $(this).find('option:selected').attr('selected','');-->
<!--//                $(this).find('option').attr('selected',true);-->
            <!--})-->
        <!--</script>-->
        <script type="text/javascript">
            function isNullObj(obj) {
                for (var i in obj) {
                    if (obj.hasOwnProperty(i)) {
                        return false;
                    }
                }
                return true;
            }
            function get_goods_price()
            {
                var goods_price = $("#old_price").val(); // 商品起始价
                var store_count = $("#old_num").val(); // 商品起始库存
                //var res =  $("#spec_arr").val();  // 规格 对应 价格 库存表   //alert(spec_goods_price['28_100']['kucun']);
                // 如果有属性选择项
                if (spec_goods_price != null)
                {

                    goods_spec_arr = new Array();
                    $(".layer-addcar .pro-choose span.active").each(function () {
                        goods_spec_arr.push($(this).attr('data-id'));

                    });
                    var spec_key = goods_spec_arr.sort(sortNumber).join('_'); //排序后组合成 key
                    goods_price = spec_goods_price[spec_key].price; // 找到对应规格的价格
                    store_count = spec_goods_price[spec_key].goods_storage; // 找到对应规格的库存
                }

//                var goods_num = parseInt($('input[name=num]').val());
                var goods_num = parseInt($('.updown-box .up').prev().val());
                var store_id = $('select[name=store_choose] option:selected').val();
                var good_id = $('input[name=store_good_id]').val();
                var source=$('input[name=source]').val();
                var cid =$('input[name=cid]').val();
                $.ajax({
                    url: 'wx.php?app=goods&act=isStoreInfo',
                    type: 'POST',
                    data: {spec_key: spec_key, store_id: store_id, good_id: good_id, goods_num: goods_num, source:source, cid:cid},
                    dataType: 'json',
                    success: function (res) {
                        //var data = eval("("+obj+")");;
                        if (res.status == 1) {
                            if (typeof (res.info.goods_storage) == "undefined") {
                                var goods_storage = 0;
                            } else {
                                var goods_storage = res.info.goods_storage;
                            }
                            var storage = goods_storage;
                            $('.product-amount').html(storage); //库存
                        } else {
//                            var storage = '当前库存(' + 0 + ')';
//                            $('.storage').html(storage); //库存
                        }
                    },
                    error: function (data) {
                        layer.alert('network error', {
                            icon: 0,
                            btn: false,
                            title: false,
                            closeBtn: 0,
                            time: 2000,
                            skin: 'alt-layer'
                        });
                    }
                })
                var shorthand = $('input[name=shorthand]').val();
                // 库存不足的情况
                if (goods_num > store_count)
                {
                    goods_num = store_count;
//                    $('.btn-sure').attr('disabled',true);
                    console.log(shorthand);
                    var btnid = $('.btn-sure').attr("id");
                    $('#product-addcar .btn-sure').attr('disabled',true);
                    if(btnid=='add'){
                        if(shorthand == 29) {
                            $('#product-addcar #add').html('暂无商品');
                        }else{
                            $('#product-addcar #add').html('Not Stock');
                        }
                        $('#product-addcar #add').css('background-color', '#888787');
                    }else if(btnid=='buy'){
                        if(shorthand == 29) {
                            $('#product-addcar #buy').html('暂无商品');
                         }else{
                            $('#product-addcar #add').html('Not Stock');
                        }
                            $('#product-addcar #buy').css('background-color','#888787');
                    }

//                    console.log(shorthand);
//                    if(shorthand.tostring() == '人民币'){
//                        $('.btn-sure').html('暂无商品');
//                    }else{
//                        $('.btn-sure').html('Not Stock');
//                    }
//                    layer.alert('库存仅剩 ' + store_count + ' 件', {icon: 2});
                    $("#goods_num").val(goods_num);
                }else{
                    $('#product-addcar .btn-sure').attr('disabled',false);
                    if(shorthand == 29) {
                        $('#product-addcar .btn-sure').html('确定');
                    }else{
                        $('#product-addcar .btn-sure').html('sure');
                    }
                    $('#product-addcar .btn-sure').css('background-color','#f33e3e');
                    $('#product-addcar .btn-sure').on('click',function(){
                        return true;
                    })
                }
                if(shorthand == 29) {
                     var storage = '当前库存（' + store_count + ')';
                }else{
                     var storage = 'stock（' + store_count + ')';
                }
                $('#saleprice').html(store_count); //对应规格库存显示出来
                $('.storage').html(storage); //库存
                $('#number').attr('max', store_count); //对应规格最大库存
                $('.layer-addcar .specPrice').html(goods_price); // 变动价格显示
                $('#spec_key').val(spec_key); //key
                console.log(goods_price);
                $('.spec_price').val(goods_price); //price
                $('#spec_price').val(goods_price); //price




            }
            /***用作 sort 排序用*/
            function sortNumber(a, b)
            {
                return a - b;
            }
            // 选择点击后的样式
            $(function () {
                $('body').on('click', '#product-addcar .pro-tags span', function () {
                    $(this).parents('.pro-tags').find('span').removeClass('active');
                    $(this).addClass('active');
                    get_goods_price();
                })
//                var imgs = $('.chooseadd-box .img-box').find('img');
//                imgs.click(function() {
//                    $(this).parent().siblings().find('img').removeClass('active');
//                    $(this).addClass('active');
//                })
            })

            //区域店铺切换
            function change_store(num) {
                var store_id = $('select[name=store_choose] option:selected').val();
                var good_id = $('input[name=store_good_id]').val();
                var spec_key = $('#spec_key').val();
                var langId = $('input[name=langId]').val();
//                var goods_num = $('input[name=num]').val();
                var goods_num = parseInt(num)  + 1;
                $.ajax({
                    url: 'wx.php?app=goods&act=isStoreInfo',
                    type: 'POST',
                    data: {'lang_id':langId,spec_key: spec_key, store_id: store_id, good_id: good_id, goods_num: goods_num},
                    dataType: 'json',
                    success: function (res) {
                        if (res.status == 1) {
                            if (typeof (res.info.goods_storage) == "undefined") {
                                var goods_storage = 0;
                            } else {
                                var goods_storage = res.info.goods_storage;
                            }
                            var storage = goods_storage;

                            $('.product-amount').html(storage); //库存
                            if(goods_num > res.info.goods_storage){
                                layer.open({
                                    shade: false,
                                    content: " <i class='ico ico-error'></i> 达到最大值" ,
                                    className: 'layer-tip',
                                    time: 2
                                });
                                setTimeout(function () {
                                    window.location.reload();
                                }, 1000);
                            }
                        } else {
                            layer.open({
                                shade: false,
                                content: " <i class='ico ico-error'></i>" + res.message,
                                className: 'layer-tip',
                                time: 2
                            });
                            setTimeout(function () {
                                window.location.reload();
                            }, 1000);
                        }
                        //                            setTimeout(function() {
                        //                                window.location.reload();
                        //                            }, 1);
                    },
                    error: function (data) {
                        layer.open({
                        shade: false,
                        content: " <i class='ico ico-error'></i>" + data.message,
                        className: 'layer-tip',
                        time: 2
                        });
                        setTimeout(function () {
                            window.location.reload();
                        }, 1000);
                    }
                })
                //                    $(this).toggleClass('sc1-active');
            }

        </script>
        <script>
            //收藏商品
            $(function () {

                $('.j_btn_sc .ico').on('click', function () {
                    var type = $(this).hasClass('ico-sc1-yes');
                    var text = $(this).find('span');
                    var id = $(this).attr('id');
                    var store_id = $('input[name=store_id]').val();
                    var store_good_id = $('input[name=store_good_id]').val();
                    $.ajax({
                        url: 'wx.php?app=userCenter&act=docollectionGoods',
                        type: 'GET',
                        data: {id: id, type: type, store_id: store_id, store_good_id: store_good_id},
                        dataType: 'json',
                        success: function (res) {
                            if (res.statu == 1) {
                                $('.j_btn_sc .ico').addClass('ico-sc1-yes');
                                text.text('已收藏');
                            } else {
                                $('.j_btn_sc .ico').addClass('ico-sc1-no');
                                text.text('收藏');
                            }
                            setTimeout(function () {
                                window.location.reload();
                            }, 1000);
                        }
                    })
                })
            });
            //通过自定义属性来设置acore初始值
            $('.start').raty({
                score: function () {
                    return $(this).attr('data-score');
                }
            });

            //	$('.product-choose,.btn-cart').click(function(){
            //		//dialog_load_addcart('{$SITE_URL}/template/wx/goods/addcart.html');
            //		var id = $(" input[ type='hidden' ] ").val();
            //		alert(id);return false;
            //		setTimeout(function(){
            //			dialog_form_radio('?app=goodProm&act=getGoods&id='+id,'添加商品');
            //		},100);
            //	});
            var swiper = new Swiper('.swiper-container', {
                spaceBetween: 0,
                centeredSlides: true,
                autoplay: {
                    delay: 5000,
                    disableOnInteraction: true,
                },
                pagination: {
                    el: '.swiper-pagination',
                    clickable: true,
                }
            });
            //详情参数切换
            $('.detailinfo-menus li').click(function () {
                var item = $('.detailinfo-item');
                var li = $('.detailinfo-menus li');
                var index = $(this).index();
                li.removeClass('active');
                $(this).addClass('active');
                item.hide();
                item.eq(index).show();
            });
            // 弹出购物车页面
        /*    $('.j_addcar').click(function () {
                var add_buy = $(this).attr('name');
                $(this).parent().parent().prev().prev().prev().prev().children().find('button').attr('id', add_buy);
                layer.open({
                    type: 1
                    , content: $('#addcar').html()
                    , anim: 'up'
                    , className: 'layer-addcar'
                    , style: 'position:fixed; bottom:0; left:0; width: 100%; height: 8.05rem;border:none;'
                });
                if (spec_goods_price) {
                    get_goods_price();
                }

            });*/
            // 查看更多
            $('#j_comments').find('.commentitem').eq(0).show();
//            $('#j_btn_all').click(function() {
//                var btn = $(this).find('a');
//                var val = btn.text();
//                if (val == '查看全部') {
//                    $('#j_comments').find('.commentitem').show();
//                    btn.text('收起');
//                } else {
//                    $('#j_comments').find('.commentitem').hide();
//                    $('#j_comments').find('.commentitem').eq(0).show();
//                    btn.text('查看全部');
//                }
//
//            })


        </script>

        <script type="text/javascript">
            

          
            $('#buy').on('click',function () {
                var store_id = $('input[name=store_id]').val();
                var store_goods_id = $('input[name=store_goods_id]').val();
                var goods_price = $('input[name=goods_price]').val();
                var item_id = $('input[name=spec_key]').val();
                //var num = $('input[name=num]').val();
                var num = $('#ku').html();
                var shipping_price = $('input[name=shipping_price]').val();
                var order_from = $('input[name=order_from]').val();
                var langId = $('input[name=langId]').val();
                var shipping_store_id = $('.layer-addcar select[name=store_choose]').val();
                var source =$('input[name=source]').val();
                var cid=$('input[name=cid]').val();
                var latlon=$('input[name=latlon]').val();
                //		var fxCode = $('input[name=fxCode]').val();
                //		alert(fxCode);
                if (shipping_price == '0.00') {
                    shipping_price = 0.00;
                }
                $.ajax({
                    url: 'wx.php?app=orderSure&act=doBuy&lang=' + langId,
                    type: 'post',
                    data: {'shipping_store_id': shipping_store_id, 'langId': langId, 'store_id': store_id, 'store_goods_id': store_goods_id, 'item_id': item_id, 'goods_num': num, 'goods_price': goods_price, 'shipping_price': shipping_price, 'order_from': order_from, 'cid':cid, 'source':source,'latlon':latlon},
                    async: false, //默认为true 异步
                    error: function () {
                        alert('error');
                    },
                    success: function (data) {
                        var data = eval("(" + data + ")");
                        if (data.status == 1) {
                            window.location.href = data.info.url;
                        } else {
                            layer.open({
                                shade: false,
                                content: " <i class='ico ico-correct'></i>" + data.message,
                                className: 'layer-tip',
                                time: 2
                            });
                            setTimeout(function () {
                                window.location = data.info.url;
                            }, 1000);
                        }
                    }
                });
            })




            //数量的增加与减少
            $("div.plus").click(function(){
                var langId = $('input[name=langId]').val();
                var num=parseInt($("span.num").html());
                var source =$('input[name=source]').val();
                var cid=$('input[name=cid]').val();
                num+=1;
                $("span.num").html(num);
                $.ajax({
                    url:'wx.php?app=goods&act=checkNum&lang=' +langId, 
                    type: 'post',
                    data:{'num':num,'cid':cid,'source':source},
                    async: false,
                    error: function () {
                        alert('error');
                    },
                    success: function (data) {
                        console.log(data);
                        var data = eval("(" + data + ")");
                        if (data.status == 1) {
                             layer.open({
                                shade: false,
                                content: " <i class='ico ico-correct'></i>" + data.message,
                                className: 'layer-tip',
                                time: 2
                            });
                            num=1;
                            $("span.num").html(num);
                        } if (data.status==3){
//                             layer.open({
//                                shade: false,
//                                content: " <i class='ico ico-correct'></i>" + data.message,
//                                className: 'layer-tip',
//                                time: 2
//                            });
                            layer.alert(data.message,{
                                icon: 0,
                                btn: false,
                                title: false,
                                closeBtn: 0,
                                time: 2000,
                                skin: 'alt-layer'
                            });
                             num =data.info.limit_amount;
                             $('span.num').html(num);
                        } 
                    
                        }
                    

                });
            });
            $("div.minus").click(function(){
                var num=parseInt($("span.num").html());
                if(num==1){
                    return;
                }else{
                    num-=1;
                    $("span.num").html(num);
                }
            });
            //下拉框
            $(".input_select").click(function(){
                var ul = $("#dropdown ul");
                if(ul.css("display")=="none"){
                    ul.slideDown();
                }else{
                    ul.slideUp();
                }
            });
            $("#dropdown ul li a").click(function(e){
                e.preventDefault()
                var txt = $(this).text();
                $(".input_select").val(txt);
                $("#dropdown ul").hide();
            });

        </script>
        <script type="text/javascript">
         
     
            $(function () {
                //库存的增加和减少
                $(document).on("click", '.updown-box .up', function (e) {
                    var symbol = $('input[name=symbol]').val();
                    var num = $(this).prev().val();
                    $(this).prev().attr('value', parseInt(num) + 1);
                    //$(this).prev().val(parseInt(num) + 1);
                    change_store(num);
                });
                // $('.updown-box .down').click(function(){
                $(document).on("click", '.updown-box .down', function (e) {

                    var symbol = $('input[name=symbol]').val();
                    var store_id = $('input[name=store_id]').val();
                    var num = $(this).next().next().val();
                    if (num <= 1) {
                        num == 1;
                        $(this).next().next().val(parseInt(num));
                    } else {
                        $(this).next().next().val(parseInt(num) - 1);
                        var price = $(this).next().val();
                        var num = $(this).next().next().val();
                        var price_html = (price * num);
                        price_html = symbol + price_html.toFixed(2);
                        $(this).parent().parent().next().next().find('span').html(price_html);
                        var goods_id = $(this).next().next().attr('data_good_id');
                        var item_id = $(this).next().next().attr('data_spec');
                        var prom_id = 0;
                    }
                })
            })
        </script>
        {/literal}
    </body>
</html>