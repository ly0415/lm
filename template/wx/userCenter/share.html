<!DOCTYPE html>
<html class="shareBg" style='font-size:50px'>
    <head lang="en">
        <meta charset="UTF-8">
        <meta name="viewport"
              content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0"/>
        <title></title>
        <link rel="stylesheet" href="{$STATIC_URL}/phone/css/style.css"/>
        <script src="{$STATIC_URL}/phone/js/jquery-2.1.1.min.js"></script>
    </head>
    <body>
        {if $res.user_url ==''}
        <div class="top">
            <img src="{$STATIC_URL}/phone/img/head.png" alt=""/>
        </div>
        <p class="userName">{$res.username}</p>
        <div class="bottom">
            <p>邀您扫一扫</p>
            <div class="persondata-list mt20" style="text-align:center;">
                <br><br><br>
                <a class="btn bg-red btn-big mt200 submit">生成二维码</a>
                <input type='hidden' name='user_id' value='{$res.id}'>
                <input type='hidden' name='lang' value='{$lang}'>
                <input type='hidden' name='latlon' value='{$latlon}'>
                <input type='hidden' name='auxiliary' value='{$auxiliary}'>
            </div>
        </div>
        {else}
        <div class="top">
            <img src="{$STATIC_URL}/phone/img/head.png" alt=""/>
        </div>
        <p class="userName">{$res.username}</p>
        <div class="bottom">
            <p>邀您扫一扫</p>
            <div class="img">
                <img src="{$res.user_url}" alt=""/>
                <input type='hidden' name='img_url' value='{$STATIC_URL}/phone/img/head.png'>
            </div>
        </div>
        <div class="shareModal">
            <div class="shareModal-dialog">
                <div class="shareArrow">
                    <img src="{$STATIC_URL}/phone/img/shareArrow.png" alt=""/>
                </div>
                <div class="modalTxt">
                    <img src="{$STATIC_URL}/phone/img/modelTxt.png" alt=""/>
                </div>
                <div class="know">知道了</div>
            </div>
        </div>
        {/if}
        <input type="hidden" name="userId"  value="{$res.id}">
        <script type="text/javascript" src="http://res.wx.qq.com/open/js/jweixin-1.2.0.js"></script>   
        <script src="{$STATIC_URL}/phone/js/jquery-2.1.1.min.js" type="text/javascript"></script>
        <script src="{$STATIC_URL}/phone/js/common.js" type="text/javascript"></script>
        <script src="{$STATIC_URL}/phone/js/layer/layer.js" type="text/javascript"></script>
        <script src="{$STATIC_URL}/phone/js/mobiscroll.custom-2.17.1.min.js" type="text/javascript"></script>
        <script src="{$STATIC_URL}/phone/js/index.js" type="text/javascript"></script>
        {include file="public/wxjs.html"}
        {literal}
        <script type="text/javascript">
            $(function () {
                $(".know").click(function () {
                    $(".shareModal").css("display", "none");
                });
                $('.submit').click(function () {
                    var user_id = $("input[name=user_id]").val()
                    var lang = $("input[name=lang]").val()
                    var latlon = $("input[name=latlon]").val()
                    var auxiliary = $("input[name=auxiliary]").val()
                    $.ajax({
                        url: 'wx.php?app=userCenter&act=doCode',
                        type: 'post',
                        data: {'user_id': user_id, 'lang': lang, 'latlon': latlon, 'auxiliary': auxiliary},
                        dateType: "json",
                        async: false, //默认为true 异步
                        success: function (res) {
//                            alert(res);return;
                            var jsondata = $.parseJSON(res);
                            if (jsondata.status == '1') {
                                layer.open({
                                    shade: false
                                    , content: '<i class="ico ico-correct"></i>' + jsondata.message
                                    , className: 'layer-tip'
                                    , time: 2
                                });
                                setTimeout(function () {
                                    window.location.href = jsondata.info.url;
                                }, 1000);
                            } else {
                                layer.open({
                                    shade: false
                                    , content: '<i class="ico ico-error"></i>' + jsondata.message
                                    , className: 'layer-tip'
                                    , time: 2
                                });
                            }

                        }
                    });
                })
            })

        </script> 
        <script type="text/javascript">
            var share_image = $('input[name=img_url]').val();
            var share_title = "艾美睿邀您入会。";
            var share_desc = "快点加入吧";
            var userId = $('input[name=userId]').val();
            var share_link = "http://www.711home.net/wx.php?app=default&act=myShare&userId=" + userId;
            wx.ready(function () {
                // 在这里调用 API
                wx.onMenuShareAppMessage({
                    title: share_title, // 分享标题
                    desc: share_desc, // 分享描述
                    link: share_link, // 分享链接
                    imgUrl: share_image, // 分享图标
                    type: '', // 分享类型,music、video或link，不填默认为link
                    dataUrl: '', // 如果type是music或video，则要提供数据链接，默认为空
                    success: function () {
                        // 用户确认分享后执行的回调函数
                    },
                    cancel: function () {
                        // 用户取消分享后执行的回调函数
                    }
                });
                wx.onMenuShareTimeline({
                    title: share_title, // 分享标题
                    link: share_link, // 分享链接
                    imgUrl: share_image, // 分享图标
                    success: function () {
                        // 用户确认分享后执行的回调函数
                    },
                    cancel: function () {
                        // 用户取消分享后执行的回调函数
                    }
                });
            });
        </script>
        {/literal}
      
    </body>
</html>