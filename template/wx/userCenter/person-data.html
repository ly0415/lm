<!DOCTYPE html>
<html>
    <head lang="en">
        <meta charset="UTF-8">
        <title>{$langdata.personal_data}</title>
        <meta content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no" name="viewport">
        <meta content="yes" name="apple-mobile-web-app-capable">
        <meta content="black" name="apple-mobile-web-app-status-bar-style">
        <meta content="telephone=no" name="format-detection">
        <meta content="email=no" name="format-detection">
        <link href="{$STATIC_URL}/phone/css/mobiscroll.custom-2.17.1.min.css"  rel="stylesheet" type="text/css"/>
        <link href="{$STATIC_URL}/phone/css/style.css"  rel="stylesheet" type="text/css"/>
    </head>
    <body>
        <form  id="form_r">
            <div class="persondata-wrap">
                <div class="ss-nav">
                    <a href="wx.php?app=userCenter&act=myCenter&storeid={$storeid}&lang={$lang}&auxiliary={$auxiliary}&latlon={$latlon}" class="ss-nav-back"></a>
                    <div class="ss-nav-title">{$langdata.personal_data}</div>
                </div>
                <div class="height90" style="height:0.9rem"></div>
                <div class="persondata-list mt20">
                    <ul class="my-section">
                        <li>
                            <a href="##" class="clearfix">
                                <span class="lab ellipsis ">{$langdata.personal_Headportrait}</span>
                                <div class="pingj-photo fr mr4">
                                    <div class="z_file" onclick="chooseImage('.wx-photo')">
                                        <div class="z_img">
                                            <div class='img'>
                                                <img src='{$res.headimgurl}' class='photo' width="50px" height="50px"> 
                                                <input type='hidden' name='order_pic[]' value='{$res.headimgurl}'>
                                            </div>
                                        </div>
                                        <button type="button" class="buss-photo wx-photo" name="" style="position: absolute;top: 0;left: 0;width: 50px;height: 50px;"/></button>
                                        <input type="hidden" name="picturePath" value="" id="picturePath">
                                        <input type="hidden" name="pictureName" value="" id="pictureName">
                                    </div>
                                </div>
                            </a>
                        </li>
                        <li>
                            <a href="##" class="clearfix">
                                <span class="lab ellipsis ">{$langdata.personal_name}</span>
                                <span class="fr mr4">  <input type="text" name="username" value='{$res.username}' /></span>
                            </a>
                        </li>
<!--                        <li>
                            <a href="##" class="clearfix">
                                <span class="lab ellipsis ">{$langdata.openid_name}</span>
                                <span class="fr mr4">  <input type="text" value='{$res.nickname}' disabled="disabled" /></span>

                            </a>
                        </li>-->
                        {if $res.phone == ''}
                        <li>
                            <a href="##" class="clearfix">
                                <span class="lab ellipsis ">{$langdata.personal_phone}</span>
                                <span class="fr mr4"><input type="text" name="phone"/></span>
                            </a>
                        </li>
                        {else}
                        <li>
                            <a href="wx.php?app=userCenter&act=editPhone&storeid={$storeid}&lang={$lang}" class="clearfix">
                                <span class="lab ellipsis ">{$langdata.personal_editphone}</span>
                                <span class="fr mr4"><input type="text" value='{$res.phone}' disabled="disabled"/></span>
                            </a> 
                        </li>
                        {/if}
                        {if $res.email == ''}
                        <li>
                            <a href="##" class="clearfix">
                                <span class="lab ellipsis ">{$langdata.personal_mailbox}</span>
                                <span class="fr mr4"> <input type="text" name="email"/> </span>
                            </a>
                        </li> 
                        {else}
                        <li>
                            <a href="wx.php?app=userCenter&act=editEmail&storeid={$storeid}&lang={$lang}" class="clearfix">
                                <span class="lab ellipsis ">{$langdata.personal_editmailbox}</span>
                                <span class="fr mr4"> <input type="text" value='{$res.email}' disabled="disabled"/> </span>
                            </a>
                        </li> 
                        {/if}
                    </ul>
                    <input type="hidden"  name="storeid"  value="{$storeid}" >
                    <input type="hidden"  name="lang"  value="{$lang}" >
                    <input type="hidden"  name="auxiliary"  value="{$auxiliary}" >
                    <!--                    <button class="btn bg-red btn-big mt200 submit">{$langdata.personal_Preservation}</button>-->
                    <a class="btn bg-red btn-big mt200 submit">{$langdata.personal_Preservation}</a>
                </div>
            </div> 
        </form>
        <div id="modal" style="display:none">
            <img src="{$STATIC_URL}/phone/images/ma.png" alt=""/>
        </div>
        <script src="{$STATIC_URL}/phone/js/jquery-2.1.1.min.js" type="text/javascript"></script>
        <script src="{$STATIC_URL}/phone/js/common.js" type="text/javascript"></script>
        <script src="{$STATIC_URL}/phone/js/layer/layer.js" type="text/javascript"></script>
        <script src="{$STATIC_URL}/phone/js/mobiscroll.custom-2.17.1.min.js" type="text/javascript"></script>
        <script src="{$STATIC_URL}/phone/js/index.js" type="text/javascript"></script>
        <script type="text/javascript" src="http://res.wx.qq.com/open/js/jweixin-1.2.0.js"></script>
        <script>
                                        wx.config({
                                            debug: false,
                                            appId: '{$signPackage["appId"]}',
                                            timestamp: '{$signPackage["timestamp"]}',
                                            nonceStr: '{$signPackage["nonceStr"]}',
                                            signature: '{$signPackage["signature"]}',
                                            jsApiList: [
                                                // 所有要调用的 API 都要加到这个列表中
                                                'checkJsApi',
                                                'openLocation',
                                                'getLocation',
                                                'chooseImage',
                                                'previewImage',
                                                'uploadImage',
                                                'getLocalImgData'
                                            ]
                                        });
                                        function chooseImage(obj) {
                                            // 选择张片
                                            wx.chooseImage({
                                                count: 1, // 默认9
                                                sizeType: ['original', 'compressed'], // 可以指定是原图还是压缩图，默认二者都有
                                                success: function (res) {
                                                    var localIds = res.localIds;// 返回选定照片的本地ID列表，localId可以作为img标签的src属性显示图片
                                                    // 上传照片
                                                    wx.uploadImage({
                                                        localId: '' + localIds,
                                                        isShowProgressTips: 1,
                                                        success: function (res) {
                                                            serverId = res.serverId;
                                                            //图片下载打水印
                                                            $.ajax({
                                                                type: "post",
                                                                async: false,
                                                                url: "?app=userCenter&act=getUploadPicture",
                                                                data: {
                                                                    'serverId': serverId,
                                                                    'access_token': "{$access_token}"
                                                                },
                                                                dataType: "json", //返回类型
                                                                success: function (data) {
                                                                    var uploadPath = data.info.uploadPath;
                                                                    var newDirName = data.info.newDirName;
                                                                    var imageName = data.info.imageName;
                                                                    var pic = newDirName + imageName;
                                                                    var imgHtml = "<div class='img'> " + "<img src='" + localIds + "' class='photo'> "
                                                                            + "<input type='hidden' name='order_pic[]' value='" + pic + "'>" + "</div>";
                                                                    $('.z_img').html(imgHtml);

                                                                }
                                                            });//ajax结束
                                                        }
                                                    });
                                                }
                                            });
                                        }
                                        $('.select').anselcfg({});
                                        $('.select_mul').anselcfg_mulit({});
        </script>
        {literal}
        <script type="text/javascript">
            $(function () {
                $('.submit').click(function () {
                    var data = $("#form_r").serializeArray()
                    $.ajax({
                        url: 'wx.php?app=userCenter&act=doUserInfo',
                        type: 'post',
                        data: data,
                        dateType: "json",
                        async: false, //默认为true 异步
                        success: function (res) {
//                            alert(res);return;
                            var jsondata = $.parseJSON(res);
                            if (jsondata.status == '1') {
                                layer.open({
                                    shade: false
                                    , content: '<i class="ico ico-correct"></i>' + jsondata.message
                                    , className: 'layer-tip'
                                    , time: 2
                                });
                                setTimeout(function () {
                                    window.location.href = jsondata.info.url;
                                }, 1000);
                            } else {
                                layer.open({
                                    shade: false
                                    , content: '<i class="ico ico-error"></i>' + jsondata.message
                                    , className: 'layer-tip'
                                    , time: 2
                                });
                            }

                        }
                    });
                })
            })

        </script>
        {/literal}
    </body>
</html>