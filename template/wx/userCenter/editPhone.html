<!DOCTYPE html>
<html>
    <head lang="en">
        <meta charset="UTF-8">
        <title>{$langdata.security_account}</title>
        <meta content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no" name="viewport">
        <meta content="yes" name="apple-mobile-web-app-capable">
        <meta content="black" name="apple-mobile-web-app-status-bar-style">
        <meta content="telephone=no" name="format-detection">
        <meta content="email=no" name="format-detection">
        <link href="{$STATIC_URL}/phone/css/mobiscroll.custom-2.17.1.min.css"  rel="stylesheet" type="text/css"/>
        <link href="{$STATIC_URL}/phone/css/style.css"  rel="stylesheet" type="text/css"/>
    </head>
    <body>
        <div class="forgetpass-wrap">
            <div class="sn-nav">
                <a href="wx.php?app=userCenter&act=myCenter&storeid={$storeid}&lang={$lang}&auxiliary={$auxiliary}&latlon={$latlon}" class="sn-nav-back"></a>
                <div class="sn-nav-title">{$langdata.phone_edit}</div>
            </div>
            <div class="forgetpass-main">
                <input type="hidden"  name="storeid"  value="{$storeid}" >
                <input type="hidden"  name="lang"  value="{$lang}" >
                <input type="hidden"  name="auxiliary"  value="{$auxiliary}" >
                <ul class="validate-phone forgetpass-item" style="display: block;">
                    <li>
                        <input type="text" name="phone" placeholder="{$langdata.phone_number}" />
                        <div class="error" style="display: none;" id="passwd_error"></div>
                    </li>
                    <li>
                        <input type="text" name="code" placeholder="{$langdata.phone_Checkcode}" />
                        <a href="##" class="validate-btn getval">{$langdata.phone_Obtain}</a> 
                        <div class="error" style="display: none;" id="code_error"></div>
                    </li>  
                </ul>
            </div>
            <button type="button" class="btn mt130" id="regist" >{$langdata.phone_Modify}</button>
        </div>   
        <script src="{$STATIC_URL}/phone/js/jquery-2.1.1.min.js" type="text/javascript"></script>
        <script src="{$STATIC_URL}/phone/js/common.js" type="text/javascript"></script>
        <script src="{$STATIC_URL}/phone/js/layer/layer.js" type="text/javascript"></script>
        <script src="{$STATIC_URL}/phone/js/mobiscroll.custom-2.17.1.min.js" type="text/javascript"></script>
        <script src="{$STATIC_URL}/phone/js/index.js" type="text/javascript"></script>
        {if $language=='ZH'}
        {literal}
        <script type="text/javascript">
            /*注册*/
            $('#regist').click(function () {
                var storeid = $('input[name=storeid]').val();
                var lang = $('input[name=lang]').val();
                var auxiliary = $('input[name=auxiliary]').val();
                var phone = $('input[name="phone"]').val();
                var code = $('input[name="code"]').val();
                $.ajax({
                    url: 'wx.php?app=userCenter&act=phoneInfo',
                    type: 'post',
                    data: {'storeid': storeid, 'lang': lang, 'auxiliary': auxiliary, 'phone': phone, 'code': code},
                    async: false, //默认为true 异步
                    dataType: 'json',
                    error: function () {
                        alert('error');
                    },
                    success: function (data) {
                        if (data.status == 1) {
                            layer.open({
                                shade: false
                                , content: '<i class="ico ico-correct"></i> ' + data.message
                                , className: 'layer-tip'
                                , time: 2
                            });
                            setTimeout(function () {
                                window.location.href = data.info.url;
                            }, 1000);
                        } else {
                            layer.open({
                                shade: false
                                , content: '<i class="ico ico-error"></i> ' + data.message
                                , className: 'layer-tip'
                                , time: 2
                            });
                        }
                    }
                });
            });
            $(function () {
                //发送验证码
                var validCode = true;
                $(".getval").click(function () {
                    //发送短信验证吗
                    $('#phone_error').css('display', 'none');
                    var phone = $('input[name="phone"]').val();
                    var reg = /^1\d{10}$/;
                    //验证
                    if (phone.length == 0) {
                        $('#phone_error').css('display', 'block');
                        $('#phone_error').text('手机号码必填！');
                        return false;
                    }

                    if (!reg.test(phone)) {
                        $('#phone_error').css('display', 'block');
                        $('#phone_error').text('手机号码格式错误！');
                        return false;
                    }
                    $.post('wx.php?app=sms&act=sendSms', {'phone': phone}, function (data) {
                    });
                    //倒计时
                    var time = 60;
                    var code = $(this);
                    code.addClass('active');
                    if (validCode) {
                        validCode = false;
                        var t = setInterval(function () {
                            time--;
                            code.html("已发送" + time + "秒");
                            if (time == 0) {
                                clearInterval(t);
                                code.removeClass('active');
                                code.html("重新获取");
                                validCode = true;
                            }
                        }, 1000)
                    }
                })
            });
        </script>
        {/literal}
        {else}
        {literal}
        <script type="text/javascript">
            /*注册*/
            $('#regist').click(function () {
                var storeid = $('input[name=storeid]').val();
                var lang = $('input[name=lang]').val();
                var phone = $('input[name="phone"]').val();
                var code = $('input[name="code"]').val();
                $.ajax({
                    url: 'wx.php?app=userCenter&act=phoneInfo',
                    type: 'post',
                    data: {'storeid': storeid, 'lang': lang, 'phone': phone, 'code': code},
                    async: false, //默认为true 异步
                    dataType: 'json',
                    error: function () {
                        alert('error');
                    },
                    success: function (data) {
                        if (data.status == 1) {
                            layer.open({
                                shade: false
                                , content: '<i class="ico ico-correct"></i> ' + data.message
                                , className: 'layer-tip'
                                , time: 2
                            });
                            setTimeout(function () {
                                window.location.href = data.info.url;
                            }, 1000);
                        } else {
                            layer.open({
                                shade: false
                                , content: '<i class="ico ico-error"></i> ' + data.message
                                , className: 'layer-tip'
                                , time: 2
                            });
                        }
                    }
                });
            });
            $(function () {
                //发送验证码
                var validCode = true;
                $(".getval").click(function () {
                    //发送短信验证吗
                    $('#phone_error').css('display', 'none');
                    var phone = $('input[name="phone"]').val();
                    var reg = /^1\d{10}$/;
                    //验证
                    if (phone.length == 0) {
                        $('#phone_error').css('display', 'block');
                        $('#phone_error').text('Mobile phone number is required！');
                        return false;
                    }
                    if (!reg.test(phone)) {
                        $('#phone_error').css('display', 'block');
                        $('#phone_error').text('Mobile phone number format error！');
                        return false;
                    }
                    //
                    $.post('wx.php?app=sms&act=sendSms', {'phone': phone}, function (data) {

                    });
                    //倒计时
                    var time = 60;
                    var code = $(this);
                    code.addClass('active');
                    if (validCode) {
                        validCode = false;
                        var t = setInterval(function () {
                            time--;
                            code.html("Send out" + time + "S");
                            if (time == 0) {
                                clearInterval(t);
                                code.removeClass('active');
                                code.html("Obtain");
                                validCode = true;
                            }
                        }, 1000)
                    }
                })
            });

        </script>
        {/literal}
        {/if}
    </body>
</html>