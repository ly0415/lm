<!DOCTYPE html>
<html style="background-color: #fff;font-size: 50px">
    <head lang="en">
        <meta charset="UTF-8">
        <title>会员二维码</title>
        <meta content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no" name="viewport">
        <link rel="stylesheet" href="{$STATIC_URL}/phone/css/style.css"/>
    </head>
    <style type="text/css">
        html{
            height: 100%;
            background-color: #2d3134 !important;
        }
        body{
            height: 100%;
        }
        .codeCardContainer{
            position: relative;
            height: 100%;
        }
        .codeCardContainer .ss-nav{
            background-color: #303030;
            color: #ffffff;
        }
        .ss-nav-back1{
            background-image:url(images/codeback.png);
            background-size: 100% 100%;
            width: .18rem;
            height: .28rem;
            display: block;
            position: absolute;
            top: .3rem;
            left: .4rem;
        }
        .codeCardContainer .codeContent{
            height:8.96rem;
            width:80%;
            background-color: #FFFFFF;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%,-50%);
            -webkit-transform:translate(-50%,-50%);
            -moz-transform:translate(-50%,-50%);
            -ms-transform:translate(-50%,-50%);		
        }
        .codeContentTop .img,.codeContentTop .text{
            display: inline-block;
            vertical-align: top;
        }
        .codeContentTop .img{
            width: 1.26rem;
            height: 1.26rem;
            border: 1px solid #EFEFEF;
            padding: 2px;
            margin-top: 0.46rem;
            margin-left: 0.46rem;
        }
        .codeContentTop .img img{
            width: 1.26rem;
            height: 1.26rem;	
        }
        .codeContentTop .text{
            margin-top: 0.66rem;
            font-size: 0.28rem;
            color: #303030;
            margin-left: 0.3rem;
        }
        .codeContentMain .img{
            width: 4rem;
            height: 4rem;
            position: absolute;
            top: 60%;
            left: 50%;
            transform: translate(-50%,-60%);
            -webkit-transform:translate(-50%,-60%);
            -moz-transform:translate(-50%,-60%);
            -ms-transform:translate(-50%,-60%);			
        }
        .codeContentMain .img img{
            width: 4rem;
            height: 4rem;
        }	
    </style>
    <body>
        <div class="codeCardContainer">
            <div class="codeContent">
                <div class="codeContentTop">
                    <div class="img">
                        <img src="{$res.headimgurl}"/>
                    </div>
                    <div class="text">
                        {$res.username}
                    </div>
                </div>
                <div class="codeContentMain">
                    {if $res.order_url==''}
                    <div class="img">
                        <a class="btn bg-red btn-big mt200 submit">生成二维码</a>
                    </div>
                    <input type='hidden' name='user_id' value='{$res.id}'>
                    <input type='hidden' name='phone' value='{$res.phone}'>
                    <input type='hidden' name='lang' value='{$lang}'>
                    <input type='hidden' name='latlon' value='{$latlon}'>
                    <input type='hidden' name='auxiliary' value='{$auxiliary}'>
                    {else}
                    <div class="img">
                      <img src="{$res.order_url}"/>
                      <a class="btn bg-red btn-big submit">更新二维码</a>
                      <input type='hidden' name='user_id' value='{$res.id}'>
                      <input type='hidden' name='phone' value='{$res.phone}'>
                      <input type='hidden' name='lang' value='{$lang}'>
                      <input type='hidden' name='latlon' value='{$latlon}'>
                      <input type='hidden' name='auxiliary' value='{$auxiliary}'>
                    </div>
                    {/if}
                </div>			
            </div>
        </div>
    <script type="text/javascript" src="http://res.wx.qq.com/open/js/jweixin-1.2.0.js"></script>   
        <script src="{$STATIC_URL}/phone/js/jquery-2.1.1.min.js" type="text/javascript"></script>
        <script src="{$STATIC_URL}/phone/js/common.js" type="text/javascript"></script>
        <script src="{$STATIC_URL}/phone/js/layer/layer.js" type="text/javascript"></script>
        <script src="{$STATIC_URL}/phone/js/mobiscroll.custom-2.17.1.min.js" type="text/javascript"></script>
        <script src="{$STATIC_URL}/phone/js/index.js" type="text/javascript"></script>
        {include file="public/wxjs.html"}
        {literal}
        <script type="text/javascript">
                $('.submit').click(function () {
                    var user_id = $("input[name=user_id]").val()
                    var phone = $("input[name=phone]").val()
                    var lang = $("input[name=lang]").val()
                    var latlon = $("input[name=latlon]").val()
                    var auxiliary = $("input[name=auxiliary]").val()
                    $.ajax({
                        url: 'wx.php?app=userCenter&act=orderCode',
                        type: 'post',
                        data: {'user_id': user_id, 'phone': phone, 'lang': lang, 'latlon': latlon, 'auxiliary': auxiliary},
                        dateType: "json",
                        async: false, //默认为true 异步
                        success: function (res) {
//                            alert(res);return;
                            var jsondata = $.parseJSON(res);
                            if (jsondata.status == '1') {
                                layer.open({
                                    shade: false
                                    , content: '<i class="ico ico-correct"></i>' + jsondata.message
                                    , className: 'layer-tip'
                                    , time: 2
                                });
                                setTimeout(function () {
                                    window.location.href = jsondata.info.url;
                                }, 1000);
                            } else {
                                layer.open({
                                    shade: false
                                    , content: '<i class="ico ico-error"></i>' + jsondata.message
                                    , className: 'layer-tip'
                                    , time: 2
                                });
                            }

                        }
                    });
                })
        </script> 
        {/literal}
    </body>
</html>