<!DOCTYPE html>
<html>
    <head lang="en">
        <meta charset="UTF-8">
        <title>{$langdata.Forgetthe_password}</title>
        <meta content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no" name="viewport">
        <meta content="yes" name="apple-mobile-web-app-capable">
        <meta content="black" name="apple-mobile-web-app-status-bar-style">
        <meta content="telephone=no" name="format-detection">
        <meta content="email=no" name="format-detection">
        <link href="{$STATIC_URL}/phone/css/mobiscroll.custom-2.17.1.min.css"  rel="stylesheet" type="text/css"/>
        <link href="{$STATIC_URL}/phone/css/style.css"  rel="stylesheet" type="text/css"/>
    </head>
    <body>
        <div class="forgetpass-wrap">
            <div class="sn-nav">
                <a href="wx.php?app=user&act=login&storeid={$storeid}" class="sn-nav-back"></a>
                <div class="sn-nav-title">{$langdata.Forgetthe_password}</div>
            </div>
            <div class="forgetpass-main">
                <ul class="validate-phone forgetpass-item" style="display: block;">
                    <li>
                        <input type="text" name="phone" placeholder="{$langdata.enter_number}" />
                        <div class="error" style="display: none;" id="phone_error"></div>
                        <!--				<i class="ico-right fr"></i>-->
                    </li>
                    <li>
                        <input type="text" name="passwd"  placeholder="{$langdata.Input_password}">
                        <div class="error" style="display: none;" id="passwd_error"></div>
                    </li>
                    <li>
                        <input type="text" name="code" placeholder="{$langdata.Input_verificationcode}" />
                        <a href="##" class="validate-btn getval">{$langdata.Obtain_validation}</a>
                    </li>  
                    <div class="error" style="display: none;" id="code_error"></div>
                    <input name="languages" type="hidden" value="{$languages}">
                </ul>
            </div>
            <button type="button" class="btn mt130" id="regist" >{$langdata.reset_password}</button>
        </div>   
        <script src="{$STATIC_URL}/phone/js/jquery-2.1.1.min.js" type="text/javascript"></script>
        <script src="{$STATIC_URL}/phone/js/common.js" type="text/javascript"></script>
        <script src="{$STATIC_URL}/phone/js/layer/layer.js" type="text/javascript"></script>
        <script src="{$STATIC_URL}/phone/js/mobiscroll.custom-2.17.1.min.js" type="text/javascript"></script>
        <script src="{$STATIC_URL}/phone/js/index.js" type="text/javascript"></script>
        {literal}
        <script type="text/javascript">
            /*注册*/
            $('#regist').click(function () {
                var phone = $('input[name="phone"]').val();
                var passwd = $.trim($('input[name="passwd"]').val());
                var code = $('input[name="code"]').val();
                var languages = $('input[name="languages"]').val();
                $.ajax({
                    url: 'wx.php?app=user&act=changePasswordE',
                    type: 'post',
                    data: {'phone': phone, 'passwd': passwd, 'code': code, 'languages': languages},
                    async: false, //默认为true 异步
                    dataType: 'json',
                    error: function () {
                        alert('error');
                    },
                    success: function (data) {
                        if (data.status == 1) {
                            layer.open({
                                shade: false
                                , content: '<i class="ico ico-correct"></i> ' + data.message
                                , className: 'layer-tip'
                                , time: 2
                            });
                            setTimeout(function () {
                                window.location.href = data.info.url;
                            }, 1000);
                        } else {
                            layer.open({
                                shade: false
                                , content: '<i class="ico ico-error"></i> ' + data.message
                                , className: 'layer-tip'
                                , time: 2
                            });
                        }
                    }
                });
            });
        </script>
        {/literal}
        {if $languages=='ZH'}
        {literal}
        <script>
            $(function () {
                //发送验证码
                var validCode = true;
                $(".getval").click(function () {
                    //发送短信验证吗
                    $('#phone_error').css('display', 'none');
                    var phone = $('input[name="phone"]').val();
                    var reg = /^(13[0-9]|14[0-9]|15[0-9]|17[0-9]|18[0-9])\d{8}$/;
                    //验证
                    if (phone.length == 0) {
                        $('#phone_error').css('display', 'block');
                        $('#phone_error').text('手机号码必填！');
                        return false;
                    }

                    if (!reg.test(phone)) {
                        $('#phone_error').css('display', 'block');
                        $('#phone_error').text('手机号码格式错误！');
                        return false;
                    }
                    //
                    $.post('wx.php?app=sms&act=sendSms', {'phone': phone}, function (data) {

                    });
                    //倒计时
                    var time = 60;
                    var code = $(this);
                    code.addClass('active');
                    if (validCode) {
                        validCode = false;
                        var t = setInterval(function () {
                            time--;
                            code.html("已发送" + time + "秒");
                            if (time == 0) {
                                clearInterval(t);
                                code.removeClass('active');
                                code.html("重新获取");
                                validCode = true;
                            }
                        }, 1000)
                    }
                })
            });
        </script>
        {/literal}
        {else}
        {literal}
        <script>
            $(function () {
                //发送验证码
                var validCode = true;
                $(".getval").click(function () {
                    //发送短信验证吗
                    $('#phone_error').css('display', 'none');
                    var phone = $('input[name="phone"]').val();
                    var reg = /^(13[0-9]|14[0-9]|15[0-9]|17[0-9]|18[0-9])\d{8}$/;
                    //验证
                    if (phone.length == 0) {
                        $('#phone_error').css('display', 'block');
                        $('#phone_error').text('Mobile phone number is required！');
                        return false;
                    }

                    if (!reg.test(phone)) {
                        $('#phone_error').css('display', 'block');
                        $('#phone_error').text('Mobile phone number format error！');
                        return false;
                    }
                    //
                    $.post('wx.php?app=sms&act=sendSms', {'phone': phone}, function (data) {

                    });
                    //倒计时
                    var time = 60;
                    var code = $(this);
                    code.addClass('active');
                    if (validCode) {
                        validCode = false;
                        var t = setInterval(function () {
                            time--;
                            code.html("Send out" + time + "S");
                            if (time == 0) {
                                clearInterval(t);
                                code.removeClass('active');
                                code.html("Obtain");
                                validCode = true;
                            }
                        }, 1000)
                    }
                })
            });
        </script>
        {/literal}
        {/if}
    </body>
</html>