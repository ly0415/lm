<!DOCTYPE html>
<html>
    <head>
        <title>{$langdata.heading_map}</title>
        <meta charset="utf-8" />
        {include file="public/header.html"}
    </head>
    <body>
        <!-- header -->
        {include file="public/daohang.html"}
        <!-- header end -->
        <!-- navs-box -->
        <!-- navs-box end -->
        <div class="border"></div>
        <div id="slideBox" class="index_flash" style="height:650px;">
            <div style="width:1200px;height:650px;border:#ccc solid 1px;" id="allmap"></div>
            <p>点击标注点，可查看由纯文本构成的简单型信息窗口</p>
        </div>
        <!-- paypal -->
        <div class="payoptions">
            <h2><span>{$langdata.Lately}</span></h2>
            <div class="img">
                <img src="{$STATIC_URL}/front/images/zhifu.png">
                <img src="{$STATIC_URL}/front/images/paypal.png">
                <img src="{$STATIC_URL}/front/images/weixin.png">
            </div>
        </div>
        <!-- slider end -->
        <!-- footer -->
        {include file="public/footer.html"}
        <!-- footer end -->
        {literal}
        <script type="text/javascript" src="http://api.map.baidu.com/api?v=2.0&ak=CmfcOlGRQE7OztyHtDGLoiiNGYUu37Te"></script>
        <!--        <script src="http://libs.baidu.com/jquery/1.9.0/jquery.js"></script>-->
        <script type="text/javascript">
            // 百度地图API功能	
            map = new BMap.Map("allmap");
            map.centerAndZoom(new BMap.Point(116.417854, 39.921988), 12);
            //地图定位
            function myFun(result) {
                var cityName = result.name;
                map.setCenter(cityName);
                layer.alert("您当前定位城市:" + cityName, {
                    icon: 1,
                    shadeClose: false,
                    skin: 'layer-ext-moon',
                    btn: false,
                    area: ['259px', '120px'],
                    time: 2000
                });
            }
            var myCity = new BMap.LocalCity();
            myCity.get(myFun);

            function getZonelist() {
                $.ajax({
                    url: 'index.php?app=map&act=getStore',
                    type: 'POST',
                    data: '',
                    dataType: "json",
                    success: function (data) {
                        $.each(data, function (key, value) {
                            if (value.store_type == 1) {
                                value.store_type = "总代理";
                            } else if (value.store_type == 2) {
                                value.store_type = "经销商";
                            } else if (value.store_type == 3) {
                                value.store_type = "门店";
                            } else {
                                value.store_type = "ODM";
                            }
//                            alert('__ID：' + value.id + '__名称：' + value.store_name + '__地址：' + value.addr_detail + '__经度：' + value.longitude + '__纬度：' + value.latitude);
                            var data_info = [
                                [value.longitude, value.latitude, "<hr/>" + "店铺地址：" + value.addr_detail + "<br/><br/>" + "电话：" + value.store_mobile + "<br/><br/>" + "<a href=" + 'index.php?storeid=' + value.id + '&lang=' + value.lang_id + '&auxiliary=' + '0' + " style='color:red'>点击进入此店铺</a>"],
                            ];
                            var opts = {
                                width: 250, // 信息窗口宽度
                                height: 140, // 信息窗口高度
                                title: value.store_name + "（" + value.store_type + "）", // 店铺名称标题
                                enableMessage: true//设置允许信息窗发送短息

                            };
//                            var myKeys = ["酒店", "加油站"];
//                            var local = new BMap.LocalSearch(map, {
//                                renderOptions: {map: map, panel: "r-result"},
//                                pageCapacity: 5
//                            });
//                            local.searchInBounds(myKeys, map.getBounds());
                            for (var i = 0; i < data_info.length; i++) {
                                var marker = new BMap.Marker(new BMap.Point(data_info[i][0], data_info[i][1]));  // 创建标注
                                var content = data_info[i][2];
                                map.addOverlay(marker);               // 将标注添加到地图中
                                marker.setAnimation(BMAP_ANIMATION_BOUNCE); //跳动的动画
                                addClickHandler(content, marker);
                            }
                            function addClickHandler(content, marker) {
                                marker.addEventListener("click", function (e) {
                                    openInfo(content, e)
                                }
                                );
                            }
                            function openInfo(content, e) {
                                var p = e.target;
                                var point = new BMap.Point(p.getPosition().lng, p.getPosition().lat);
                                var infoWindow = new BMap.InfoWindow(content, opts);  // 创建信息窗口对象 
                                map.openInfoWindow(infoWindow, point); //开启信息窗口
                            }

                        });
                    }
                });
                return false;
            }
            var myCitys = new BMap.LocalCity();
            myCitys.get(getZonelist);

            //全国地区搜索
            window.map = map;//将map变量存储在全局
            map.enableScrollWheelZoom();
            map.enableInertialDragging();
            map.enableContinuousZoom();
            var size = new BMap.Size(10, 20);
            map.addControl(new BMap.CityListControl({
                anchor: BMAP_ANCHOR_TOP_LEFT,
                offset: size,
            }));
        </script>
        {/literal}
    </body>
</html>