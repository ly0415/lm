<!DOCTYPE html>
<html>
    <head>
        <title>{$langdata.login_forget}</title>
        <meta charset="utf-8" />
        <link rel="stylesheet" type="text/css" href="{$STATIC_URL}/front/css/base.css">
    </head>
    <body style="background-color:#fff;">
        <div class="container clearfix login-header">
            <a href="index.php?storeid={$storeid}&lang={$langid}" class="logo fl mt20">
                <img src="{$webconf.store_logo.value}" width="156" height="106">
            </a>
            <div class="login fr">
                {$langdata.login_security}
                <i class="ico-lock ico"></i>
            </div>
        </div>
        <div class="login-box ">
            <div>
                <div class="login-tit" style="margin-bottom:20px;">
                    {$langdata.login_Welcome}
                    <p class="sub">{$langdata.Resetthe_password}</p>
                </div>
                <div class="login-content">
                    <p>
                        <input type="text" name="phone" placeholder="{$langdata.enter_number}" class="text">
                    <div class="error" style="display: none;" id="phone_error"></div>
                    </p>

                    <p class=" password">
                        <input type="password" name="passwd"  placeholder="{$langdata.Input_password}" class="text"><span class="show">{$langdata.login_display}</span></p>
                    <div class="error" style="display: none;" id="passwd_error"></div>
                    <p>
                        <input type="text" name="code" placeholder="{$langdata.Input_verificationcode}" class="text inblock" style="width: 50%">
                        <a href="javascript:;" class="btn-sub inblock fr getval" style="width: 45%">{$langdata.Obtain_validation}</a>
                    <div class="error" style="display: none;" id="code_error"></div>

                    </p>

                    <p><button class="btn-sub" id="regist" >{$langdata.Reset}</button> </p>
                </div>
            </div>
        </div>
        <div class="login-footer">
            <p class="web">www.711home.com www.711home.net</p>
            <p>Copyright @ 2003 - 2016 711 household co., ltd. - amy juwang shanghai icp for 16027528 - 1</p>
        </div>


        <script type="text/javascript" src="{$STATIC_URL}/front/js/jquery.1.8.2.min.js"></script>
        <!-- iCheck -->
        <script src="{$STATIC_URL}/plugin/iCheck/icheck.min.js"></script>
        <script type="text/javascript" src="{$STATIC_URL}/front/js/common.js"></script>
        <script type="text/javascript" src="{$STATIC_URL}/front/plus/layer/layer.js"></script>
        {if $lang_id == 'ZH'}
        <script>
            $(function () {
                $('input').iCheck({
                    checkboxClass: 'icheckbox_square-blue',
                    radioClass: 'iradio_square-blue',
                    increaseArea: '20%' // optional
                });
                document.onkeydown = function (event) {
                    e = event ? event : (window.event ? window.event : null);
                    if (e.keyCode == 13) {
                        var button = document.getElementById('login_button');
                        button.focus();
                        button.onclick();
                    }
                };
            });
        </script>
        {literal}
        <script type="text/javascript">
            /*注册*/
            $('#regist').click(function () {

                $('#phone_error').css('display', 'none');
                $('#passwd_error').css('display', 'none');
                $('#code_error').css('display', 'none');

                var phone = $('input[name="phone"]').val();
                var passwd = $.trim($('input[name="passwd"]').val());
                var code = $('input[name="code"]').val();
                var reg = /^(13[0-9]|14[0-9]|15[0-9]|17[0-9]|18[0-9])\d{8}$/;
                if (phone.length == 0) {
                    $('#phone_error').css('display', 'block');
                    $('#phone_error').text('手机号码必填！');
                    return false;
                }
                if (!reg.test(phone)) {
                    $('#phone_error').css('display', 'block');
                    $('#phone_error').text('手机号码格式错误！');
                    return false;
                }
                if (passwd.length == 0) {
                    $('#passwd_error').css('display', 'block');
                    $('#passwd_error').text('密码必填！');
                    return false;
                }
                if (passwd.length < 6 || passwd.length > 16) {
                    $('#passwd_error').css('display', 'block');
                    $('#passwd_error').text('密码长度是6-16个字符！');
                    return false;
                }
                if (code.length == 0) {
                    $('#code_error').css('display', 'block');
                    $('#code_error').text('验证码必填！');
                    return false;
                }

                $.ajax({
                    url: 'index.php?app=user&act=changePasswordE',
                    type: 'post',
                    data: {'phone': phone, 'passwd': passwd, 'code': code},
                    async: false, //默认为true 异步
                    dataType: 'json',
                    error: function () {
                        alert('error');
                    },
                    success: function (data) {
                        var status = data.status;
                        var message = data.message;
                        if (status == 1) {
                            layer.alert(message, {
                                icon: 1,
                                btn: false,
                                title: false,
                                closeBtn: 0,
                                time: 2000,
                                skin: 'alt-layer'
                            });
                            setTimeout(function () {
                                window.location.href = data.info.url;
                            }, 2500);
                        } else {
                            layer.alert(message, {
                                icon: 0,
                                btn: false,
                                title: false,
                                closeBtn: 0,
                                time: 2000,
                                skin: 'alt-layer'
                            });
                        }


                    }

                });

            });


            $(function () {
                $('.password').on('click', '.show', function () {
                    name = $(this).prev().attr('name');
                    value = $(this).prev().attr('value');
                    if ($(this).prev().attr('type') == 'password') {
                        $('.password').html('<input type="text" name="' + name + '" value="' + value + '" placeholder="请输入新密码" class="text"><span class="show">显示</span>');
                    } else if ($(this).prev().attr('type') == 'text') {
                        $('.password').html('<input type="password" name="' + name + '" value="' + value + '" placeholder="请输入新密码" class="text"><span class="show">显示</span>');
                    }
                })
            });
            $(function () {
                //发送验证码
                var validCode = true;
                $(".getval").click(function () {
                    //发送短信验证吗
                    $('#phone_error').css('display', 'none');
                    var phone = $('input[name="phone"]').val();
                    var reg = /^(13[0-9]|14[0-9]|15[0-9]|17[0-9]|18[0-9])\d{8}$/;
                    //验证
                    if (phone.length == 0) {
                        $('#phone_error').css('display', 'block');
                        $('#phone_error').text('手机号码必填！');
                        return false;
                    }

                    if (!reg.test(phone)) {
                        $('#phone_error').css('display', 'block');
                        $('#phone_error').text('手机号码格式错误！');
                        return false;
                    }
                    //
                    $.post('index.php?app=sms&act=sendSmsReset', {'phone': phone}, function (data) {

                    });
                    //倒计时
                    var time = 60;
                    var code = $(this);
                    code.addClass('active');
                    if (validCode) {
                        validCode = false;
                        var t = setInterval(function () {
                            time--;
                            code.html("已发送" + time + "秒");
                            if (time == 0) {
                                clearInterval(t);
                                code.removeClass('active');
                                code.html("重新获取");
                                validCode = true;
                            }
                        }, 1000)
                    }



                })
            });

        </script>
        {/literal}
        {else}
        <script>
            $(function () {
                $('input').iCheck({
                    checkboxClass: 'icheckbox_square-blue',
                    radioClass: 'iradio_square-blue',
                    increaseArea: '20%' // optional
                });
                document.onkeydown = function (event) {
                    e = event ? event : (window.event ? window.event : null);
                    if (e.keyCode == 13) {
                        var button = document.getElementById('login_button');
                        button.focus();
                        button.onclick();
                    }
                };
            });
        </script>
        {literal}
        <script type="text/javascript">
            /*注册*/
            $('#regist').click(function () {

                $('#phone_error').css('display', 'none');
                $('#passwd_error').css('display', 'none');
                $('#code_error').css('display', 'none');

                var phone = $('input[name="phone"]').val();
                var passwd = $.trim($('input[name="passwd"]').val());
                var code = $('input[name="code"]').val();
                var reg = /^(13[0-9]|14[0-9]|15[0-9]|17[0-9]|18[0-9])\d{8}$/;
                if (phone.length == 0) {
                    $('#phone_error').css('display', 'block');
                    $('#phone_error').text('Mobile phone number is required！');
                    return false;
                }
                if (!reg.test(phone)) {
                    $('#phone_error').css('display', 'block');
                    $('#phone_error').text('Mobile phone number format error！');
                    return false;
                }
                if (passwd.length == 0) {
                    $('#passwd_error').css('display', 'block');
                    $('#passwd_error').text('Password required！');
                    return false;
                }
                if (passwd.length < 6 || passwd.length > 16) {
                    $('#passwd_error').css('display', 'block');
                    $('#passwd_error').text('The password length is 6-16 characters！');
                    return false;
                }
                if (code.length == 0) {
                    $('#code_error').css('display', 'block');
                    $('#code_error').text('The verification code is required！');
                    return false;
                }

                $.ajax({
                    url: 'index.php?app=user&act=changePasswordE',
                    type: 'post',
                    data: {'phone': phone, 'passwd': passwd, 'code': code},
                    async: false, //默认为true 异步
                    dataType: 'json',
                    error: function () {
                        alert('error');
                    },
                    success: function (data) {
                        var status = data.status;
                        var message = data.message;
                        if (status == 1) {
                            layer.alert(message, {
                                icon: 1,
                                btn: false,
                                title: false,
                                closeBtn: 0,
                                time: 2000,
                                skin: 'alt-layer'
                            });
                            setTimeout(function () {
                                window.location.href = data.info.url;
                            }, 2500);
                        } else {
                            layer.alert(message, {
                                icon: 0,
                                btn: false,
                                title: false,
                                closeBtn: 0,
                                time: 2000,
                                skin: 'alt-layer'
                            });
                        }


                    }

                });

            });


            $(function () {
                $('.password').on('click', '.show', function () {
                    name = $(this).prev().attr('name');
                    value = $(this).prev().attr('value');
                    if ($(this).prev().attr('type') == 'password') {
                        $('.password').html('<input type="text" name="' + name + '" value="' + value + '" placeholder="Please enter a new password" class="text"><span class="show">Show</span>');
                    } else if ($(this).prev().attr('type') == 'text') {
                        $('.password').html('<input type="password" name="' + name + '" value="' + value + '" placeholder="Please enter a new password" class="text"><span class="show">Show</span>');
                    }
                })
            });
            $(function () {
                //发送验证码
                var validCode = true;
                $(".getval").click(function () {
                    //发送短信验证吗
                    $('#phone_error').css('display', 'none');
                    var phone = $('input[name="phone"]').val();
                    var reg = /^(13[0-9]|14[0-9]|15[0-9]|17[0-9]|18[0-9])\d{8}$/;
                    //验证
                    if (phone.length == 0) {
                        $('#phone_error').css('display', 'block');
                        $('#phone_error').text('Mobile phone number is required！');
                        return false;
                    }

                    if (!reg.test(phone)) {
                        $('#phone_error').css('display', 'block');
                        $('#phone_error').text('Mobile phone number format error！');
                        return false;
                    }
                    //
                    $.post('index.php?app=sms&act=sendSmsReset', {'phone': phone}, function (data) {

                    });
                    //倒计时
                    var time = 60;
                    var code = $(this);
                    code.addClass('active');
                    if (validCode) {
                        validCode = false;
                        var t = setInterval(function () {
                            time--;
                            code.html("has been sent" + time + "second");
                            if (time == 0) {
                                clearInterval(t);
                                code.removeClass('active');
                                code.html("Recapture");
                                validCode = true;
                            }
                        }, 1000)
                    }



                })
            });

        </script>
        {/literal}
        {/if}
    </body>
</html>