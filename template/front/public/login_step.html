<!DOCTYPE html>
<html>
    <head>
        <title>step 2</title>
        <meta charset="utf-8" />
        <link rel="stylesheet" type="text/css" href="{$STATIC_URL}/front/css/base.css">
        <!-- iCheck -->
        <link rel="stylesheet" href="{$STATIC_URL}/plugin/iCheck/square/blue.css">
    </head>
    <body style="background-color:#fff;">
        <div class="container clearfix login-header">
            <div style="margin-top:8px;width:240px">
                <a href="index.php?storeid={$storeid}&lang={$langid}" class="logo fl mt20">
                    <img src="{$webconf.store_logo.value}" style="width:100%">
                </a>
            </div>
            <div class="login fr">
                {$langdata.login_security}
                <i class="ico-lock ico"></i>
            </div>
        </div>
        <div class="login-box ">
            <div>
                <div class="login-tit" style="margin-bottom:20px;">
                    {$langdata.login_Welcome}
                    <p class="sub">{$langdata.login_add}</p>
                </div>
                <div class="login-content">
                    <p>
                        <input type="text" name="email" placeholder="{$langdata.login_mail}" class="text" value="{$username}">
                    <div class="error" style="display: none;" id="email_error">{$langdata.login_input}</div>
                    </p>
                    <p class=" password">
                        <input type="password" name="password" value="" placeholder="{$langdata.login_Password}" class="text"><span class="show">{$langdata.login_display}</span>
                    <div class="error" style="display: none;" id="password_error"></div>
                    <input type="hidden" value="{$returnUrl}" name="returnUrl" />
                    <input type="hidden" value="{$returnUrl1}" name="returnUrl1">
                    </p>
                    <p class="other">
                        <a href="index.php?app=user&act=login_stepK&lang={$langid}&username={base64_encode($username)}&returnUrl={$returnUrl}&returnUrl1={$returnUrl1}">手机号快捷登录</a>
                        <a href="javascript:void (0);" id="forgot_password">{$langdata.login_forget}</a>
                        <input type="hidden" value="{$langid}" name="lang" />
                    </p>
                    <p>
                        <button type="button" class="btn-sub" id="login_button" >{$langdata.login_Land}</button>
                    <div class="error" style="display: none;" id="login_error"></div> 
                    </p>
                </div>
            </div>
        </div>
        <div class="login-footer">
            <p class="web">www.711home.com www.711home.net</p>
            <p>Copyright @ 2003 - 2016 711 household co., ltd. - amy juwang shanghai icp for 16027528 - 1</p>
        </div>
        <script type="text/javascript" src="{$STATIC_URL}/front/js/jquery.1.8.2.min.js"></script>
        <script type="text/javascript" src="{$STATIC_URL}/front/plus/layer/layer.js"></script>
        <!-- iCheck -->
        <script src="{$STATIC_URL}/plugin/iCheck/icheck.min.js"></script>

        <script type="text/javascript" src="{$STATIC_URL}/front/js/common.js"></script>s
        <script>
            $(function () {
                $('input').iCheck({
                    checkboxClass: 'icheckbox_square-blue',
                    radioClass: 'iradio_square-blue',
                    increaseArea: '20%' // optional
                });
                document.onkeydown = function (event) {
                    e = event ? event : (window.event ? window.event : null);
                    if (e.keyCode == 13) {
                        var button = document.getElementById('login_button');
                        button.focus();
                        button.onclick();
                    }
                };
            });
        </script>
        {if $lang_id =='ZH'}

        {literal}
        <script type="text/javascript">
            $(function () {
                var userName = $('input[name=email]').val();
                var lang = $('input[name=lang]').val();
                $('#forgot_password').attr('href', 'index.php?app=user&act=forgot_password_p&lang=' + lang + '&username=' + userName);
                $('.password').on('click', '.show', function () {
                    name = $(this).prev().attr('name');
                    value = $(this).prev().attr('value');
                    if ($(this).prev().attr('type') == 'password') {
                        $('.password').html('<input type="text" name="' + name + '" value="' + value + '" placeholder="请输入密码" class="text"><span class="show">隐藏</span>');
                    } else if ($(this).prev().attr('type') == 'text') {
                        $('.password').html('<input type="password" name="' + name + '" value="' + value + '" placeholder="请输入密码" class="text"><span class="show">显示</span>');
                    }
                })
            })
            // 点击登录
            $(function () {
                $('.btn-sub').click(function () {
                    var email = $('input[name=email]').val();
                    var returnUrl = $('input[name=returnUrl]').val();
                    var reg_e = /^([a-zA-Z0-9_-])+@([a-zA-Z0-9_-])+((\.[a-zA-Z0-9_-]{2,3}){1,2})$/;
                    var reg_p = /^1[3|4|7|5|8][0-9]\d{4,8}$/;
                    var password = $('input[name=password]').val();
                    var returnUrl1 = $('input[name=returnUrl1]').val();
                    if (email == "") {
                        $('#email_error').css('display', 'block');
                        $('input[name=yanzheng]').focus();
                        return false;
                    }
                    if (reg_e.test(email) || reg_p.test(email)) {

                    } else {
                        $('#email_error').css('display', 'block');
                        $('#email_error').html('您的电子邮件/电话模式是错误的！');
                        return false;
                    }
                    if (password.length < 6) {
                        $('#password_error').css('display', 'block');
                        $('#password_error').html('密码太短!');
                        return false;
                    }
                    $.ajax({
                        url: 'index.php?app=user&act=doLogin',
                        type: 'post',
                        data: {'email': email, 'password': password, 'returnUrl': returnUrl, 'returnUrl1': returnUrl1},
                        async: false, //默认为true 异步
                        error: function () {
                            alert('error');
                        },
                        success: function (data) {
                            var data = eval("(" + data + ")");
                            if (data.status == 1) {//用户名不存在需要注册！
                                $('#login_error').css('display', 'block');
                                $('#password_error').css('display', 'block');
                                window.location.href = data.info.url;
                            } else if (data.status == 0) {
                                $('#password_error').css('display', 'block');
                                $('#password_error').html(data.message);
                            } else {
                                layer.confirm('账号已被登录，继续登录吗？', {
                                    btn: ['是', '否'] //按钮
                                }, function () {
                                    $.ajax({
                                        url: "index.php?app=user&act=goOnLogin",
                                        data: {'userName': data.info.userName, 'userId': data.info.userId, 'url': data.info.url},
                                        type: "POST",
                                        dataType: "json",
                                        success: function (res) {
//                                            console.log(res);
//                                            return ;
//                                            layer.alert(res.message, {
//                                                icon: 1,
//                                                btn:false,
//                                                title:false,
//                                                closeBtn: 0,
//                                                time:3000,
//                                                skin:'alt-layer'
//                                            });
                                            window.location = res.info.url;
                                        }
                                    })
                                }, function () {
                                });
                            }
                        }
                    });
                })
            })
        </script>
        {/literal}
        {else}
        {literal}
        <script type="text/javascript">
            $(function () {
                var userName = $('input[name=email]').val();
                var lang = $('input[name=lang]').val();
                $('#forgot_password').attr('href', 'index.php?app=user&act=forgot_password_p&lang=' + lang + '&username=' + userName);
                $('.password').on('click', '.show', function () {
                    name = $(this).prev().attr('name');
                    value = $(this).prev().attr('value');
                    if ($(this).prev().attr('type') == 'password') {
                        $('.password').html('<input type="text" name="' + name + '" value="' + value + '" placeholder="Please input a password" class="text"><span class="show">Hide</span>');
                    } else if ($(this).prev().attr('type') == 'text') {
                        $('.password').html('<input type="password" name="' + name + '" value="' + value + '" placeholder="Please input a password" class="text"><span class="show">Show</span>');
                    }
                })
            })
            // 点击登录
            $(function () {
                $('.btn-sub').click(function () {
                    var email = $('input[name=email]').val();
                    var returnUrl = $('input[name=returnUrl]').val();
                    var reg_e = /^([a-zA-Z0-9_-])+@([a-zA-Z0-9_-])+((\.[a-zA-Z0-9_-]{2,3}){1,2})$/;
                    var reg_p = /^1[3|4|7|5|8][0-9]\d{4,8}$/;
                    var password = $('input[name=password]').val();
                    if (email == "") {
                        $('#email_error').css('display', 'block');
                        $('input[name=yanzheng]').focus();
                        return false;
                    }
                    if (reg_e.test(email) || reg_p.test(email)) {

                    } else {
                        $('#email_error').css('display', 'block');
                        $('#email_error').html('Your email / phone mode is wrong！');
                        return false;
                    }
                    if (password.length < 6) {
                        $('#password_error').css('display', 'block');
                        $('#password_error').html('Password too short!');
                        return false;
                    }
                    $.ajax({
                        url: 'index.php?app=user&act=doLogin',
                        type: 'post',
                        data: {'email': email, 'password': password, 'returnUrl': returnUrl},
                        async: false, //默认为true 异步
                        error: function () {
                            alert('error');
                        },
                        success: function (data) {
                            var data = eval("(" + data + ")");
                            if (data.status == 1) {//用户名不存在需要注册！
                                $('#login_error').css('display', 'block');
                                $('#password_error').css('display', 'block');
                                window.location.href = data.info.url;
                            } else if (data.status == 0) {
                                $('#password_error').css('display', 'block');
                                $('#password_error').html(data.message);
                            } else {
                                layer.confirm('Account is used,Continue to log in？', {
                                    btn: ['yes', 'no'] //按钮
                                }, function () {
                                    layer.msg('yes', {icon: 1});
                                }, function () {
                                });
                            }
                        }
                    });
                })
            })
        </script>
        {/literal}

        {/if}
    </body>
</html>