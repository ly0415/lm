<!DOCTYPE html>
<html>
    <head>
        <title>{$langdata.cart_head_title}</title>
        <meta charset="utf-8" />
        {include file="public/header.html"}
        <style>
            .cart-itemtop .img{
                position:relative;
            }
            .product-modal{
                width:100%;
                height:20px;
                line-height:20px;
                text-align:center;
                background:rgba(0,0,0,0.5);
                color:#fff;
                position:absolute;
                left:0;
                bottom:0;

            }

        </style>
    </head>
    <body>
        <!-- header -->
        {include file="public/daohang.html"}
        <!-- navs-box end -->
        <div class="border"></div>

        <div class="container mycart-box">
            <div class="mt30 clearfix">
                <h1 class="normal font24 fl">{$langdata.cart_title}</h1>
                <div class="fr">
                    <a href="index.php?storeid={$store_id}&lang={$lang}&auxiliary={$auxiliary}" class="btn btn-next mr20">{$langdata.keeping_shopping}</a>
                    <!--<a href="##" class="btn btn-o">{$langdata.proceed_to_Checkout}</a>-->
                </div>
            </div>
            {if $cartInfo[0] == ''}
            <div class="payoptions">
                <div class="img">
                    <img src="{$STATIC_URL}/front/images/mycart.png" style="width: 300px; height: 300px">
                </div>
            </div>
            {else}
            <div class="title-box clearfix">
                <div class="fl it1">{$langdata.Item}</div>
                <!--<div class="fl it2">Shipping To: M4C 1B5 <a href="##" class="or uline ml15">Change</a></div>-->
                <div class="fl it2">{$langdata.Quantity}</div>
                <div class="fl it3 tr">{$langdata.Price}</div>
                <div class="fl it4 tr">{$langdata.total_price}</div>
                <div class="fl it5 tr">{$langdata.operation}</div>
            </div>
            <div class="cart-container delete-allbox">
                {foreach from=$cartInfo item=vo}
                {if $vo.invalid==1}
                <div class="cart-item">
                           <div class="cart-itemtop clearfix">
                        <div class="it1 fl">
                            <div class="img">
                                <a href="index.php?app=goods&act=goodInfo&storeid={$store_id}&lang={$lang}&auxiliary={$auxiliary}&gid={$vo.goods_id}"><img src="{$vo.original_img}"></a>
                                <div class="product-modal">失效</div>
                            </div>
                            <div class="cont">
                                <a href="index.php?app=goods&act=goodInfo&storeid={$store_id}&lang={$lang}&auxiliary={$auxiliary}&gid={$vo.goods_id}">
                                    <h2 class="font18 normal mt15 word">{$vo.goods_name}</h2>
                                    <p class="mt5">{$langdata.adopt} : {$vo.store_name}</p>
                                </a>
                                <!--                                <p class="mt5">Sku : {$vo.sku}</p>-->
                                <p class="mt10">{$langdata.indoor} : {$vo.spec_key_name}</p>
                                <p class="mt10">{$langdata.shipping_store} : {$vo.shipping_store}</p>

                            </div>
                        </div>
                        <!--<div class="it2 fl word">-->
                        <!--<input type="radio" class="mr15" /> Get it by Mon, Aug 28 – FREE  Ground-->
                        <!--</div>-->
                        <div class="it2 fl">
                            <div class="updown-box clearfix">
                                <span class="down fl">-</span>
                                <input type="hidden" value="{$vo.goods_price} "/>
                                <input type="text" class="num fl"  data_cart_id = '{$vo.id}' data_spec="{$vo.spec_key}" value="{$vo.goods_num}" data_good_id = "{$vo.goods_id}"  style="width:30px; ;" readonly />
                                <span class="up fl">+</span>
                            </div>
                            <!--<a href="##" class="or mt15 block">Save for Later</a>-->

                        </div>
                        <div class="it3 fl tr">
                            <span class="price red">{$symbol}{$vo.goods_price}</span>
                        </div>
                        <div class="it4 fl tr">
                            <span class="price red ">{$symbol}{$vo.totalMoney}</span>
                        </div>
                        <div class="it5 fl tr">
                            <a onclick="shanchu({$vo.id})" class="or block delete-table">{$langdata.remove}</a>
                        </div>
                    </div>
                    <!--<div class="service mt40">-->
                    <!--<p>Protect Your Purchase <a href="##" class="or ml15">Edit</a></p>-->
                    <!--<p class="mt5 plan">Purchase a Protection Plan for CAD $69.98</p>-->
                    <!--</div>-->
                </div>
                {else}
                <div class="cart-item">
                    <input type="checkbox" name='check-name' data_spec = "{$vo.spec_key}" value="{$vo.goods_id}"  data-status = '{$vo.selected}' cart_id = "{$vo.id}"class="check" onclick="getPrice()" {if $vo.selected ==1 } checked {/if}/>
                    <div class="cart-itemtop clearfix">
                        <div class="it1 fl">
                            <div class="img">
                                <a href="index.php?app=goods&act=goodInfo&storeid={$store_id}&lang={$lang}&auxiliary={$auxiliary}&gid={$vo.goods_id}"><img src="{$vo.original_img}"></a>

                            </div>
                            <div class="cont">
                                <a href="index.php?app=goods&act=goodInfo&storeid={$store_id}&lang={$lang}&auxiliary={$auxiliary}&gid={$vo.goods_id}">
                                    <h2 class="font18 normal mt15 word">{$vo.goods_name}</h2>
                                    <p class="mt5">{$langdata.adopt} : {$vo.store_name}</p>
                                </a>
                                <!--                                <p class="mt5">Sku : {$vo.sku}</p>-->
                                <p class="mt10">{$langdata.indoor} : {$vo.spec_key_name}</p>
                                <p class="mt10">{$langdata.shipping_store} : {$vo.shipping_store}</p>

                            </div>
                        </div>
                        <!--<div class="it2 fl word">-->
                        <!--<input type="radio" class="mr15" /> Get it by Mon, Aug 28 – FREE  Ground-->
                        <!--</div>-->
                        <div class="it2 fl">
                            <div class="updown-box clearfix">
                                <span class="down fl">-</span>
                                <input type="hidden" value="{$vo.goods_price} "/>
                                <input type="text" class="num fl"  data_cart_id = '{$vo.id}' data_spec="{$vo.spec_key}" value="{$vo.goods_num}" data_good_id = "{$vo.goods_id}"  style="width:30px; ;" readonly />
                                <span class="up fl">+</span>
                            </div>
                            <!--<a href="##" class="or mt15 block">Save for Later</a>-->

                        </div>
                        <div class="it3 fl tr">
                            <span class="price red">{$symbol}{$vo.goods_price}</span>
                        </div>
                        <div class="it4 fl tr">
                            <span class="price red ">{$symbol}{$vo.totalMoney}</span>
                        </div>
                        <div class="it5 fl tr">
                            <a onclick="shanchu({$vo.id})" class="or block delete-table">{$langdata.remove}</a>
                        </div>
                    </div>
                    <!--<div class="service mt40">-->
                    <!--<p>Protect Your Purchase <a href="##" class="or ml15">Edit</a></p>-->
                    <!--<p class="mt5 plan">Purchase a Protection Plan for CAD $69.98</p>-->
                    <!--</div>-->
                </div>

                {/if}
                {/foreach}
                <div class="all">
                    <span style="margin-left: 6px;"><input type="checkbox" id="all" />{$langdata.all_check}</span>
                    <a href="##" class="inblock ml30 or delete-all">{$langdata.delete_all}</a>
                </div>
            </div>
            <div class="clearfix mt40">
                <div class="leftbox fl">
                    <!--<div class="freebox">-->
                    <!--<p>{$langdata.worries}<br/>{$langdata.Return_goods}</p>               -->
                    <!--<a href="##" class="or font18">{$langdata.See}</a>-->
                    <!--</div>-->
                    <span class="btn btn-next mt20 phone"><i class="ico ico-ph"></i>{$langdata.Telephone} {$webconf.kefu_phone.value}</span>
                    <div class="infobox">
                        {$langdata.brief}
                    </div>
                </div>
                <div class="rightbox fr">
                    <div class="ordertotal">
                        <div class="clearfix mb15">
                            <span class="fl">{$langdata.subtotal}:</span>
                            <span class="fr red Ototal">{$symbol} 0.00</span>
                        </div>
                        <div class="border mt20 mb20"></div>
                        <div class="clearfix  mb15">
                            <span class="fl pt5">{$langdata.estimated_total}:</span>
                            <span class="fr font24 red total">{$symbol} 0.00</span>
                        </div>
                        <input type="hidden" name="store_id" value="{$store_id}"/>
                        <input type="hidden" name="lang_id" value="{$lang}"/>
                        <input type="hidden" name="auxiliary" value="{$auxiliary}"/>
                        <button class="btn btn-o mt30">{$langdata.proceed_to_Checkout}</button>
                        <!--					<div class="tc mt10">or</div>
                                                                <div class="tc mt10">
                                                                        <img src="{$STATIC_URL}/front/images/paypal.png" width="160" height="40">
                                                                </div>-->

                    </div>
                </div>
            </div>
            {/if}
            <input type="hidden" name="symbol" value="{$symbol}"/>
            <input type="hidden" name="order_from" value="1"/>
            <!-- paypal -->
            <div class="payoptions">
                <h2><span>{$langdata.Lately}</span></h2>
                <div class="img">
                    <img src="{$STATIC_URL}/front/images/zhifu.png">
                    <img src="{$STATIC_URL}/front/images/paypal.png">
                    <img src="{$STATIC_URL}/front/images/weixin.png">
                </div>
            </div>
        </div>

        {include file="public/footer.html"}
        {if $lang_id == 'ZH'}
        {literal}
        <script type="text/javascript">
            /*直接购买*/
            $('.btn-o').click(function () {
                var arr = [];
                var store_id = $('input[name=store_id]').val();
                var lang_id = $('input[name=lang_id]').val();
                var auxiliary = $('input[name=auxiliary]').val();
                var order_from = $('input[name=order_from]').val();
                $("input[name='check-name']").each(function () {
                    if ($(this).is(':checked')) {
                        arr.push($(this).attr('cart_id'));
                    }
                });
                if (arr.length == 0) {
                    layer.alert('请勾选商品，进行结算', {
                        icon: 2,
                        btn: false,
                        title: false,
                        closeBtn: 0,
                        time: 2000,
                        skin: 'alt-layer'
                    });
                    return false;
                } else {
                    item_id = arr.join(',');
                    window.location.href = "index.php?app=comfirmOrder&act=index&storeid=" + store_id + "&lang=" + lang_id + "&auxiliary=" + auxiliary + "&item_id=" + arr;
                }

            });
        </script>
        <script type="text/javascript">
            /*删除*/
            function shanchu(id) {
                deletes('?app=cart&act=dele&id=' + id);
            }
        </script>
        {/literal}
        {else}
        {literal}
        <script type="text/javascript">
            /*直接购买*/
            $('.btn-o').click(function () {
                var arr = [];
                var store_id = $('input[name=store_id]').val();
                var lang_id = $('input[name=lang_id]').val();
                var order_from = $('input[name=order_from]').val();
                var auxiliary = $('input[name=auxiliary]').val();
                $("input[name='check-name']").each(function () {
                    if ($(this).is(':checked')) {
                        arr.push($(this).attr('cart_id'));
                    }
                });
                if (arr.length == 0) {
                    layer.alert('Please check the goods and settle the settlement', {
                        icon: 2,
                        btn: false,
                        title: false,
                        closeBtn: 0,
                        time: 2000,
                        skin: 'alt-layer'
                    });
                    return false;
                } else {
                    item_id = arr.join(',');
                    window.location.href = "index.php?app=comfirmOrder&act=index&storeid=" + store_id + "&lang=" + lang_id + "&auxiliary=" + auxiliary + "&item_id=" + arr;
                }

            });
        </script>
        <script type="text/javascript">
            /*删除*/
            function shanchu(id) {
                deletes_en('?app=cart&act=dele&id=' + id);
            }
        </script>
        {/literal}
        {/if}
        {literal}
        <script type="text/javascript">
            //开始判断商品的选中状态
            $(function () {
                allchk();
                getPrice();
            });
            // 点击不是全选的按钮，总价格变化。
            function getPrice() {
                var store_id = $('input[name=store_id]').val();
                var arr = [];
                var symbol = $('input[name=symbol]').val();
                //alert($(obj).attr('data_spec'));
                $("input[name='check-name']").each(function () {
                    if ($(this).is(':checked')) {
                        //var item_id = $(this).attr('data_spec');
//                  var goods_id = $(this).val();
//                  if(goods_id.length ==0){
//                      goods_id =0;
//				  }
                        var cart_ids = $(this).attr('cart_id');  // 获取选中的购物车ID 唯一的。
                        //var selected =$(this).attr('data-status');
                        // var item_ids  = goods_id+','+item_id+','+selected;
//                  var item_ids  = goods_id+','+item_id;
                        arr.push(cart_ids);
                    }
                });
                console.log(arr);
//          return false;
                $.ajax({
                    url: 'index.php?app=cart&act=getMoney',
                    type: 'post',
                    data: {'cart_ids': arr, 'store_id': store_id},
                    async: false, //默认为true 异步
                    error: function () {
                        alert('error');
                    },
                    success: function (data) {
                        var data = eval("(" + data + ")");
                        if (data.status == 1) {
                            var total = symbol + data.info.total;
                            $('.total').html(total);
                            $('.Ototal').html(total);
                        } else {
                            var total = symbol + data.info.total;
                            $('.total').html(total);
                            $('.Ototal').html(total);
                        }
                    }
                });

            }
        </script>

        <script type="text/javascript">
            //全选价格
            $('body').on('click', '#all', function () {
                //实现全选反选功能
                var checkbox_all = $('input[type=checkbox]');
                var store_id = $('input[name=store_id]').val();
                var symbol = $('input[name=symbol]').val();
                if (this.checked == true) {
                    for (var i = 0, l = checkbox_all.length; i < l; i++) {
                        checkbox_all[i].checked = true;
                        var flag = 1;
                        $.ajax({
                            url: 'index.php?app=cart&act=getTotalMoney',
                            type: 'post',
                            data: {'flag': flag, 'store_id': store_id},
                            async: false, //默认为true 异步
                            error: function () {
                                alert('error');
                            },
                            success: function (data) {
                                var data = eval("(" + data + ")");
                                if (data.status == 1) {
                                    var total = symbol + data.info.total;
                                    $('.total').html(total);
                                    $('.Ototal').html(total);
                                } else {
                                    var total = symbol + data.info.total;
                                    $('.total').html(total);
                                    $('.Ototal').html(total);
                                }
                            }
                        });
                    }
                } else {
                    for (var i = 0, l = checkbox_all.length; i < l; i++) {
                        checkbox_all[i].checked = false;
                        var flag = 0;
                        $.ajax({
                            url: 'index.php?app=cart&act=getTotalMoney',
                            type: 'post',
                            data: {'flag': flag, 'store_id': store_id},
                            async: false, //默认为true 异步
                            error: function () {
                                alert('error');
                            },
                            success: function (data) {
                                var data = eval("(" + data + ")");
                                if (data.status == 1) {
                                    var total = symbol + data.info.total;
                                    $('.total').html(total);
                                    $('.Ototal').html(total);
                                } else {

                                    var total = symbol + data.info.total;
                                    $('.total').html(total);
                                    $('.Ototal').html(total);
                                }
                            }
                        });
                    }
                }
            });
        </script>

        <script type="text/javascript">
            $(function () {
                //库存的增加和减少
                $(document).on("click", '.updown-box .up', function (e) {
                    var symbol = $('input[name=symbol]').val();
                    //var num = $('.updown-box .num').val();
                    var store_id = $('input[name=store_id]').val();
                    var num = $(this).prev().val();
                    var price = $(this).prev().prev().val();
                    $(this).prev().val(parseInt(num) + 1);
                    var real_num = $(this).prev().val();
                    var price_html = (real_num * price);
                    price_html = symbol + price_html.toFixed(2);
                    $(this).parent().parent().next().next().find('span').html(price_html);
                    //            var goods_id = $(this).prev().attr('data_good_id');
                    //            var item_id = $(this).prev().attr('data_spec');
                    var cart_id = $(this).prev().attr('data_cart_id');
                    var prom_id = 0;
                    $.ajax({
                        url: 'index.php?app=cart&act=doChangeNum',
                        type: 'post',
                        data: {'cart_id': cart_id, 'goods_num': real_num, 'prom_id': prom_id, 'store_id': store_id},
                        async: false, //默认为true 异步
                        error: function () {
                            alert('error');
                        },
                        success: function (data) {
                            var data = eval("(" + data + ")");
                            if (data.status == 1) {//用户名不存在需要注册！
                                var total = symbol + data.total;
                                $('.total').html(total);
                                $('.Ototal').html(total);
                            }
                        }
                    });
                });
                // $('.updown-box .down').click(function(){
                $(document).on("click", '.updown-box .down', function (e) {
                    var symbol = $('input[name=symbol]').val();
                    var store_id = $('input[name=store_id]').val();
                    var num = $(this).next().next().val();
                    if (num == 1) {
                        return false;
                    } else {
                        $(this).next().next().val(parseInt(num) - 1);
                        var price = $(this).next().val();
                        var num = $(this).next().next().val();
                        var price_html = (price * num);
                        price_html = symbol + price_html.toFixed(2);
                        $(this).parent().parent().next().next().find('span').html(price_html);
                        var cart_id = $(this).next().next().attr('data_cart_id');
                        var prom_id = 0;
                        $.ajax({
                            url: 'index.php?app=cart&act=doChangeNum',
                            type: 'post',
                            data: {'cart_id': cart_id, 'goods_num': num, 'prom_id': prom_id, 'store_id': store_id},
                            async: false, //默认为true 异步
                            error: function () {
                                alert('error');
                            },
                            success: function (data) {
                                var data = eval("(" + data + ")");
                                ;
                                if (data.status == 1) {//用户名不存在需要注册！
                                    var total = symbol + data.total;
                                    $('.total').html(total);
                                    $('.Ototal').html(total);
                                }
                            }
                        });
                    }
                })
            })
        </script>
        {/literal}
    </body>
</html>